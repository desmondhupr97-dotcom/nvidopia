const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CFtQHdc-.js","assets/recharts-B76czZoA.js","assets/antd-CWUbQNRl.js"])))=>i.map(i=>d[i]);
var Or=Object.defineProperty;var Ma=t=>{throw TypeError(t)};var Dr=(t,s,n)=>s in t?Or(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var Na=(t,s,n)=>Dr(t,typeof s!="symbol"?s+"":s,n),kn=(t,s,n)=>s.has(t)||Ma("Cannot "+n);var f=(t,s,n)=>(kn(t,s,"read from private field"),n?n.call(t):s.get(t)),D=(t,s,n)=>s.has(t)?Ma("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,n),A=(t,s,n,a)=>(kn(t,s,"write to private field"),a?a.call(t,n):s.set(t,n),n),H=(t,s,n)=>(kn(t,s,"access private method"),n);var Us=(t,s,n,a)=>({set _(i){A(t,s,i,n)},get _(){return f(t,s,a)}});import{r as d,D as Lr,A as Br,L as $r,B as qr,F as L,d as z,e as At,f as fe,C as q,S as Z,I as Y,h as fn,i as V,j as ea,k as Ri,l as Pi,E as ce,m as ve,M as $e,n as Ts,T as Ee,o as K,P as ta,s as ie,p as Ke,q as Kr,t as sa,u as U,v as ae,w as es,x as gn,y as Wr,z as Ei,G as Ur,H as Vr,J as ts,K as Hr,N as Cn,O as en,Q as Qr,U as Ai,V as Gr,W as an,X as zi,Y as En,Z as Jr,_ as Oa,$ as Mi,a0 as Zt,a1 as _n,a2 as Yr,a3 as Xr,a4 as Da,a5 as Zr,a6 as el,a7 as tl,a8 as sl,a9 as nl}from"./antd-CWUbQNRl.js";import{R as zt,L as Ni,C as Xt,X as yt,Y as Je,T as Me,a as it,b as na,B as Rs,c as mt,d as fs,e as al,f as il,P as rl,g as ll,h as ol,i as cl,j as yn,k as xn,S as dl,l as ul,A as Oi,m as An,n as hl}from"./recharts-B76czZoA.js";import{M as aa,T as ia,P as Ps,a as ra,b as la,C as zn,c as rn,u as pl,L as gs,d as ml}from"./maps-l1jNUUUg.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();var wn={exports:{}},ws={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var La;function fl(){if(La)return ws;La=1;var t=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function n(a,i,r){var l=null;if(r!==void 0&&(l=""+r),i.key!==void 0&&(l=""+i.key),"key"in i){r={};for(var o in i)o!=="key"&&(r[o]=i[o])}else r=i;return i=r.ref,{$$typeof:t,type:a,key:l,ref:i!==void 0?i:null,props:r}}return ws.Fragment=s,ws.jsx=n,ws.jsxs=n,ws}var Ba;function gl(){return Ba||(Ba=1,wn.exports=fl()),wn.exports}var e=gl();/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var $a="popstate";function yl(t={}){function s(a,i){let{pathname:r,search:l,hash:o}=a.location;return Mn("",{pathname:r,search:l,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(a,i){return typeof i=="string"?i:Es(i)}return vl(s,n,null,t)}function ue(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function Ye(t,s){if(!t){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function xl(){return Math.random().toString(36).substring(2,10)}function qa(t,s){return{usr:t.state,key:t.key,idx:s}}function Mn(t,s,n=null,a){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof s=="string"?xs(s):s,state:n,key:s&&s.key||a||xl()}}function Es({pathname:t="/",search:s="",hash:n=""}){return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function xs(t){let s={};if(t){let n=t.indexOf("#");n>=0&&(s.hash=t.substring(n),t=t.substring(0,n));let a=t.indexOf("?");a>=0&&(s.search=t.substring(a),t=t.substring(0,a)),t&&(s.pathname=t)}return s}function vl(t,s,n,a={}){let{window:i=document.defaultView,v5Compat:r=!1}=a,l=i.history,o="POP",p=null,h=u();h==null&&(h=0,l.replaceState({...l.state,idx:h},""));function u(){return(l.state||{idx:null}).idx}function c(){o="POP";let v=u(),b=v==null?null:v-h;h=v,p&&p({action:o,location:x.location,delta:b})}function g(v,b){o="PUSH";let w=Mn(x.location,v,b);h=u()+1;let _=qa(w,h),j=x.createHref(w);try{l.pushState(_,"",j)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;i.location.assign(j)}r&&p&&p({action:o,location:x.location,delta:1})}function m(v,b){o="REPLACE";let w=Mn(x.location,v,b);h=u();let _=qa(w,h),j=x.createHref(w);l.replaceState(_,"",j),r&&p&&p({action:o,location:x.location,delta:0})}function k(v){return jl(v)}let x={get action(){return o},get location(){return t(i,l)},listen(v){if(p)throw new Error("A history only accepts one active listener");return i.addEventListener($a,c),p=v,()=>{i.removeEventListener($a,c),p=null}},createHref(v){return s(i,v)},createURL:k,encodeLocation(v){let b=k(v);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:g,replace:m,go(v){return l.go(v)}};return x}function jl(t,s=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),ue(n,"No window.location.(origin|href) available to create URL");let a=typeof t=="string"?t:Es(t);return a=a.replace(/ $/,"%20"),!s&&a.startsWith("//")&&(a=n+a),new URL(a,n)}function Di(t,s,n="/"){return bl(t,s,n,!1)}function bl(t,s,n,a){let i=typeof s=="string"?xs(s):s,r=xt(i.pathname||"/",n);if(r==null)return null;let l=Li(t);Sl(l);let o=null;for(let p=0;o==null&&p<l.length;++p){let h=Al(r);o=Pl(l[p],h,a)}return o}function Li(t,s=[],n=[],a="",i=!1){let r=(l,o,p=i,h)=>{let u={relativePath:h===void 0?l.path||"":h,caseSensitive:l.caseSensitive===!0,childrenIndex:o,route:l};if(u.relativePath.startsWith("/")){if(!u.relativePath.startsWith(a)&&p)return;ue(u.relativePath.startsWith(a),`Absolute route path "${u.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(a.length)}let c=ft([a,u.relativePath]),g=n.concat(u);l.children&&l.children.length>0&&(ue(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${c}".`),Li(l.children,s,g,c,p)),!(l.path==null&&!l.index)&&s.push({path:c,score:Tl(c,l.index),routesMeta:g})};return t.forEach((l,o)=>{var p;if(l.path===""||!((p=l.path)!=null&&p.includes("?")))r(l,o);else for(let h of Bi(l.path))r(l,o,!0,h)}),s}function Bi(t){let s=t.split("/");if(s.length===0)return[];let[n,...a]=s,i=n.endsWith("?"),r=n.replace(/\?$/,"");if(a.length===0)return i?[r,""]:[r];let l=Bi(a.join("/")),o=[];return o.push(...l.map(p=>p===""?r:[r,p].join("/"))),i&&o.push(...l),o.map(p=>t.startsWith("/")&&p===""?"/":p)}function Sl(t){t.sort((s,n)=>s.score!==n.score?n.score-s.score:Rl(s.routesMeta.map(a=>a.childrenIndex),n.routesMeta.map(a=>a.childrenIndex)))}var kl=/^:[\w-]+$/,Cl=3,_l=2,wl=1,Fl=10,Il=-2,Ka=t=>t==="*";function Tl(t,s){let n=t.split("/"),a=n.length;return n.some(Ka)&&(a+=Il),s&&(a+=_l),n.filter(i=>!Ka(i)).reduce((i,r)=>i+(kl.test(r)?Cl:r===""?wl:Fl),a)}function Rl(t,s){return t.length===s.length&&t.slice(0,-1).every((a,i)=>a===s[i])?t[t.length-1]-s[s.length-1]:0}function Pl(t,s,n=!1){let{routesMeta:a}=t,i={},r="/",l=[];for(let o=0;o<a.length;++o){let p=a[o],h=o===a.length-1,u=r==="/"?s:s.slice(r.length)||"/",c=ln({path:p.relativePath,caseSensitive:p.caseSensitive,end:h},u),g=p.route;if(!c&&h&&n&&!a[a.length-1].route.index&&(c=ln({path:p.relativePath,caseSensitive:p.caseSensitive,end:!1},u)),!c)return null;Object.assign(i,c.params),l.push({params:i,pathname:ft([r,c.pathname]),pathnameBase:Ol(ft([r,c.pathnameBase])),route:g}),c.pathnameBase!=="/"&&(r=ft([r,c.pathnameBase]))}return l}function ln(t,s){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,a]=El(t.path,t.caseSensitive,t.end),i=s.match(n);if(!i)return null;let r=i[0],l=r.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:a.reduce((h,{paramName:u,isOptional:c},g)=>{if(u==="*"){let k=o[g]||"";l=r.slice(0,r.length-k.length).replace(/(.)\/+$/,"$1")}const m=o[g];return c&&!m?h[u]=void 0:h[u]=(m||"").replace(/%2F/g,"/"),h},{}),pathname:r,pathnameBase:l,pattern:t}}function El(t,s=!1,n=!0){Ye(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let a=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,o,p)=>(a.push({paramName:o,isOptional:p!=null}),p?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(a.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,s?void 0:"i"),a]}function Al(t){try{return t.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return Ye(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${s}).`),t}}function xt(t,s){if(s==="/")return t;if(!t.toLowerCase().startsWith(s.toLowerCase()))return null;let n=s.endsWith("/")?s.length-1:s.length,a=t.charAt(n);return a&&a!=="/"?null:t.slice(n)||"/"}var zl=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function Ml(t,s="/"){let{pathname:n,search:a="",hash:i=""}=typeof t=="string"?xs(t):t,r;return n?(n=n.replace(/\/\/+/g,"/"),n.startsWith("/")?r=Wa(n.substring(1),"/"):r=Wa(n,s)):r=s,{pathname:r,search:Dl(a),hash:Ll(i)}}function Wa(t,s){let n=s.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Fn(t,s,n,a){return`Cannot include a '${t}' character in a manually specified \`to.${s}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Nl(t){return t.filter((s,n)=>n===0||s.route.path&&s.route.path.length>0)}function oa(t){let s=Nl(t);return s.map((n,a)=>a===s.length-1?n.pathname:n.pathnameBase)}function ca(t,s,n,a=!1){let i;typeof t=="string"?i=xs(t):(i={...t},ue(!i.pathname||!i.pathname.includes("?"),Fn("?","pathname","search",i)),ue(!i.pathname||!i.pathname.includes("#"),Fn("#","pathname","hash",i)),ue(!i.search||!i.search.includes("#"),Fn("#","search","hash",i)));let r=t===""||i.pathname==="",l=r?"/":i.pathname,o;if(l==null)o=n;else{let c=s.length-1;if(!a&&l.startsWith("..")){let g=l.split("/");for(;g[0]==="..";)g.shift(),c-=1;i.pathname=g.join("/")}o=c>=0?s[c]:"/"}let p=Ml(i,o),h=l&&l!=="/"&&l.endsWith("/"),u=(r||l===".")&&n.endsWith("/");return!p.pathname.endsWith("/")&&(h||u)&&(p.pathname+="/"),p}var ft=t=>t.join("/").replace(/\/\/+/g,"/"),Ol=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Dl=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Ll=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,Bl=class{constructor(t,s,n,a=!1){this.status=t,this.statusText=s||"",this.internal=a,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function $l(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function ql(t){return t.map(s=>s.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var $i=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function qi(t,s){let n=t;if(typeof n!="string"||!zl.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let a=n,i=!1;if($i)try{let r=new URL(window.location.href),l=n.startsWith("//")?new URL(r.protocol+n):new URL(n),o=xt(l.pathname,s);l.origin===r.origin&&o!=null?n=o+l.search+l.hash:i=!0}catch{Ye(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:a,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Ki=["POST","PUT","PATCH","DELETE"];new Set(Ki);var Kl=["GET",...Ki];new Set(Kl);var vs=d.createContext(null);vs.displayName="DataRouter";var vn=d.createContext(null);vn.displayName="DataRouterState";var Wl=d.createContext(!1),Wi=d.createContext({isTransitioning:!1});Wi.displayName="ViewTransition";var Ul=d.createContext(new Map);Ul.displayName="Fetchers";var Vl=d.createContext(null);Vl.displayName="Await";var Oe=d.createContext(null);Oe.displayName="Navigation";var Bs=d.createContext(null);Bs.displayName="Location";var We=d.createContext({outlet:null,matches:[],isDataRoute:!1});We.displayName="Route";var da=d.createContext(null);da.displayName="RouteError";var Ui="REACT_ROUTER_ERROR",Hl="REDIRECT",Ql="ROUTE_ERROR_RESPONSE";function Gl(t){if(t.startsWith(`${Ui}:${Hl}:{`))try{let s=JSON.parse(t.slice(28));if(typeof s=="object"&&s&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.location=="string"&&typeof s.reloadDocument=="boolean"&&typeof s.replace=="boolean")return s}catch{}}function Jl(t){if(t.startsWith(`${Ui}:${Ql}:{`))try{let s=JSON.parse(t.slice(40));if(typeof s=="object"&&s&&typeof s.status=="number"&&typeof s.statusText=="string")return new Bl(s.status,s.statusText,s.data)}catch{}}function Yl(t,{relative:s}={}){ue(js(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:a}=d.useContext(Oe),{hash:i,pathname:r,search:l}=$s(t,{relative:s}),o=r;return n!=="/"&&(o=r==="/"?n:ft([n,r])),a.createHref({pathname:o,search:l,hash:i})}function js(){return d.useContext(Bs)!=null}function Ze(){return ue(js(),"useLocation() may be used only in the context of a <Router> component."),d.useContext(Bs).location}var Vi="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Hi(t){d.useContext(Oe).static||d.useLayoutEffect(t)}function Nt(){let{isDataRoute:t}=d.useContext(We);return t?po():Xl()}function Xl(){ue(js(),"useNavigate() may be used only in the context of a <Router> component.");let t=d.useContext(vs),{basename:s,navigator:n}=d.useContext(Oe),{matches:a}=d.useContext(We),{pathname:i}=Ze(),r=JSON.stringify(oa(a)),l=d.useRef(!1);return Hi(()=>{l.current=!0}),d.useCallback((p,h={})=>{if(Ye(l.current,Vi),!l.current)return;if(typeof p=="number"){n.go(p);return}let u=ca(p,JSON.parse(r),i,h.relative==="path");t==null&&s!=="/"&&(u.pathname=u.pathname==="/"?s:ft([s,u.pathname])),(h.replace?n.replace:n.push)(u,h.state,h)},[s,n,r,i,t])}var Zl=d.createContext(null);function eo(t){let s=d.useContext(We).outlet;return d.useMemo(()=>s&&d.createElement(Zl.Provider,{value:t},s),[s,t])}function bs(){let{matches:t}=d.useContext(We),s=t[t.length-1];return s?s.params:{}}function $s(t,{relative:s}={}){let{matches:n}=d.useContext(We),{pathname:a}=Ze(),i=JSON.stringify(oa(n));return d.useMemo(()=>ca(t,JSON.parse(i),a,s==="path"),[t,i,a,s])}function to(t,s){return Qi(t,s)}function Qi(t,s,n,a,i){var w;ue(js(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=d.useContext(Oe),{matches:l}=d.useContext(We),o=l[l.length-1],p=o?o.params:{},h=o?o.pathname:"/",u=o?o.pathnameBase:"/",c=o&&o.route;{let _=c&&c.path||"";Ji(h,!c||_.endsWith("*")||_.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${_}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_}"> to <Route path="${_==="/"?"*":`${_}/*`}">.`)}let g=Ze(),m;if(s){let _=typeof s=="string"?xs(s):s;ue(u==="/"||((w=_.pathname)==null?void 0:w.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${_.pathname}" was given in the \`location\` prop.`),m=_}else m=g;let k=m.pathname||"/",x=k;if(u!=="/"){let _=u.replace(/^\//,"").split("/");x="/"+k.replace(/^\//,"").split("/").slice(_.length).join("/")}let v=Di(t,{pathname:x});Ye(c||v!=null,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),Ye(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let b=ro(v&&v.map(_=>Object.assign({},_,{params:Object.assign({},p,_.params),pathname:ft([u,r.encodeLocation?r.encodeLocation(_.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?u:ft([u,r.encodeLocation?r.encodeLocation(_.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_.pathnameBase])})),l,n,a,i);return s&&b?d.createElement(Bs.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...m},navigationType:"POP"}},b):b}function so(){let t=ho(),s=$l(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,a="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:a},r={padding:"2px 4px",backgroundColor:a},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=d.createElement(d.Fragment,null,d.createElement("p",null,"ðŸ’¿ Hey developer ðŸ‘‹"),d.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",d.createElement("code",{style:r},"ErrorBoundary")," or"," ",d.createElement("code",{style:r},"errorElement")," prop on your route.")),d.createElement(d.Fragment,null,d.createElement("h2",null,"Unexpected Application Error!"),d.createElement("h3",{style:{fontStyle:"italic"}},s),n?d.createElement("pre",{style:i},n):null,l)}var no=d.createElement(so,null),Gi=class extends d.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,s){return s.location!==t.location||s.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:s.error,location:s.location,revalidation:t.revalidation||s.revalidation}}componentDidCatch(t,s){this.props.onError?this.props.onError(t,s):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=Jl(t.digest);n&&(t=n)}let s=t!==void 0?d.createElement(We.Provider,{value:this.props.routeContext},d.createElement(da.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?d.createElement(ao,{error:t},s):s}};Gi.contextType=Wl;var In=new WeakMap;function ao({children:t,error:s}){let{basename:n}=d.useContext(Oe);if(typeof s=="object"&&s&&"digest"in s&&typeof s.digest=="string"){let a=Gl(s.digest);if(a){let i=In.get(s);if(i)throw i;let r=qi(a.location,n);if($i&&!In.get(s))if(r.isExternal||a.reloadDocument)window.location.href=r.absoluteURL||r.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(r.to,{replace:a.replace}));throw In.set(s,l),l}return d.createElement("meta",{httpEquiv:"refresh",content:`0;url=${r.absoluteURL||r.to}`})}}return t}function io({routeContext:t,match:s,children:n}){let a=d.useContext(vs);return a&&a.static&&a.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=s.route.id),d.createElement(We.Provider,{value:t},n)}function ro(t,s=[],n=null,a=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(s.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let r=t,l=n==null?void 0:n.errors;if(l!=null){let u=r.findIndex(c=>c.route.id&&(l==null?void 0:l[c.route.id])!==void 0);ue(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),r=r.slice(0,Math.min(r.length,u+1))}let o=!1,p=-1;if(n)for(let u=0;u<r.length;u++){let c=r[u];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(p=u),c.route.id){let{loaderData:g,errors:m}=n,k=c.route.loader&&!g.hasOwnProperty(c.route.id)&&(!m||m[c.route.id]===void 0);if(c.route.lazy||k){o=!0,p>=0?r=r.slice(0,p+1):r=[r[0]];break}}}let h=n&&a?(u,c)=>{var g,m;a(u,{location:n.location,params:((m=(g=n.matches)==null?void 0:g[0])==null?void 0:m.params)??{},unstable_pattern:ql(n.matches),errorInfo:c})}:void 0;return r.reduceRight((u,c,g)=>{let m,k=!1,x=null,v=null;n&&(m=l&&c.route.id?l[c.route.id]:void 0,x=c.route.errorElement||no,o&&(p<0&&g===0?(Ji("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),k=!0,v=null):p===g&&(k=!0,v=c.route.hydrateFallbackElement||null)));let b=s.concat(r.slice(0,g+1)),w=()=>{let _;return m?_=x:k?_=v:c.route.Component?_=d.createElement(c.route.Component,null):c.route.element?_=c.route.element:_=u,d.createElement(io,{match:c,routeContext:{outlet:u,matches:b,isDataRoute:n!=null},children:_})};return n&&(c.route.ErrorBoundary||c.route.errorElement||g===0)?d.createElement(Gi,{location:n.location,revalidation:n.revalidation,component:x,error:m,children:w(),routeContext:{outlet:null,matches:b,isDataRoute:!0},onError:h}):w()},null)}function ua(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function lo(t){let s=d.useContext(vs);return ue(s,ua(t)),s}function oo(t){let s=d.useContext(vn);return ue(s,ua(t)),s}function co(t){let s=d.useContext(We);return ue(s,ua(t)),s}function ha(t){let s=co(t),n=s.matches[s.matches.length-1];return ue(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function uo(){return ha("useRouteId")}function ho(){var a;let t=d.useContext(da),s=oo("useRouteError"),n=ha("useRouteError");return t!==void 0?t:(a=s.errors)==null?void 0:a[n]}function po(){let{router:t}=lo("useNavigate"),s=ha("useNavigate"),n=d.useRef(!1);return Hi(()=>{n.current=!0}),d.useCallback(async(i,r={})=>{Ye(n.current,Vi),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:s,...r}))},[t,s])}var Ua={};function Ji(t,s,n){!s&&!Ua[t]&&(Ua[t]=!0,Ye(!1,n))}d.memo(mo);function mo({routes:t,future:s,state:n,onError:a}){return Qi(t,void 0,n,a,s)}function Va({to:t,replace:s,state:n,relative:a}){ue(js(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=d.useContext(Oe);Ye(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:r}=d.useContext(We),{pathname:l}=Ze(),o=Nt(),p=ca(t,oa(r),l,a==="path"),h=JSON.stringify(p);return d.useEffect(()=>{o(JSON.parse(h),{replace:s,state:n,relative:a})},[o,h,a,s,n]),null}function fo(t){return eo(t.context)}function he(t){ue(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function go({basename:t="/",children:s=null,location:n,navigationType:a="POP",navigator:i,static:r=!1,unstable_useTransitions:l}){ue(!js(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),p=d.useMemo(()=>({basename:o,navigator:i,static:r,unstable_useTransitions:l,future:{}}),[o,i,r,l]);typeof n=="string"&&(n=xs(n));let{pathname:h="/",search:u="",hash:c="",state:g=null,key:m="default"}=n,k=d.useMemo(()=>{let x=xt(h,o);return x==null?null:{location:{pathname:x,search:u,hash:c,state:g,key:m},navigationType:a}},[o,h,u,c,g,m,a]);return Ye(k!=null,`<Router basename="${o}"> is not able to match the URL "${h}${u}${c}" because it does not start with the basename, so the <Router> won't render anything.`),k==null?null:d.createElement(Oe.Provider,{value:p},d.createElement(Bs.Provider,{children:s,value:k}))}function yo({children:t,location:s}){return to(Nn(t),s)}function Nn(t,s=[]){let n=[];return d.Children.forEach(t,(a,i)=>{if(!d.isValidElement(a))return;let r=[...s,i];if(a.type===d.Fragment){n.push.apply(n,Nn(a.props.children,r));return}ue(a.type===he,`[${typeof a.type=="string"?a.type:a.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ue(!a.props.index||!a.props.children,"An index route cannot have child routes.");let l={id:a.props.id||r.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,middleware:a.props.middleware,loader:a.props.loader,action:a.props.action,hydrateFallbackElement:a.props.hydrateFallbackElement,HydrateFallback:a.props.HydrateFallback,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.hasErrorBoundary===!0||a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(l.children=Nn(a.props.children,r)),n.push(l)}),n}var tn="get",sn="application/x-www-form-urlencoded";function jn(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function xo(t){return jn(t)&&t.tagName.toLowerCase()==="button"}function vo(t){return jn(t)&&t.tagName.toLowerCase()==="form"}function jo(t){return jn(t)&&t.tagName.toLowerCase()==="input"}function bo(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function So(t,s){return t.button===0&&(!s||s==="_self")&&!bo(t)}var Vs=null;function ko(){if(Vs===null)try{new FormData(document.createElement("form"),0),Vs=!1}catch{Vs=!0}return Vs}var Co=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Tn(t){return t!=null&&!Co.has(t)?(Ye(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${sn}"`),null):t}function _o(t,s){let n,a,i,r,l;if(vo(t)){let o=t.getAttribute("action");a=o?xt(o,s):null,n=t.getAttribute("method")||tn,i=Tn(t.getAttribute("enctype"))||sn,r=new FormData(t)}else if(xo(t)||jo(t)&&(t.type==="submit"||t.type==="image")){let o=t.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let p=t.getAttribute("formaction")||o.getAttribute("action");if(a=p?xt(p,s):null,n=t.getAttribute("formmethod")||o.getAttribute("method")||tn,i=Tn(t.getAttribute("formenctype"))||Tn(o.getAttribute("enctype"))||sn,r=new FormData(o,t),!ko()){let{name:h,type:u,value:c}=t;if(u==="image"){let g=h?`${h}.`:"";r.append(`${g}x`,"0"),r.append(`${g}y`,"0")}else h&&r.append(h,c)}}else{if(jn(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=tn,a=null,i=sn,l=t}return r&&i==="text/plain"&&(l=r,r=void 0),{action:a,method:n.toLowerCase(),encType:i,formData:r,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function pa(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function wo(t,s,n,a){let i=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n?i.pathname.endsWith("/")?i.pathname=`${i.pathname}_.${a}`:i.pathname=`${i.pathname}.${a}`:i.pathname==="/"?i.pathname=`_root.${a}`:s&&xt(i.pathname,s)==="/"?i.pathname=`${s.replace(/\/$/,"")}/_root.${a}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${a}`,i}async function Fo(t,s){if(t.id in s)return s[t.id];try{let n=await import(t.module);return s[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Io(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function To(t,s,n){let a=await Promise.all(t.map(async i=>{let r=s.routes[i.route.id];if(r){let l=await Fo(r,n);return l.links?l.links():[]}return[]}));return Ao(a.flat(1).filter(Io).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Ha(t,s,n,a,i,r){let l=(p,h)=>n[h]?p.route.id!==n[h].route.id:!0,o=(p,h)=>{var u;return n[h].pathname!==p.pathname||((u=n[h].route.path)==null?void 0:u.endsWith("*"))&&n[h].params["*"]!==p.params["*"]};return r==="assets"?s.filter((p,h)=>l(p,h)||o(p,h)):r==="data"?s.filter((p,h)=>{var c;let u=a.routes[p.route.id];if(!u||!u.hasLoader)return!1;if(l(p,h)||o(p,h))return!0;if(p.route.shouldRevalidate){let g=p.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((c=n[0])==null?void 0:c.params)||{},nextUrl:new URL(t,window.origin),nextParams:p.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function Ro(t,s,{includeHydrateFallback:n}={}){return Po(t.map(a=>{let i=s.routes[a.route.id];if(!i)return[];let r=[i.module];return i.clientActionModule&&(r=r.concat(i.clientActionModule)),i.clientLoaderModule&&(r=r.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(r=r.concat(i.hydrateFallbackModule)),i.imports&&(r=r.concat(i.imports)),r}).flat(1))}function Po(t){return[...new Set(t)]}function Eo(t){let s={},n=Object.keys(t).sort();for(let a of n)s[a]=t[a];return s}function Ao(t,s){let n=new Set;return new Set(s),t.reduce((a,i)=>{let r=JSON.stringify(Eo(i));return n.has(r)||(n.add(r),a.push({key:r,link:i})),a},[])}function Yi(){let t=d.useContext(vs);return pa(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function zo(){let t=d.useContext(vn);return pa(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var ma=d.createContext(void 0);ma.displayName="FrameworkContext";function Xi(){let t=d.useContext(ma);return pa(t,"You must render this element inside a <HydratedRouter> element"),t}function Mo(t,s){let n=d.useContext(ma),[a,i]=d.useState(!1),[r,l]=d.useState(!1),{onFocus:o,onBlur:p,onMouseEnter:h,onMouseLeave:u,onTouchStart:c}=s,g=d.useRef(null);d.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let x=b=>{b.forEach(w=>{l(w.isIntersecting)})},v=new IntersectionObserver(x,{threshold:.5});return g.current&&v.observe(g.current),()=>{v.disconnect()}}},[t]),d.useEffect(()=>{if(a){let x=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(x)}}},[a]);let m=()=>{i(!0)},k=()=>{i(!1),l(!1)};return n?t!=="intent"?[r,g,{}]:[r,g,{onFocus:Fs(o,m),onBlur:Fs(p,k),onMouseEnter:Fs(h,m),onMouseLeave:Fs(u,k),onTouchStart:Fs(c,m)}]:[!1,g,{}]}function Fs(t,s){return n=>{t&&t(n),n.defaultPrevented||s(n)}}function No({page:t,...s}){let{router:n}=Yi(),a=d.useMemo(()=>Di(n.routes,t,n.basename),[n.routes,t,n.basename]);return a?d.createElement(Do,{page:t,matches:a,...s}):null}function Oo(t){let{manifest:s,routeModules:n}=Xi(),[a,i]=d.useState([]);return d.useEffect(()=>{let r=!1;return To(t,s,n).then(l=>{r||i(l)}),()=>{r=!0}},[t,s,n]),a}function Do({page:t,matches:s,...n}){let a=Ze(),{future:i,manifest:r,routeModules:l}=Xi(),{basename:o}=Yi(),{loaderData:p,matches:h}=zo(),u=d.useMemo(()=>Ha(t,s,h,r,a,"data"),[t,s,h,r,a]),c=d.useMemo(()=>Ha(t,s,h,r,a,"assets"),[t,s,h,r,a]),g=d.useMemo(()=>{if(t===a.pathname+a.search+a.hash)return[];let x=new Set,v=!1;if(s.forEach(w=>{var j;let _=r.routes[w.route.id];!_||!_.hasLoader||(!u.some(F=>F.route.id===w.route.id)&&w.route.id in p&&((j=l[w.route.id])!=null&&j.shouldRevalidate)||_.hasClientLoader?v=!0:x.add(w.route.id))}),x.size===0)return[];let b=wo(t,o,i.unstable_trailingSlashAwareDataRequests,"data");return v&&x.size>0&&b.searchParams.set("_routes",s.filter(w=>x.has(w.route.id)).map(w=>w.route.id).join(",")),[b.pathname+b.search]},[o,i.unstable_trailingSlashAwareDataRequests,p,a,r,u,s,t,l]),m=d.useMemo(()=>Ro(c,r),[c,r]),k=Oo(c);return d.createElement(d.Fragment,null,g.map(x=>d.createElement("link",{key:x,rel:"prefetch",as:"fetch",href:x,...n})),m.map(x=>d.createElement("link",{key:x,rel:"modulepreload",href:x,...n})),k.map(({key:x,link:v})=>d.createElement("link",{key:x,nonce:n.nonce,...v,crossOrigin:v.crossOrigin??n.crossOrigin})))}function Lo(...t){return s=>{t.forEach(n=>{typeof n=="function"?n(s):n!=null&&(n.current=s)})}}var Bo=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Bo&&(window.__reactRouterVersion="7.13.0")}catch{}function $o({basename:t,children:s,unstable_useTransitions:n,window:a}){let i=d.useRef();i.current==null&&(i.current=yl({window:a,v5Compat:!0}));let r=i.current,[l,o]=d.useState({action:r.action,location:r.location}),p=d.useCallback(h=>{n===!1?o(h):d.startTransition(()=>o(h))},[n]);return d.useLayoutEffect(()=>r.listen(p),[r,p]),d.createElement(go,{basename:t,children:s,location:l.location,navigationType:l.action,navigator:r,unstable_useTransitions:n})}var Zi=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,vt=d.forwardRef(function({onClick:s,discover:n="render",prefetch:a="none",relative:i,reloadDocument:r,replace:l,state:o,target:p,to:h,preventScrollReset:u,viewTransition:c,unstable_defaultShouldRevalidate:g,...m},k){let{basename:x,unstable_useTransitions:v}=d.useContext(Oe),b=typeof h=="string"&&Zi.test(h),w=qi(h,x);h=w.to;let _=Yl(h,{relative:i}),[j,F,T]=Mo(a,m),y=Uo(h,{replace:l,state:o,target:p,preventScrollReset:u,relative:i,viewTransition:c,unstable_defaultShouldRevalidate:g,unstable_useTransitions:v});function I(C){s&&s(C),C.defaultPrevented||y(C)}let P=d.createElement("a",{...m,...T,href:w.absoluteURL||_,onClick:w.isExternal||r?s:I,ref:Lo(k,F),target:p,"data-discover":!b&&n==="render"?"true":void 0});return j&&!b?d.createElement(d.Fragment,null,P,d.createElement(No,{page:_})):P});vt.displayName="Link";var qo=d.forwardRef(function({"aria-current":s="page",caseSensitive:n=!1,className:a="",end:i=!1,style:r,to:l,viewTransition:o,children:p,...h},u){let c=$s(l,{relative:h.relative}),g=Ze(),m=d.useContext(vn),{navigator:k,basename:x}=d.useContext(Oe),v=m!=null&&Jo(c)&&o===!0,b=k.encodeLocation?k.encodeLocation(c).pathname:c.pathname,w=g.pathname,_=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;n||(w=w.toLowerCase(),_=_?_.toLowerCase():null,b=b.toLowerCase()),_&&x&&(_=xt(_,x)||_);const j=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let F=w===b||!i&&w.startsWith(b)&&w.charAt(j)==="/",T=_!=null&&(_===b||!i&&_.startsWith(b)&&_.charAt(b.length)==="/"),y={isActive:F,isPending:T,isTransitioning:v},I=F?s:void 0,P;typeof a=="function"?P=a(y):P=[a,F?"active":null,T?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let C=typeof r=="function"?r(y):r;return d.createElement(vt,{...h,"aria-current":I,className:P,ref:u,style:C,to:l,viewTransition:o},typeof p=="function"?p(y):p)});qo.displayName="NavLink";var Ko=d.forwardRef(({discover:t="render",fetcherKey:s,navigate:n,reloadDocument:a,replace:i,state:r,method:l=tn,action:o,onSubmit:p,relative:h,preventScrollReset:u,viewTransition:c,unstable_defaultShouldRevalidate:g,...m},k)=>{let{unstable_useTransitions:x}=d.useContext(Oe),v=Qo(),b=Go(o,{relative:h}),w=l.toLowerCase()==="get"?"get":"post",_=typeof o=="string"&&Zi.test(o),j=F=>{if(p&&p(F),F.defaultPrevented)return;F.preventDefault();let T=F.nativeEvent.submitter,y=(T==null?void 0:T.getAttribute("formmethod"))||l,I=()=>v(T||F.currentTarget,{fetcherKey:s,method:y,navigate:n,replace:i,state:r,relative:h,preventScrollReset:u,viewTransition:c,unstable_defaultShouldRevalidate:g});x&&n!==!1?d.startTransition(()=>I()):I()};return d.createElement("form",{ref:k,method:w,action:b,onSubmit:a?p:j,...m,"data-discover":!_&&t==="render"?"true":void 0})});Ko.displayName="Form";function Wo(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function er(t){let s=d.useContext(vs);return ue(s,Wo(t)),s}function Uo(t,{target:s,replace:n,state:a,preventScrollReset:i,relative:r,viewTransition:l,unstable_defaultShouldRevalidate:o,unstable_useTransitions:p}={}){let h=Nt(),u=Ze(),c=$s(t,{relative:r});return d.useCallback(g=>{if(So(g,s)){g.preventDefault();let m=n!==void 0?n:Es(u)===Es(c),k=()=>h(t,{replace:m,state:a,preventScrollReset:i,relative:r,viewTransition:l,unstable_defaultShouldRevalidate:o});p?d.startTransition(()=>k()):k()}},[u,h,c,n,a,s,t,i,r,l,o,p])}var Vo=0,Ho=()=>`__${String(++Vo)}__`;function Qo(){let{router:t}=er("useSubmit"),{basename:s}=d.useContext(Oe),n=uo(),a=t.fetch,i=t.navigate;return d.useCallback(async(r,l={})=>{let{action:o,method:p,encType:h,formData:u,body:c}=_o(r,s);if(l.navigate===!1){let g=l.fetcherKey||Ho();await a(g,n,l.action||o,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:u,body:c,formMethod:l.method||p,formEncType:l.encType||h,flushSync:l.flushSync})}else await i(l.action||o,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:u,body:c,formMethod:l.method||p,formEncType:l.encType||h,replace:l.replace,state:l.state,fromRouteId:n,flushSync:l.flushSync,viewTransition:l.viewTransition})},[a,i,s,n])}function Go(t,{relative:s}={}){let{basename:n}=d.useContext(Oe),a=d.useContext(We);ue(a,"useFormAction must be used inside a RouteContext");let[i]=a.matches.slice(-1),r={...$s(t||".",{relative:s})},l=Ze();if(t==null){r.search=l.search;let o=new URLSearchParams(r.search),p=o.getAll("index");if(p.some(u=>u==="")){o.delete("index"),p.filter(c=>c).forEach(c=>o.append("index",c));let u=o.toString();r.search=u?`?${u}`:""}}return(!t||t===".")&&i.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(r.pathname=r.pathname==="/"?n:ft([n,r.pathname])),Es(r)}function Jo(t,{relative:s}={}){let n=d.useContext(Wi);ue(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=er("useViewTransitionState"),i=$s(t,{relative:s});if(!n.isTransitioning)return!1;let r=xt(n.currentLocation.pathname,a)||n.currentLocation.pathname,l=xt(n.nextLocation.pathname,a)||n.nextLocation.pathname;return ln(i.pathname,l)!=null||ln(i.pathname,r)!=null}var Ss=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Yo={setTimeout:(t,s)=>setTimeout(t,s),clearTimeout:t=>clearTimeout(t),setInterval:(t,s)=>setInterval(t,s),clearInterval:t=>clearInterval(t)},kt,Zn,vi,Xo=(vi=class{constructor(){D(this,kt,Yo);D(this,Zn,!1)}setTimeoutProvider(t){A(this,kt,t)}setTimeout(t,s){return f(this,kt).setTimeout(t,s)}clearTimeout(t){f(this,kt).clearTimeout(t)}setInterval(t,s){return f(this,kt).setInterval(t,s)}clearInterval(t){f(this,kt).clearInterval(t)}},kt=new WeakMap,Zn=new WeakMap,vi),Dt=new Xo;function Zo(t){setTimeout(t,0)}var Jt=typeof window>"u"||"Deno"in globalThis;function Ie(){}function ec(t,s){return typeof t=="function"?t(s):t}function On(t){return typeof t=="number"&&t>=0&&t!==1/0}function tr(t,s){return Math.max(t+(s||0)-Date.now(),0)}function Mt(t,s){return typeof t=="function"?t(s):t}function Le(t,s){return typeof t=="function"?t(s):t}function Qa(t,s){const{type:n="all",exact:a,fetchStatus:i,predicate:r,queryKey:l,stale:o}=t;if(l){if(a){if(s.queryHash!==fa(l,s.options))return!1}else if(!As(s.queryKey,l))return!1}if(n!=="all"){const p=s.isActive();if(n==="active"&&!p||n==="inactive"&&p)return!1}return!(typeof o=="boolean"&&s.isStale()!==o||i&&i!==s.state.fetchStatus||r&&!r(s))}function Ga(t,s){const{exact:n,status:a,predicate:i,mutationKey:r}=t;if(r){if(!s.options.mutationKey)return!1;if(n){if(Yt(s.options.mutationKey)!==Yt(r))return!1}else if(!As(s.options.mutationKey,r))return!1}return!(a&&s.state.status!==a||i&&!i(s))}function fa(t,s){return((s==null?void 0:s.queryKeyHashFn)||Yt)(t)}function Yt(t){return JSON.stringify(t,(s,n)=>Dn(n)?Object.keys(n).sort().reduce((a,i)=>(a[i]=n[i],a),{}):n)}function As(t,s){return t===s?!0:typeof t!=typeof s?!1:t&&s&&typeof t=="object"&&typeof s=="object"?Object.keys(s).every(n=>As(t[n],s[n])):!1}var tc=Object.prototype.hasOwnProperty;function sr(t,s,n=0){if(t===s)return t;if(n>500)return s;const a=Ja(t)&&Ja(s);if(!a&&!(Dn(t)&&Dn(s)))return s;const r=(a?t:Object.keys(t)).length,l=a?s:Object.keys(s),o=l.length,p=a?new Array(o):{};let h=0;for(let u=0;u<o;u++){const c=a?u:l[u],g=t[c],m=s[c];if(g===m){p[c]=g,(a?u<r:tc.call(t,c))&&h++;continue}if(g===null||m===null||typeof g!="object"||typeof m!="object"){p[c]=m;continue}const k=sr(g,m,n+1);p[c]=k,k===g&&h++}return r===o&&h===r?t:p}function on(t,s){if(!s||Object.keys(t).length!==Object.keys(s).length)return!1;for(const n in t)if(t[n]!==s[n])return!1;return!0}function Ja(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Dn(t){if(!Ya(t))return!1;const s=t.constructor;if(s===void 0)return!0;const n=s.prototype;return!(!Ya(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Ya(t){return Object.prototype.toString.call(t)==="[object Object]"}function sc(t){return new Promise(s=>{Dt.setTimeout(s,t)})}function Ln(t,s,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,s):n.structuralSharing!==!1?sr(t,s):s}function nc(t,s,n=0){const a=[...t,s];return n&&a.length>n?a.slice(1):a}function ac(t,s,n=0){const a=[s,...t];return n&&a.length>n?a.slice(0,-1):a}var ga=Symbol();function nr(t,s){return!t.queryFn&&(s!=null&&s.initialPromise)?()=>s.initialPromise:!t.queryFn||t.queryFn===ga?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function ya(t,s){return typeof t=="function"?t(...s):!!t}function ic(t,s,n){let a=!1,i;return Object.defineProperty(t,"signal",{enumerable:!0,get:()=>(i??(i=s()),a||(a=!0,i.aborted?n():i.addEventListener("abort",n,{once:!0})),i)}),t}var Lt,Ct,ns,ji,rc=(ji=class extends Ss{constructor(){super();D(this,Lt);D(this,Ct);D(this,ns);A(this,ns,s=>{if(!Jt&&window.addEventListener){const n=()=>s();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){f(this,Ct)||this.setEventListener(f(this,ns))}onUnsubscribe(){var s;this.hasListeners()||((s=f(this,Ct))==null||s.call(this),A(this,Ct,void 0))}setEventListener(s){var n;A(this,ns,s),(n=f(this,Ct))==null||n.call(this),A(this,Ct,s(a=>{typeof a=="boolean"?this.setFocused(a):this.onFocus()}))}setFocused(s){f(this,Lt)!==s&&(A(this,Lt,s),this.onFocus())}onFocus(){const s=this.isFocused();this.listeners.forEach(n=>{n(s)})}isFocused(){var s;return typeof f(this,Lt)=="boolean"?f(this,Lt):((s=globalThis.document)==null?void 0:s.visibilityState)!=="hidden"}},Lt=new WeakMap,Ct=new WeakMap,ns=new WeakMap,ji),xa=new rc;function Bn(){let t,s;const n=new Promise((i,r)=>{t=i,s=r});n.status="pending",n.catch(()=>{});function a(i){Object.assign(n,i),delete n.resolve,delete n.reject}return n.resolve=i=>{a({status:"fulfilled",value:i}),t(i)},n.reject=i=>{a({status:"rejected",reason:i}),s(i)},n}var lc=Zo;function oc(){let t=[],s=0,n=o=>{o()},a=o=>{o()},i=lc;const r=o=>{s?t.push(o):i(()=>{n(o)})},l=()=>{const o=t;t=[],o.length&&i(()=>{a(()=>{o.forEach(p=>{n(p)})})})};return{batch:o=>{let p;s++;try{p=o()}finally{s--,s||l()}return p},batchCalls:o=>(...p)=>{r(()=>{o(...p)})},schedule:r,setNotifyFunction:o=>{n=o},setBatchNotifyFunction:o=>{a=o},setScheduler:o=>{i=o}}}var xe=oc(),as,_t,is,bi,cc=(bi=class extends Ss{constructor(){super();D(this,as,!0);D(this,_t);D(this,is);A(this,is,s=>{if(!Jt&&window.addEventListener){const n=()=>s(!0),a=()=>s(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",a,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",a)}}})}onSubscribe(){f(this,_t)||this.setEventListener(f(this,is))}onUnsubscribe(){var s;this.hasListeners()||((s=f(this,_t))==null||s.call(this),A(this,_t,void 0))}setEventListener(s){var n;A(this,is,s),(n=f(this,_t))==null||n.call(this),A(this,_t,s(this.setOnline.bind(this)))}setOnline(s){f(this,as)!==s&&(A(this,as,s),this.listeners.forEach(a=>{a(s)}))}isOnline(){return f(this,as)}},as=new WeakMap,_t=new WeakMap,is=new WeakMap,bi),cn=new cc;function dc(t){return Math.min(1e3*2**t,3e4)}function ar(t){return(t??"online")==="online"?cn.isOnline():!0}var $n=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function ir(t){let s=!1,n=0,a;const i=Bn(),r=()=>i.status!=="pending",l=x=>{var v;if(!r()){const b=new $n(x);g(b),(v=t.onCancel)==null||v.call(t,b)}},o=()=>{s=!0},p=()=>{s=!1},h=()=>xa.isFocused()&&(t.networkMode==="always"||cn.isOnline())&&t.canRun(),u=()=>ar(t.networkMode)&&t.canRun(),c=x=>{r()||(a==null||a(),i.resolve(x))},g=x=>{r()||(a==null||a(),i.reject(x))},m=()=>new Promise(x=>{var v;a=b=>{(r()||h())&&x(b)},(v=t.onPause)==null||v.call(t)}).then(()=>{var x;a=void 0,r()||(x=t.onContinue)==null||x.call(t)}),k=()=>{if(r())return;let x;const v=n===0?t.initialPromise:void 0;try{x=v??t.fn()}catch(b){x=Promise.reject(b)}Promise.resolve(x).then(c).catch(b=>{var T;if(r())return;const w=t.retry??(Jt?0:3),_=t.retryDelay??dc,j=typeof _=="function"?_(n,b):_,F=w===!0||typeof w=="number"&&n<w||typeof w=="function"&&w(n,b);if(s||!F){g(b);return}n++,(T=t.onFail)==null||T.call(t,n,b),sc(j).then(()=>h()?void 0:m()).then(()=>{s?g(b):k()})})};return{promise:i,status:()=>i.status,cancel:l,continue:()=>(a==null||a(),i),cancelRetry:o,continueRetry:p,canStart:u,start:()=>(u()?k():m().then(k),i)}}var Bt,Si,rr=(Si=class{constructor(){D(this,Bt)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),On(this.gcTime)&&A(this,Bt,Dt.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Jt?1/0:300*1e3))}clearGcTimeout(){f(this,Bt)&&(Dt.clearTimeout(f(this,Bt)),A(this,Bt,void 0))}},Bt=new WeakMap,Si),$t,rs,De,qt,je,Ms,Kt,Qe,ot,ki,uc=(ki=class extends rr{constructor(s){super();D(this,Qe);D(this,$t);D(this,rs);D(this,De);D(this,qt);D(this,je);D(this,Ms);D(this,Kt);A(this,Kt,!1),A(this,Ms,s.defaultOptions),this.setOptions(s.options),this.observers=[],A(this,qt,s.client),A(this,De,f(this,qt).getQueryCache()),this.queryKey=s.queryKey,this.queryHash=s.queryHash,A(this,$t,Za(this.options)),this.state=s.state??f(this,$t),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var s;return(s=f(this,je))==null?void 0:s.promise}setOptions(s){if(this.options={...f(this,Ms),...s},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=Za(this.options);n.data!==void 0&&(this.setState(Xa(n.data,n.dataUpdatedAt)),A(this,$t,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&f(this,De).remove(this)}setData(s,n){const a=Ln(this.state.data,s,this.options);return H(this,Qe,ot).call(this,{data:a,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),a}setState(s,n){H(this,Qe,ot).call(this,{type:"setState",state:s,setStateOptions:n})}cancel(s){var a,i;const n=(a=f(this,je))==null?void 0:a.promise;return(i=f(this,je))==null||i.cancel(s),n?n.then(Ie).catch(Ie):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(f(this,$t))}isActive(){return this.observers.some(s=>Le(s.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===ga||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(s=>Mt(s.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(s=>s.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(s=0){return this.state.data===void 0?!0:s==="static"?!1:this.state.isInvalidated?!0:!tr(this.state.dataUpdatedAt,s)}onFocus(){var n;const s=this.observers.find(a=>a.shouldFetchOnWindowFocus());s==null||s.refetch({cancelRefetch:!1}),(n=f(this,je))==null||n.continue()}onOnline(){var n;const s=this.observers.find(a=>a.shouldFetchOnReconnect());s==null||s.refetch({cancelRefetch:!1}),(n=f(this,je))==null||n.continue()}addObserver(s){this.observers.includes(s)||(this.observers.push(s),this.clearGcTimeout(),f(this,De).notify({type:"observerAdded",query:this,observer:s}))}removeObserver(s){this.observers.includes(s)&&(this.observers=this.observers.filter(n=>n!==s),this.observers.length||(f(this,je)&&(f(this,Kt)?f(this,je).cancel({revert:!0}):f(this,je).cancelRetry()),this.scheduleGc()),f(this,De).notify({type:"observerRemoved",query:this,observer:s}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||H(this,Qe,ot).call(this,{type:"invalidate"})}async fetch(s,n){var p,h,u,c,g,m,k,x,v,b,w,_;if(this.state.fetchStatus!=="idle"&&((p=f(this,je))==null?void 0:p.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(f(this,je))return f(this,je).continueRetry(),f(this,je).promise}if(s&&this.setOptions(s),!this.options.queryFn){const j=this.observers.find(F=>F.options.queryFn);j&&this.setOptions(j.options)}const a=new AbortController,i=j=>{Object.defineProperty(j,"signal",{enumerable:!0,get:()=>(A(this,Kt,!0),a.signal)})},r=()=>{const j=nr(this.options,n),T=(()=>{const y={client:f(this,qt),queryKey:this.queryKey,meta:this.meta};return i(y),y})();return A(this,Kt,!1),this.options.persister?this.options.persister(j,T,this):j(T)},o=(()=>{const j={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:f(this,qt),state:this.state,fetchFn:r};return i(j),j})();(h=this.options.behavior)==null||h.onFetch(o,this),A(this,rs,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((u=o.fetchOptions)==null?void 0:u.meta))&&H(this,Qe,ot).call(this,{type:"fetch",meta:(c=o.fetchOptions)==null?void 0:c.meta}),A(this,je,ir({initialPromise:n==null?void 0:n.initialPromise,fn:o.fetchFn,onCancel:j=>{j instanceof $n&&j.revert&&this.setState({...f(this,rs),fetchStatus:"idle"}),a.abort()},onFail:(j,F)=>{H(this,Qe,ot).call(this,{type:"failed",failureCount:j,error:F})},onPause:()=>{H(this,Qe,ot).call(this,{type:"pause"})},onContinue:()=>{H(this,Qe,ot).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0}));try{const j=await f(this,je).start();if(j===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(j),(m=(g=f(this,De).config).onSuccess)==null||m.call(g,j,this),(x=(k=f(this,De).config).onSettled)==null||x.call(k,j,this.state.error,this),j}catch(j){if(j instanceof $n){if(j.silent)return f(this,je).promise;if(j.revert){if(this.state.data===void 0)throw j;return this.state.data}}throw H(this,Qe,ot).call(this,{type:"error",error:j}),(b=(v=f(this,De).config).onError)==null||b.call(v,j,this),(_=(w=f(this,De).config).onSettled)==null||_.call(w,this.state.data,j,this),j}finally{this.scheduleGc()}}},$t=new WeakMap,rs=new WeakMap,De=new WeakMap,qt=new WeakMap,je=new WeakMap,Ms=new WeakMap,Kt=new WeakMap,Qe=new WeakSet,ot=function(s){const n=a=>{switch(s.type){case"failed":return{...a,fetchFailureCount:s.failureCount,fetchFailureReason:s.error};case"pause":return{...a,fetchStatus:"paused"};case"continue":return{...a,fetchStatus:"fetching"};case"fetch":return{...a,...lr(a.data,this.options),fetchMeta:s.meta??null};case"success":const i={...a,...Xa(s.data,s.dataUpdatedAt),dataUpdateCount:a.dataUpdateCount+1,...!s.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return A(this,rs,s.manual?i:void 0),i;case"error":const r=s.error;return{...a,error:r,errorUpdateCount:a.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:a.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...a,isInvalidated:!0};case"setState":return{...a,...s.state}}};this.state=n(this.state),xe.batch(()=>{this.observers.forEach(a=>{a.onQueryUpdate()}),f(this,De).notify({query:this,type:"updated",action:s})})},ki);function lr(t,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:ar(s.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Xa(t,s){return{data:t,dataUpdatedAt:s??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Za(t){const s=typeof t.initialData=="function"?t.initialData():t.initialData,n=s!==void 0,a=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:n?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Re,X,Ns,Fe,Wt,ls,ct,wt,Os,os,cs,Ut,Vt,Ft,ds,le,Is,qn,Kn,Wn,Un,Vn,Hn,Qn,or,Ci,hc=(Ci=class extends Ss{constructor(s,n){super();D(this,le);D(this,Re);D(this,X);D(this,Ns);D(this,Fe);D(this,Wt);D(this,ls);D(this,ct);D(this,wt);D(this,Os);D(this,os);D(this,cs);D(this,Ut);D(this,Vt);D(this,Ft);D(this,ds,new Set);this.options=n,A(this,Re,s),A(this,wt,null),A(this,ct,Bn()),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(f(this,X).addObserver(this),ei(f(this,X),this.options)?H(this,le,Is).call(this):this.updateResult(),H(this,le,Un).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Gn(f(this,X),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Gn(f(this,X),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,H(this,le,Vn).call(this),H(this,le,Hn).call(this),f(this,X).removeObserver(this)}setOptions(s){const n=this.options,a=f(this,X);if(this.options=f(this,Re).defaultQueryOptions(s),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Le(this.options.enabled,f(this,X))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");H(this,le,Qn).call(this),f(this,X).setOptions(this.options),n._defaulted&&!on(this.options,n)&&f(this,Re).getQueryCache().notify({type:"observerOptionsUpdated",query:f(this,X),observer:this});const i=this.hasListeners();i&&ti(f(this,X),a,this.options,n)&&H(this,le,Is).call(this),this.updateResult(),i&&(f(this,X)!==a||Le(this.options.enabled,f(this,X))!==Le(n.enabled,f(this,X))||Mt(this.options.staleTime,f(this,X))!==Mt(n.staleTime,f(this,X)))&&H(this,le,qn).call(this);const r=H(this,le,Kn).call(this);i&&(f(this,X)!==a||Le(this.options.enabled,f(this,X))!==Le(n.enabled,f(this,X))||r!==f(this,Ft))&&H(this,le,Wn).call(this,r)}getOptimisticResult(s){const n=f(this,Re).getQueryCache().build(f(this,Re),s),a=this.createResult(n,s);return mc(this,a)&&(A(this,Fe,a),A(this,ls,this.options),A(this,Wt,f(this,X).state)),a}getCurrentResult(){return f(this,Fe)}trackResult(s,n){return new Proxy(s,{get:(a,i)=>(this.trackProp(i),n==null||n(i),i==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&f(this,ct).status==="pending"&&f(this,ct).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(a,i))})}trackProp(s){f(this,ds).add(s)}getCurrentQuery(){return f(this,X)}refetch({...s}={}){return this.fetch({...s})}fetchOptimistic(s){const n=f(this,Re).defaultQueryOptions(s),a=f(this,Re).getQueryCache().build(f(this,Re),n);return a.fetch().then(()=>this.createResult(a,n))}fetch(s){return H(this,le,Is).call(this,{...s,cancelRefetch:s.cancelRefetch??!0}).then(()=>(this.updateResult(),f(this,Fe)))}createResult(s,n){var P;const a=f(this,X),i=this.options,r=f(this,Fe),l=f(this,Wt),o=f(this,ls),h=s!==a?s.state:f(this,Ns),{state:u}=s;let c={...u},g=!1,m;if(n._optimisticResults){const C=this.hasListeners(),S=!C&&ei(s,n),E=C&&ti(s,a,n,i);(S||E)&&(c={...c,...lr(u.data,s.options)}),n._optimisticResults==="isRestoring"&&(c.fetchStatus="idle")}let{error:k,errorUpdatedAt:x,status:v}=c;m=c.data;let b=!1;if(n.placeholderData!==void 0&&m===void 0&&v==="pending"){let C;r!=null&&r.isPlaceholderData&&n.placeholderData===(o==null?void 0:o.placeholderData)?(C=r.data,b=!0):C=typeof n.placeholderData=="function"?n.placeholderData((P=f(this,cs))==null?void 0:P.state.data,f(this,cs)):n.placeholderData,C!==void 0&&(v="success",m=Ln(r==null?void 0:r.data,C,n),g=!0)}if(n.select&&m!==void 0&&!b)if(r&&m===(l==null?void 0:l.data)&&n.select===f(this,Os))m=f(this,os);else try{A(this,Os,n.select),m=n.select(m),m=Ln(r==null?void 0:r.data,m,n),A(this,os,m),A(this,wt,null)}catch(C){A(this,wt,C)}f(this,wt)&&(k=f(this,wt),m=f(this,os),x=Date.now(),v="error");const w=c.fetchStatus==="fetching",_=v==="pending",j=v==="error",F=_&&w,T=m!==void 0,I={status:v,fetchStatus:c.fetchStatus,isPending:_,isSuccess:v==="success",isError:j,isInitialLoading:F,isLoading:F,data:m,dataUpdatedAt:c.dataUpdatedAt,error:k,errorUpdatedAt:x,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>h.dataUpdateCount||c.errorUpdateCount>h.errorUpdateCount,isFetching:w,isRefetching:w&&!_,isLoadingError:j&&!T,isPaused:c.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:j&&T,isStale:va(s,n),refetch:this.refetch,promise:f(this,ct),isEnabled:Le(n.enabled,s)!==!1};if(this.options.experimental_prefetchInRender){const C=I.data!==void 0,S=I.status==="error"&&!C,E=oe=>{S?oe.reject(I.error):C&&oe.resolve(I.data)},N=()=>{const oe=A(this,ct,I.promise=Bn());E(oe)},Q=f(this,ct);switch(Q.status){case"pending":s.queryHash===a.queryHash&&E(Q);break;case"fulfilled":(S||I.data!==Q.value)&&N();break;case"rejected":(!S||I.error!==Q.reason)&&N();break}}return I}updateResult(){const s=f(this,Fe),n=this.createResult(f(this,X),this.options);if(A(this,Wt,f(this,X).state),A(this,ls,this.options),f(this,Wt).data!==void 0&&A(this,cs,f(this,X)),on(n,s))return;A(this,Fe,n);const a=()=>{if(!s)return!0;const{notifyOnChangeProps:i}=this.options,r=typeof i=="function"?i():i;if(r==="all"||!r&&!f(this,ds).size)return!0;const l=new Set(r??f(this,ds));return this.options.throwOnError&&l.add("error"),Object.keys(f(this,Fe)).some(o=>{const p=o;return f(this,Fe)[p]!==s[p]&&l.has(p)})};H(this,le,or).call(this,{listeners:a()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&H(this,le,Un).call(this)}},Re=new WeakMap,X=new WeakMap,Ns=new WeakMap,Fe=new WeakMap,Wt=new WeakMap,ls=new WeakMap,ct=new WeakMap,wt=new WeakMap,Os=new WeakMap,os=new WeakMap,cs=new WeakMap,Ut=new WeakMap,Vt=new WeakMap,Ft=new WeakMap,ds=new WeakMap,le=new WeakSet,Is=function(s){H(this,le,Qn).call(this);let n=f(this,X).fetch(this.options,s);return s!=null&&s.throwOnError||(n=n.catch(Ie)),n},qn=function(){H(this,le,Vn).call(this);const s=Mt(this.options.staleTime,f(this,X));if(Jt||f(this,Fe).isStale||!On(s))return;const a=tr(f(this,Fe).dataUpdatedAt,s)+1;A(this,Ut,Dt.setTimeout(()=>{f(this,Fe).isStale||this.updateResult()},a))},Kn=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(f(this,X)):this.options.refetchInterval)??!1},Wn=function(s){H(this,le,Hn).call(this),A(this,Ft,s),!(Jt||Le(this.options.enabled,f(this,X))===!1||!On(f(this,Ft))||f(this,Ft)===0)&&A(this,Vt,Dt.setInterval(()=>{(this.options.refetchIntervalInBackground||xa.isFocused())&&H(this,le,Is).call(this)},f(this,Ft)))},Un=function(){H(this,le,qn).call(this),H(this,le,Wn).call(this,H(this,le,Kn).call(this))},Vn=function(){f(this,Ut)&&(Dt.clearTimeout(f(this,Ut)),A(this,Ut,void 0))},Hn=function(){f(this,Vt)&&(Dt.clearInterval(f(this,Vt)),A(this,Vt,void 0))},Qn=function(){const s=f(this,Re).getQueryCache().build(f(this,Re),this.options);if(s===f(this,X))return;const n=f(this,X);A(this,X,s),A(this,Ns,s.state),this.hasListeners()&&(n==null||n.removeObserver(this),s.addObserver(this))},or=function(s){xe.batch(()=>{s.listeners&&this.listeners.forEach(n=>{n(f(this,Fe))}),f(this,Re).getQueryCache().notify({query:f(this,X),type:"observerResultsUpdated"})})},Ci);function pc(t,s){return Le(s.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&s.retryOnMount===!1)}function ei(t,s){return pc(t,s)||t.state.data!==void 0&&Gn(t,s,s.refetchOnMount)}function Gn(t,s,n){if(Le(s.enabled,t)!==!1&&Mt(s.staleTime,t)!=="static"){const a=typeof n=="function"?n(t):n;return a==="always"||a!==!1&&va(t,s)}return!1}function ti(t,s,n,a){return(t!==s||Le(a.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&va(t,n)}function va(t,s){return Le(s.enabled,t)!==!1&&t.isStaleByTime(Mt(s.staleTime,t))}function mc(t,s){return!on(t.getCurrentResult(),s)}function si(t){return{onFetch:(s,n)=>{var u,c,g,m,k;const a=s.options,i=(g=(c=(u=s.fetchOptions)==null?void 0:u.meta)==null?void 0:c.fetchMore)==null?void 0:g.direction,r=((m=s.state.data)==null?void 0:m.pages)||[],l=((k=s.state.data)==null?void 0:k.pageParams)||[];let o={pages:[],pageParams:[]},p=0;const h=async()=>{let x=!1;const v=_=>{ic(_,()=>s.signal,()=>x=!0)},b=nr(s.options,s.fetchOptions),w=async(_,j,F)=>{if(x)return Promise.reject();if(j==null&&_.pages.length)return Promise.resolve(_);const y=(()=>{const S={client:s.client,queryKey:s.queryKey,pageParam:j,direction:F?"backward":"forward",meta:s.options.meta};return v(S),S})(),I=await b(y),{maxPages:P}=s.options,C=F?ac:nc;return{pages:C(_.pages,I,P),pageParams:C(_.pageParams,j,P)}};if(i&&r.length){const _=i==="backward",j=_?fc:ni,F={pages:r,pageParams:l},T=j(a,F);o=await w(F,T,_)}else{const _=t??r.length;do{const j=p===0?l[0]??a.initialPageParam:ni(a,o);if(p>0&&j==null)break;o=await w(o,j),p++}while(p<_)}return o};s.options.persister?s.fetchFn=()=>{var x,v;return(v=(x=s.options).persister)==null?void 0:v.call(x,h,{client:s.client,queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},n)}:s.fetchFn=h}}}function ni(t,{pages:s,pageParams:n}){const a=s.length-1;return s.length>0?t.getNextPageParam(s[a],s,n[a],n):void 0}function fc(t,{pages:s,pageParams:n}){var a;return s.length>0?(a=t.getPreviousPageParam)==null?void 0:a.call(t,s[0],s,n[0],n):void 0}var Ds,st,ke,Ht,nt,St,_i,gc=(_i=class extends rr{constructor(s){super();D(this,nt);D(this,Ds);D(this,st);D(this,ke);D(this,Ht);A(this,Ds,s.client),this.mutationId=s.mutationId,A(this,ke,s.mutationCache),A(this,st,[]),this.state=s.state||cr(),this.setOptions(s.options),this.scheduleGc()}setOptions(s){this.options=s,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(s){f(this,st).includes(s)||(f(this,st).push(s),this.clearGcTimeout(),f(this,ke).notify({type:"observerAdded",mutation:this,observer:s}))}removeObserver(s){A(this,st,f(this,st).filter(n=>n!==s)),this.scheduleGc(),f(this,ke).notify({type:"observerRemoved",mutation:this,observer:s})}optionalRemove(){f(this,st).length||(this.state.status==="pending"?this.scheduleGc():f(this,ke).remove(this))}continue(){var s;return((s=f(this,Ht))==null?void 0:s.continue())??this.execute(this.state.variables)}async execute(s){var l,o,p,h,u,c,g,m,k,x,v,b,w,_,j,F,T,y;const n=()=>{H(this,nt,St).call(this,{type:"continue"})},a={client:f(this,Ds),meta:this.options.meta,mutationKey:this.options.mutationKey};A(this,Ht,ir({fn:()=>this.options.mutationFn?this.options.mutationFn(s,a):Promise.reject(new Error("No mutationFn found")),onFail:(I,P)=>{H(this,nt,St).call(this,{type:"failed",failureCount:I,error:P})},onPause:()=>{H(this,nt,St).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>f(this,ke).canRun(this)}));const i=this.state.status==="pending",r=!f(this,Ht).canStart();try{if(i)n();else{H(this,nt,St).call(this,{type:"pending",variables:s,isPaused:r}),f(this,ke).config.onMutate&&await f(this,ke).config.onMutate(s,this,a);const P=await((o=(l=this.options).onMutate)==null?void 0:o.call(l,s,a));P!==this.state.context&&H(this,nt,St).call(this,{type:"pending",context:P,variables:s,isPaused:r})}const I=await f(this,Ht).start();return await((h=(p=f(this,ke).config).onSuccess)==null?void 0:h.call(p,I,s,this.state.context,this,a)),await((c=(u=this.options).onSuccess)==null?void 0:c.call(u,I,s,this.state.context,a)),await((m=(g=f(this,ke).config).onSettled)==null?void 0:m.call(g,I,null,this.state.variables,this.state.context,this,a)),await((x=(k=this.options).onSettled)==null?void 0:x.call(k,I,null,s,this.state.context,a)),H(this,nt,St).call(this,{type:"success",data:I}),I}catch(I){try{await((b=(v=f(this,ke).config).onError)==null?void 0:b.call(v,I,s,this.state.context,this,a))}catch(P){Promise.reject(P)}try{await((_=(w=this.options).onError)==null?void 0:_.call(w,I,s,this.state.context,a))}catch(P){Promise.reject(P)}try{await((F=(j=f(this,ke).config).onSettled)==null?void 0:F.call(j,void 0,I,this.state.variables,this.state.context,this,a))}catch(P){Promise.reject(P)}try{await((y=(T=this.options).onSettled)==null?void 0:y.call(T,void 0,I,s,this.state.context,a))}catch(P){Promise.reject(P)}throw H(this,nt,St).call(this,{type:"error",error:I}),I}finally{f(this,ke).runNext(this)}}},Ds=new WeakMap,st=new WeakMap,ke=new WeakMap,Ht=new WeakMap,nt=new WeakSet,St=function(s){const n=a=>{switch(s.type){case"failed":return{...a,failureCount:s.failureCount,failureReason:s.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:s.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:s.isPaused,status:"pending",variables:s.variables,submittedAt:Date.now()};case"success":return{...a,data:s.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:s.error,failureCount:a.failureCount+1,failureReason:s.error,isPaused:!1,status:"error"}}};this.state=n(this.state),xe.batch(()=>{f(this,st).forEach(a=>{a.onMutationUpdate(s)}),f(this,ke).notify({mutation:this,type:"updated",action:s})})},_i);function cr(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var dt,Ge,Ls,wi,yc=(wi=class extends Ss{constructor(s={}){super();D(this,dt);D(this,Ge);D(this,Ls);this.config=s,A(this,dt,new Set),A(this,Ge,new Map),A(this,Ls,0)}build(s,n,a){const i=new gc({client:s,mutationCache:this,mutationId:++Us(this,Ls)._,options:s.defaultMutationOptions(n),state:a});return this.add(i),i}add(s){f(this,dt).add(s);const n=Hs(s);if(typeof n=="string"){const a=f(this,Ge).get(n);a?a.push(s):f(this,Ge).set(n,[s])}this.notify({type:"added",mutation:s})}remove(s){if(f(this,dt).delete(s)){const n=Hs(s);if(typeof n=="string"){const a=f(this,Ge).get(n);if(a)if(a.length>1){const i=a.indexOf(s);i!==-1&&a.splice(i,1)}else a[0]===s&&f(this,Ge).delete(n)}}this.notify({type:"removed",mutation:s})}canRun(s){const n=Hs(s);if(typeof n=="string"){const a=f(this,Ge).get(n),i=a==null?void 0:a.find(r=>r.state.status==="pending");return!i||i===s}else return!0}runNext(s){var a;const n=Hs(s);if(typeof n=="string"){const i=(a=f(this,Ge).get(n))==null?void 0:a.find(r=>r!==s&&r.state.isPaused);return(i==null?void 0:i.continue())??Promise.resolve()}else return Promise.resolve()}clear(){xe.batch(()=>{f(this,dt).forEach(s=>{this.notify({type:"removed",mutation:s})}),f(this,dt).clear(),f(this,Ge).clear()})}getAll(){return Array.from(f(this,dt))}find(s){const n={exact:!0,...s};return this.getAll().find(a=>Ga(n,a))}findAll(s={}){return this.getAll().filter(n=>Ga(s,n))}notify(s){xe.batch(()=>{this.listeners.forEach(n=>{n(s)})})}resumePausedMutations(){const s=this.getAll().filter(n=>n.state.isPaused);return xe.batch(()=>Promise.all(s.map(n=>n.continue().catch(Ie))))}},dt=new WeakMap,Ge=new WeakMap,Ls=new WeakMap,wi);function Hs(t){var s;return(s=t.options.scope)==null?void 0:s.id}var ut,It,Pe,ht,gt,nn,Jn,Fi,xc=(Fi=class extends Ss{constructor(n,a){super();D(this,gt);D(this,ut);D(this,It);D(this,Pe);D(this,ht);A(this,ut,n),this.setOptions(a),this.bindMethods(),H(this,gt,nn).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){var i;const a=this.options;this.options=f(this,ut).defaultMutationOptions(n),on(this.options,a)||f(this,ut).getMutationCache().notify({type:"observerOptionsUpdated",mutation:f(this,Pe),observer:this}),a!=null&&a.mutationKey&&this.options.mutationKey&&Yt(a.mutationKey)!==Yt(this.options.mutationKey)?this.reset():((i=f(this,Pe))==null?void 0:i.state.status)==="pending"&&f(this,Pe).setOptions(this.options)}onUnsubscribe(){var n;this.hasListeners()||(n=f(this,Pe))==null||n.removeObserver(this)}onMutationUpdate(n){H(this,gt,nn).call(this),H(this,gt,Jn).call(this,n)}getCurrentResult(){return f(this,It)}reset(){var n;(n=f(this,Pe))==null||n.removeObserver(this),A(this,Pe,void 0),H(this,gt,nn).call(this),H(this,gt,Jn).call(this)}mutate(n,a){var i;return A(this,ht,a),(i=f(this,Pe))==null||i.removeObserver(this),A(this,Pe,f(this,ut).getMutationCache().build(f(this,ut),this.options)),f(this,Pe).addObserver(this),f(this,Pe).execute(n)}},ut=new WeakMap,It=new WeakMap,Pe=new WeakMap,ht=new WeakMap,gt=new WeakSet,nn=function(){var a;const n=((a=f(this,Pe))==null?void 0:a.state)??cr();A(this,It,{...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset})},Jn=function(n){xe.batch(()=>{var a,i,r,l,o,p,h,u;if(f(this,ht)&&this.hasListeners()){const c=f(this,It).variables,g=f(this,It).context,m={client:f(this,ut),meta:this.options.meta,mutationKey:this.options.mutationKey};if((n==null?void 0:n.type)==="success"){try{(i=(a=f(this,ht)).onSuccess)==null||i.call(a,n.data,c,g,m)}catch(k){Promise.reject(k)}try{(l=(r=f(this,ht)).onSettled)==null||l.call(r,n.data,null,c,g,m)}catch(k){Promise.reject(k)}}else if((n==null?void 0:n.type)==="error"){try{(p=(o=f(this,ht)).onError)==null||p.call(o,n.error,c,g,m)}catch(k){Promise.reject(k)}try{(u=(h=f(this,ht)).onSettled)==null||u.call(h,void 0,n.error,c,g,m)}catch(k){Promise.reject(k)}}}this.listeners.forEach(c=>{c(f(this,It))})})},Fi),at,Ii,vc=(Ii=class extends Ss{constructor(s={}){super();D(this,at);this.config=s,A(this,at,new Map)}build(s,n,a){const i=n.queryKey,r=n.queryHash??fa(i,n);let l=this.get(r);return l||(l=new uc({client:s,queryKey:i,queryHash:r,options:s.defaultQueryOptions(n),state:a,defaultOptions:s.getQueryDefaults(i)}),this.add(l)),l}add(s){f(this,at).has(s.queryHash)||(f(this,at).set(s.queryHash,s),this.notify({type:"added",query:s}))}remove(s){const n=f(this,at).get(s.queryHash);n&&(s.destroy(),n===s&&f(this,at).delete(s.queryHash),this.notify({type:"removed",query:s}))}clear(){xe.batch(()=>{this.getAll().forEach(s=>{this.remove(s)})})}get(s){return f(this,at).get(s)}getAll(){return[...f(this,at).values()]}find(s){const n={exact:!0,...s};return this.getAll().find(a=>Qa(n,a))}findAll(s={}){const n=this.getAll();return Object.keys(s).length>0?n.filter(a=>Qa(s,a)):n}notify(s){xe.batch(()=>{this.listeners.forEach(n=>{n(s)})})}onFocus(){xe.batch(()=>{this.getAll().forEach(s=>{s.onFocus()})})}onOnline(){xe.batch(()=>{this.getAll().forEach(s=>{s.onOnline()})})}},at=new WeakMap,Ii),me,Tt,Rt,us,hs,Pt,ps,ms,Ti,jc=(Ti=class{constructor(t={}){D(this,me);D(this,Tt);D(this,Rt);D(this,us);D(this,hs);D(this,Pt);D(this,ps);D(this,ms);A(this,me,t.queryCache||new vc),A(this,Tt,t.mutationCache||new yc),A(this,Rt,t.defaultOptions||{}),A(this,us,new Map),A(this,hs,new Map),A(this,Pt,0)}mount(){Us(this,Pt)._++,f(this,Pt)===1&&(A(this,ps,xa.subscribe(async t=>{t&&(await this.resumePausedMutations(),f(this,me).onFocus())})),A(this,ms,cn.subscribe(async t=>{t&&(await this.resumePausedMutations(),f(this,me).onOnline())})))}unmount(){var t,s;Us(this,Pt)._--,f(this,Pt)===0&&((t=f(this,ps))==null||t.call(this),A(this,ps,void 0),(s=f(this,ms))==null||s.call(this),A(this,ms,void 0))}isFetching(t){return f(this,me).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return f(this,Tt).findAll({...t,status:"pending"}).length}getQueryData(t){var n;const s=this.defaultQueryOptions({queryKey:t});return(n=f(this,me).get(s.queryHash))==null?void 0:n.state.data}ensureQueryData(t){const s=this.defaultQueryOptions(t),n=f(this,me).build(this,s),a=n.state.data;return a===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(Mt(s.staleTime,n))&&this.prefetchQuery(s),Promise.resolve(a))}getQueriesData(t){return f(this,me).findAll(t).map(({queryKey:s,state:n})=>{const a=n.data;return[s,a]})}setQueryData(t,s,n){const a=this.defaultQueryOptions({queryKey:t}),i=f(this,me).get(a.queryHash),r=i==null?void 0:i.state.data,l=ec(s,r);if(l!==void 0)return f(this,me).build(this,a).setData(l,{...n,manual:!0})}setQueriesData(t,s,n){return xe.batch(()=>f(this,me).findAll(t).map(({queryKey:a})=>[a,this.setQueryData(a,s,n)]))}getQueryState(t){var n;const s=this.defaultQueryOptions({queryKey:t});return(n=f(this,me).get(s.queryHash))==null?void 0:n.state}removeQueries(t){const s=f(this,me);xe.batch(()=>{s.findAll(t).forEach(n=>{s.remove(n)})})}resetQueries(t,s){const n=f(this,me);return xe.batch(()=>(n.findAll(t).forEach(a=>{a.reset()}),this.refetchQueries({type:"active",...t},s)))}cancelQueries(t,s={}){const n={revert:!0,...s},a=xe.batch(()=>f(this,me).findAll(t).map(i=>i.cancel(n)));return Promise.all(a).then(Ie).catch(Ie)}invalidateQueries(t,s={}){return xe.batch(()=>(f(this,me).findAll(t).forEach(n=>{n.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},s)))}refetchQueries(t,s={}){const n={...s,cancelRefetch:s.cancelRefetch??!0},a=xe.batch(()=>f(this,me).findAll(t).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let r=i.fetch(void 0,n);return n.throwOnError||(r=r.catch(Ie)),i.state.fetchStatus==="paused"?Promise.resolve():r}));return Promise.all(a).then(Ie)}fetchQuery(t){const s=this.defaultQueryOptions(t);s.retry===void 0&&(s.retry=!1);const n=f(this,me).build(this,s);return n.isStaleByTime(Mt(s.staleTime,n))?n.fetch(s):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(Ie).catch(Ie)}fetchInfiniteQuery(t){return t.behavior=si(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(Ie).catch(Ie)}ensureInfiniteQueryData(t){return t.behavior=si(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return cn.isOnline()?f(this,Tt).resumePausedMutations():Promise.resolve()}getQueryCache(){return f(this,me)}getMutationCache(){return f(this,Tt)}getDefaultOptions(){return f(this,Rt)}setDefaultOptions(t){A(this,Rt,t)}setQueryDefaults(t,s){f(this,us).set(Yt(t),{queryKey:t,defaultOptions:s})}getQueryDefaults(t){const s=[...f(this,us).values()],n={};return s.forEach(a=>{As(t,a.queryKey)&&Object.assign(n,a.defaultOptions)}),n}setMutationDefaults(t,s){f(this,hs).set(Yt(t),{mutationKey:t,defaultOptions:s})}getMutationDefaults(t){const s=[...f(this,hs).values()],n={};return s.forEach(a=>{As(t,a.mutationKey)&&Object.assign(n,a.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const s={...f(this,Rt).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return s.queryHash||(s.queryHash=fa(s.queryKey,s)),s.refetchOnReconnect===void 0&&(s.refetchOnReconnect=s.networkMode!=="always"),s.throwOnError===void 0&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.queryFn===ga&&(s.enabled=!1),s}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...f(this,Rt).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){f(this,me).clear(),f(this,Tt).clear()}},me=new WeakMap,Tt=new WeakMap,Rt=new WeakMap,us=new WeakMap,hs=new WeakMap,Pt=new WeakMap,ps=new WeakMap,ms=new WeakMap,Ti),dr=d.createContext(void 0),Se=t=>{const s=d.useContext(dr);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},bc=({client:t,children:s})=>(d.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),e.jsx(dr.Provider,{value:t,children:s})),ur=d.createContext(!1),Sc=()=>d.useContext(ur);ur.Provider;function kc(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Cc=d.createContext(kc()),_c=()=>d.useContext(Cc),wc=(t,s,n)=>{const a=n!=null&&n.state.error&&typeof t.throwOnError=="function"?ya(t.throwOnError,[n.state.error,n]):t.throwOnError;(t.suspense||t.experimental_prefetchInRender||a)&&(s.isReset()||(t.retryOnMount=!1))},Fc=t=>{d.useEffect(()=>{t.clearReset()},[t])},Ic=({result:t,errorResetBoundary:s,throwOnError:n,query:a,suspense:i})=>t.isError&&!s.isReset()&&!t.isFetching&&a&&(i&&t.data===void 0||ya(n,[t.error,a])),Tc=t=>{if(t.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),a=t.staleTime;t.staleTime=typeof a=="function"?(...i)=>n(a(...i)):n(a),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},Rc=(t,s)=>t.isLoading&&t.isFetching&&!s,Pc=(t,s)=>(t==null?void 0:t.suspense)&&s.isPending,ai=(t,s,n)=>s.fetchOptimistic(t).catch(()=>{n.clearReset()});function Ec(t,s,n){var g,m,k,x;const a=Sc(),i=_c(),r=Se(),l=r.defaultQueryOptions(t);(m=(g=r.getDefaultOptions().queries)==null?void 0:g._experimental_beforeQuery)==null||m.call(g,l);const o=r.getQueryCache().get(l.queryHash);l._optimisticResults=a?"isRestoring":"optimistic",Tc(l),wc(l,i,o),Fc(i);const p=!r.getQueryCache().get(l.queryHash),[h]=d.useState(()=>new s(r,l)),u=h.getOptimisticResult(l),c=!a&&t.subscribed!==!1;if(d.useSyncExternalStore(d.useCallback(v=>{const b=c?h.subscribe(xe.batchCalls(v)):Ie;return h.updateResult(),b},[h,c]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),d.useEffect(()=>{h.setOptions(l)},[l,h]),Pc(l,u))throw ai(l,h,i);if(Ic({result:u,errorResetBoundary:i,throwOnError:l.throwOnError,query:o,suspense:l.suspense}))throw u.error;if((x=(k=r.getDefaultOptions().queries)==null?void 0:k._experimental_afterQuery)==null||x.call(k,l,u),l.experimental_prefetchInRender&&!Jt&&Rc(u,a)){const v=p?ai(l,h,i):o==null?void 0:o.promise;v==null||v.catch(Ie).finally(()=>{h.updateResult()})}return l.notifyOnChangeProps?u:h.trackResult(u)}function O(t,s){return Ec(t,hc)}function pe(t,s){const n=Se(),[a]=d.useState(()=>new xc(n,t));d.useEffect(()=>{a.setOptions(t)},[a,t]);const i=d.useSyncExternalStore(d.useCallback(l=>a.subscribe(xe.batchCalls(l)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),r=d.useCallback((l,o)=>{a.mutate(l,o).catch(Ie)},[a]);if(i.error&&ya(a.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:r,mutateAsync:i.mutate}}/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ac=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),hr=(...t)=>t.filter((s,n,a)=>!!s&&s.trim()!==""&&a.indexOf(s)===n).join(" ").trim();/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var zc={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mc=d.forwardRef(({color:t="currentColor",size:s=24,strokeWidth:n=2,absoluteStrokeWidth:a,className:i="",children:r,iconNode:l,...o},p)=>d.createElement("svg",{ref:p,...zc,width:s,height:s,stroke:t,strokeWidth:a?Number(n)*24/Number(s):n,className:hr("lucide",i),...o},[...l.map(([h,u])=>d.createElement(h,u)),...Array.isArray(r)?r:[r]]));/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=(t,s)=>{const n=d.forwardRef(({className:a,...i},r)=>d.createElement(Mc,{ref:r,iconNode:s,className:hr(`lucide-${Ac(t)}`,a),...i}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nc=G("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oc=G("Bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dc=G("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lc=G("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=G("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bc=G("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=G("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $c=G("CircleMinus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=G("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qc=G("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kc=G("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wc=G("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ii=G("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uc=G("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ri=G("FolderKanban",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vc=G("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hc=G("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qc=G("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gc=G("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jc=G("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yc=G("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xc=G("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zc=G("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ed=G("MonitorPlay",[["path",{d:"M10 7.75a.75.75 0 0 1 1.142-.638l3.664 2.249a.75.75 0 0 1 0 1.278l-3.664 2.25a.75.75 0 0 1-1.142-.64z",key:"1pctta"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",key:"x3v2xh"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const td=G("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sd=G("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=G("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=G("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fr=G("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nd=G("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ad=G("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const li=G("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const id=G("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=G("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rd=G("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gr=G("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=G("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ld=G("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),xr=[{label:"Core",key:"core",paths:["/projects","/tasks","/runs","/issues"],items:[{path:"/projects",label:"Projects"},{path:"/tasks",label:"Tasks"},{path:"/runs",label:"Runs"},{path:"/issues",label:"Issues"}]},{label:"Fleet",key:"fleet",paths:["/fleet"],items:[{path:"/fleet",label:"Fleet Overview"},{path:"/fleet/trajectory",label:"Trajectory"},{path:"/fleet/issues-map",label:"Issue Map"}]},{label:"Analytics",key:"analytics",paths:["/kpi","/traceability","/auto-triage"],items:[{path:"/kpi",label:"KPI Dashboard"},{path:"/traceability",label:"Traceability"},{path:"/auto-triage",label:"Auto-Triage"}]},{label:"PTC",key:"ptc",paths:["/ptc"],items:[{path:"/ptc/binding",label:"Binding"},{path:"/ptc/kpi",label:"PTC KPI"}]},{label:"Simulation",key:"simulation",paths:["/simulation"],items:[{path:"/simulation",label:"Simulation"}]}];function od(t){for(const s of xr)if(s.paths.some(n=>t===n||t.startsWith(n+"/")))return s.key;return null}function cd(){const{pathname:t}=Ze(),s=Nt(),n=od(t);return e.jsxs("nav",{className:"topnav",children:[e.jsx("div",{className:"topnav-logo",children:"N"}),e.jsx("span",{className:"topnav-title",children:"Nvidopia"}),e.jsx("div",{className:"topnav-nav",children:xr.map(a=>{const i=n===a.key;if(a.items.length===1){const l=a.items[0];return e.jsx("button",{className:`topnav-item${i?" active":""}`,onClick:()=>l&&s(l.path),children:a.label},a.key)}const r=a.items.map(l=>({key:l.path,label:l.label,onClick:()=>s(l.path)}));return e.jsx(Lr,{menu:{items:r},placement:"bottomLeft",children:e.jsxs("button",{className:`topnav-item${i?" active":""}`,children:[a.label,e.jsx(Bc,{size:14,style:{marginLeft:4,opacity:.5}})]})},a.key)})}),e.jsxs("div",{className:"topnav-right",children:[e.jsx("button",{className:"topnav-icon-btn",title:"Search (Cmd+K)",children:e.jsx(ad,{size:18})}),e.jsx("button",{className:"topnav-icon-btn",title:"Notifications",children:e.jsx(Oc,{size:18})}),e.jsx(Br,{size:32,style:{background:"var(--brand-green)",cursor:"pointer",fontSize:"0.8rem",fontWeight:600},children:"U"})]})]})}const dd=[{prefixes:["/projects","/tasks","/runs","/issues"],tabs:[{path:"/projects",label:"Projects"},{path:"/tasks",label:"Tasks"},{path:"/runs",label:"Runs"},{path:"/issues",label:"Issues"}]},{prefixes:["/fleet"],tabs:[{path:"/fleet",label:"Fleet Overview"},{path:"/fleet/trajectory",label:"Trajectory"},{path:"/fleet/issues-map",label:"Issue Map"}]},{prefixes:["/kpi","/traceability","/auto-triage"],tabs:[{path:"/kpi",label:"KPI Dashboard"},{path:"/traceability",label:"Traceability"},{path:"/auto-triage",label:"Auto-Triage"}]},{prefixes:["/ptc"],tabs:[{path:"/ptc/binding",label:"Binding"},{path:"/ptc/kpi",label:"PTC KPI"}]},{prefixes:["/simulation"],tabs:[{path:"/simulation",label:"Simulation"}]}];function ud(t){for(const s of dd)for(const n of s.prefixes)if(t===n||t.startsWith(n+"/"))return s;return null}function hd(t,s){return s==="/fleet"?t==="/fleet"||t.startsWith("/fleet/vehicles"):t===s||t.startsWith(s+"/")}function pd(){const{pathname:t}=Ze(),s=Nt(),n=ud(t);return!n||n.tabs.length<=1?null:e.jsx("div",{className:"secondary-tabs",children:n.tabs.map(a=>e.jsx("button",{className:`secondary-tab${hd(t,a.path)?" active":""}`,onClick:()=>s(a.path),children:a.label},a.path))})}const{Content:md}=$r,fd={projects:"Projects",tasks:"Tasks",runs:"Runs",issues:"Issues",kpi:"KPI Dashboard",traceability:"Traceability","auto-triage":"Auto-Triage",simulation:"Simulation",fleet:"Fleet",vehicles:"Vehicle",trajectory:"Trajectory","issues-map":"Issue Map"};function gd(){const{pathname:t}=Ze(),s=t.split("/").filter(Boolean),n=[{title:e.jsx(vt,{to:"/",children:e.jsx(Hc,{size:15,strokeWidth:2})})},...s.map((a,i)=>{const r="/"+s.slice(0,i+1).join("/"),l=fd[a]??a;return{title:i===s.length-1?e.jsx("span",{children:l}):e.jsx(vt,{to:r,children:l})}})];return e.jsx(qr,{items:n})}function yd(){return e.jsxs("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(cd,{}),e.jsx(pd,{}),e.jsxs(md,{style:{padding:"20px 24px",minHeight:"calc(100vh - var(--header-height) - var(--secondary-tab-height))"},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(gd,{})}),e.jsx("div",{className:"animate-fade-in",children:e.jsx(fo,{})})]})]})}const xd="/api";class vd extends Error{constructor(s,n){super(n),this.status=s,this.name="ApiError"}}function te(t,s=""){return typeof t=="string"?t:s}function J(t){return typeof t=="string"?t:void 0}function pt(t){return typeof t=="number"?t:void 0}function bn(t,s){const n={};for(const[a,i]of Object.entries(t))!s.has(a)&&!a.startsWith("_")&&(n[a]=i);return t.extra&&typeof t.extra=="object"&&Object.assign(n,t.extra),n}const jd=new Set(["id","project_id","name","description","status","vehicle_platform","soc_architecture","sensor_suite_version","software_baseline_version","target_mileage_km","start_date","end_date","extra","createdAt","created_at","updatedAt","updated_at","__v"]);function vr(t){return{id:te(t.id??t.project_id),name:te(t.name,"Unnamed Project"),description:J(t.description),status:te(t.status,"Planning"),vehicle_platform:J(t.vehicle_platform),soc_architecture:J(t.soc_architecture),sensor_suite_version:J(t.sensor_suite_version),software_baseline_version:J(t.software_baseline_version),target_mileage_km:pt(t.target_mileage_km),start_date:J(t.start_date),extra:bn(t,jd),createdAt:te(t.createdAt??t.created_at,new Date().toISOString()),updatedAt:te(t.updatedAt??t.updated_at,new Date().toISOString())}}const bd=new Set(["id","task_id","project_id","projectId","name","title","description","stage","status","task_type","taskType","priority","assignee","assigned_to","execution_region","executionRegion","target_vehicle_count","targetVehicleCount","simulation_ref","simulation_status","extra","createdAt","created_at","updatedAt","updated_at","__v"]);function jr(t){return{id:te(t.id??t.task_id),projectId:te(t.projectId??t.project_id),title:te(t.title??t.name??t.task_id,"Untitled Task"),description:J(t.description),stage:te(t.stage??t.status,"Pending"),taskType:J(t.task_type??t.taskType),priority:te(t.priority,"Medium"),assignee:J(t.assignee??t.assigned_to),executionRegion:J(t.execution_region??t.executionRegion),targetVehicleCount:pt(t.target_vehicle_count??t.targetVehicleCount),extra:bn(t,bd),createdAt:te(t.createdAt??t.created_at,new Date().toISOString()),updatedAt:te(t.updatedAt??t.updated_at,new Date().toISOString())}}const Sd=new Set(["id","run_id","task_id","taskId","vehicle_vin","vehicleIds","driver_id","start_time","startedAt","end_time","completedAt","total_auto_mileage_km","software_version_hash","hardware_heartbeat_version","status","result","simulation_ref","simulation_status","extra","createdAt","created_at","updatedAt","updated_at","__v"]);function br(t){const s=J(t.vehicle_vin);return{id:te(t.id??t.run_id),taskId:te(t.taskId??t.task_id),status:te(t.status,"Scheduled"),vehicleIds:Array.isArray(t.vehicleIds)?t.vehicleIds:s?[s]:[],startedAt:J(t.startedAt??t.start_time),completedAt:J(t.completedAt??t.end_time),totalAutoMileageKm:pt(t.total_auto_mileage_km),result:J(t.result),extra:bn(t,Sd),createdAt:te(t.createdAt??t.created_at,new Date().toISOString()),updatedAt:te(t.updatedAt??t.updated_at,new Date().toISOString())}}const kd=new Set(["id","issue_id","run_id","runId","task_id","taskId","title","description","status","severity","category","assignee","assigned_to","module","assigned_module","takeover_type","takeoverType","gps_coordinates","gps_lat","gps_lng","data_snapshot_uri","data_snapshot_url","trigger_timestamp","fault_codes","environment_tags","triage_mode","triage_hint","triage_source","fix_commit_id","fix_version_hash","rejection_reason","vehicle_dynamics","extra","createdAt","created_at","updatedAt","updated_at","__v"]);function Sr(t){const s=te(t.id??t.issue_id),n=J(t.category),a=t.gps_coordinates;return{id:s,title:te(t.title,n?`${n} (${s})`:`Issue ${s}`),description:J(t.description),status:te(t.status,"New"),severity:te(t.severity,"Medium"),category:n,runId:J(t.runId??t.run_id),taskId:J(t.taskId??t.task_id),assignee:J(t.assignee??t.assigned_to),module:J(t.module??t.assigned_module),takeoverType:J(t.takeover_type??t.takeoverType),gpsLat:pt(t.gps_lat)??pt(a==null?void 0:a.lat),gpsLng:pt(t.gps_lng)??pt(a==null?void 0:a.lng),dataSnapshotUri:J(t.data_snapshot_uri??t.data_snapshot_url),triggerTimestamp:J(t.trigger_timestamp),faultCodes:Array.isArray(t.fault_codes)?t.fault_codes:void 0,environmentTags:Array.isArray(t.environment_tags)?t.environment_tags:void 0,triageMode:J(t.triage_mode),triageHint:J(t.triage_hint),fixCommitId:J(t.fix_commit_id),rejectionReason:J(t.rejection_reason),vehicleDynamics:t.vehicle_dynamics,extra:bn(t,kd),createdAt:te(t.createdAt??t.created_at,new Date().toISOString()),updatedAt:te(t.updatedAt??t.updated_at,new Date().toISOString())}}function Cd(t){return{id:te(t.id??t.transition_id),fromStatus:te(t.from_status??t.fromStatus??t.from),toStatus:te(t.to_status??t.toStatus??t.to),triggeredBy:te(t.triggered_by??t.triggeredBy),transitionedAt:J(t.transitioned_at??t.created_at),reason:J(t.reason)}}async function M(t,s){const n=await fetch(`${xd}${t}`,{...s,headers:{"Content-Type":"application/json",...s==null?void 0:s.headers}});if(!n.ok){const a=await n.text().catch(()=>"");throw new vd(n.status,a||n.statusText)}if(n.status!==204)return n.json()}function Ce(t){if(!t)return"";const s={projectId:"project_id",taskId:"task_id",runId:"run_id",vehicleVin:"vehicle_vin",startDate:"start_date",endDate:"end_date",timeRange:"time_range"},n=Object.fromEntries(Object.entries(t).filter(([,i])=>i!==void 0&&i!=="").map(([i,r])=>[s[i]??i,r])),a=new URLSearchParams(n).toString();return a?`?${a}`:""}async function ks(t){const s=Ce(t),n=await M(`/projects${s}`);return(Array.isArray(n)?n:n.data??n.items??[]).map(i=>vr(i))}function kr(t){return M(`/projects/${t}`).then(vr)}function _d(t){return M("/projects",{method:"POST",body:JSON.stringify(t)})}function wd(t,s){return M(`/projects/${t}`,{method:"PUT",body:JSON.stringify(s)})}async function qs(t){const s=Ce(t),n=await M(`/tasks${s}`);return(Array.isArray(n)?n:n.data??[]).map(i=>jr(i))}function Fd(t){return M(`/tasks/${t}`).then(jr)}function Id(t){return M("/tasks",{method:"POST",body:JSON.stringify(t)})}function Td(t){return M(`/tasks/${t}/advance-stage`,{method:"PUT"})}async function Ks(t){const s=Ce(t),n=await M(`/runs${s}`);return(Array.isArray(n)?n:n.data??[]).map(i=>br(i))}function Rd(t){return M(`/runs/${t}`).then(br)}function Cr(t){return{id:te(t.vin??t._id??t.id),vin:te(t.vin),name:te(t.vin??t.name,"Unknown"),status:te(t.current_status??t.status,"Offline"),platform:J(t.vehicle_platform??t.platform),plateType:J(t.plate_type),modelCode:J(t.model_code),socArchitecture:J(t.soc_architecture),sensorSuiteVersion:J(t.sensor_suite_version),componentVersions:t.component_versions,currentSpeed:pt(t.current_speed_mps),drivingMode:J(t.driving_mode),currentLocation:t.current_location,fuelOrBatteryLevel:pt(t.fuel_or_battery_level),lastHeartbeat:J(t.last_heartbeat),updatedAt:J(t.updated_at??t.updatedAt)}}async function ja(t){const s=Ce(t),n=await M(`/vehicles${s}`);return(Array.isArray(n)?n:n.data??[]).map(i=>Cr(i))}function Pd(t){return M(`/vehicles/${t}`).then(Cr)}function Ed(t,s){return M(`/vehicles/${t}/status-distribution${Ce(s)}`)}function Ad(t,s){return M(`/vehicles/${t}/trajectory${Ce(s)}`)}function zd(){return M("/fleet/distribution")}function Md(){return M("/fleet/status-distribution")}function Nd(t){return M(`/trajectory/query${Ce(t)}`)}function Od(t){return M(`/trajectory/issues${Ce(t)}`)}async function Dd(t){const s=Ce(t),n=await M(`/issues${s}`);return(Array.isArray(n)?n:n.data??[]).map(i=>Sr(i))}function Ld(t){return M(`/issues/${t}`).then(Sr)}function Bd(t,s){return M(`/issues/${t}/transition`,{method:"PUT",body:JSON.stringify(s)})}function $d(t,s){return M(`/issues/${t}/triage`,{method:"POST",body:JSON.stringify({assigned_to:s.assignee,assigned_module:s.module,triggered_by:s.triggered_by??"ui-user"})})}async function qd(t){const s=await M(`/issues/${t}/transitions`);return{items:(Array.isArray(s)?s:s.items??[]).map(Cd)}}function Kd(t){return M(`/traceability/forward/${t}`)}function Wd(t){return M(`/traceability/backward/${t}`)}const Ud=Kd,Vd=Wd;function Hd(t){return M("/traceability/coverage").then(s=>({total:Number(s.total??s.total_requirements??0),covered:Number(s.covered??s.covered_requirements??0),percentage:Number(s.percentage??s.coverage_percentage??0),details:Array.isArray(s.details)?s.details:[]}))}function Qd(t){return M(`/kpi/mpi${Ce(t)}`)}function Gd(t){return M(`/kpi/mttr${Ce(t)}`)}function Jd(t){return M(`/kpi/regression-pass-rate${Ce(t)}`)}function Yd(t){return M(`/kpi/fleet-utilization${Ce(t)}`)}function Xd(t){return M(`/kpi/issue-convergence${Ce(t)}`).then(s=>{const n=Array.isArray(s.series)?s.series:[];return{value:Number(s.value??0),unit:te(s.unit,""),points:n.map(a=>({timestamp:te(a.date),value:Number(a.new_issues??0),dimensions:{open_count:Number(a.new_issues??0),closed_count:Number(a.closed_issues??0)}})),...s}})}function Zd(t){return M(`/issues/${t}/snapshot`)}function eu(t){return M(`/issues/${t}/timeseries`)}function tu(t){const s=t?`/schema/fields/${t}`:"/schema/fields";return M(s)}function su(){return M("/kpi/definitions")}function nu(t){return M("/kpi/definitions",{method:"POST",body:JSON.stringify(t)})}function au(t,s){return M(`/kpi/definitions/${t}`,{method:"PUT",body:JSON.stringify(s)})}function iu(t){return M(`/kpi/definitions/${t}`,{method:"DELETE"})}function ru(t,s){return M(`/kpi/custom/${t}/evaluate${Ce(s)}`)}function lu(t){return M("/kpi/custom/preview",{method:"POST",body:JSON.stringify(t)})}function ou(t){return M("/kpi/definitions/import",{method:"POST",body:JSON.stringify(t)})}function cu(t){return M(`/simulations${Ce(t)}`)}function du(t){return M(`/simulations/${t}`)}function uu(t){return M("/simulations",{method:"POST",body:JSON.stringify(t)})}function hu(t){return M(`/simulations/${t}`,{method:"DELETE"})}function Yn(t){return M(`/simulations/${t}/start`,{method:"POST"})}function pu(t){return M(`/simulations/${t}/pause`,{method:"POST"})}function mu(t){return M(`/simulations/${t}/resume`,{method:"POST"})}function fu(t){return M(`/simulations/${t}/stop`,{method:"POST"})}function gu(t){return M(`/simulations/${t}/stats`)}function yu(t,s=30){return M(`/simulations/${t}/vehicles?tail=${s}`)}function xu(t){return M("/simulations/generate-routes",{method:"POST",body:JSON.stringify(t)})}function vu(t){return M("/simulations/generate-fleet",{method:"POST",body:JSON.stringify(t)})}function ju(t){return M("/simulations/snap-routes",{method:"POST",body:JSON.stringify({routes:t})})}function bu(t){return M(`/ptc/projects${t?`?q=${encodeURIComponent(t)}`:""}`)}function Su(t){return M("/ptc/projects",{method:"POST",body:JSON.stringify({name:t})})}function ku(t){const s=new URLSearchParams;t!=null&&t.q&&s.set("q",t.q),t!=null&&t.project_id&&s.set("project_id",t.project_id);const n=s.toString();return M(`/ptc/tasks${n?`?${n}`:""}`)}function Cu(t){return M("/ptc/tasks",{method:"POST",body:JSON.stringify(t)})}function _u(t,s){return M(`/ptc/tasks/${t}`,{method:"PUT",body:JSON.stringify(s)})}function wu(t){return M("/ptc/bindings",{method:"POST",body:JSON.stringify(t)})}function Fu(t,s){return M(`/ptc/bindings/${t}/drives`,{method:"PUT",body:JSON.stringify(s)})}function Iu(t){return M(`/ptc/bindings/${t}`,{method:"DELETE"})}function Tu(t){return M(`/ptc/builds${t?`?q=${encodeURIComponent(t)}`:""}`)}function Ru(t){const s=new URLSearchParams;t!=null&&t.q&&s.set("q",t.q),t!=null&&t.build_id&&s.set("build_id",t.build_id),t!=null&&t.tag_id&&s.set("tag_id",t.tag_id);const n=s.toString();return M(`/ptc/cars${n?`?${n}`:""}`)}function Pu(t){return M(`/ptc/tags${t?`?q=${encodeURIComponent(t)}`:""}`)}function Eu(t){const s=new URLSearchParams;return t.builds&&s.set("builds",t.builds),t.cars&&s.set("cars",t.cars),t.tags&&s.set("tags",t.tags),M(`/ptc/drives/filter?${s.toString()}`)}function _r(t){return M(t?`/ptc/overview?project_id=${t}`:"/ptc/overview")}function Au(t){return M(`/ptc/overview/${t}`)}const ze={Planning:"blue",Active:"purple",Completed:"green",Archived:"default",Frozen:"cyan",Pending:"default",InProgress:"gold",Cancelled:"default",Scheduled:"blue",Aborted:"red",New:"blue",Triage:"purple",Assigned:"geekblue",Fixed:"green",RegressionTracking:"cyan",Closed:"default",Reopened:"orange",Rejected:"red",backlog:"default",ready:"blue","in-progress":"gold",review:"purple",done:"green",pending:"default",queued:"blue",running:"gold",passed:"green",failed:"red",cancelled:"default",open:"blue",triaged:"purple",fixed:"green",verified:"cyan",closed:"default","wont-fix":"red",duplicate:"default"},pn={Pending:"default",Smoke:"cyan",Gray:"gold",Freeze:"orange",GoLive:"green",backlog:"default",ready:"blue","in-progress":"gold",review:"purple",done:"green"},mn={Critical:"red",High:"orange",Medium:"gold",Low:"blue",critical:"red",high:"orange",medium:"gold",low:"blue"},Xn={Blocker:"red",Critical:"red",High:"orange",Medium:"gold",Low:"blue",Trivial:"green",blocker:"red",critical:"red",high:"orange",medium:"gold",low:"blue",trivial:"green",Minor:"gold",Major:"orange"};function jt({title:t,subtitle:s,action:n}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:t}),s&&e.jsx("p",{className:"page-subtitle",children:s})]}),n]})}function qe({to:t,children:s,mono:n,style:a}){return e.jsx(vt,{to:t,style:{color:"var(--text-primary)",fontWeight:500,transition:"color 0.2s ease",...n?{fontFamily:"var(--font-mono)"}:{},...a},children:s})}const zu={Planning:{bg:"#E8F0FE",text:"#1A73E8"},Active:{bg:"#F3E8FF",text:"#7C3AED"},Completed:{bg:"#ECFDF5",text:"#059669"},Archived:{bg:"#F3F4F6",text:"#6B7280"},Frozen:{bg:"#E0F7FA",text:"#0097A7"}};function Mu({status:t}){const s=zu[t]??{bg:"#F3F4F6",text:"#6B7280"};return e.jsx("span",{style:{display:"inline-block",padding:"2px 12px",borderRadius:9999,fontSize:"0.75rem",fontWeight:600,background:s.bg,color:s.text,lineHeight:"20px"},children:t})}function Nu({project:t}){const n={Planning:15,Active:55,Frozen:40,Completed:100,Archived:100}[t.status]??30;return e.jsx(qe,{to:`/projects/${t.id}`,style:{textDecoration:"none",display:"block"},children:e.jsxs("div",{className:"ios-card ios-card-interactive",style:{padding:20,height:"100%",cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:700,color:"var(--text-primary)",lineHeight:1.3},children:t.name}),e.jsx(Mu,{status:t.status})]}),e.jsxs("div",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",marginBottom:16,lineHeight:1.6},children:[t.vehicle_platform&&e.jsxs("div",{children:[e.jsx("span",{style:{fontWeight:500},children:"Platform:"})," ",t.vehicle_platform]}),t.soc_architecture&&e.jsxs("div",{children:[e.jsx("span",{style:{fontWeight:500},children:"SoC:"})," ",t.soc_architecture]}),t.description&&e.jsx("div",{style:{marginTop:4,color:"var(--text-muted)"},children:t.description})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem",color:"var(--text-muted)",marginBottom:4},children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[n,"%"]})]}),e.jsx(ta,{percent:n,showInfo:!1,strokeColor:"#76B900",trailColor:"#F0F0F0",size:"small"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",gap:12,fontSize:"0.75rem",color:"var(--text-muted)"},children:[t.target_mileage_km!=null&&e.jsxs("span",{children:[t.target_mileage_km.toLocaleString()," km target"]}),t.sensor_suite_version&&e.jsxs("span",{children:["Sensor ",t.sensor_suite_version]})]}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)"},children:new Date(t.updatedAt).toLocaleDateString()})]})]})})}function Ou(){const[t,s]=d.useState(""),[n,a]=d.useState(),[i,r]=d.useState(!1),[l,o]=d.useState("grid"),[p]=L.useForm(),h=Se(),{data:u,isLoading:c}=O({queryKey:["projects"],queryFn:()=>ks()}),g=pe({mutationFn:b=>{var _;const w=`PROJ-${crypto.randomUUID().slice(0,6).toUpperCase()}`;return _d({project_id:w,name:b.name,vehicle_platform:b.vehicle_platform,soc_architecture:b.soc_architecture,sensor_suite_version:b.sensor_suite_version,software_baseline_version:b.software_baseline_version,start_date:(_=b.start_date)==null?void 0:_.toISOString(),target_mileage_km:b.target_mileage_km,status:b.status??"Planning"})},onSuccess:()=>{h.invalidateQueries({queryKey:["projects"]}),r(!1),p.resetFields(),ie.success("Project created")},onError:b=>{ie.error(b.message||"Failed to create project")}}),m=u==null?void 0:u.filter(b=>!(t&&!b.name.toLowerCase().includes(t.toLowerCase())||n&&b.status!==n)),k=d.useMemo(()=>{const b=u??[];return{total:b.length,active:b.filter(w=>w.status==="Active").length,completed:b.filter(w=>w.status==="Completed").length,archived:b.filter(w=>w.status==="Archived").length}},[u]),x=[{title:"Name",dataIndex:"name",key:"name",render:(b,w)=>e.jsx(qe,{to:`/projects/${w.id}`,children:b})},{title:"Status",dataIndex:"status",key:"status",width:130,render:b=>e.jsx(K,{color:ze[b]??"default",children:b})},{title:"Platform",dataIndex:"vehicle_platform",key:"vehicle_platform",width:140,render:b=>b??"â€”"},{title:"Created",dataIndex:"createdAt",key:"createdAt",width:140,render:b=>new Date(b).toLocaleDateString()},{title:"Updated",dataIndex:"updatedAt",key:"updatedAt",width:140,render:b=>new Date(b).toLocaleDateString()}],v=[{label:"Total Projects",value:k.total,color:"#76B900"},{label:"Active",value:k.active,color:"#7C3AED"},{label:"Completed",value:k.completed,color:"#059669"},{label:"Archived",value:k.archived,color:"#6B7280"}];return e.jsxs("div",{children:[e.jsx(jt,{title:"Projects",subtitle:"Manage autonomous driving test projects",action:e.jsx(z,{className:"btn-primary-green",icon:e.jsx(At,{}),size:"large",onClick:()=>r(!0),children:"New Project"})}),e.jsx(fe,{gutter:16,style:{marginBottom:24},children:v.map(b=>e.jsx(q,{xs:12,sm:6,children:e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-card-label",children:b.label}),e.jsx("div",{className:"stat-card-value",style:{color:b.color},children:b.value})]})},b.label))}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexWrap:"wrap",gap:12},children:[e.jsxs(Z,{wrap:!0,children:[e.jsx(Y,{placeholder:"Search projects...",prefix:e.jsx(fn,{style:{color:"var(--text-muted)"}}),value:t,onChange:b=>s(b.target.value),allowClear:!0,style:{width:280}}),e.jsx(V,{placeholder:"Filter by status",allowClear:!0,value:n,onChange:a,style:{width:160},options:[{value:"Planning",label:"Planning"},{value:"Active",label:"Active"},{value:"Frozen",label:"Frozen"},{value:"Completed",label:"Completed"},{value:"Archived",label:"Archived"}]})]}),e.jsx(ea,{value:l,onChange:b=>o(b),options:[{value:"grid",icon:e.jsx(Ri,{})},{value:"list",icon:e.jsx(Pi,{})}]})]}),l==="grid"?(!m||m.length===0)&&!c?e.jsx("div",{className:"ios-card",style:{padding:48,textAlign:"center"},children:e.jsx(ce,{image:e.jsx(ri,{size:48,style:{color:"var(--text-muted)",opacity:.4}}),description:e.jsx("span",{style:{color:"var(--text-muted)"},children:"No projects yet. Create your first project to get started."})})}):e.jsx(fe,{gutter:[16,16],children:(m??[]).map(b=>e.jsx(q,{xs:24,sm:12,lg:8,children:e.jsx(Nu,{project:b})},b.id))}):e.jsx("div",{className:"ios-card",style:{overflow:"hidden"},children:e.jsx(ve,{columns:x,dataSource:m,rowKey:"id",loading:c,pagination:{pageSize:15,showSizeChanger:!1},locale:{emptyText:e.jsx(ce,{image:e.jsx(ri,{size:48,style:{color:"var(--text-muted)",opacity:.4}}),description:e.jsx("span",{style:{color:"var(--text-muted)"},children:"No projects yet. Create your first project to get started."})})}})}),e.jsx($e,{title:"New Project",open:i,onCancel:()=>r(!1),onOk:()=>p.submit(),confirmLoading:g.isPending,okText:"Create",width:600,children:e.jsxs(L,{form:p,layout:"vertical",onFinish:b=>g.mutate(b),children:[e.jsx(L.Item,{name:"name",label:"Project Name",rules:[{required:!0,message:"Please enter project name"}],children:e.jsx(Y,{placeholder:"e.g. V2.0 Urban Pilot"})}),e.jsx(L.Item,{name:"vehicle_platform",label:"Vehicle Platform",rules:[{required:!0}],children:e.jsx(Y,{placeholder:"e.g. EP40"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsx(L.Item,{name:"soc_architecture",label:"SoC Architecture",rules:[{required:!0}],children:e.jsx(Y,{placeholder:"e.g. Orin-X Dual"})}),e.jsx(L.Item,{name:"sensor_suite_version",label:"Sensor Suite Version",rules:[{required:!0}],children:e.jsx(Y,{placeholder:"e.g. SS-4.0"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsx(L.Item,{name:"software_baseline_version",label:"SW Baseline Version",rules:[{required:!0}],children:e.jsx(Y,{placeholder:"e.g. v3.1.0-rc1"})}),e.jsx(L.Item,{name:"start_date",label:"Start Date",rules:[{required:!0}],children:e.jsx(Ts,{style:{width:"100%"}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsx(L.Item,{name:"target_mileage_km",label:"Target Mileage (km)",children:e.jsx(Ee,{min:0,style:{width:"100%"},placeholder:"Optional"})}),e.jsx(L.Item,{name:"status",label:"Initial Status",initialValue:"Planning",children:e.jsx(V,{options:[{value:"Planning",label:"Planning"},{value:"Active",label:"Active"}]})})]})]})})]})}function Ws(){return e.jsx("div",{style:{display:"flex",justifyContent:"center",padding:80},children:e.jsx(Ke,{size:"large"})})}function ba({entity:t}){return e.jsx(ce,{description:`${t} not found`,style:{padding:80}})}function ye(){return e.jsx("span",{style:{color:"var(--text-muted)"},children:"â€”"})}class Du extends d.Component{constructor(){super(...arguments);Na(this,"state",{hasError:!1})}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,a){console.error("[ErrorBoundary]",n,a.componentStack)}render(){var n;return this.state.hasError?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(Kr,{status:"error",title:"Something went wrong",subTitle:((n=this.state.error)==null?void 0:n.message)??"An unexpected error occurred",extra:e.jsx(z,{type:"primary",onClick:()=>{this.setState({hasError:!1,error:void 0}),window.location.reload()},children:"Reload Page"})})}):this.props.children}}function Sa(t,s,n){const{data:a,isLoading:i,error:r}=O({queryKey:[t,s],queryFn:()=>n(s),enabled:!!s});return{data:a,isLoading:i,error:r}}const Lu={Planning:["Active"],Active:["Frozen","Completed"],Frozen:["Active","Completed"],Completed:["Archived"],Archived:[]},Rn=t=>e.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:600,fontSize:"1rem",color:"var(--text-primary)",letterSpacing:"-0.01em"},children:t});function bt({label:t,children:s}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid var(--border-secondary)"},children:[e.jsx("span",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",fontWeight:500},children:t}),e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-primary)",fontWeight:500,textAlign:"right"},children:s})]})}function Bu(){const{id:t}=bs(),s=Se(),[n,a]=d.useState("overview"),{data:i,isLoading:r}=Sa("project",t,kr),{data:l}=O({queryKey:["tasks",{projectId:t}],queryFn:()=>qs({projectId:t}),enabled:!!t}),o=pe({mutationFn:c=>wd(t,{status:c}),onSuccess:()=>{s.invalidateQueries({queryKey:["project",t]}),s.invalidateQueries({queryKey:["projects"]}),ie.success("Status updated")},onError:c=>ie.error(c.message||"Failed to update status")});if(r)return e.jsx(Ws,{});if(!i)return e.jsx(ba,{entity:"Project"});const p=Lu[i.status]??[],h=(l==null?void 0:l.length)??0,u=[{title:"Title",dataIndex:"title",key:"title",render:(c,g)=>e.jsx(qe,{to:`/tasks/${g.id}`,children:c})},{title:"Stage",dataIndex:"stage",key:"stage",width:120,render:c=>e.jsx(K,{color:pn[c]??"default",children:c})},{title:"Priority",dataIndex:"priority",key:"priority",width:110,render:c=>e.jsx(K,{color:mn[c]??"default",children:c})},{title:"Type",dataIndex:"taskType",key:"taskType",width:100,render:c=>c?e.jsx(K,{children:c}):e.jsx(ye,{})}];return e.jsxs("div",{style:{maxWidth:1280,margin:"0 auto"},children:[e.jsxs(vt,{to:"/projects",style:{display:"inline-flex",alignItems:"center",gap:6,color:"var(--text-secondary)",marginBottom:20,fontSize:13,fontWeight:500},children:[e.jsx(sa,{})," Back to Projects"]}),e.jsxs("div",{className:"ios-card",style:{padding:"24px",marginBottom:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:"1.5rem",fontWeight:700,color:"var(--text-primary)",margin:0,letterSpacing:"-0.02em"},children:i.name}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:4},children:i.description??"No description"})]}),e.jsxs(Z,{size:8,wrap:!0,children:[e.jsx(K,{color:ze[i.status]??"blue",style:{fontSize:13,padding:"3px 14px",borderRadius:9999},children:i.status}),p.map(c=>e.jsxs(z,{size:"small",loading:o.isPending,onClick:()=>o.mutate(c),style:{borderRadius:9999,fontWeight:500,borderColor:"var(--border-primary)",color:"var(--text-secondary)"},children:["â†’ ",c]},c))]})]}),h>0&&e.jsxs("div",{style:{marginTop:20},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)",fontWeight:500},children:"Progress"}),e.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)",fontWeight:500},children:[(l==null?void 0:l.filter(c=>c.stage==="GoLive"||c.stage==="done").length)??0," / ",h," completed"]})]}),e.jsx("div",{style:{height:6,background:"var(--bg-hover)",borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${((l==null?void 0:l.filter(c=>c.stage==="GoLive"||c.stage==="done").length)??0)/h*100}%`,background:"var(--brand-green)",borderRadius:3,transition:"width 0.3s ease"}})})]}),e.jsxs("div",{style:{display:"flex",gap:32,marginTop:20,paddingTop:16,borderTop:"1px solid var(--border-secondary)"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,fontFamily:"var(--font-display)",color:"var(--text-primary)"},children:h}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-muted)",fontWeight:500},children:"Tasks"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,fontFamily:"var(--font-display)",color:"var(--text-primary)"},children:i.target_mileage_km!=null?i.target_mileage_km.toLocaleString():"â€”"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-muted)",fontWeight:500},children:"Target KM"})]})]})]}),e.jsx("div",{style:{display:"flex",gap:4,marginBottom:24},children:["overview","tasks"].map(c=>e.jsx("button",{className:`secondary-tab ${n===c?"active":""}`,onClick:()=>a(c),children:c==="overview"?"Overview":`Tasks (${h})`},c))}),n==="overview"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 380px",gap:24,alignItems:"start"},children:[e.jsxs("div",{className:"ios-card",style:{overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid var(--border-secondary)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Rn("Tasks"),e.jsx("button",{onClick:()=>a("tasks"),style:{background:"none",border:"none",color:"var(--brand-green)",fontSize:13,fontWeight:500,cursor:"pointer"},children:"View All"})]}),e.jsx(ve,{columns:u,dataSource:l==null?void 0:l.slice(0,5),rowKey:"id",pagination:!1,locale:{emptyText:e.jsx(ce,{description:"No tasks for this project yet"})}})]}),e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[Rn("Details"),e.jsxs("div",{style:{marginTop:12},children:[e.jsx(bt,{label:"Status",children:e.jsx(K,{color:ze[i.status]??"blue",style:{margin:0},children:i.status})}),e.jsx(bt,{label:"Vehicle Platform",children:i.vehicle_platform??e.jsx(ye,{})}),e.jsx(bt,{label:"SoC Architecture",children:i.soc_architecture??e.jsx(ye,{})}),e.jsx(bt,{label:"Sensor Suite",children:i.sensor_suite_version??e.jsx(ye,{})}),e.jsx(bt,{label:"SW Baseline",children:i.software_baseline_version??e.jsx(ye,{})}),e.jsx(bt,{label:"Target Mileage",children:i.target_mileage_km!=null?`${i.target_mileage_km.toLocaleString()} km`:e.jsx(ye,{})}),e.jsx(bt,{label:"Start Date",children:i.start_date?new Date(i.start_date).toLocaleDateString():e.jsx(ye,{})}),e.jsx(bt,{label:"Created",children:new Date(i.createdAt).toLocaleString()}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0"},children:[e.jsx("span",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",fontWeight:500},children:"Last Updated"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-primary)",fontWeight:500},children:new Date(i.updatedAt).toLocaleString()})]})]})]})]}),n==="tasks"&&e.jsxs("div",{className:"ios-card",style:{overflow:"hidden"},children:[e.jsx("div",{style:{padding:"16px 24px",borderBottom:"1px solid var(--border-secondary)"},children:Rn("All Tasks")}),e.jsx(ve,{columns:u,dataSource:l,rowKey:"id",pagination:!1,locale:{emptyText:e.jsx(ce,{description:"No tasks for this project yet"})}})]})]})}const $u={Critical:{bg:"#FEE2E2",text:"#DC2626"},High:{bg:"#FFF7ED",text:"#EA580C"},Medium:{bg:"#FFFBEB",text:"#D97706"},Low:{bg:"#EFF6FF",text:"#2563EB"}},qu={Daily:{bg:"#E8F0FE",text:"#1A73E8"},Smoke:{bg:"#E0F7FA",text:"#0097A7"},Gray:{bg:"#FFF3E0",text:"#E65100"},Freeze:{bg:"#F3E8FF",text:"#7C3AED"},Retest:{bg:"#FCE4EC",text:"#C62828"}};function oi({label:t,colors:s}){return e.jsx("span",{style:{display:"inline-block",padding:"2px 10px",borderRadius:9999,fontSize:"0.6875rem",fontWeight:600,background:s.bg,color:s.text,lineHeight:"18px",whiteSpace:"nowrap"},children:t})}const ci=[{key:"Pending",title:"Pending",accent:"#6B7280"},{key:"InProgress",title:"In Progress",accent:"#D97706"},{key:"Completed",title:"Completed",accent:"#059669"},{key:"Cancelled",title:"Cancelled",accent:"#9CA3AF"}];function Ku({task:t,projectName:s}){const n=$u[t.priority]??{bg:"#F3F4F6",text:"#6B7280"},a=t.taskType?qu[t.taskType]??{bg:"#F3F4F6",text:"#6B7280"}:null;return e.jsx(qe,{to:`/tasks/${t.id}`,style:{textDecoration:"none",display:"block"},children:e.jsxs("div",{className:"ios-card ios-card-interactive",style:{padding:14,cursor:"pointer",marginBottom:10},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.875rem",color:"var(--text-primary)",marginBottom:8,lineHeight:1.4},children:t.title}),s&&e.jsx("div",{style:{marginBottom:8},children:e.jsx("span",{style:{display:"inline-block",padding:"1px 8px",borderRadius:9999,fontSize:"0.6875rem",fontWeight:500,background:"#F0FDF0",color:"#76B900",border:"1px solid #D4EDDA",lineHeight:"18px"},children:s})}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:10},children:[e.jsx(oi,{label:t.priority,colors:n}),a&&t.taskType&&e.jsx(oi,{label:t.taskType,colors:a})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.75rem",color:"var(--text-muted)"},children:[e.jsx("span",{children:t.assignee??"Unassigned"}),e.jsx("span",{children:new Date(t.updatedAt).toLocaleDateString()})]})]})})}function Wu(){const[t,s]=d.useState(""),[n,a]=d.useState(),[i,r]=d.useState(!1),[l,o]=d.useState("kanban"),[p]=L.useForm(),h=Se(),{data:u,isLoading:c}=O({queryKey:["tasks"],queryFn:()=>qs()}),{data:g}=O({queryKey:["projects"],queryFn:()=>ks()}),m=pe({mutationFn:j=>{const F=`TASK-${crypto.randomUUID().slice(0,6).toUpperCase()}`;return Id({task_id:F,project_id:j.project_id,name:j.name,task_type:j.task_type,priority:j.priority??"Medium",execution_region:j.execution_region,target_vehicle_count:j.target_vehicle_count})},onSuccess:()=>{h.invalidateQueries({queryKey:["tasks"]}),r(!1),p.resetFields(),ie.success("Task created")},onError:j=>{ie.error(j.message||"Failed to create task")}}),k=d.useMemo(()=>{const j=new Map;return(g??[]).forEach(F=>j.set(F.id,F.name)),j},[g]),x=u==null?void 0:u.filter(j=>!(t&&!j.title.toLowerCase().includes(t.toLowerCase())||n&&j.stage!==n)),v=d.useMemo(()=>{const j=u??[];return{total:j.length,pending:j.filter(F=>F.stage==="Pending").length,inProgress:j.filter(F=>F.stage==="InProgress").length,completed:j.filter(F=>F.stage==="Completed").length}},[u]),b=d.useMemo(()=>{const j={};for(const F of ci)j[F.key]=[];for(const F of x??[])(j[F.stage]??j.Pending).push(F);return j},[x]),w=[{title:"Title",dataIndex:"title",key:"title",render:(j,F)=>e.jsx(qe,{to:`/tasks/${F.id}`,children:j})},{title:"Stage",dataIndex:"stage",key:"stage",width:130,render:j=>e.jsx(K,{color:pn[j]??"default",children:j})},{title:"Priority",dataIndex:"priority",key:"priority",width:110,render:j=>e.jsx(K,{color:mn[j]??"default",children:j})},{title:"Assignee",dataIndex:"assignee",key:"assignee",width:140,render:j=>j??e.jsx(ye,{})},{title:"Updated",dataIndex:"updatedAt",key:"updatedAt",width:140,render:j=>new Date(j).toLocaleDateString()}],_=[{label:"Total Tasks",value:v.total,color:"#76B900"},{label:"Pending",value:v.pending,color:"#6B7280"},{label:"In Progress",value:v.inProgress,color:"#D97706"},{label:"Completed",value:v.completed,color:"#059669"}];return e.jsxs("div",{children:[e.jsx(jt,{title:"Tasks",subtitle:"Track test campaign tasks through their lifecycle",action:e.jsx(z,{className:"btn-primary-green",icon:e.jsx(At,{}),size:"large",onClick:()=>r(!0),children:"New Task"})}),e.jsx(fe,{gutter:16,style:{marginBottom:24},children:_.map(j=>e.jsx(q,{xs:12,sm:6,children:e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-card-label",children:j.label}),e.jsx("div",{className:"stat-card-value",style:{color:j.color},children:j.value})]})},j.label))}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexWrap:"wrap",gap:12},children:[e.jsxs(Z,{wrap:!0,children:[e.jsx(Y,{placeholder:"Search tasks...",prefix:e.jsx(fn,{style:{color:"var(--text-muted)"}}),value:t,onChange:j=>s(j.target.value),allowClear:!0,style:{width:280}}),e.jsx(V,{placeholder:"Filter by status",allowClear:!0,value:n,onChange:a,style:{width:160},options:[{value:"Pending",label:"Pending"},{value:"InProgress",label:"In Progress"},{value:"Completed",label:"Completed"},{value:"Cancelled",label:"Cancelled"}]})]}),e.jsx(ea,{value:l,onChange:j=>o(j),options:[{value:"kanban",icon:e.jsx(Gc,{size:16}),label:"Kanban"},{value:"list",icon:e.jsx(Yc,{size:16}),label:"List"}]})]}),l==="kanban"?e.jsx("div",{style:{display:"flex",gap:12,overflowX:"auto",paddingBottom:8},children:ci.map(j=>{const F=b[j.key]??[];return e.jsxs("div",{style:{flex:"1 1 0",minWidth:260,background:"#F9FAFB",borderRadius:12,padding:12,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12,paddingLeft:4},children:[e.jsx("span",{style:{width:8,height:8,borderRadius:9999,background:j.accent,display:"inline-block"}}),e.jsx("span",{style:{fontWeight:600,fontSize:"0.875rem",color:"var(--text-primary)"},children:j.title}),e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",minWidth:22,height:22,borderRadius:9999,background:"#E5E7EB",fontSize:"0.75rem",fontWeight:600,color:"#6B7280"},children:F.length})]}),e.jsx("div",{style:{flex:1},children:F.length===0?e.jsx("div",{style:{padding:"24px 8px",textAlign:"center",color:"var(--text-muted)",fontSize:"0.8125rem"},children:"No tasks"}):F.map(T=>e.jsx(Ku,{task:T,projectName:k.get(T.projectId)},T.id))})]},j.key)})}):e.jsx("div",{className:"ios-card",style:{overflow:"hidden"},children:e.jsx(ve,{columns:w,dataSource:x,rowKey:"id",loading:c,pagination:{pageSize:15,showSizeChanger:!1},locale:{emptyText:e.jsx(ce,{image:e.jsx(Jc,{size:48,style:{color:"var(--text-muted)",opacity:.4}}),description:e.jsx("span",{style:{color:"var(--text-muted)"},children:"No tasks yet. Create tasks to plan and track your test activities."})})}})}),e.jsx($e,{title:"New Task",open:i,onCancel:()=>r(!1),onOk:()=>p.submit(),confirmLoading:m.isPending,okText:"Create",width:560,children:e.jsxs(L,{form:p,layout:"vertical",onFinish:j=>m.mutate(j),children:[e.jsx(L.Item,{name:"project_id",label:"Project",rules:[{required:!0,message:"Please select a project"}],children:e.jsx(V,{placeholder:"Select project",showSearch:!0,optionFilterProp:"label",options:(g??[]).map(j=>({value:j.id,label:j.name}))})}),e.jsx(L.Item,{name:"name",label:"Task Name",rules:[{required:!0,message:"Please enter task name"}],children:e.jsx(Y,{placeholder:"e.g. Highway Daily Mileage"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsx(L.Item,{name:"task_type",label:"Task Type",rules:[{required:!0,message:"Please select type"}],children:e.jsx(V,{placeholder:"Select type",options:[{value:"Daily",label:"Daily"},{value:"Smoke",label:"Smoke"},{value:"Gray",label:"Gray"},{value:"Freeze",label:"Freeze"},{value:"Retest",label:"Retest"}]})}),e.jsx(L.Item,{name:"priority",label:"Priority",initialValue:"Medium",children:e.jsx(V,{options:[{value:"Low",label:"Low"},{value:"Medium",label:"Medium"},{value:"High",label:"High"},{value:"Critical",label:"Critical"}]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsx(L.Item,{name:"execution_region",label:"Execution Region",children:e.jsx(Y,{placeholder:"e.g. Shanghai Lingang"})}),e.jsx(L.Item,{name:"target_vehicle_count",label:"Target Vehicle Count",children:e.jsx(Ee,{min:1,style:{width:"100%"},placeholder:"Optional"})})]})]})})]})}const Uu=["Completed","Cancelled"],di=t=>e.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:600,fontSize:"1rem",color:"var(--text-primary)",letterSpacing:"-0.01em"},children:t});function Ot({label:t,children:s}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid var(--border-secondary)"},children:[e.jsx("span",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",fontWeight:500},children:t}),e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-primary)",fontWeight:500,textAlign:"right"},children:s})]})}function Vu(){const{id:t}=bs(),s=Se(),{data:n,isLoading:a}=Sa("task",t,Fd),{data:i}=O({queryKey:["runs",{taskId:t}],queryFn:()=>Ks({taskId:t}),enabled:!!t}),{data:r}=O({queryKey:["project",n==null?void 0:n.projectId],queryFn:()=>kr(n.projectId),enabled:!!(n!=null&&n.projectId)}),l=pe({mutationFn:()=>Td(t),onSuccess:()=>{s.invalidateQueries({queryKey:["task",t]}),s.invalidateQueries({queryKey:["tasks"]}),ie.success("Status advanced")},onError:h=>ie.error(h.message||"Failed to advance status")});if(a)return e.jsx(Ws,{});if(!n)return e.jsx(ba,{entity:"Task"});const o=!Uu.includes(n.stage),p=[{title:"Run ID",dataIndex:"id",key:"id",width:120,render:h=>e.jsx(qe,{to:`/runs/${h}`,mono:!0,children:h.slice(0,8)})},{title:"Status",dataIndex:"status",key:"status",width:120,render:h=>e.jsx(K,{color:ze[h]??"default",children:h})},{title:"Result",dataIndex:"result",key:"result",width:100,render:h=>h??e.jsx(ye,{})},{title:"Started",dataIndex:"startedAt",key:"startedAt",render:h=>h?new Date(h).toLocaleString():e.jsx(ye,{})}];return e.jsxs("div",{style:{maxWidth:1280,margin:"0 auto"},children:[e.jsxs(vt,{to:"/tasks",style:{display:"inline-flex",alignItems:"center",gap:6,color:"var(--text-secondary)",marginBottom:20,fontSize:13,fontWeight:500},children:[e.jsx(sa,{})," Back to Tasks"]}),e.jsx("div",{className:"ios-card",style:{padding:"24px",marginBottom:24},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:"1.5rem",fontWeight:700,color:"var(--text-primary)",margin:0,letterSpacing:"-0.02em"},children:n.title}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:4},children:n.description??"No description"})]}),e.jsxs(Z,{size:8,children:[e.jsx(K,{color:pn[n.stage]??"default",style:{fontSize:13,padding:"3px 14px",borderRadius:9999},children:n.stage}),e.jsx(K,{color:mn[n.priority]??"default",style:{fontSize:13,padding:"3px 14px",borderRadius:9999},children:n.priority}),o&&e.jsx("button",{className:"btn-primary-green",onClick:()=>l.mutate(),disabled:l.isPending,children:l.isPending?"Advancingâ€¦":"Advance Stage â†’"})]})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 380px",gap:24,alignItems:"start"},children:[e.jsxs("div",{className:"ios-card",style:{overflow:"hidden"},children:[e.jsx("div",{style:{padding:"16px 24px",borderBottom:"1px solid var(--border-secondary)"},children:di("Test Runs")}),e.jsx(ve,{columns:p,dataSource:i,rowKey:"id",pagination:!1,locale:{emptyText:e.jsx(ce,{description:"No runs executed yet"})}})]}),e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[di("Details"),e.jsxs("div",{style:{marginTop:12},children:[e.jsx(Ot,{label:"Stage",children:e.jsx(K,{color:pn[n.stage]??"default",style:{margin:0},children:n.stage})}),e.jsx(Ot,{label:"Task Type",children:n.taskType?e.jsx(K,{style:{margin:0},children:n.taskType}):e.jsx(ye,{})}),e.jsx(Ot,{label:"Priority",children:e.jsx(K,{color:mn[n.priority]??"default",style:{margin:0},children:n.priority})}),e.jsx(Ot,{label:"Project",children:n.projectId?e.jsx(qe,{to:`/projects/${n.projectId}`,children:(r==null?void 0:r.name)??n.projectId.slice(0,8)}):e.jsx(ye,{})}),e.jsx(Ot,{label:"Execution Region",children:n.executionRegion??e.jsx(ye,{})}),e.jsx(Ot,{label:"Target Vehicles",children:n.targetVehicleCount??e.jsx(ye,{})}),e.jsx(Ot,{label:"Created",children:new Date(n.createdAt).toLocaleString()}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0"},children:[e.jsx("span",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",fontWeight:500},children:"Updated"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-primary)",fontWeight:500},children:new Date(n.updatedAt).toLocaleString()})]})]})]})]})]})}const Hu={Completed:e.jsx(un,{size:15,style:{color:"#34C759",verticalAlign:"middle",marginRight:4}}),Aborted:e.jsx(pr,{size:15,style:{color:"#FF3B30",verticalAlign:"middle",marginRight:4}}),Active:e.jsx(Xc,{size:15,style:{color:"#007AFF",verticalAlign:"middle",marginRight:4},className:"spin-icon"}),Scheduled:e.jsx($c,{size:15,style:{color:"#8E8E93",verticalAlign:"middle",marginRight:4}})};function Qu(){const{data:t,isLoading:s}=O({queryKey:["runs"],queryFn:()=>Ks()}),n=d.useMemo(()=>t?{total:t.length,running:t.filter(r=>r.status==="Active"||r.status==="running").length,passed:t.filter(r=>r.result==="passed"||r.result==="pass"||r.status==="Completed").length,failed:t.filter(r=>r.result==="failed"||r.result==="fail"||r.status==="Aborted").length}:{total:0,running:0,passed:0,failed:0},[t]),a=n.passed+n.failed||1,i=[{title:"Run ID",dataIndex:"id",key:"id",width:120,render:r=>e.jsx(qe,{to:`/runs/${r}`,mono:!0,children:r.slice(0,8)})},{title:"Task",dataIndex:"taskId",key:"taskId",width:120,render:r=>r?e.jsx(qe,{to:`/tasks/${r}`,mono:!0,children:r.slice(0,8)}):e.jsx(ye,{})},{title:"Status",dataIndex:"status",key:"status",width:140,render:r=>e.jsxs("span",{style:{display:"inline-flex",alignItems:"center"},children:[Hu[r]??null,e.jsx(K,{color:ze[r]??"default",style:{margin:0},children:r})]})},{title:"Result",dataIndex:"result",key:"result",width:100,render:r=>r??e.jsx(ye,{})},{title:"Vehicles",dataIndex:"vehicleIds",key:"vehicles",width:90,render:r=>(r==null?void 0:r.length)??0},{title:"Started",dataIndex:"startedAt",key:"startedAt",width:160,render:r=>r?new Date(r).toLocaleString():e.jsx(ye,{})},{title:"Completed",dataIndex:"completedAt",key:"completedAt",width:160,render:r=>r?new Date(r).toLocaleString():e.jsx(ye,{})}];return e.jsxs("div",{children:[e.jsx(jt,{title:"Test Runs",subtitle:"Monitor and manage test execution runs"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16,marginBottom:24},children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Total Runs"}),e.jsx("span",{className:"stat-card-value",children:n.total})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Running"}),e.jsx("span",{className:"stat-card-value",style:{color:"#007AFF"},children:n.running})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Passed"}),e.jsx("span",{className:"stat-card-value",style:{color:"#34C759"},children:n.passed})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Failed"}),e.jsx("span",{className:"stat-card-value",style:{color:"#FF3B30"},children:n.failed})]})]}),e.jsx("div",{className:"ios-card",style:{overflow:"hidden"},children:e.jsx(ve,{columns:i,dataSource:t,rowKey:"id",loading:s,pagination:{pageSize:15,showSizeChanger:!1},scroll:{x:900},locale:{emptyText:e.jsx(ce,{image:e.jsx(hn,{size:48,style:{color:"#8E8E93",opacity:.4}}),description:e.jsx("span",{style:{color:"#8E8E93"},children:"No test runs yet. Runs will appear here once tasks are executed."})})}})}),n.total>0&&e.jsxs("div",{className:"ios-card",style:{marginTop:16,padding:"14px 20px"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:500,color:"#86868B",marginBottom:8,fontFamily:"Inter, sans-serif"},children:"Result Distribution"}),e.jsxs("div",{style:{display:"flex",height:8,borderRadius:4,overflow:"hidden",background:"#E5E5EA"},children:[e.jsx("div",{style:{width:`${n.passed/a*100}%`,background:"#34C759",transition:"width 0.4s ease"}}),e.jsx("div",{style:{width:`${n.failed/a*100}%`,background:"#FF3B30",transition:"width 0.4s ease"}})]}),e.jsxs("div",{style:{display:"flex",gap:20,marginTop:8,fontSize:12,color:"#86868B",fontFamily:"Inter, sans-serif"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:"#34C759",display:"inline-block"}}),"Passed ",n.passed]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:"#FF3B30",display:"inline-block"}}),"Failed ",n.failed]})]})]})]})}function Gu(){var l;const{id:t}=bs(),{data:s,isLoading:n}=Sa("run",t,Rd);if(n)return e.jsx(Ws,{});if(!s)return e.jsx(ba,{entity:"Run"});const a={color:"var(--text-secondary)",fontWeight:500},i={color:"var(--text-primary)"},r=o=>e.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:600,color:"var(--text-primary)"},children:o});return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"page-title",children:["Run ",s.id.slice(0,8)]}),e.jsx("p",{className:"page-subtitle",children:"Detailed execution information"})]}),e.jsx(K,{color:ze[s.status]??"default",style:{fontSize:14,padding:"4px 12px"},children:s.status})]}),e.jsxs(fe,{gutter:[24,24],children:[e.jsx(q,{xs:24,lg:16,children:e.jsx(U,{title:r("Run Overview"),className:"ios-card",children:e.jsxs(ae,{column:{xs:1,sm:2},size:"small",colon:!1,labelStyle:a,contentStyle:i,children:[e.jsx(ae.Item,{label:"Run ID",children:e.jsx("code",{style:{color:"var(--brand-green)",fontSize:13,fontFamily:"var(--font-mono)"},children:s.id})}),e.jsx(ae.Item,{label:"Task",children:s.taskId?e.jsx(qe,{to:`/tasks/${s.taskId}`,mono:!0,children:s.taskId}):"â€”"}),e.jsx(ae.Item,{label:"Status",children:e.jsx(K,{color:ze[s.status]??"default",children:s.status})}),e.jsx(ae.Item,{label:"Result",children:s.result??"â€”"}),e.jsx(ae.Item,{label:"Vehicles",children:((l=s.vehicleIds)==null?void 0:l.length)??0}),e.jsx(ae.Item,{label:"Started",children:s.startedAt?new Date(s.startedAt).toLocaleString():"â€”"}),e.jsx(ae.Item,{label:"Completed",children:s.completedAt?new Date(s.completedAt).toLocaleString():"â€”"})]})})}),e.jsx(q,{xs:24,lg:8,children:e.jsx(U,{title:r("Timeline"),className:"ios-card",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:"var(--ios-green)",flexShrink:0}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)",fontWeight:500},children:"Started"}),e.jsx("div",{style:{fontSize:13,color:"var(--text-primary)"},children:s.startedAt?new Date(s.startedAt).toLocaleString():"â€”"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:s.completedAt?"var(--ios-blue)":"var(--text-muted)",flexShrink:0}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)",fontWeight:500},children:"Completed"}),e.jsx("div",{style:{fontSize:13,color:"var(--text-primary)"},children:s.completedAt?new Date(s.completedAt).toLocaleString():"â€”"})]})]})]})})})]})]})}const Ju={Critical:"#FF3B30",Blocker:"#FF3B30",High:"#FF9500",Medium:"#FFCC00",Low:"#007AFF",Trivial:"#8E8E93"};function Yu(){const[t,s]=d.useState(""),[n,a]=d.useState(),[i,r]=d.useState(),{data:l,isLoading:o}=O({queryKey:["issues"],queryFn:()=>Dd()}),p=l==null?void 0:l.filter(c=>!(t&&!c.title.toLowerCase().includes(t.toLowerCase())||n&&c.status!==n||i&&c.severity!==i)),h=d.useMemo(()=>{if(!l)return{open:0,inProgress:0,resolved:0,total:0};const c=new Set(["New","Triage","Assigned","Reopened"]),g=new Set(["InProgress"]),m=new Set(["Fixed","Closed","Rejected","RegressionTracking"]);return{open:l.filter(k=>c.has(k.status)).length,inProgress:l.filter(k=>g.has(k.status)).length,resolved:l.filter(k=>m.has(k.status)).length,total:l.length}},[l]),u=[{title:"Title",dataIndex:"title",key:"title",ellipsis:!0,render:(c,g)=>e.jsx(qe,{to:`/issues/${g.id}`,children:c})},{title:"Status",dataIndex:"status",key:"status",width:150,render:c=>e.jsx(K,{color:ze[c]??"default",children:c})},{title:"Severity",dataIndex:"severity",key:"severity",width:130,render:c=>e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:Ju[c]??"#8E8E93",flexShrink:0}}),e.jsx(K,{color:Xn[c]??"default",style:{margin:0},children:c})]})},{title:"Assignee",dataIndex:"assignee",key:"assignee",width:140,render:c=>c??e.jsx(ye,{})},{title:"Updated",dataIndex:"updatedAt",key:"updatedAt",width:140,render:c=>new Date(c).toLocaleDateString()}];return e.jsxs("div",{children:[e.jsx(jt,{title:"Issues",subtitle:"Track defects and issues found during testing",action:e.jsx(z,{type:"primary",icon:e.jsx(At,{}),size:"large",className:"btn-primary-green",children:"Report Issue"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16,marginBottom:20},children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Open"}),e.jsx("span",{className:"stat-card-value",style:{color:"#FF9500"},children:h.open})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"In Progress"}),e.jsx("span",{className:"stat-card-value",style:{color:"#007AFF"},children:h.inProgress})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Resolved"}),e.jsx("span",{className:"stat-card-value",style:{color:"#34C759"},children:h.resolved})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Total"}),e.jsx("span",{className:"stat-card-value",children:h.total})]})]}),e.jsxs(Z,{direction:"vertical",size:12,style:{width:"100%"},children:[e.jsxs(Z,{wrap:!0,children:[e.jsx(Y,{placeholder:"Search issues...",prefix:e.jsx(fn,{style:{color:"#8E8E93"}}),value:t,onChange:c=>s(c.target.value),allowClear:!0,style:{width:280}}),e.jsx(V,{placeholder:"Status",allowClear:!0,value:n,onChange:a,style:{width:160},options:[{value:"New",label:"New"},{value:"Triage",label:"Triage"},{value:"Assigned",label:"Assigned"},{value:"InProgress",label:"In Progress"},{value:"Fixed",label:"Fixed"},{value:"RegressionTracking",label:"Regression"},{value:"Closed",label:"Closed"},{value:"Reopened",label:"Reopened"},{value:"Rejected",label:"Rejected"}]}),e.jsx(V,{placeholder:"Severity",allowClear:!0,value:i,onChange:r,style:{width:140},options:[{value:"Critical",label:"Critical"},{value:"High",label:"High"},{value:"Medium",label:"Medium"},{value:"Low",label:"Low"},{value:"Trivial",label:"Trivial"}]})]}),e.jsx("div",{className:"ios-card",style:{overflow:"hidden"},children:e.jsx(ve,{columns:u,dataSource:p,rowKey:"id",loading:o,pagination:{pageSize:15,showSizeChanger:!1},size:"small",locale:{emptyText:e.jsx(ce,{image:e.jsx(Lc,{size:48,style:{color:"#8E8E93",opacity:.4}}),description:e.jsx("span",{style:{color:"#8E8E93"},children:"No issues reported. Issues from test runs will appear here."})})}})})]})]})}const ui=["#007AFF","#34C759","#FF9500","#AF52DE","#5AC8FA","#FF3B30","#FFCC00","#6E6E73"],Xu={Triage:"btn-triage",Assigned:"btn-assigned",InProgress:"btn-in-progress",Fixed:"btn-fixed",RegressionTracking:"btn-regression",Closed:"btn-closed",Reopened:"btn-reopened",Rejected:"btn-rejected"};function Zu({channel:t}){const{chartData:s,valueKeys:n}=d.useMemo(()=>{const a=new Set;return{chartData:t.data_points.map(r=>{const l={t:r.t/1e3};for(const[o,p]of Object.entries(r.values))typeof p=="number"&&(l[o]=p,a.add(o));return l}),valueKeys:Array.from(a)}},[t.data_points]);return n.length===0?e.jsx(ce,{description:"No numeric data",image:ce.PRESENTED_IMAGE_SIMPLE}):e.jsx(zt,{width:"100%",height:250,children:e.jsxs(Ni,{data:s,children:[e.jsx(Xt,{strokeDasharray:"3 3",stroke:"var(--border-secondary)"}),e.jsx(yt,{dataKey:"t",tick:{fill:"var(--text-muted)",fontSize:11},unit:"s"}),e.jsx(Je,{tick:{fill:"var(--text-muted)",fontSize:11}}),e.jsx(Me,{contentStyle:{background:"var(--bg-surface)",border:"1px solid var(--border-secondary)",borderRadius:10,boxShadow:"var(--shadow-md)"},labelStyle:{color:"var(--text-muted)"}}),e.jsx(it,{}),n.map((a,i)=>e.jsx(na,{type:"monotone",dataKey:a,stroke:ui[i%ui.length],dot:!1,strokeWidth:1.5},a))]})})}const eh={New:["Triage","Rejected"],Triage:["Assigned","Rejected"],Assigned:["InProgress"],InProgress:["Fixed"],Fixed:["RegressionTracking"],RegressionTracking:["Closed","Reopened"],Reopened:["InProgress"],Closed:[],Rejected:[]},et=t=>e.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:600,fontSize:"1rem",color:"var(--text-primary)",letterSpacing:"-0.01em"},children:t});function He({label:t,children:s}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid var(--border-secondary)"},children:[e.jsx("span",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",fontWeight:500},children:t}),e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-primary)",fontWeight:500,textAlign:"right",maxWidth:"60%"},children:s})]})}function tt({label:t,value:s}){return e.jsxs("div",{style:{textAlign:"center",padding:"12px 8px"},children:[e.jsx("div",{style:{fontSize:"1.125rem",fontWeight:700,fontFamily:"var(--font-mono)",color:"var(--text-primary)"},children:s??"â€”"}),e.jsx("div",{style:{fontSize:"0.6875rem",color:"var(--text-muted)",marginTop:2,fontWeight:500,textTransform:"uppercase",letterSpacing:"0.04em"},children:t})]})}function th(){var _,j,F,T,y,I,P,C;const{id:t}=bs(),s=Se(),[n,a]=d.useState(!1),[i]=L.useForm(),[r,l]=d.useState(""),{data:o,isLoading:p,error:h}=O({queryKey:["issue",t],queryFn:()=>Ld(t),enabled:!!t}),{data:u}=O({queryKey:["issue-transitions",t],queryFn:()=>qd(t),enabled:!!t}),c=pe({mutationFn:({toStatus:S,reason:E})=>Bd(t,{to_status:S,triggered_by:"ui-user",reason:E}),onSuccess:()=>{s.invalidateQueries({queryKey:["issue",t]}),s.invalidateQueries({queryKey:["issue-transitions",t]}),l("")}}),g=pe({mutationFn:S=>$d(t,S),onSuccess:()=>{s.invalidateQueries({queryKey:["issue",t]}),s.invalidateQueries({queryKey:["issue-transitions",t]}),a(!1),i.resetFields()}}),{data:m}=O({queryKey:["issue-snapshot",t],queryFn:()=>Zd(t),enabled:!!t}),{data:k}=O({queryKey:["issue-timeseries",t],queryFn:()=>eu(t),enabled:!!t}),x=d.useMemo(()=>{if(!k)return{};const S={};for(const E of k){const N=E.channel_type||"other";(S[N]??(S[N]=[])).push(E)}return S},[k]);if(p)return e.jsx(Ws,{});if(h||!o)return e.jsx(es,{type:"error",message:"Failed to load issue",showIcon:!0,style:{borderRadius:12}});const v=o.status,b=eh[v]??[],w=v==="Triage";return e.jsxs("div",{style:{maxWidth:1280,margin:"0 auto"},children:[e.jsxs(vt,{to:"/issues",style:{display:"inline-flex",alignItems:"center",gap:6,color:"var(--text-secondary)",marginBottom:20,fontSize:13,fontWeight:500},children:[e.jsx(sa,{})," Back to Issues"]}),e.jsx("div",{className:"ios-card",style:{padding:"20px 24px",marginBottom:24},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:10,background:"rgba(255, 59, 48, 0.08)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(gr,{size:20,style:{color:"var(--ios-red)"}})}),e.jsxs("div",{children:[e.jsxs("h1",{style:{fontFamily:"var(--font-display)",fontSize:"1.25rem",fontWeight:700,color:"var(--text-primary)",margin:0,letterSpacing:"-0.01em"},children:["Issue ",o.id.slice(0,12)]}),e.jsx("code",{style:{fontSize:11,color:"var(--text-muted)"},children:o.id})]})]}),e.jsxs(Z,{size:8,children:[e.jsx(K,{color:Xn[o.severity]??"default",style:{fontSize:13,padding:"2px 12px",borderRadius:9999},children:o.severity}),e.jsx(K,{color:ze[v]??"default",style:{fontSize:13,padding:"2px 12px",borderRadius:9999},children:v})]})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 380px",gap:24,alignItems:"start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24,minWidth:0},children:[o.description&&e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[et("Description"),e.jsx("p",{style:{marginTop:12,color:"var(--text-secondary)",fontSize:"0.9rem",lineHeight:1.7},children:o.description})]}),(o.triageMode||o.triageHint)&&e.jsx("div",{className:"hint-box",children:e.jsxs("dl",{style:{display:"flex",flexDirection:"column",gap:6,margin:0},children:[e.jsx("dt",{children:"Triage Hints"}),o.triageMode&&e.jsxs("dd",{children:["Mode: ",e.jsx("strong",{children:o.triageMode})]}),o.triageHint&&e.jsxs("dd",{children:["Hint: ",e.jsx("strong",{children:o.triageHint})]})]})}),b.length>0&&e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[et("Transition"),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:13,margin:"12px 0 16px"},children:["Current: ",e.jsx(K,{color:ze[v],children:v})," â€” Choose next state:"]}),e.jsx(Y,{placeholder:"Reason (optional)",value:r,onChange:S=>l(S.target.value),style:{marginBottom:16,maxWidth:400,borderRadius:8}}),e.jsx(Z,{wrap:!0,children:b.map(S=>w&&S==="Assigned"?e.jsx(gn,{title:"Assign owner and module",children:e.jsx("button",{className:"btn-primary-green",onClick:()=>a(!0),children:"Assign (Triage)"})},S):e.jsx(z,{className:Xu[S]??"",onClick:()=>c.mutate({toStatus:S,reason:r||void 0}),loading:c.isPending,style:{borderRadius:9999,fontWeight:500},children:S},S))}),c.isError&&e.jsx(es,{type:"error",message:"Transition failed",style:{marginTop:12,borderRadius:8}})]}),e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[et("Audit Trail"),e.jsx("div",{style:{marginTop:16},children:u!=null&&u.items&&u.items.length>0?e.jsx("div",{children:u.items.map((S,E)=>e.jsxs("div",{className:"audit-trail-item",children:[e.jsx("div",{className:"audit-trail-dot",children:e.jsx(Wr,{})}),e.jsxs("div",{children:[e.jsxs(Z,{size:4,children:[e.jsx(K,{color:ze[S.fromStatus]??"default",style:{fontSize:11},children:S.fromStatus}),e.jsx("span",{style:{color:"var(--text-muted)"},children:"â†’"}),e.jsx(K,{color:ze[S.toStatus]??"default",style:{fontSize:11},children:S.toStatus})]}),e.jsxs("div",{className:"audit-trail-meta",children:["by ",S.triggeredBy," Â· ",S.transitionedAt?new Date(S.transitionedAt).toLocaleString():"â€”"]}),S.reason&&e.jsxs("div",{className:"audit-trail-reason",children:["â€œ",S.reason,"â€"]})]})]},E))}):e.jsx("div",{style:{color:"var(--text-muted)",fontSize:13},children:"No transitions recorded yet."})})]}),e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[et("Vehicle Dynamics Snapshot"),m?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:1,marginTop:16,background:"var(--border-secondary)",borderRadius:8,overflow:"hidden"},children:[e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(tt,{label:"Speed (m/s)",value:(_=m.speed_mps)==null?void 0:_.toFixed(2)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(tt,{label:"Accel (m/sÂ²)",value:(j=m.acceleration_mps2)==null?void 0:j.toFixed(3)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(tt,{label:"Lat Accel (m/sÂ²)",value:(F=m.lateral_acceleration_mps2)==null?void 0:F.toFixed(3)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(tt,{label:"Yaw (Â°/s)",value:(T=m.yaw_rate_dps)==null?void 0:T.toFixed(2)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(tt,{label:"Heading (Â°)",value:(y=m.heading_deg)==null?void 0:y.toFixed(2)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(tt,{label:"Steering (Â°)",value:(I=m.steering_angle_deg)==null?void 0:I.toFixed(2)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(tt,{label:"Throttle (%)",value:(P=m.throttle_pct)==null?void 0:P.toFixed(1)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(tt,{label:"Brake (bar)",value:(C=m.brake_pressure_bar)==null?void 0:C.toFixed(2)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(tt,{label:"Gear",value:m.gear})}),e.jsx("div",{style:{background:"var(--bg-surface)",gridColumn:"span 2"},children:e.jsx(tt,{label:"Quaternion",value:m.quaternion?`${m.quaternion.w.toFixed(3)}, ${m.quaternion.x.toFixed(3)}, ${m.quaternion.y.toFixed(3)}, ${m.quaternion.z.toFixed(3)}`:null})})]}):e.jsx(ce,{description:"No snapshot data",image:ce.PRESENTED_IMAGE_SIMPLE,style:{marginTop:16}})]}),k&&k.length>0&&e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[et("Time-Series Data"),e.jsx("div",{style:{marginTop:16},children:e.jsx(Ei,{items:Object.entries(x).map(([S,E])=>({key:S,label:e.jsx(K,{children:S}),children:e.jsx(Z,{direction:"vertical",size:16,style:{width:"100%"},children:E.map(N=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text-secondary)",marginBottom:8},children:N.channel}),e.jsx(Zu,{channel:N})]},N.channel))})}))})})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[et("Properties"),e.jsxs("div",{style:{marginTop:12},children:[e.jsx(He,{label:"Severity",children:e.jsx(K,{color:Xn[o.severity]??"default",style:{margin:0},children:o.severity})}),e.jsx(He,{label:"Status",children:e.jsx(K,{color:ze[v]??"default",style:{margin:0},children:v})}),e.jsx(He,{label:"Assignee",children:o.assignee??"â€”"}),e.jsx(He,{label:"Module",children:o.module??"â€”"}),e.jsx(He,{label:"Category",children:o.category??"â€”"}),e.jsx(He,{label:"Takeover Type",children:o.takeoverType??"â€”"}),o.gpsLat!=null&&o.gpsLng!=null&&e.jsx(He,{label:"GPS",children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[e.jsx(Ur,{style:{color:"var(--ios-blue)",fontSize:12}}),e.jsxs("code",{style:{fontSize:12},children:[Number(o.gpsLat).toFixed(6),", ",Number(o.gpsLng).toFixed(6)]})]})}),e.jsx(He,{label:"Triggered At",children:o.triggerTimestamp?new Date(o.triggerTimestamp).toLocaleString():"â€”"}),e.jsx(He,{label:"Created",children:o.createdAt?new Date(o.createdAt).toLocaleString():"â€”"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0"},children:[e.jsx("span",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",fontWeight:500},children:"Updated"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-primary)",fontWeight:500},children:o.updatedAt?new Date(o.updatedAt).toLocaleString():"â€”"})]})]})]}),e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[et("Related"),e.jsxs("div",{style:{marginTop:12},children:[e.jsx(He,{label:"Run",children:o.runId?e.jsxs(vt,{to:`/runs/${o.runId}`,style:{color:"var(--brand-green)",fontWeight:500,fontSize:13},children:[o.runId.slice(0,8),"â€¦"]}):"â€”"}),o.dataSnapshotUri&&e.jsx(He,{label:"Snapshot",children:e.jsxs("a",{href:o.dataSnapshotUri,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--ios-blue)",fontWeight:500,fontSize:13},children:["View ",e.jsx(Vr,{})]})})]})]}),o.faultCodes&&o.faultCodes.length>0&&e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[et("Fault Codes"),e.jsx("div",{style:{marginTop:12,display:"flex",flexWrap:"wrap",gap:6},children:o.faultCodes.map(S=>e.jsx("span",{className:"chip chip-red",children:S},S))})]}),o.environmentTags&&o.environmentTags.length>0&&e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[et("Environment Tags"),e.jsx("div",{style:{marginTop:12,display:"flex",flexWrap:"wrap",gap:6},children:o.environmentTags.map(S=>e.jsx("span",{className:"chip chip-gray",children:S},S))})]}),e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[et("Attachments"),e.jsx("div",{style:{marginTop:12,color:"var(--text-muted)",fontSize:13},children:"No attachments yet."})]})]})]}),e.jsx($e,{title:"Triage Assignment",open:n,onCancel:()=>a(!1),onOk:()=>i.submit(),confirmLoading:g.isPending,okText:"Assign & Transition",children:e.jsxs(L,{form:i,layout:"vertical",onFinish:S=>g.mutate(S),children:[e.jsx(L.Item,{name:"assignee",label:"Assign To",rules:[{required:!0,message:"Please enter assignee"}],children:e.jsx(Y,{placeholder:"Developer name"})}),e.jsx(L.Item,{name:"module",label:"Module",rules:[{required:!0,message:"Please enter module"}],children:e.jsx(Y,{placeholder:"e.g. perception, planning"})})]})})]})}const ys=["#76B900","#007AFF","#FF9500","#34C759","#AF52DE","#5AC8FA","#FF3B30","#FFCC00","#FF2D55","#00C7BE"],Te="rgba(0,0,0,0.06)",Ne="#6E6E73",Cs={contentStyle:{background:"#FFFFFF",border:"1px solid #E5E5EA",borderRadius:12,backdropFilter:"blur(20px)",color:"#1D1D1F",fontFamily:"'Fira Code', monospace",fontSize:11,boxShadow:"0 4px 12px rgba(0,0,0,0.08)"}};function Be(t,s){return t.color||ys[s%ys.length]}function sh(t){return t.some(s=>s.axisId==="right")}function ka({thresholds:t}){return!t||t.length===0?null:e.jsx(e.Fragment,{children:t.map((s,n)=>e.jsx(hl,{y:s.value,yAxisId:"left",stroke:s.color||"#ff0044",strokeDasharray:"6 3",strokeWidth:1.5,label:{value:s.label??`${s.value}`,fill:s.color||"#ff0044",fontSize:10,position:"right"}},n))})}function Ca({xField:t,yFields:s,children:n,thresholds:a}){const i=sh(s);return e.jsxs(e.Fragment,{children:[e.jsx(Xt,{strokeDasharray:"3 3",stroke:Te}),e.jsx(yt,{dataKey:t,tick:{fontSize:11,fill:Ne},stroke:Te}),e.jsx(Je,{yAxisId:"left",tick:{fontSize:11,fill:Ne},stroke:Te}),i&&e.jsx(Je,{yAxisId:"right",orientation:"right",tick:{fontSize:11,fill:Ne},stroke:Te}),e.jsx(Me,{...Cs}),e.jsx(it,{}),e.jsx(ka,{thresholds:a}),n]})}function nh({data:t,xField:s,yFields:n,thresholds:a}){return e.jsx(Rs,{data:t,children:e.jsx(Ca,{xField:s,yFields:n,thresholds:a,children:n.map((i,r)=>e.jsx(mt,{dataKey:i.key,name:i.label||i.key,fill:Be(i,r),yAxisId:i.axisId||"left",radius:[6,6,0,0],fillOpacity:.85},i.key))})})}function ah({data:t,xField:s,yFields:n,thresholds:a}){return e.jsx(Ni,{data:t,children:e.jsx(Ca,{xField:s,yFields:n,thresholds:a,children:n.map((i,r)=>e.jsx(na,{type:"monotone",dataKey:i.key,name:i.label||i.key,stroke:Be(i,r),yAxisId:i.axisId||"left",strokeWidth:2,dot:{r:3,fill:Be(i,r)},activeDot:{r:5,stroke:Be(i,r),filter:`drop-shadow(0 0 4px ${Be(i,r)})`}},i.key))})})}function ih({data:t,xField:s,yFields:n,thresholds:a}){return e.jsxs(Oi,{data:t,children:[e.jsx("defs",{children:n.map((i,r)=>{const l=Be(i,r);return e.jsxs("linearGradient",{id:`areaGrad-${i.key}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:l,stopOpacity:.3}),e.jsx("stop",{offset:"100%",stopColor:l,stopOpacity:0})]},i.key)})}),e.jsx(Ca,{xField:s,yFields:n,thresholds:a,children:n.map((i,r)=>e.jsx(An,{type:"monotone",dataKey:i.key,name:i.label||i.key,stroke:Be(i,r),fill:`url(#areaGrad-${i.key})`,yAxisId:i.axisId||"left",strokeWidth:2},i.key))})]})}function rh({data:t,xField:s,yFields:n}){var a,i,r;return e.jsxs(dl,{children:[e.jsx(Xt,{strokeDasharray:"3 3",stroke:Te}),e.jsx(yt,{dataKey:s,name:s,tick:{fontSize:11,fill:Ne},stroke:Te}),e.jsx(Je,{dataKey:(a=n[0])==null?void 0:a.key,name:((i=n[0])==null?void 0:i.label)||((r=n[0])==null?void 0:r.key),tick:{fontSize:11,fill:Ne},stroke:Te}),e.jsx(Me,{...Cs}),e.jsx(it,{}),n.map((l,o)=>e.jsx(ul,{name:l.label||l.key,data:t,fill:Be(l,o),fillOpacity:.7},l.key))]})}function lh({data:t,xField:s,yFields:n}){var i;const a=((i=n[0])==null?void 0:i.key)??"value";return e.jsxs(yn,{children:[e.jsx(Me,{...Cs}),e.jsx(it,{}),e.jsx(xn,{data:t,dataKey:a,nameKey:s||"name",cx:"50%",cy:"50%",innerRadius:"40%",outerRadius:"75%",strokeWidth:1,stroke:"rgba(0,0,0,0.06)",label:({name:r,percent:l})=>`${r} ${(l*100).toFixed(0)}%`,children:t.map((r,l)=>e.jsx(fs,{fill:ys[l%ys.length],fillOpacity:.85},l))})]})}function oh({data:t,yFields:s}){var o,p,h;const n=Number(((p=t[0])==null?void 0:p[((o=s[0])==null?void 0:o.key)??"value"])??0),i=Math.min(100,Math.max(0,n/100*100)),r=i>=80?"#34d399":i>=50?"#fbbf24":"#f87171",l=[{name:"value",value:i},{name:"remaining",value:100-i}];return e.jsxs(yn,{children:[e.jsxs(xn,{data:l,cx:"50%",cy:"70%",startAngle:180,endAngle:0,innerRadius:"60%",outerRadius:"85%",dataKey:"value",strokeWidth:0,children:[e.jsx(fs,{fill:r}),e.jsx(fs,{fill:"rgba(0,0,0,0.04)"})]}),e.jsx("text",{x:"50%",y:"62%",textAnchor:"middle",fill:r,style:{fontSize:24,fontFamily:"'Fira Code', monospace",fontWeight:700},children:n.toFixed(1)}),e.jsx("text",{x:"50%",y:"78%",textAnchor:"middle",fill:"#6E6E73",style:{fontSize:11,fontFamily:"'Fira Code', monospace"},children:((h=s[0])==null?void 0:h.label)||"Value"})]})}function ch({data:t,xField:s,yFields:n}){return e.jsxs(il,{data:t,cx:"50%",cy:"50%",outerRadius:"75%",children:[e.jsx(rl,{stroke:Te}),e.jsx(ll,{dataKey:s,tick:{fontSize:11,fill:Ne}}),e.jsx(ol,{tick:{fontSize:10,fill:Ne}}),e.jsx(Me,{...Cs}),e.jsx(it,{}),n.map((a,i)=>e.jsx(cl,{name:a.label||a.key,dataKey:a.key,stroke:Be(a,i),fill:Be(a,i),fillOpacity:.2,strokeWidth:2},a.key))]})}function dh({data:t,xField:s,yFields:n,thresholds:a}){return e.jsxs(al,{data:t,children:[e.jsx(Xt,{strokeDasharray:"3 3",stroke:Te}),e.jsx(yt,{dataKey:s,tick:{fontSize:11,fill:Ne},stroke:Te}),e.jsx(Je,{yAxisId:"left",tick:{fontSize:11,fill:Ne},stroke:Te}),e.jsx(Je,{yAxisId:"right",orientation:"right",tick:{fontSize:11,fill:Ne},stroke:Te}),e.jsx(Me,{...Cs}),e.jsx(it,{}),e.jsx(ka,{thresholds:a}),n.map((i,r)=>{const l=i.axisId||(r===0?"left":"right");return r===0?e.jsx(mt,{dataKey:i.key,name:i.label||i.key,fill:Be(i,r),yAxisId:l,radius:[6,6,0,0],fillOpacity:.85},i.key):e.jsx(na,{type:"monotone",dataKey:i.key,name:i.label||i.key,stroke:Be(i,r),yAxisId:l,strokeWidth:2,dot:{r:3}},i.key)})]})}function uh({data:t,xField:s,yFields:n}){var l,o;const a=((l=n[0])==null?void 0:l.key)??"value",i=[...t].sort((p,h)=>Number(h[a]??0)-Number(p[a]??0)),r=Number(((o=i[0])==null?void 0:o[a])??1);return e.jsx("div",{style:{padding:"20px 0"},children:i.map((p,h)=>{const u=Number(p[a]??0),c=Math.max(10,u/r*100),g=ys[h%ys.length];return e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:8,justifyContent:"center"},children:[e.jsx("span",{style:{width:100,textAlign:"right",paddingRight:12,fontSize:11,color:Ne,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontFamily:"'Fira Code', monospace"},children:String(p[s||"name"]??`Step ${h+1}`)}),e.jsx("div",{style:{width:`${c}%`,maxWidth:400,height:28,background:g,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",color:"#000",fontSize:10,fontWeight:700,opacity:.85,transition:"width 0.3s ease",fontFamily:"'Fira Code', monospace"},children:u})]},h)})})}function hh({data:t,xField:s,yFields:n,thresholds:a}){var o,p;const i=((o=n[0])==null?void 0:o.key)??"value";let r=0;const l=t.map(h=>{const u=Number(h[i]??0),c=r;return r+=u,{...h,_wf_start:c,_wf_end:r,_wf_value:u}});return e.jsxs(Rs,{data:l,children:[e.jsx(Xt,{strokeDasharray:"3 3",stroke:Te}),e.jsx(yt,{dataKey:s,tick:{fontSize:11,fill:Ne},stroke:Te}),e.jsx(Je,{yAxisId:"left",tick:{fontSize:11,fill:Ne},stroke:Te}),e.jsx(Me,{...Cs}),e.jsx(it,{}),e.jsx(ka,{thresholds:a}),e.jsx(mt,{dataKey:"_wf_start",stackId:"wf",fill:"transparent",yAxisId:"left"}),e.jsx(mt,{dataKey:"_wf_value",stackId:"wf",name:((p=n[0])==null?void 0:p.label)||i,yAxisId:"left",radius:[6,6,0,0],children:l.map((h,u)=>e.jsx(fs,{fill:Number(h._wf_value)>=0?"#34d399":"#f87171",fillOpacity:.85},u))})]})}const ph={bar:nh,line:ah,area:ih,scatter:rh,pie:lh,gauge:oh,radar:ch,dual_axes:dh,funnel:uh,waterfall:hh};function mh(t){const{chartType:s,data:n,title:a}=t,i=ph[s];return!i||!n.length?e.jsx(U,{className:"ios-card",children:e.jsx(ce,{description:n.length===0?"No data":`Unknown chart type: ${s}`})}):e.jsx(U,{className:"ios-card",title:a?e.jsx("span",{className:"font-display",style:{fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em"},children:a}):void 0,children:e.jsx(zt,{width:"100%",height:340,children:e.jsx(i,{...t})})})}function hi({title:t,value:s,unit:n,loading:a}){return e.jsx(U,{className:"ios-card",style:{height:"100%"},children:a?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(Ke,{})}):e.jsx(ts,{title:e.jsx("span",{className:"font-display",style:{fontWeight:600,fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em"},children:t}),value:s??void 0,precision:2,suffix:n?e.jsx("span",{style:{fontSize:12,color:"var(--text-muted)"},children:n}):void 0,valueStyle:{fontFamily:"var(--font-mono)",fontWeight:700,color:"var(--accent-strong)"},formatter:i=>i==null?"â€”":String(i)})})}function fh({groups:t,title:s}){const n=d.useMemo(()=>{const i=new Set;return t.forEach(l=>Object.keys(l.group).forEach(o=>i.add(o))),[...[...i].map(l=>({title:e.jsx("span",{style:{fontFamily:"var(--font-mono)"},children:l}),dataIndex:["group",l],key:l,render:o=>String(o??"â€”")})),{title:e.jsx("span",{style:{fontFamily:"var(--font-mono)"},children:"Value"}),dataIndex:"value",key:"_value",align:"right",render:l=>e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontWeight:600,color:"var(--accent-strong)"},children:l.toLocaleString(void 0,{maximumFractionDigits:2})})}]},[t]),a=d.useMemo(()=>t.map((i,r)=>({...i,_key:String(r)})),[t]);return e.jsx(U,{className:"ios-card",title:s?e.jsx("span",{className:"font-display",style:{fontWeight:600},children:s}):void 0,children:e.jsx(ve,{dataSource:a,columns:n,rowKey:"_key",pagination:t.length>20?{pageSize:20,size:"small"}:!1,size:"small"})})}function wr(t,s=""){return t.map(n=>{const a=s?`${s}.${n.name}`:n.name,i=n.children&&n.children.length>0;return{title:`${n.name} (${n.type})`,value:a,selectable:!i,children:i?wr(n.children,a):void 0}})}function gh({entity:t,value:s,onChange:n}){const{data:a,isLoading:i}=O({queryKey:["schema-fields",t],queryFn:()=>tu(t),enabled:!!t}),r=d.useMemo(()=>{if(!a)return[];const l="fields"in a?a:void 0;return l?wr(l.fields):[]},[a]);return e.jsx(Hr,{value:s||void 0,onChange:n,treeData:r,loading:i,placeholder:t?"Select field...":"Choose entity first",disabled:!t,showSearch:!0,treeDefaultExpandAll:!0,style:{width:"100%"},dropdownStyle:{maxHeight:360,overflow:"auto"},popupClassName:"ios-card-elevated"})}const pi=[{value:"project",label:"Project"},{value:"task",label:"Task"},{value:"run",label:"Run"},{value:"issue",label:"Issue"},{value:"cross",label:"Cross-Entity"}],yh=[{value:"sum",label:"Sum"},{value:"avg",label:"Average"},{value:"count",label:"Count"},{value:"min",label:"Min"},{value:"max",label:"Max"},{value:"distinct_count",label:"Distinct Count"},{value:"raw",label:"Raw"},{value:"percentile_50",label:"P50 (Median)"},{value:"percentile_90",label:"P90"},{value:"percentile_99",label:"P99"},{value:"stddev",label:"Std Dev"}],xh=[{value:"stat",label:"Stat Card"},{value:"table",label:"Table"},{value:"bar",label:"Bar Chart"},{value:"line",label:"Line Chart"},{value:"area",label:"Area Chart"},{value:"scatter",label:"Scatter Plot"},{value:"pie",label:"Pie Chart"},{value:"gauge",label:"Gauge"},{value:"radar",label:"Radar"},{value:"dual_axes",label:"Dual Axes (Bar+Line)"},{value:"funnel",label:"Funnel"},{value:"waterfall",label:"Waterfall"}],vh=[{label:"+",value:" + ",title:"Add"},{label:"âˆ’",value:" - ",title:"Subtract"},{label:"Ã—",value:" * ",title:"Multiply"},{label:"Ã·",value:" / ",title:"Divide"},{label:"(",value:"(",title:"Open paren"},{label:")",value:")",title:"Close paren"},{label:"âˆš",value:"sqrt(",title:"Square root"},{label:"xÂ²",value:"^2",title:"Square"},{label:"pow",value:"pow(",title:"Power"},{label:"abs",value:"abs(",title:"Absolute value"},{label:"log",value:"log(",title:"Natural log"},{label:"round",value:"round(",title:"Round"},{label:"ceil",value:"ceil(",title:"Ceiling"},{label:"floor",value:"floor(",title:"Floor"},{label:"min",value:"min(",title:"Minimum"},{label:"max",value:"max(",title:"Maximum"}],jh=[{name:"Issue Count by Category (Bar)",template:{name:"Issue Count by Category",data_source:"issue",formula:"issue_count",variables:[{name:"issue_count",source_entity:"issue",field:"issue_id",aggregation:"count"}],visualization:{chart_type:"bar",x_axis:{field:"category"},y_axes:[{variable:"value",label:"Issues"}]}}},{name:"Issue Severity Distribution (Pie)",template:{name:"Issue Severity Distribution",data_source:"issue",formula:"severity_count",variables:[{name:"severity_count",source_entity:"issue",field:"issue_id",aggregation:"count"}],visualization:{chart_type:"pie",x_axis:{field:"severity"},y_axes:[{variable:"value",label:"Count"}]}}},{name:"Total Mileage by Task (Bar)",template:{name:"Total Mileage by Task",data_source:"run",formula:"total_km",variables:[{name:"total_km",source_entity:"run",field:"total_auto_mileage_km",aggregation:"sum"}],visualization:{chart_type:"bar",x_axis:{field:"task_id"},y_axes:[{variable:"value",label:"Mileage (km)"}]}}},{name:"Fleet Utilization Gauge",template:{name:"Fleet Utilization",data_source:"run",formula:"utilization",variables:[{name:"utilization",source_entity:"run",field:"total_auto_mileage_km",aggregation:"avg"}],visualization:{chart_type:"gauge",y_axes:[{variable:"value",label:"Utilization %"}]}}}],bh=[{value:"left",label:"Left"},{value:"right",label:"Right"}],we={fontFamily:"var(--font-mono)",fontWeight:500};function Qs(){return{name:"",source_entity:"",field:"",aggregation:"count"}}function Gs(){return{variable:"",label:"",color:"",axis_id:"left"}}function Sh({open:t,onClose:s,onSaved:n,editingDef:a}){const[i]=L.useForm(),[r,l]=d.useState(!1),[o,p]=d.useState(!1),[h,u]=d.useState(null),[c,g]=d.useState([Qs()]),[m,k]=d.useState([Gs()]),[x,v]=d.useState("issue"),[b,w]=d.useState([]);d.useEffect(()=>{var C,S;t&&(a?(i.setFieldsValue({name:a.name,description:a.description,data_source:a.data_source,formula:a.formula,chart_type:a.visualization.chart_type,x_axis_field:(C=a.visualization.x_axis)==null?void 0:C.field}),v(a.data_source),g(a.variables.length>0?a.variables.map(E=>({...E})):[Qs()]),k(a.visualization.y_axes&&a.visualization.y_axes.length>0?a.visualization.y_axes.map(E=>({variable:E.variable,label:E.label??"",color:E.color??"",axis_id:E.axis_id??"left"})):[Gs()]),w(((S=a.visualization.thresholds)==null?void 0:S.map(E=>({value:E.value,label:E.label??"",color:E.color??"#ef4444"})))??[])):(i.resetFields(),g([Qs()]),k([Gs()]),w([]),v("issue"),u(null)))},[t,a,i]);const _=(C,S)=>{g(E=>E.map((N,Q)=>Q===C?{...N,...S}:N))},j=C=>{g(S=>S.length<=1?S:S.filter((E,N)=>N!==C))},F=(C,S)=>{k(E=>E.map((N,Q)=>Q===C?{...N,...S}:N))},T=C=>{k(S=>S.length<=1?S:S.filter((E,N)=>N!==C))},y=()=>{const C=i.getFieldsValue();return{name:C.name,description:C.description,data_source:C.data_source,formula:C.formula,variables:c.filter(S=>S.name&&S.field),visualization:{chart_type:C.chart_type||"stat",x_axis:C.x_axis_field?{field:C.x_axis_field}:void 0,y_axes:m.filter(S=>S.variable).map(S=>({variable:S.variable,label:S.label||void 0,color:S.color||void 0,axis_id:S.axis_id||void 0})),thresholds:b.length>0?b.filter(S=>S.value!=null).map(S=>({value:S.value,label:S.label||void 0,color:S.color||"#ef4444"})):void 0,format:C.format_suffix?{suffix:C.format_suffix,precision:C.format_precision}:void 0},enabled:!0}},I=async()=>{try{const C=i.getFieldsValue();if(!C.formula){ie.warning("Enter a formula first");return}p(!0);const S=await lu({formula:C.formula,variables:c.filter(E=>E.name&&E.field)});u(S)}catch(C){const S=C instanceof Error?C.message:"Preview failed";ie.error(S)}finally{p(!1)}},P=async()=>{try{await i.validateFields(),l(!0);const C=y();a?(await au(a.kpi_id,C),ie.success("KPI definition updated")):(await nu(C),ie.success("KPI definition created")),n(),s()}catch(C){if(C&&typeof C=="object"&&"errorFields"in C)return;const S=C instanceof Error?C.message:"Save failed";ie.error(S)}finally{l(!1)}};return e.jsx($e,{open:t,onCancel:s,title:e.jsx("span",{className:"font-display",style:{fontWeight:600},children:a?"Edit KPI Definition":"New KPI Definition"}),width:780,footer:e.jsxs(Z,{children:[e.jsx(z,{onClick:s,children:"Cancel"}),e.jsx(z,{icon:e.jsx(Qr,{}),onClick:I,loading:o,children:"Preview"}),e.jsx(z,{type:"primary",onClick:P,loading:r,children:a?"Update":"Create"})]}),destroyOnClose:!0,children:e.jsxs(L,{form:i,layout:"vertical",requiredMark:"optional",children:[!a&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{...we,fontSize:12,color:"var(--text-muted)",marginBottom:6},children:"Quick Start from Template"}),e.jsx(Z,{wrap:!0,size:[6,6],children:jh.map(C=>e.jsx(z,{size:"small",onClick:()=>{var E,N,Q,oe;const S=C.template;i.setFieldsValue({name:S.name,data_source:S.data_source,formula:S.formula,chart_type:(E=S.visualization)==null?void 0:E.chart_type,x_axis_field:(Q=(N=S.visualization)==null?void 0:N.x_axis)==null?void 0:Q.field}),S.data_source&&v(S.data_source),S.variables&&g(S.variables.map(B=>({...B}))),(oe=S.visualization)!=null&&oe.y_axes&&k(S.visualization.y_axes.map(B=>({variable:B.variable??"",label:B.label??"",color:B.color??"",axis_id:B.axis_id??"left"})))},children:C.name},C.name))})]}),e.jsxs(fe,{gutter:16,children:[e.jsx(q,{span:16,children:e.jsx(L.Item,{name:"name",label:e.jsx("span",{style:we,children:"Name"}),rules:[{required:!0,message:"Name is required"}],children:e.jsx(Y,{placeholder:"e.g. Issue Resolution Rate"})})}),e.jsx(q,{span:8,children:e.jsx(L.Item,{name:"data_source",label:e.jsx("span",{style:we,children:"Data Source"}),rules:[{required:!0}],initialValue:"issue",children:e.jsx(V,{options:pi,onChange:C=>v(C)})})})]}),e.jsx(L.Item,{name:"description",label:e.jsx("span",{style:we,children:"Description"}),children:e.jsx(Y.TextArea,{rows:2,placeholder:"What does this KPI measure?"})}),e.jsx(Cn,{titlePlacement:"left",style:{...we,fontSize:13},children:"Variables"}),c.map((C,S)=>e.jsx(U,{size:"small",className:"ios-card",style:{marginBottom:12},extra:c.length>1&&e.jsx(z,{type:"text",size:"small",icon:e.jsx(en,{}),danger:!0,onClick:()=>j(S)}),children:e.jsxs(fe,{gutter:12,children:[e.jsx(q,{span:5,children:e.jsx(Y,{placeholder:"Variable name",value:C.name,onChange:E=>_(S,{name:E.target.value})})}),e.jsx(q,{span:5,children:e.jsx(V,{value:C.source_entity||void 0,onChange:E=>_(S,{source_entity:E,field:""}),placeholder:"Entity",options:pi,style:{width:"100%"}})}),e.jsx(q,{span:8,children:e.jsx(gh,{entity:C.source_entity||x,value:C.field,onChange:E=>_(S,{field:E})})}),e.jsx(q,{span:6,children:e.jsx(V,{value:C.aggregation,onChange:E=>_(S,{aggregation:E}),options:yh,style:{width:"100%"}})})]})},S)),e.jsx(z,{type:"dashed",icon:e.jsx(At,{}),onClick:()=>g(C=>[...C,Qs()]),block:!0,style:{marginBottom:16},children:"Add Variable"}),e.jsx(L.Item,{name:"formula",label:e.jsx("span",{style:we,children:"Formula"}),rules:[{required:!0,message:"Formula is required"}],extra:e.jsx("span",{style:{color:"var(--text-muted)",fontSize:12},children:"Reference variables by name, e.g. closed_count / total_count * 100"}),children:e.jsx(Y.TextArea,{rows:2,placeholder:"closed_count / total_count * 100",style:{fontFamily:"monospace"}})}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{...we,fontSize:12,color:"var(--text-muted)",marginBottom:6},children:"Operator Palette"}),e.jsxs(Z,{wrap:!0,size:[4,4],children:[vh.map(C=>e.jsx(z,{size:"small",title:C.title,style:{fontFamily:"monospace",minWidth:36},onClick:()=>{const S=i.getFieldValue("formula")||"";i.setFieldsValue({formula:S+C.value})},children:C.label},C.value)),c.filter(C=>C.name).map(C=>e.jsx(z,{size:"small",type:"dashed",style:{fontFamily:"monospace",color:"var(--accent-strong)"},onClick:()=>{const S=i.getFieldValue("formula")||"";i.setFieldsValue({formula:S+C.name})},children:C.name},`var-${C.name}`))]})]}),e.jsx(Cn,{titlePlacement:"left",style:{...we,fontSize:13},children:"Visualization"}),e.jsxs(fe,{gutter:16,children:[e.jsx(q,{span:8,children:e.jsx(L.Item,{name:"chart_type",label:e.jsx("span",{style:we,children:"Chart Type"}),initialValue:"stat",children:e.jsx(V,{options:xh})})}),e.jsx(q,{span:16,children:e.jsx(L.Item,{name:"x_axis_field",label:e.jsx("span",{style:we,children:"X-Axis Field"}),children:e.jsx(Y,{placeholder:"e.g. date, category, status"})})})]}),e.jsx("div",{style:{...we,fontSize:13,marginBottom:8},children:"Y-Axes"}),m.map((C,S)=>e.jsx(U,{size:"small",className:"ios-card",style:{marginBottom:12},extra:m.length>1&&e.jsx(z,{type:"text",size:"small",icon:e.jsx(en,{}),danger:!0,onClick:()=>T(S)}),children:e.jsxs(fe,{gutter:12,children:[e.jsx(q,{span:7,children:e.jsx(Y,{placeholder:"Variable ref",value:C.variable,onChange:E=>F(S,{variable:E.target.value})})}),e.jsx(q,{span:7,children:e.jsx(Y,{placeholder:"Label",value:C.label,onChange:E=>F(S,{label:E.target.value})})}),e.jsx(q,{span:5,children:e.jsx(Y,{placeholder:"#6366f1",value:C.color,onChange:E=>F(S,{color:E.target.value})})}),e.jsx(q,{span:5,children:e.jsx(V,{value:C.axis_id,onChange:E=>F(S,{axis_id:E}),options:bh,style:{width:"100%"}})})]})},S)),e.jsx(z,{type:"dashed",icon:e.jsx(At,{}),onClick:()=>k(C=>[...C,Gs()]),block:!0,style:{marginBottom:16},children:"Add Y-Axis"}),e.jsx("div",{style:{...we,fontSize:13,marginBottom:8},children:"Thresholds (Reference Lines)"}),b.map((C,S)=>e.jsx(U,{size:"small",className:"ios-card",style:{marginBottom:8},children:e.jsxs(fe,{gutter:8,children:[e.jsx(q,{span:8,children:e.jsx(Y,{type:"number",placeholder:"Value",value:C.value,onChange:E=>{const N=[...b];N[S]={...N[S],value:Number(E.target.value)},w(N)}})}),e.jsx(q,{span:8,children:e.jsx(Y,{placeholder:"Label",value:C.label,onChange:E=>{const N=[...b];N[S]={...N[S],label:E.target.value},w(N)}})}),e.jsx(q,{span:5,children:e.jsx(Y,{placeholder:"#ef4444",value:C.color,onChange:E=>{const N=[...b];N[S]={...N[S],color:E.target.value},w(N)}})}),e.jsx(q,{span:3,children:e.jsx(z,{type:"text",danger:!0,size:"small",icon:e.jsx(en,{}),onClick:()=>w(b.filter((E,N)=>N!==S))})})]})},S)),e.jsx(z,{type:"dashed",size:"small",icon:e.jsx(At,{}),onClick:()=>w([...b,{value:0,label:"",color:"#ef4444"}]),style:{marginBottom:16},children:"Add Threshold"}),e.jsxs(fe,{gutter:16,style:{marginBottom:16},children:[e.jsx(q,{span:8,children:e.jsx(L.Item,{name:"format_suffix",label:e.jsx("span",{style:we,children:"Unit Suffix"}),children:e.jsx(Y,{placeholder:"%, km, hours"})})}),e.jsx(q,{span:8,children:e.jsx(L.Item,{name:"format_precision",label:e.jsx("span",{style:we,children:"Precision"}),children:e.jsx(V,{options:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"}],placeholder:"Auto",allowClear:!0})})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx(Cn,{titlePlacement:"left",style:{...we,fontSize:13},children:"Preview Result"}),e.jsx(U,{size:"small",className:"ios-card",children:h.error?e.jsx("span",{style:{color:"var(--danger)"},children:h.error}):e.jsxs("div",{children:[e.jsx("span",{style:{fontFamily:"var(--font-mono)",color:"var(--text-muted)",marginRight:8},children:"Value:"}),e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontWeight:700,fontSize:18,color:"var(--accent-strong)"},children:h.value!=null?h.value.toLocaleString():"â€”"}),h.groups&&h.groups.length>0&&e.jsxs("div",{style:{marginTop:8,fontSize:12,color:"var(--text-secondary)"},children:[h.groups.length," group(s) returned"]})]})})]})]})})}const{Text:Pn}=Ai,{Dragger:kh}=Gr,Ch={dashboards:[{dashboard_id:"demo-quality",name:"Quality Metrics",description:"Issue quality analysis dashboard",kpis:[{name:"Issues by Severity",data_source:"issue",variables:[{name:"count",source_entity:"issue",field:"issue_id",aggregation:"count"}],formula:"count",group_by:["severity"],vchart_spec:{type:"pie",categoryField:"severity",valueField:"value",legends:{visible:!0,orient:"right"},label:{visible:!0}}},{name:"Issues by Category (Bar)",data_source:"issue",variables:[{name:"total",source_entity:"issue",field:"issue_id",aggregation:"count"}],formula:"total",group_by:["category"],vchart_spec:{type:"bar",xField:"category",yField:"value",label:{visible:!0,position:"top"}}},{name:"Issue Status Distribution",data_source:"issue",variables:[{name:"cnt",source_entity:"issue",field:"issue_id",aggregation:"count"}],formula:"cnt",group_by:["status"],vchart_spec:{type:"rose",categoryField:"status",valueField:"value",legends:{visible:!0}}}]},{dashboard_id:"demo-fleet",name:"Fleet Analytics",kpis:[{name:"Mileage by Task Type",data_source:"run",variables:[{name:"mileage",source_entity:"run",field:"total_auto_mileage_km",aggregation:"sum"}],formula:"mileage",group_by:["status"],vchart_spec:{type:"bar",xField:"status",yField:"value",seriesField:"status",label:{visible:!0}}}]}]};function _h({open:t,onClose:s,onImported:n}){const a=Se(),[i,r]=d.useState(null),[l,o]=d.useState(null),[p,h]=d.useState(null),u=pe({mutationFn:x=>ou(x),onSuccess:x=>{h(x),a.invalidateQueries({queryKey:["kpi-definitions"]}),ie.success(`Imported ${x.summary.created} KPIs, updated ${x.summary.updated}`)},onError:x=>{ie.error(x.message||"Import failed")}}),c=d.useCallback(x=>{o(null),r(null),h(null);const v=new FileReader;return v.onload=b=>{var w;try{const _=JSON.parse((w=b.target)==null?void 0:w.result);if(!_.dashboards||!Array.isArray(_.dashboards)){o('JSON must contain a "dashboards" array at the top level.');return}const j=_.dashboards.map(F=>({id:F.dashboard_id??"(unnamed)",name:F.name??"(unnamed)",kpiCount:Array.isArray(F.kpis)?F.kpis.length:0}));r({raw:_,dashboardCount:_.dashboards.length,totalKpis:j.reduce((F,T)=>F+T.kpiCount,0),dashboards:j})}catch{o("Invalid JSON file. Please check the syntax.")}},v.readAsText(x),!1},[]),g=()=>{const x=new Blob([JSON.stringify(Ch,null,2)],{type:"application/json"}),v=URL.createObjectURL(x),b=document.createElement("a");b.href=v,b.download="kpi-dashboard-example.json",b.click(),URL.revokeObjectURL(v)},m=()=>{r(null),o(null),h(null),s()},k=()=>{i!=null&&i.raw&&u.mutate(i.raw)};return e.jsxs($e,{open:t,title:e.jsxs(Z,{children:[e.jsx(Uc,{size:16,style:{color:"var(--accent)"}}),e.jsx("span",{className:"font-display",style:{fontWeight:600},children:"Import KPI Dashboards"})]}),onCancel:m,width:640,footer:p?e.jsx(z,{type:"primary",onClick:()=>{m(),n()},children:"Done"}):e.jsxs(Z,{children:[e.jsx(z,{onClick:m,children:"Cancel"}),e.jsxs(z,{type:"primary",onClick:k,disabled:!i||u.isPending,loading:u.isPending,children:["Import ",i?`(${i.totalKpis} KPIs)`:""]})]}),children:[!p&&e.jsxs(e.Fragment,{children:[e.jsx(kh,{accept:".json",showUploadList:!1,beforeUpload:c,style:{background:"var(--bg-surface)",borderColor:"var(--border-primary)",borderStyle:"dashed",borderRadius:16},children:e.jsxs("div",{style:{padding:"20px 0"},children:[e.jsx(yr,{size:32,style:{color:"var(--accent)",marginBottom:10}}),e.jsx("p",{style:{color:"var(--text-primary)",fontSize:12,marginBottom:4},children:"Drop JSON file here or click to browse"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:11},children:"Supports batch import of multiple dashboards with VChart specs"})]})}),e.jsx("div",{style:{marginTop:12,textAlign:"right"},children:e.jsx(z,{type:"link",size:"small",icon:e.jsx(Wc,{size:12}),onClick:g,style:{color:"var(--accent-strong)",fontSize:11},children:"Download sample JSON"})}),l&&e.jsx(es,{type:"error",showIcon:!0,icon:e.jsx(pr,{size:16}),message:l,style:{marginTop:12}}),i&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx(es,{type:"success",showIcon:!0,icon:e.jsx(un,{size:16}),message:`Parsed ${i.dashboardCount} dashboard(s), ${i.totalKpis} KPI(s)`}),e.jsx(an,{ghost:!0,style:{marginTop:8},items:i.dashboards.map(x=>({key:x.id,label:e.jsxs(Z,{children:[e.jsx(Pn,{style:{color:"var(--text-primary)"},children:x.name}),e.jsxs(K,{color:"cyan",children:[x.kpiCount," KPIs"]})]}),children:e.jsxs(Pn,{style:{color:"var(--text-muted)",fontSize:11},children:["Dashboard ID: ",e.jsx("code",{children:x.id})]})}))})]})]}),p&&e.jsxs("div",{children:[e.jsx(es,{type:p.summary.failed>0?"warning":"success",showIcon:!0,icon:p.summary.failed>0?e.jsx(gr,{size:16}):e.jsx(un,{size:16}),message:`Created: ${p.summary.created}, Updated: ${p.summary.updated}, Failed: ${p.summary.failed}`}),p.results.map(x=>e.jsxs("div",{style:{marginTop:12},children:[e.jsx(Pn,{strong:!0,style:{color:"var(--text-primary)"},children:x.dashboard_id}),e.jsxs("div",{style:{marginLeft:12,marginTop:4},children:[x.created.length>0&&e.jsx("div",{children:x.created.map(v=>e.jsx(K,{color:"green",children:v},v))}),x.failed.length>0&&e.jsx("div",{style:{marginTop:4},children:x.failed.map((v,b)=>e.jsx(es,{type:"error",message:`${v.name}: ${v.error}`,style:{marginBottom:4,fontSize:12},banner:!0},b))})]})]},x.dashboard_id))]})]})}const wh="modulepreload",Fh=function(t){return"/"+t},mi={},Ih=function(s,n,a){let i=Promise.resolve();if(n&&n.length>0){let l=function(h){return Promise.all(h.map(u=>Promise.resolve(u).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),p=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=l(n.map(h=>{if(h=Fh(h),h in mi)return;mi[h]=!0;const u=h.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${c}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":wh,u||(g.as="script"),g.crossOrigin="",g.href=h,p&&g.setAttribute("nonce",p),document.head.appendChild(g),u)return new Promise((m,k)=>{g.addEventListener("load",m),g.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${h}`)))})}))}function r(l){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=l,window.dispatchEvent(o),!o.defaultPrevented)throw l}return i.then(l=>{for(const o of l||[])o.status==="rejected"&&r(o.reason);return s().catch(r)})},Fr=["#8b929a","#60a5fa","#34d399","#fbbf24","#f87171","#a78bfa","#fb923c","#22d3ee","#e879f9","#4ade80"],Th={background:"transparent",colorScheme:{default:Fr},series:{bar:{style:{fillOpacity:.85}},line:{style:{lineWidth:2}},area:{style:{fillOpacity:.2}},pie:{style:{stroke:"rgba(255,255,255,0.06)",lineWidth:1}}},component:{axis:{domainLine:{style:{stroke:"rgba(255,255,255,0.1)"}},grid:{style:{stroke:"rgba(255,255,255,0.05)",lineDash:[3,3]}},label:{style:{fill:"#505660",fontSize:10}},title:{style:{fill:"#8b929a",fontSize:11}}},legend:{item:{label:{style:{fill:"#8b929a",fontSize:10}}}},tooltip:{panel:{style:{background:"rgba(24,25,30,0.95)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0,0,0,0.3)"}},titleLabel:{style:{fill:"#e4e7eb",fontSize:11}},contentLabel:{style:{fill:"#8b929a",fontSize:10}},contentValue:{style:{fill:"#e4e7eb",fontSize:10}}}}};let Et=null;const Rh=async()=>Et||(Et=(await Ih(()=>import("./index-CFtQHdc-.js"),__vite__mapDeps([0,1,2]))).default,Et);function Ph({spec:t,data:s,title:n,height:a=340,loading:i}){const r=d.useRef(null),l=d.useRef(null),[o,p]=d.useState(!!Et);d.useEffect(()=>{Et||Rh().then(()=>p(!0))},[]);const h=d.useMemo(()=>{const u={...t};return s&&s.length>0&&(Array.isArray(u.data)?u.data=u.data.map((c,g)=>g===0?{...c,values:s}:c):u.data&&typeof u.data=="object"?u.data={...u.data,values:s}:u.data={id:"kpiData",values:s}),u.background="transparent",u.padding=u.padding??12,u.width=void 0,u.height=a,u.color||(u.color=Fr),u.theme={...Th},u},[t,s,a]);return d.useEffect(()=>{if(!r.current||!o||!Et)return;if(l.current){l.current.updateSpec(h);return}const u=new Et(h,{dom:r.current});return u.renderSync(),l.current=u,()=>{u.release(),l.current=null}},[h,o]),i||!o?e.jsx(U,{className:"ios-card",children:e.jsx("div",{style:{display:"flex",justifyContent:"center",padding:40},children:e.jsx(Ke,{})})}):!t||!t.type?e.jsx(U,{className:"ios-card",children:e.jsx(ce,{description:"Invalid VChart spec"})}):e.jsx(U,{className:"ios-card",title:n?e.jsx("span",{className:"font-display",style:{fontWeight:600},children:n}):void 0,children:e.jsx("div",{ref:r,style:{width:"100%",height:a}})})}const Qt={background:"#FFFFFF",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.08)",border:"none",padding:20};function fi(t){return t>=80?"#34C759":t>=50?"#FF9500":"#FF3B30"}function Eh({projectId:t,startDate:s,endDate:n,interval:a}){const i={project_id:t,start_date:s||void 0,end_date:n||void 0},{data:r}=O({queryKey:["kpi-mpi",t,s,n],queryFn:()=>Qd(i),enabled:!!t}),{data:l}=O({queryKey:["kpi-mttr",t,s,n],queryFn:()=>Gd(i),enabled:!!t}),{data:o}=O({queryKey:["kpi-rpr",t],queryFn:()=>Jd({project_id:t}),enabled:!!t}),{data:p}=O({queryKey:["kpi-fleet",t,s,n],queryFn:()=>Yd(i),enabled:!!t}),{data:h}=O({queryKey:["kpi-convergence",t,s,n,a],queryFn:()=>Xd({...i,interval:a}),enabled:!!t}),u=d.useMemo(()=>{var m;return((m=h==null?void 0:h.points)==null?void 0:m.map(k=>{var x,v;return{timestamp:k.timestamp,open:Number(((x=k.dimensions)==null?void 0:x.open_count)??k.value??0),closed:Number(((v=k.dimensions)==null?void 0:v.closed_count)??0)}}))??[]},[h]),c=[{title:"Miles Per Intervention",value:r==null?void 0:r.value,unit:"km"},{title:"Mean Time To Resolution",value:l==null?void 0:l.value,unit:"hours"}],g=[{title:"Regression Pass Rate",value:o==null?void 0:o.value,unit:"%"},{title:"Fleet Utilization",value:p==null?void 0:p.value,unit:"%"}];return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16,marginBottom:24},children:[c.map(m=>e.jsx("div",{className:"ios-card",style:Qt,children:e.jsx(ts,{title:e.jsx("span",{style:{fontWeight:600,fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em",color:"#8E8E93"},children:m.title}),value:m.value!=null?Number(m.value):void 0,precision:1,suffix:e.jsx("span",{style:{fontSize:12,color:"#8E8E93"},children:m.unit}),valueStyle:{fontFamily:"var(--font-mono)",fontWeight:700,color:"#76B900"}})},m.title)),g.map(m=>{const k=m.value!=null?Number(m.value):null;return e.jsxs("div",{className:"ios-card",style:Qt,children:[e.jsx("div",{style:{fontWeight:600,fontSize:11,color:"#8E8E93",marginBottom:6,textTransform:"uppercase",letterSpacing:"0.06em"},children:m.title}),e.jsxs("div",{style:{fontFamily:"var(--font-mono)",fontSize:28,fontWeight:700,color:k!=null?fi(k):"#1C1C1E",marginBottom:8},children:[k!=null?k.toFixed(1):"â€”",e.jsx("span",{style:{fontSize:12,color:"#8E8E93",marginLeft:4},children:m.unit})]}),e.jsx(ta,{percent:k!=null?Math.min(100,Math.max(0,k)):0,showInfo:!1,strokeColor:k!=null?fi(k):"#34C759",size:"small"})]},m.title)}),e.jsxs("div",{className:"ios-card",style:{...Qt,gridColumn:"span 2",minHeight:340},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,color:"#1C1C1E",marginBottom:16,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Issue Convergence"}),u.length>0?e.jsx(zt,{width:"100%",height:280,children:e.jsxs(Oi,{data:u,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"openGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#FF3B30",stopOpacity:.15}),e.jsx("stop",{offset:"100%",stopColor:"#FF3B30",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"closedGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#76B900",stopOpacity:.15}),e.jsx("stop",{offset:"100%",stopColor:"#76B900",stopOpacity:0})]})]}),e.jsx(Xt,{strokeDasharray:"3 3",stroke:"rgba(0,0,0,0.06)"}),e.jsx(yt,{dataKey:"timestamp",tick:{fontSize:10,fill:"#8E8E93"},tickFormatter:m=>new Date(m).toLocaleDateString(),stroke:"rgba(0,0,0,0.06)"}),e.jsx(Je,{tick:{fontSize:10,fill:"#8E8E93"},stroke:"rgba(0,0,0,0.06)"}),e.jsx(Me,{labelFormatter:m=>new Date(m).toLocaleDateString(),contentStyle:{background:"#FFFFFF",border:"1px solid rgba(0,0,0,0.08)",borderRadius:12,color:"#1C1C1E",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),e.jsx(it,{}),e.jsx(An,{type:"monotone",dataKey:"open",stroke:"#FF3B30",fill:"url(#openGrad)",name:"Open",strokeWidth:2}),e.jsx(An,{type:"monotone",dataKey:"closed",stroke:"#76B900",fill:"url(#closedGrad)",name:"Closed",strokeWidth:2})]})}):e.jsx(ce,{description:"No convergence data available"})]})]})}function Ah({def:t,projectId:s}){var o,p,h,u,c,g,m;const n={};s&&(n.project_id=s);const{data:a,isLoading:i}=O({queryKey:["kpi-custom",t.kpi_id,s],queryFn:()=>ru(t.kpi_id,n),enabled:t.enabled}),r=t.renderer==="vchart"&&t.vchart_spec,l=((o=t.visualization)==null?void 0:o.chart_type)??"stat";if(r&&t.vchart_spec){const k=a!=null&&a.groups?a.groups.map(x=>({...x.group,value:x.value})):(a==null?void 0:a.value)!=null?[{value:a.value}]:[];return e.jsx(Ph,{spec:t.vchart_spec,data:k,title:t.name,loading:i})}if(l==="stat")return e.jsx(hi,{title:t.name,value:(a==null?void 0:a.value)??null,loading:i});if(l==="table"&&(a!=null&&a.groups))return e.jsx(U,{className:"ios-card",style:Qt,title:e.jsx("span",{style:{fontWeight:600,color:"#1C1C1E"},children:t.name}),children:e.jsx(fh,{groups:a.groups})});if(a!=null&&a.groups&&a.groups.length>0){const k=a.groups.map(w=>({...w.group,value:w.value})),x=((h=(p=t.visualization)==null?void 0:p.x_axis)==null?void 0:h.field)??Object.keys(((u=a.groups[0])==null?void 0:u.group)??{})[0]??"group",v=((g=(c=t.visualization)==null?void 0:c.y_axes)==null?void 0:g.map(w=>({key:w.variable??"value",label:w.label,color:w.color,axisId:w.axis_id})))??[{key:"value",label:t.name}],b=(m=t.visualization)==null?void 0:m.thresholds;return e.jsx(U,{className:"ios-card",style:Qt,title:e.jsx("span",{style:{fontWeight:600,color:"#1C1C1E"},children:t.name}),children:e.jsx(mh,{chartType:l,data:k,xField:x,yFields:v,thresholds:b})})}return e.jsx(hi,{title:t.name,value:(a==null?void 0:a.value)??null,loading:i})}function zh(){const t=Se(),[s,n]=d.useState(""),[a,i]=d.useState(""),[r,l]=d.useState(""),[o,p]=d.useState("day"),[h,u]=d.useState(!0),[c,g]=d.useState(!1),[m,k]=d.useState(!1),[x,v]=d.useState(),{data:b}=O({queryKey:["projects"],queryFn:()=>ks({})}),{data:w}=O({queryKey:["kpi-definitions"],queryFn:su}),_=pe({mutationFn:F=>iu(F),onSuccess:()=>t.invalidateQueries({queryKey:["kpi-definitions"]})}),j=d.useMemo(()=>{if(!w)return new Map;const F=new Map;for(const T of w.filter(y=>y.enabled)){const y=T.dashboard_id??"__ungrouped__",I=F.get(y)??[];I.push(T),F.set(y,I)}return F},[w]);return e.jsxs("div",{style:{background:"#F5F5F7",minHeight:"100vh"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24,flexWrap:"wrap",gap:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx(dn,{size:24,style:{color:"#76B900"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",style:{margin:0,color:"#1C1C1E"},children:"KPI Overview"}),e.jsx("p",{style:{margin:0,color:"#8E8E93",fontSize:13},children:"Key performance indicators for autonomous driving test campaigns"})]})]}),e.jsxs(Z,{wrap:!0,children:[e.jsx(V,{value:s||void 0,onChange:n,placeholder:"Select Project",style:{width:200},allowClear:!0,options:b==null?void 0:b.map(F=>({value:F.id,label:F.name}))}),e.jsx(Ts,{placeholder:"Start date",onChange:(F,T)=>i(typeof T=="string"?T:""),style:{width:140}}),e.jsx(Ts,{placeholder:"End date",onChange:(F,T)=>l(typeof T=="string"?T:""),style:{width:140}}),e.jsx(V,{value:o,onChange:F=>p(F),style:{width:110},options:[{value:"day",label:"Daily"},{value:"week",label:"Weekly"},{value:"month",label:"Monthly"}]})]})]}),e.jsx("div",{className:"ios-card",style:{...Qt,marginBottom:24},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,marginBottom:4,textTransform:"uppercase",letterSpacing:"0.06em",color:"#1C1C1E"},children:"Panel Configuration"}),e.jsxs(Z,{children:[e.jsx("span",{style:{color:"#8E8E93",fontSize:12},children:"Built-in metrics"}),e.jsx(zi,{size:"small",checked:h,onChange:u})]})]}),e.jsxs(Z,{children:[e.jsx(z,{icon:e.jsx(yr,{size:14}),onClick:()=>k(!0),style:{borderColor:"#E5E5EA",color:"#76B900",borderRadius:8},children:"Import JSON"}),e.jsx(z,{type:"primary",icon:e.jsx(fr,{size:14}),onClick:()=>{v(void 0),g(!0)},style:{background:"#76B900",borderColor:"#76B900",borderRadius:8},children:"Add Custom KPI"})]})]})}),!s&&e.jsxs("div",{className:"ios-card",style:{...Qt,textAlign:"center",padding:"48px 20px"},children:[e.jsx(rd,{size:48,style:{color:"#C7C7CC",marginBottom:16}}),e.jsx("p",{style:{color:"#8E8E93",fontSize:14,margin:0},children:"Select a project to view KPI metrics"})]}),s&&e.jsxs(e.Fragment,{children:[h&&e.jsx(Eh,{projectId:s,startDate:a,endDate:r,interval:o}),j.size>0&&e.jsxs("div",{style:{marginTop:24},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,marginBottom:12,color:"#1C1C1E",textTransform:"uppercase",letterSpacing:"0.04em"},children:"Custom KPIs"}),Array.from(j.entries()).map(([F,T])=>{var C;const y=(C=T[0])==null?void 0:C.dashboard_name,I=F!=="__ungrouped__",P=e.jsx(fe,{gutter:[16,16],children:T.map(S=>{var N;const E=S.renderer==="vchart"||((N=S.visualization)==null?void 0:N.chart_type)!=="stat";return e.jsx(q,{xs:24,md:E?24:8,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Ah,{def:S,projectId:s}),e.jsxs("div",{style:{position:"absolute",top:8,right:8,display:"flex",gap:4},children:[e.jsx(z,{size:"small",type:"text",icon:e.jsx(mr,{size:12}),onClick:()=>{v(S),g(!0)},style:{color:"#8E8E93"}}),e.jsx(En,{title:"Delete this KPI?",onConfirm:()=>_.mutate(S.kpi_id),okText:"Delete",cancelText:"Cancel",children:e.jsx(z,{size:"small",type:"text",danger:!0,icon:e.jsx(zs,{size:12})})})]})]})},S.kpi_id)})});return I?e.jsx(an,{ghost:!0,defaultActiveKey:[F],style:{marginBottom:16},items:[{key:F,label:e.jsxs(Z,{children:[e.jsx("span",{style:{color:"#1C1C1E",fontWeight:600},children:y??F}),e.jsxs(K,{color:"cyan",children:[T.length," KPIs"]}),T.some(S=>S.renderer==="vchart")&&e.jsx(K,{color:"magenta",children:"VChart"})]}),children:P}]},F):e.jsx("div",{children:P},F)})]})]}),e.jsx(Sh,{open:c,onClose:()=>{g(!1),v(void 0)},onSaved:()=>{t.invalidateQueries({queryKey:["kpi-definitions"]}),g(!1),v(void 0)},editingDef:x}),e.jsx(_h,{open:m,onClose:()=>k(!1),onImported:()=>t.invalidateQueries({queryKey:["kpi-definitions"]})})]})}const Mh={requirement:"#007AFF",commit:"#AF52DE",build:"#FF9500",project:"#76B900",task:"#FFCC00",run:"#34C759",issue:"#FF3B30"},Nh={requirement:"REQ",commit:"CMT",build:"BLD",project:"PRJ",task:"TSK",run:"RUN",issue:"ISS"};function Oh({percentage:t,covered:s,total:n}){const a=t!=null?Number(t):0,i=120,r=10,l=(i-r)/2,o=2*Math.PI*l,p=o-a/100*o,h=a>=80?"#34C759":a>=50?"#FF9500":"#FF3B30";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:32},children:[e.jsxs("div",{style:{position:"relative",width:i,height:i,flexShrink:0},children:[e.jsxs("svg",{width:i,height:i,style:{transform:"rotate(-90deg)"},children:[e.jsx("circle",{cx:i/2,cy:i/2,r:l,fill:"none",stroke:"var(--border-secondary)",strokeWidth:r}),e.jsx("circle",{cx:i/2,cy:i/2,r:l,fill:"none",stroke:h,strokeWidth:r,strokeDasharray:o,strokeDashoffset:p,strokeLinecap:"round",style:{transition:"stroke-dashoffset 0.6s ease"}})]}),e.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontSize:24,fontWeight:700,color:"var(--text-primary)",lineHeight:1},children:t!=null?`${a.toFixed(0)}`:"â€”"}),e.jsx("span",{style:{fontSize:11,color:"var(--text-muted)",fontWeight:500},children:"%"})]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text-primary)",marginBottom:4},children:"Requirement Verification"}),e.jsxs("div",{style:{fontSize:13,color:"var(--text-secondary)",marginBottom:12},children:[s," of ",n," requirements verified"]}),e.jsx(ta,{percent:a,showInfo:!1,strokeColor:h,size:"small",style:{maxWidth:280}}),e.jsxs("div",{style:{display:"flex",gap:16,marginTop:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:"#34C759"}}),e.jsxs("span",{style:{fontSize:12,color:"var(--text-muted)"},children:["Covered (",s,")"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:"var(--border-primary)"}}),e.jsxs("span",{style:{fontSize:12,color:"var(--text-muted)"},children:["Remaining (",n-s,")"]})]})]})]})]})}function Dh({nodes:t,links:s}){return e.jsx("div",{style:{overflowX:"auto",padding:"16px 0"},children:e.jsx("div",{style:{display:"flex",alignItems:"flex-start",minWidth:"max-content"},children:t.map((n,a)=>{const i=n.type,r=Mh[i]??"#6E6E73",l=Nh[i]??"?",o=a<s.length?s[a]:null;return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:100,maxWidth:140},children:[e.jsx(gn,{title:`${i}: ${n.id}`,children:e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:r,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:700,color:i==="task"?"#1D1D1F":"#fff",fontFamily:"var(--font-mono)",boxShadow:`0 2px 8px ${r}40`,cursor:"default",flexShrink:0},children:l})}),e.jsx(K,{style:{marginTop:8,fontSize:11,fontWeight:500,borderColor:`${r}30`,color:i==="task"?"#8B7500":r,background:`${r}10`,borderRadius:"var(--radius-full)",maxWidth:130,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i}),e.jsx("div",{style:{marginTop:4,fontSize:11,color:"var(--text-secondary)",fontFamily:"var(--font-mono)",maxWidth:130,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"center"},children:n.label||n.id})]}),a<t.length-1&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",alignSelf:"flex-start",paddingTop:18,minWidth:60},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx("div",{style:{flex:1,height:2,background:"var(--border-primary)"}}),e.jsx("div",{style:{width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:"6px solid var(--border-primary)"}})]}),o&&e.jsx("span",{style:{fontSize:10,color:"var(--text-muted)",marginTop:4,fontStyle:"italic",whiteSpace:"nowrap"},children:o.relationship})]})]},a)})})})}function Lh(){const[t,s]=d.useState("forward"),[n,a]=d.useState(""),[i,r]=d.useState(""),{data:l,isLoading:o}=O({queryKey:["trace-forward",i],queryFn:()=>Ud(i),enabled:t==="forward"&&!!i}),{data:p,isLoading:h}=O({queryKey:["trace-backward",i],queryFn:()=>Vd(i),enabled:t==="backward"&&!!i}),{data:u}=O({queryKey:["trace-coverage"],queryFn:()=>Hd()}),c=()=>{r(n.trim())},g=t==="forward"?l:p,m=t==="forward"?o:h,k=(g==null?void 0:g.links)??[];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:4},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:10,background:"rgba(118, 185, 0, 0.10)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Vc,{size:20,style:{color:"#76B900"}})}),e.jsx("h1",{className:"page-title",children:"Traceability"})]}),e.jsx("p",{className:"page-subtitle",style:{marginBottom:24},children:"End-to-end links between requirements, tasks, runs, and issues for coverage and impact analysis."}),u&&e.jsx(U,{className:"ios-card-elevated",style:{marginBottom:24,border:"none"},children:e.jsx(Oh,{percentage:u.percentage!=null?Number(u.percentage):null,covered:Number(u.covered??0),total:Number(u.total??0)})}),e.jsx(Ei,{activeKey:t,onChange:x=>{s(x),r(""),a("")},items:[{key:"forward",label:"Forward Trace"},{key:"backward",label:"Backward Trace"}],style:{marginBottom:16}}),e.jsxs(Z.Compact,{style:{width:"100%",maxWidth:500,marginBottom:24},children:[e.jsx(Y,{value:n,onChange:x=>a(x.target.value),placeholder:t==="forward"?"Enter Requirement ID...":"Enter Issue ID...",onPressEnter:c,size:"large"}),e.jsx(z,{type:"primary",icon:e.jsx(fn,{}),onClick:c,disabled:!n.trim(),size:"large",style:{background:"#76B900",borderColor:"#76B900"},children:"Trace"})]}),m&&e.jsx(Ws,{}),g&&g.nodes&&g.nodes.length>0&&e.jsx(U,{className:"ios-card",title:e.jsxs("span",{className:"font-display",style:{fontWeight:600},children:[t==="forward"?"Forward":"Backward"," Trace from"," ",e.jsx("code",{style:{color:"#76B900",background:"rgba(118,185,0,0.08)",padding:"2px 8px",borderRadius:6,fontSize:13},children:g.origin_id})]}),extra:e.jsxs(K,{style:{borderRadius:"var(--radius-full)",fontWeight:500},children:[g.nodes.length," nodes"]}),children:e.jsx(Dh,{nodes:g.nodes,links:k})}),i&&!m&&g&&(!g.nodes||g.nodes.length===0)&&e.jsx(U,{className:"ios-card",children:e.jsx(ce,{description:`No trace results found for "${i}"`})})]})}const Bh=["Rule-based classification","ML severity prediction","Auto-assignment to team","Historical pattern matching"],$h=[{label:"Severity",value:"P1 â€” Critical",color:"#FF3B30"},{label:"Category",value:"Perception > LiDAR",color:"#007AFF"},{label:"Assigned Team",value:"Sensor Fusion",color:"#AF52DE"},{label:"Confidence",value:"92%",color:"#34C759"}];function qh(){return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:4},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:10,background:"rgba(175, 82, 222, 0.10)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(li,{size:20,style:{color:"#AF52DE"}})}),e.jsx("h1",{className:"page-title",children:"Auto-Triage"}),e.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:4,background:"rgba(175, 82, 222, 0.08)",color:"#AF52DE",fontSize:11,fontWeight:600,padding:"3px 10px",borderRadius:"var(--radius-full)",letterSpacing:"0.02em"},children:"Beta"})]}),e.jsx("p",{className:"page-subtitle",style:{marginBottom:24},children:"Intelligent automated issue classification and assignment powered by rule engine and ML models."}),e.jsxs(U,{className:"ios-card-elevated",style:{marginBottom:24,border:"none"},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text-primary)",marginBottom:12,display:"flex",alignItems:"center",gap:8},children:[e.jsx(Dc,{size:16,style:{color:"#AF52DE"}}),"AI Issue Analysis"]}),e.jsx("textarea",{placeholder:"Describe an issue or paste error logs...",disabled:!0,style:{width:"100%",minHeight:120,padding:16,border:"1px solid var(--border-secondary)",borderRadius:"var(--radius-sm)",background:"var(--bg-deep)",color:"var(--text-muted)",fontSize:14,fontFamily:"var(--font-body)",resize:"vertical",outline:"none"}}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:12},children:e.jsx(gn,{title:"Feature in development",children:e.jsxs("button",{className:"btn-primary-green",disabled:!0,style:{opacity:.5,cursor:"not-allowed",display:"flex",alignItems:"center",gap:6},children:[e.jsx(li,{size:14}),"Analyze"]})})}),e.jsxs("div",{style:{marginTop:20,padding:16,background:"var(--bg-deep)",borderRadius:"var(--radius-sm)",border:"1px dashed var(--border-primary)"},children:[e.jsx("div",{style:{fontSize:11,fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:12},children:"Analysis Preview"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))",gap:12},children:$h.map(t=>e.jsxs("div",{style:{background:"var(--bg-surface)",border:"1px solid var(--border-secondary)",borderRadius:"var(--radius-xs)",padding:"12px 14px"},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.04em",marginBottom:4},children:t.label}),e.jsx("div",{style:{fontSize:14,fontWeight:600,color:t.color},children:t.value})]},t.label))}),e.jsx("div",{style:{textAlign:"center",marginTop:12,fontSize:12,color:"var(--text-muted)",fontStyle:"italic"},children:"Sample output â€” actual results will appear here once enabled"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:24},children:[e.jsxs(U,{className:"ios-card",style:{border:"none"},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text-primary)",marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[e.jsx(qc,{size:16,style:{color:"#FF9500"}}),"Recent Analyses"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"32px 0",color:"var(--text-muted)"},children:[e.jsx(Qc,{size:36,style:{color:"var(--border-primary)",marginBottom:12}}),e.jsx("span",{style:{fontSize:13,fontWeight:500},children:"No analyses yet"}),e.jsx("span",{style:{fontSize:12,marginTop:4},children:"Past triage results will appear here"})]})]}),e.jsxs(U,{className:"ios-card",style:{border:"none"},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text-primary)",marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[e.jsx(dn,{size:16,style:{color:"#34C759"}}),"Triage Accuracy"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"32px 0",color:"var(--text-muted)"},children:[e.jsx("div",{style:{width:48,height:48,borderRadius:12,background:"rgba(52, 199, 89, 0.06)",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:12},children:e.jsx(dn,{size:24,style:{color:"var(--border-primary)"}})}),e.jsx("span",{style:{fontSize:13,fontWeight:500},children:"Coming Soon"}),e.jsx("span",{style:{fontSize:12,marginTop:4},children:"Accuracy metrics available after first analyses"})]})]})]}),e.jsxs(U,{className:"ios-card",style:{border:"none"},children:[e.jsx("div",{style:{fontSize:11,fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:16},children:"Planned Capabilities"}),e.jsx(Z,{direction:"vertical",size:12,style:{width:"100%"},children:Bh.map(t=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx(un,{size:16,style:{color:"var(--text-muted)",opacity:.4,flexShrink:0}}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:14},children:t})]},t))})]})]})}const Js=["#6366f1","#22c55e","#f59e0b","#ef4444","#3b82f6","#ec4899","#14b8a6","#a855f7"],Kh=(t,s)=>gs.divIcon({className:"",html:`<div style="width:20px;height:20px;border-radius:50%;background:${t};border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:bold;color:#fff">${s+1}</div>`,iconSize:[20,20],iconAnchor:[10,10]});function Wh({onAdd:t}){return pl({click(s){t(s.latlng.lat,s.latlng.lng)}}),null}function Uh({routes:t,onChange:s,mode:n,startPoint:a}){const[i,r]=d.useState(!1),[l,o]=d.useState(-1),[p,h]=d.useState(!1),u=t.length>0&&t[0].waypoints.length>0?[t[0].waypoints[0].lat,t[0].waypoints[0].lng]:a?[a.lat,a.lng]:[31.23,121.47],c=n==="custom"||p,g=l>=0&&l<t.length?l:t.length>0?t.length-1:-1,m=d.useCallback((y,I)=>{if(!c)return;const P=[...t];if(P.length===0)P.push({route_id:`ROUTE-${Date.now().toString(36)}`,name:"Route 1",waypoints:[{lat:y,lng:I}]});else{const C=g>=0?g:P.length-1,S={...P[C],waypoints:[...P[C].waypoints,{lat:y,lng:I}]};delete S.road,P[C]=S}s(P)},[t,s,c,g]),k=(y,I)=>{const P=[...t],C={...P[y],waypoints:P[y].waypoints.filter((S,E)=>E!==I)};delete C.road,P[y]=C,s(P)},x=(y,I,P,C)=>{const S=[...t],E=[...S[y].waypoints];E[I]={lat:P,lng:C};const N={...S[y],waypoints:E};delete N.road,S[y]=N,s(S)},v=()=>{const y=t.length;s([...t,{route_id:`ROUTE-${Date.now().toString(36)}`,name:`Route ${y+1}`,waypoints:[]}]),o(y)},b=y=>{s(t.filter((I,P)=>P!==y)),l>=t.length-1&&o(Math.max(0,t.length-2))},w=async()=>{if(t.filter(I=>I.waypoints.length>=2).length===0){ie.warning("Each route needs at least 2 waypoints to plan a road route");return}r(!0);try{const I=await ju(t);s(I.routes),ie.success(`${I.routes.length} route(s) snapped to real roads`)}catch(I){ie.error(`Road planning failed: ${I.message}`)}finally{r(!1)}},_=()=>{h(!p),!p&&t.length>0&&o(t.length-1)},j=t.some(y=>y.road),F=t.reduce((y,I)=>{var P;return y+(((P=I.road)==null?void 0:P.total_distance_m)??0)},0),T=t.reduce((y,I)=>{var P;return y+(((P=I.road)==null?void 0:P.total_duration_s)??0)},0);return t.length===0&&n==="random"?e.jsx("div",{style:{marginTop:16},children:e.jsx(ce,{description:"Click 'Generate Routes' above to preview"})}):e.jsxs("div",{style:{marginTop:16},children:[e.jsx(Ke,{spinning:i,tip:"Snapping routes to real roads via OSRM...",children:e.jsx("div",{style:{height:400,marginBottom:12,position:"relative"},children:e.jsxs(aa,{center:u,zoom:12,style:{height:"100%",width:"100%",borderRadius:8},children:[e.jsx(ia,{url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:"Â© CartoDB"}),c&&e.jsx(Wh,{onAdd:m}),t.map((y,I)=>{var N;const P=Js[I%Js.length],C=(N=y.road)==null?void 0:N.coordinates,S=C??y.waypoints,E=I===g;return e.jsxs("span",{children:[e.jsx(Ps,{positions:S.map(Q=>[Q.lat,Q.lng]),pathOptions:{color:P,weight:C?4:3,opacity:E?.9:.4,dashArray:C?void 0:"8 4"}}),C&&y.waypoints.length>0&&e.jsx(Ps,{positions:y.waypoints.map(Q=>[Q.lat,Q.lng]),pathOptions:{color:P,weight:1,opacity:.3,dashArray:"4 4"}}),y.waypoints.map((Q,oe)=>e.jsx(ra,{position:[Q.lat,Q.lng],icon:Kh(P,oe),draggable:c,eventHandlers:{dragend:B=>{const W=B.target.getLatLng();x(I,oe,W.lat,W.lng)}},children:e.jsx(la,{children:e.jsxs("div",{style:{fontSize:12,minWidth:180},children:[e.jsx("strong",{children:y.name||y.route_id})," â€” WP ",oe+1,e.jsx("br",{}),e.jsxs(Z,{size:4,style:{marginTop:4},children:[e.jsx(Ee,{size:"small",style:{width:90},step:1e-4,value:Number(Q.lat.toFixed(5)),onChange:B=>B!=null&&x(I,oe,B,Q.lng)}),e.jsx(Ee,{size:"small",style:{width:90},step:1e-4,value:Number(Q.lng.toFixed(5)),onChange:B=>B!=null&&x(I,oe,Q.lat,B)})]}),c&&e.jsx("div",{style:{marginTop:4},children:e.jsx(z,{size:"small",type:"text",danger:!0,icon:e.jsx(zs,{size:10}),onClick:()=>k(I,oe),children:"Remove"})})]})})},`wp-${y.route_id}-${oe}`)),S.length>0&&e.jsx(zn,{center:[S[0].lat,S[0].lng],radius:7,pathOptions:{color:"#fff",fillColor:P,fillOpacity:1,weight:2},children:e.jsxs(rn,{children:[y.name||y.route_id," (Start)"]})}),S.length>1&&e.jsx(zn,{center:[S[S.length-1].lat,S[S.length-1].lng],radius:7,pathOptions:{color:"#fff",fillColor:"#ef4444",fillOpacity:1,weight:2},children:e.jsxs(rn,{children:[y.name||y.route_id," (End)"]})})]},y.route_id)})]})})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8,flexWrap:"wrap",gap:8},children:[e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:12},children:[t.length," route(s) Â· ",c?"Click map to add waypoints Â· Drag to move":"View only",j&&e.jsxs("span",{style:{marginLeft:8},children:[e.jsx(Jr,{status:"success",text:"",style:{marginRight:4}}),"Road-planned Â· ",(F/1e3).toFixed(1)," km Â· ~",Math.round(T/60)," min"]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[t.length>0&&t.some(y=>y.waypoints.length>=2)&&e.jsx(z,{size:"small",type:j?"default":"primary",icon:e.jsx(td,{size:12}),loading:i,onClick:w,children:j?"Re-plan Roads":"Plan on Roads"}),n==="random"&&t.length>0&&e.jsx(z,{size:"small",type:p?"primary":"default",icon:p?e.jsx(ld,{size:12}):e.jsx(mr,{size:12}),onClick:_,children:p?"Done Editing":"Edit Waypoints"}),c&&e.jsx(z,{size:"small",icon:e.jsx(Zc,{size:12}),onClick:v,children:"New Route"})]})]}),e.jsx(Oa,{size:"small",dataSource:t,renderItem:(y,I)=>{const P=I===g&&c;return e.jsx(Oa.Item,{style:{cursor:c?"pointer":void 0,background:P?"rgba(99,102,241,0.1)":void 0,borderRadius:4},onClick:()=>c&&o(I),actions:c?[e.jsx(z,{size:"small",type:"text",danger:!0,icon:e.jsx(zs,{size:12}),onClick:C=>{C.stopPropagation(),b(I)}})]:void 0,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1},children:[e.jsx(K,{color:Js[I%Js.length],children:y.name||y.route_id}),e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:12},children:[y.waypoints.length," waypoints"]}),y.road&&e.jsxs(Ai.Text,{type:"success",style:{fontSize:11},children:[(y.road.total_distance_m/1e3).toFixed(1)," km Â· ",y.road.coordinates.length," pts"]}),P&&e.jsx(K,{color:"processing",style:{fontSize:10},children:"Active"})]})})}})]})}function Vh({vehicles:t,projects:s,tasks:n,assignments:a,onChange:i}){const r=(u,c)=>a.some(g=>g.vin===u&&g.task_id===c),l=(u,c,g)=>{r(u,c)?i(a.filter(m=>!(m.vin===u&&m.task_id===c))):i([...a,{vin:u,project_id:g,task_id:c}])},o=()=>{if(n.length===0)return;const u=n[0],c=s.find(g=>g.id===u.projectId);c&&i(t.map(g=>({vin:g.vin,project_id:c.id,task_id:u.id})))},p=()=>{const u=[];t.forEach((c,g)=>{const m=n[g%n.length],k=s.find(x=>x.id===m.projectId);k&&u.push({vin:c.vin,project_id:k.id,task_id:m.id})}),i(u)},h=[{title:"Vehicle",dataIndex:"vin",key:"vin",fixed:"left",width:180,render:u=>e.jsx("code",{style:{fontSize:11},children:u})},...n.map(u=>{const c=s.find(g=>g.id===u.projectId);return{title:e.jsxs("div",{style:{textAlign:"center",fontSize:11},children:[e.jsx("div",{children:e.jsx(K,{color:"blue",style:{fontSize:10},children:(c==null?void 0:c.name)??u.projectId})}),e.jsx("div",{children:u.title})]}),key:u.id,width:140,render:(g,m)=>e.jsx("div",{style:{textAlign:"center"},children:e.jsx(Mi,{checked:r(m.vin,u.id),onChange:()=>l(m.vin,u.id,u.projectId)})})}})];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:12},children:[a.length," assignment(s)"]}),e.jsxs(Z,{size:"small",children:[e.jsx(z,{size:"small",onClick:o,children:"All â†’ First Task"}),e.jsx(z,{size:"small",onClick:p,children:"Round Robin"})]})]}),e.jsx(ve,{size:"small",dataSource:t,columns:h,rowKey:"vin",pagination:!1,scroll:{x:"max-content"}})]})}const Hh={Draft:{bg:"#F3F4F6",text:"#6B7280"},Running:{bg:"#ECFDF5",text:"#059669"},Paused:{bg:"#FEF3C7",text:"#D97706"},Completed:{bg:"#E8F0FE",text:"#1A73E8"},Aborted:{bg:"#FEE2E2",text:"#DC2626"}};function Qh({status:t}){const s=Hh[t]??{bg:"#F3F4F6",text:"#6B7280"};return e.jsx("span",{style:{display:"inline-block",padding:"2px 12px",borderRadius:9999,fontSize:"0.75rem",fontWeight:600,background:s.bg,color:s.text,lineHeight:"20px"},children:t})}const Gh={Draft:"default",Running:"processing",Paused:"warning",Completed:"success",Aborted:"error"};function Jh(){var _s;const t=Nt(),s=Se(),[n,a]=d.useState(!1),[i,r]=d.useState(0),[l]=L.useForm(),[o,p]=d.useState("grid"),[h,u]=d.useState("random"),[c,g]=d.useState("random"),[m,k]=d.useState(!0),[x,v]=d.useState([]),[b,w]=d.useState([]),[_,j]=d.useState([]),[F,T]=d.useState([]),[y,I]=d.useState([]),{data:P,isLoading:C}=O({queryKey:["simulations"],queryFn:()=>cu()}),{data:S}=O({queryKey:["projects"],queryFn:()=>ks({})}),{data:E}=O({queryKey:["tasks"],queryFn:()=>qs({})}),[N,Q]=d.useState(!1),oe=pe({mutationFn:R=>uu(R),onSuccess:async R=>{if(s.invalidateQueries({queryKey:["simulations"]}),a(!1),rt(),N&&R.session_id)try{await Yn(R.session_id),s.invalidateQueries({queryKey:["simulations"]}),ie.success("Simulation created & started")}catch{ie.warning("Created but failed to start â€” start it manually")}else ie.success("Simulation saved as draft");Q(!1)},onError:R=>{ie.error(`Failed to create simulation: ${R.message}`),Q(!1)}}),B=pe({mutationFn:R=>hu(R),onSuccess:()=>{s.invalidateQueries({queryKey:["simulations"]}),ie.success("Deleted")}}),W=pe({mutationFn:R=>Yn(R),onSuccess:()=>{s.invalidateQueries({queryKey:["simulations"]}),ie.success("Simulation started")}}),ge=pe({mutationFn:R=>vu(R),onSuccess:R=>v(R.vehicles)}),Ae=pe({mutationFn:R=>xu(R),onSuccess:R=>{w(R.routes);const ne=R.routes.some(ee=>ee.road);ie.success(`${R.routes.length} route(s) generated${ne?" with road planning":""}`)},onError:R=>ie.error(`Route generation failed: ${R.message}`)});function rt(){r(0),u("random"),g("random"),k(!0),v([]),w([]),j([]),T([]),I([]),l.resetFields()}function se(){const R=l.getFieldsValue(!0),ne={name:R.name||"New Simulation",fleet_config:{mode:h,vehicle_count:R.vehicle_count??5,vehicles:h==="custom"?x:void 0,vehicle_template:h==="random"?{vehicle_platform:R.platform,soc_architecture:R.soc,sensor_suite_version:R.sensor}:void 0},route_config:{mode:c,routes:b.length>0?b.map(ee=>({route_id:ee.route_id,name:ee.name,waypoints:ee.waypoints,road:ee.road?{total_distance_m:ee.road.total_distance_m,total_duration_s:ee.road.total_duration_s,coordinates:ee.road.coordinates??[],segments:ee.road.segments??[]}:void 0})):void 0,random_config:c==="random"?{start_point:{lat:R.start_lat??31.2304,lng:R.start_lng??121.4737},radius_km:R.radius_km??10,min_waypoints:R.min_waypoints??5,max_waypoints:R.max_waypoints??15}:void 0},report_config:{telemetry_interval_ms:(R.telemetry_interval??3)*1e3,issue_interval_range_ms:[(R.issue_min??30)*1e3,(R.issue_max??120)*1e3],status_change_interval_ms:(R.mode_switch??60)*1e3,speed_range_mps:[Math.round((R.speed_min??30)/3.6),Math.round((R.speed_max??120)/3.6)]},assignments:m?[]:_};oe.mutate(ne)}const re=d.useMemo(()=>{const R=P??[];return{total:R.length,running:R.filter(ne=>ne.status==="Running").length,queued:R.filter(ne=>ne.status==="Draft"||ne.status==="Paused").length,completed:R.filter(ne=>ne.status==="Completed").length}},[P]),$=[{label:"Total",value:re.total,color:"#76B900"},{label:"Running",value:re.running,color:"#34C759"},{label:"Queued / Draft",value:re.queued,color:"#FF9500"},{label:"Completed",value:re.completed,color:"#007AFF"}],de=[{title:"Name",dataIndex:"name",key:"name",render:(R,ne)=>e.jsx("a",{onClick:()=>t(`/simulation/${ne.session_id}`),children:R})},{title:"Status",dataIndex:"status",key:"status",render:R=>e.jsx(K,{color:Gh[R]||"default",children:R})},{title:"Vehicles",key:"vehicles",render:(R,ne)=>{var ee,Ve,be;return((ee=ne.fleet_config)==null?void 0:ee.vehicle_count)??((be=(Ve=ne.fleet_config)==null?void 0:Ve.vehicles)==null?void 0:be.length)??0}},{title:"Telemetry Sent",key:"telemetry",render:(R,ne)=>{var ee;return((ee=ne.stats)==null?void 0:ee.telemetry_sent)??0}},{title:"Issues Sent",key:"issues",render:(R,ne)=>{var ee;return((ee=ne.stats)==null?void 0:ee.issues_sent)??0}},{title:"Mileage (km)",key:"mileage",render:(R,ne)=>{var ee;return(((ee=ne.stats)==null?void 0:ee.total_mileage_km)??0).toFixed(1)}},{title:"Actions",key:"actions",render:(R,ne)=>e.jsxs(Z,{size:"small",children:[e.jsx(z,{size:"small",icon:e.jsx(ii,{size:12}),onClick:()=>t(`/simulation/${ne.session_id}`)}),ne.status==="Draft"&&e.jsx(z,{size:"small",type:"primary",icon:e.jsx(hn,{size:12}),onClick:()=>W.mutate(ne.session_id)}),e.jsx(En,{title:"Delete simulation?",onConfirm:()=>B.mutate(ne.session_id),children:e.jsx(z,{size:"small",danger:!0,icon:e.jsx(zs,{size:12})})})]})}],_e=(E==null?void 0:E.filter(R=>F.includes(R.projectId)))??[];function Ue({session:R}){var Ve,be,Ia,Ta,Ra,Pa,Ea,Aa,za;const ne=((Ve=R.fleet_config)==null?void 0:Ve.vehicle_count)??((Ia=(be=R.fleet_config)==null?void 0:be.vehicles)==null?void 0:Ia.length)??0,ee=((Ta=R.route_config)==null?void 0:Ta.mode)??"random";return e.jsxs("div",{className:"ios-card ios-card-interactive",style:{padding:20,height:"100%",cursor:"pointer",display:"flex",flexDirection:"column"},onClick:()=>t(`/simulation/${R.session_id}`),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:700,color:"var(--text-primary)",lineHeight:1.3,flex:1,marginRight:8},children:R.name}),e.jsx(Qh,{status:R.status})]}),e.jsxs("div",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",marginBottom:16,lineHeight:1.8,flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(Kc,{size:13,style:{color:"var(--text-muted)"}}),e.jsxs("span",{children:[ne," vehicle",ne!==1?"s":""," (",(Ra=R.fleet_config)==null?void 0:Ra.mode,")"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(nd,{size:13,style:{color:"var(--text-muted)"}}),e.jsxs("span",{children:["Routes: ",ee,(Pa=R.route_config)!=null&&Pa.routes?` (${R.route_config.routes.length})`:""]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(dn,{size:13,style:{color:"var(--text-muted)"}}),e.jsxs("span",{children:[(((Ea=R.stats)==null?void 0:Ea.total_mileage_km)??0).toFixed(1)," km driven"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:12,fontSize:"0.75rem",color:"var(--text-muted)",marginBottom:14,flexWrap:"wrap"},children:[e.jsxs("span",{children:["Telemetry: ",((Aa=R.stats)==null?void 0:Aa.telemetry_sent)??0]}),e.jsxs("span",{children:["Issues: ",((za=R.stats)==null?void 0:za.issues_sent)??0]})]}),e.jsxs("div",{style:{display:"flex",gap:6,borderTop:"1px solid var(--border-secondary)",paddingTop:12},onClick:Nr=>Nr.stopPropagation(),children:[e.jsx(z,{size:"small",icon:e.jsx(ii,{size:12}),onClick:()=>t(`/simulation/${R.session_id}`),children:"View"}),R.status==="Draft"&&e.jsx(z,{size:"small",type:"primary",icon:e.jsx(hn,{size:12}),onClick:()=>W.mutate(R.session_id),children:"Start"}),e.jsx(En,{title:"Delete simulation?",onConfirm:()=>B.mutate(R.session_id),children:e.jsx(z,{size:"small",danger:!0,icon:e.jsx(zs,{size:12})})})]})]})}const lt=[{title:"Fleet",content:e.jsxs("div",{children:[e.jsx(L.Item,{label:"Simulation Name",name:"name",rules:[{required:!0}],children:e.jsx(Y,{placeholder:"My Fleet Simulation"})}),e.jsx(L.Item,{label:"Fleet Mode",children:e.jsxs(Zt.Group,{value:h,onChange:R=>u(R.target.value),children:[e.jsx(Zt.Button,{value:"random",children:"Random"}),e.jsx(Zt.Button,{value:"custom",children:"Custom"})]})}),h==="random"?e.jsxs(e.Fragment,{children:[e.jsx(L.Item,{label:"Vehicle Count",name:"vehicle_count",initialValue:5,children:e.jsx(_n,{min:1,max:100})}),e.jsxs(fe,{gutter:16,children:[e.jsx(q,{span:8,children:e.jsx(L.Item,{label:"Platform",name:"platform",children:e.jsx(Y,{placeholder:"ORIN-X"})})}),e.jsx(q,{span:8,children:e.jsx(L.Item,{label:"SoC",name:"soc",children:e.jsx(Y,{placeholder:"Orin-SoC-A"})})}),e.jsx(q,{span:8,children:e.jsx(L.Item,{label:"Sensor Suite",name:"sensor",children:e.jsx(Y,{placeholder:"LiDAR-v4"})})})]}),e.jsx(z,{onClick:()=>ge.mutate({count:l.getFieldValue("vehicle_count")??5,template:{vehicle_platform:l.getFieldValue("platform"),soc_architecture:l.getFieldValue("soc"),sensor_suite_version:l.getFieldValue("sensor")}}),loading:ge.isPending,children:"Preview Fleet"}),x.length>0&&e.jsx(ve,{size:"small",dataSource:x,rowKey:"vin",columns:[{title:"VIN",dataIndex:"vin"},{title:"Platform",dataIndex:"vehicle_platform"},{title:"Model",dataIndex:"model_code"}],pagination:!1,style:{marginTop:12}})]}):e.jsx(ve,{size:"small",dataSource:x,rowKey:"vin",columns:[{title:"VIN",dataIndex:"vin",render:(R,ne,ee)=>e.jsx(Y,{size:"small",value:R,onChange:Ve=>{const be=[...x];be[ee]={...be[ee],vin:Ve.target.value},v(be)}})},{title:"Platform",dataIndex:"vehicle_platform",render:(R,ne,ee)=>e.jsx(Y,{size:"small",value:R,onChange:Ve=>{const be=[...x];be[ee]={...be[ee],vehicle_platform:Ve.target.value},v(be)}})},{title:"Model",dataIndex:"model_code",render:(R,ne,ee)=>e.jsx(Y,{size:"small",value:R,onChange:Ve=>{const be=[...x];be[ee]={...be[ee],model_code:Ve.target.value},v(be)}})}],pagination:!1,footer:()=>e.jsx(z,{size:"small",onClick:()=>v([...x,{vin:`SIM-${Date.now().toString(36)}`,plate_type:"temporary",model_code:"AD-SUV-01",vehicle_platform:"ORIN-X",sensor_suite_version:"LiDAR-v4",soc_architecture:"Orin-SoC-A"}]),children:"Add Vehicle"})})]})},{title:"Project/Task",content:e.jsxs("div",{children:[e.jsxs(L.Item,{label:"Use Default Project",children:[e.jsx(zi,{checked:m,onChange:k}),e.jsx("span",{style:{marginLeft:8,color:"var(--text-muted)",fontSize:12},children:"Auto-create a simulation-specific project and task"})]}),!m&&e.jsxs(e.Fragment,{children:[e.jsx(L.Item,{label:"Select Projects",children:e.jsx(V,{mode:"multiple",value:F,onChange:T,placeholder:"Select projects",options:(S==null?void 0:S.map(R=>({value:R.id,label:R.name})))??[],style:{width:"100%"}})}),e.jsx(L.Item,{label:"Select Tasks",children:e.jsx(V,{mode:"multiple",value:y,onChange:I,placeholder:"Select tasks",options:_e.map(R=>({value:R.id,label:`${R.title} (${R.taskType??R.stage})`}))??[],style:{width:"100%"}})}),x.length>0&&y.length>0&&e.jsx(Vh,{vehicles:x,projects:(S==null?void 0:S.filter(R=>F.includes(R.id)))??[],tasks:_e.filter(R=>y.includes(R.id)),assignments:_,onChange:j})]})]})},{title:"Routes",content:e.jsxs("div",{children:[e.jsx(L.Item,{label:"Route Mode",children:e.jsxs(Zt.Group,{value:c,onChange:R=>g(R.target.value),children:[e.jsx(Zt.Button,{value:"random",children:"Random"}),e.jsx(Zt.Button,{value:"custom",children:"Custom"})]})}),c==="random"?e.jsxs(e.Fragment,{children:[e.jsxs(fe,{gutter:16,children:[e.jsx(q,{span:6,children:e.jsx(L.Item,{label:"Start Lat",name:"start_lat",initialValue:31.2304,children:e.jsx(Ee,{style:{width:"100%"},step:.001})})}),e.jsx(q,{span:6,children:e.jsx(L.Item,{label:"Start Lng",name:"start_lng",initialValue:121.4737,children:e.jsx(Ee,{style:{width:"100%"},step:.001})})}),e.jsx(q,{span:6,children:e.jsx(L.Item,{label:"Target Distance (km)",name:"target_distance_km",initialValue:500,tooltip:"Total road distance target. Set 0 to use radius mode.",children:e.jsx(Ee,{min:0,max:2e3,style:{width:"100%"}})})}),e.jsx(q,{span:6,children:e.jsx(L.Item,{label:"Radius (km)",name:"radius_km",initialValue:10,tooltip:"Only used when Target Distance is 0",children:e.jsx(Ee,{min:1,max:500,style:{width:"100%"}})})})]}),e.jsxs(fe,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(L.Item,{label:"Min Waypoints",name:"min_waypoints",initialValue:3,children:e.jsx(Ee,{min:2,max:10,style:{width:"100%"}})})}),e.jsx(q,{span:12,children:e.jsx(L.Item,{label:"Max Waypoints",name:"max_waypoints",initialValue:8,children:e.jsx(Ee,{min:2,max:10,style:{width:"100%"}})})})]}),e.jsx(z,{onClick:()=>Ae.mutate({start_point:{lat:l.getFieldValue("start_lat")??31.2304,lng:l.getFieldValue("start_lng")??121.4737},radius_km:l.getFieldValue("radius_km")??10,count:x.length||l.getFieldValue("vehicle_count")||5,min_waypoints:l.getFieldValue("min_waypoints")??3,max_waypoints:l.getFieldValue("max_waypoints")??8,target_distance_km:l.getFieldValue("target_distance_km")??500}),loading:Ae.isPending,children:"Generate Routes"})]}):null,e.jsx(Uh,{routes:b,onChange:w,mode:c,startPoint:c==="random"?{lat:l.getFieldValue("start_lat")??31.2304,lng:l.getFieldValue("start_lng")??121.4737}:void 0})]})},{title:"Reporting",content:e.jsxs("div",{children:[e.jsx(L.Item,{label:"Telemetry Interval (seconds)",name:"telemetry_interval",initialValue:3,children:e.jsx(_n,{min:1,max:30})}),e.jsxs(fe,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(L.Item,{label:"Issue Min Interval (sec)",name:"issue_min",initialValue:30,children:e.jsx(Ee,{min:5,max:600,style:{width:"100%"}})})}),e.jsx(q,{span:12,children:e.jsx(L.Item,{label:"Issue Max Interval (sec)",name:"issue_max",initialValue:120,children:e.jsx(Ee,{min:10,max:600,style:{width:"100%"}})})})]}),e.jsx(L.Item,{label:"Driving Mode Switch Interval (sec)",name:"mode_switch",initialValue:60,children:e.jsx(_n,{min:10,max:300})}),e.jsxs(fe,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(L.Item,{label:"Min Speed (km/h)",name:"speed_min",initialValue:30,children:e.jsx(Ee,{min:5,max:200,style:{width:"100%"}})})}),e.jsx(q,{span:12,children:e.jsx(L.Item,{label:"Max Speed (km/h)",name:"speed_max",initialValue:120,children:e.jsx(Ee,{min:10,max:200,style:{width:"100%"}})})})]})]})},{title:"Review",content:e.jsx("div",{children:e.jsx("div",{className:"ios-card",style:{padding:20,marginBottom:16},children:e.jsxs(fe,{gutter:[16,8],children:[e.jsxs(q,{span:12,children:[e.jsx("strong",{children:"Name:"})," ",l.getFieldValue("name")||"New Simulation"]}),e.jsxs(q,{span:12,children:[e.jsx("strong",{children:"Fleet:"})," ",h==="random"?`${l.getFieldValue("vehicle_count")??5} random vehicles`:`${x.length} custom vehicles`]}),e.jsxs(q,{span:12,children:[e.jsx("strong",{children:"Routes:"})," ",c==="random"?"Auto-generated":`${b.length} custom routes`]}),e.jsxs(q,{span:12,children:[e.jsx("strong",{children:"Project:"})," ",m?"Auto-create":`${F.length} selected`]}),e.jsxs(q,{span:12,children:[e.jsx("strong",{children:"Telemetry:"})," every ",l.getFieldValue("telemetry_interval")??3,"s"]}),e.jsxs(q,{span:12,children:[e.jsx("strong",{children:"Speed:"})," ",l.getFieldValue("speed_min")??30," - ",l.getFieldValue("speed_max")??120," km/h"]})]})})})}];return e.jsxs("div",{children:[e.jsx(jt,{title:"Fleet Simulation",subtitle:"Simulate vehicle fleets for demo and stress testing",action:e.jsx(z,{className:"btn-primary-green",icon:e.jsx(fr,{size:14}),size:"large",onClick:()=>{rt(),a(!0)},children:"New Simulation"})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16,marginBottom:20},children:$.map(R=>e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:R.label}),e.jsx("span",{className:"stat-card-value",style:{color:R.color},children:R.value})]},R.label))}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:16},children:e.jsx(ea,{value:o,onChange:R=>p(R),options:[{value:"grid",icon:e.jsx(Ri,{})},{value:"list",icon:e.jsx(Pi,{})}]})}),o==="grid"?(!P||P.length===0)&&!C?e.jsx("div",{className:"ios-card",style:{padding:48,textAlign:"center"},children:e.jsx(ce,{image:e.jsx(ed,{size:48,style:{color:"var(--text-muted)",opacity:.4}}),description:e.jsx("span",{style:{color:"var(--text-muted)"},children:"No simulations yet. Create your first simulation to get started."})})}):e.jsx(fe,{gutter:[16,16],children:(P??[]).map(R=>e.jsx(q,{xs:24,sm:12,lg:8,children:e.jsx(Ue,{session:R})},R.session_id))}):e.jsx("div",{className:"ios-card",style:{overflow:"hidden"},children:e.jsx(ve,{dataSource:P??[],columns:de,rowKey:"session_id",loading:C,pagination:{pageSize:10},size:"middle"})}),e.jsxs($e,{open:n,onCancel:()=>a(!1),width:900,title:"Create Simulation",footer:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(z,{disabled:i===0,onClick:()=>r(i-1),children:"Previous"}),e.jsxs(Z,{children:[i<lt.length-1&&e.jsx(z,{type:"primary",onClick:()=>r(i+1),children:"Next"}),i===lt.length-1&&e.jsxs(e.Fragment,{children:[e.jsx(z,{onClick:()=>{Q(!1),se()},loading:oe.isPending&&!N,children:"Save as Draft"}),e.jsx(z,{type:"primary",onClick:()=>{Q(!0),se()},loading:oe.isPending&&N,children:"Create & Start"})]})]})]}),destroyOnClose:!0,children:[e.jsx(Yr,{current:i,items:lt.map(R=>({title:R.title})),style:{marginBottom:24},size:"small"}),e.jsx(L,{form:l,layout:"vertical",children:(_s=lt[i])==null?void 0:_s.content})]})]})}const Yh={Draft:"default",Running:"processing",Paused:"warning",Completed:"success",Aborted:"error"},ss=["#22c55e","#3b82f6","#f59e0b","#ef4444","#ec4899","#14b8a6","#a855f7","#6366f1"],Ys=["#6366f1","#22c55e","#f59e0b","#ef4444","#3b82f6","#ec4899","#14b8a6","#a855f7"];function gi(t,s){return gs.divIcon({className:"",html:`<div style="width:22px;height:22px;display:flex;align-items:center;justify-content:center;transform:rotate(${s}deg)">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="${t}" stroke="#fff" stroke-width="1.5">
        <path d="M12 2L6 12l6 4 6-4z"/>
      </svg>
    </div>`,iconSize:[22,22],iconAnchor:[11,11]})}function Xh({vehicles:t}){const s=ml(),n=d.useRef(new Map);return d.useEffect(()=>{const a=new Set;t.forEach((i,r)=>{if(!i.current)return;a.add(i.vin);const l=ss[r%ss.length],o=gs.latLng(i.current.lat,i.current.lng),p=i.current.heading_deg??0,h=n.current.get(i.vin);if(h)h.setLatLng(o),h.setIcon(gi(l,p));else{const c=gs.marker(o,{icon:gi(l,p)}).bindTooltip(`${i.vin}<br/>${(i.current.speed_mps*3.6).toFixed(0)} km/h Â· ${i.current.driving_mode}`,{direction:"top",offset:[0,-12]}).addTo(s);n.current.set(i.vin,c)}n.current.get(i.vin).setTooltipContent(`${i.vin}<br/>${(i.current.speed_mps*3.6).toFixed(0)} km/h Â· ${i.current.driving_mode}`)}),n.current.forEach((i,r)=>{a.has(r)||(i.remove(),n.current.delete(r))})},[t,s]),d.useEffect(()=>()=>{n.current.forEach(a=>a.remove()),n.current.clear()},[]),null}function Zh(){var F,T,y,I,P,C,S,E,N,Q,oe,B,W,ge,Ae,rt,se,re;const{id:t}=bs(),s=Nt(),n=Se(),{data:a,isLoading:i}=O({queryKey:["simulation",t],queryFn:()=>du(t),enabled:!!t,refetchInterval:$=>{const de=$.state.data;return(de==null?void 0:de.status)==="Running"?5e3:!1}}),{data:r}=O({queryKey:["simulation-stats",t],queryFn:()=>gu(t),enabled:!!t&&(a==null?void 0:a.status)==="Running",refetchInterval:3e3}),l=(a==null?void 0:a.status)==="Running",o=(a==null?void 0:a.status)==="Completed",{data:p}=O({queryKey:["simulation-vehicles",t],queryFn:()=>yu(t,50),enabled:!!t&&(l||o),refetchInterval:l?3e3:!1}),h=()=>{n.invalidateQueries({queryKey:["simulation",t]}),n.invalidateQueries({queryKey:["simulation-stats",t]}),n.invalidateQueries({queryKey:["simulation-vehicles",t]}),n.invalidateQueries({queryKey:["simulations"]})},u=pe({mutationFn:()=>Yn(t),onSuccess:()=>{h(),ie.success("Started")}}),c=pe({mutationFn:()=>pu(t),onSuccess:()=>{h(),ie.success("Paused")}}),g=pe({mutationFn:()=>mu(t),onSuccess:()=>{h(),ie.success("Resumed")}}),m=pe({mutationFn:()=>fu(t),onSuccess:()=>{h(),ie.success("Stopped")}});if(i||!a)return e.jsx(U,{className:"ios-card",loading:!0});const k=r??a.stats,x=((F=a.route_config)==null?void 0:F.routes)??[],v=(y=(T=a.route_config)==null?void 0:T.random_config)==null?void 0:y.start_point,b=p??[],w=(()=>{const $=b.find(de=>de.current);return $!=null&&$.current?[$.current.lat,$.current.lng]:x.length>0&&x[0].waypoints.length>0?[x[0].waypoints[0].lat,x[0].waypoints[0].lng]:v?[v.lat,v.lng]:[31.23,121.47]})(),_=$=>e.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:600,color:"var(--text-primary)"},children:$}),j={color:"var(--text-secondary)",fontWeight:500};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:24},children:[e.jsx(z,{type:"text",icon:e.jsx(Nc,{size:18}),onClick:()=>s("/simulation")}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h1",{className:"page-title",style:{marginBottom:0},children:a.name}),e.jsxs(Z,{children:[e.jsx(K,{color:Yh[a.status],children:a.status}),a.started_at&&e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:12},children:["Started: ",new Date(a.started_at).toLocaleString()]})]})]}),e.jsxs(Z,{children:[(a.status==="Draft"||a.status==="Paused")&&e.jsx(z,{type:"primary",icon:e.jsx(hn,{size:14}),onClick:()=>a.status==="Draft"?u.mutate():g.mutate(),loading:u.isPending||g.isPending,style:{background:"#34C759",borderColor:"#34C759"},children:a.status==="Draft"?"Start":"Resume"}),a.status==="Running"&&e.jsxs(e.Fragment,{children:[e.jsx(z,{icon:e.jsx(sd,{size:14}),onClick:()=>c.mutate(),loading:c.isPending,style:{color:"#FF9500",borderColor:"#FF9500"},children:"Pause"}),e.jsx(z,{danger:!0,icon:e.jsx(id,{size:14}),onClick:()=>m.mutate(),loading:m.isPending,style:{color:"#FF3B30",borderColor:"#FF3B30"},children:"Stop"})]})]})]}),e.jsxs(fe,{gutter:[16,16],style:{marginBottom:24},children:[e.jsx(q,{xs:24,sm:6,children:e.jsx(U,{className:"ios-card",children:e.jsx(ts,{title:"Vehicles",value:((I=a.fleet_config)==null?void 0:I.vehicle_count)??((C=(P=a.fleet_config)==null?void 0:P.vehicles)==null?void 0:C.length)??0,valueStyle:{fontFamily:"var(--font-mono)",color:"var(--accent-strong)"}})})}),e.jsx(q,{xs:24,sm:6,children:e.jsx(U,{className:"ios-card",children:e.jsx(ts,{title:"Telemetry Sent",value:(k==null?void 0:k.telemetry_sent)??0,valueStyle:{fontFamily:"var(--font-mono)",color:"var(--ios-green)"}})})}),e.jsx(q,{xs:24,sm:6,children:e.jsx(U,{className:"ios-card",children:e.jsx(ts,{title:"Issues Reported",value:(k==null?void 0:k.issues_sent)??0,valueStyle:{fontFamily:"var(--font-mono)",color:"var(--ios-orange)"}})})}),e.jsx(q,{xs:24,sm:6,children:e.jsx(U,{className:"ios-card",children:e.jsx(ts,{title:"Total Mileage",value:Number((k==null?void 0:k.total_mileage_km)??0).toFixed(1),suffix:"km",valueStyle:{fontFamily:"var(--font-mono)",color:"var(--brand-green)"}})})})]}),e.jsxs(fe,{gutter:[16,16],children:[e.jsx(q,{xs:24,lg:14,children:e.jsx(U,{className:"ios-card",title:_(l?"Live Vehicle Map":"Route Map"),style:{height:520},children:e.jsx("div",{style:{height:440},children:e.jsxs(aa,{center:w,zoom:11,style:{height:"100%",width:"100%",borderRadius:8},children:[e.jsx(ia,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:"Â© CartoDB"}),x.map(($,de)=>{var _s;const _e=Ys[de%Ys.length],Ue=(_s=$.road)==null?void 0:_s.coordinates,lt=Ue??$.waypoints;return e.jsx(Ps,{positions:lt.map(R=>[R.lat,R.lng]),pathOptions:{color:_e,weight:b.length>0?2:4,opacity:b.length>0?.25:.8,dashArray:Ue?void 0:"8 4"}},`route-${$.route_id}`)}),b.map(($,de)=>{const _e=ss[de%ss.length];return $.trail.length<2?null:e.jsx(Ps,{positions:$.trail.map(Ue=>[Ue.lat,Ue.lng]),pathOptions:{color:_e,weight:4,opacity:.9}},`trail-${$.vin}`)}),b.length===0&&x.map(($,de)=>{var lt;const _e=Ys[de%Ys.length],Ue=((lt=$.road)==null?void 0:lt.coordinates)??$.waypoints;return e.jsx("span",{children:Ue.length>0&&e.jsx(zn,{center:[Ue[0].lat,Ue[0].lng],radius:6,pathOptions:{color:"#fff",fillColor:_e,fillOpacity:1,weight:2},children:e.jsxs(rn,{children:[$.name||$.route_id," (Start)"]})})},`markers-${$.route_id}`)}),e.jsx(Xh,{vehicles:b})]})})})}),e.jsxs(q,{xs:24,lg:10,children:[e.jsx(U,{className:"ios-card",title:_("Configuration"),style:{marginBottom:16},children:e.jsxs(ae,{column:1,size:"small",labelStyle:j,children:[e.jsx(ae.Item,{label:"Fleet Mode",children:(S=a.fleet_config)==null?void 0:S.mode}),e.jsx(ae.Item,{label:"Route Mode",children:(E=a.route_config)==null?void 0:E.mode}),e.jsxs(ae.Item,{label:"Routes",children:[x.length," route(s)",x.some($=>$.road)?" (road-planned)":""]}),x.some($=>$.road)&&e.jsxs(ae.Item,{label:"Road Distance",children:[(x.reduce(($,de)=>{var _e;return $+(((_e=de.road)==null?void 0:_e.total_distance_m)??0)},0)/1e3).toFixed(1)," km total"]}),e.jsxs(ae.Item,{label:"Telemetry Interval",children:[(((N=a.report_config)==null?void 0:N.telemetry_interval_ms)??3e3)/1e3,"s"]}),e.jsxs(ae.Item,{label:"Issue Interval",children:[(((oe=(Q=a.report_config)==null?void 0:Q.issue_interval_range_ms)==null?void 0:oe[0])??3e4)/1e3,"s - ",(((W=(B=a.report_config)==null?void 0:B.issue_interval_range_ms)==null?void 0:W[1])??12e4)/1e3,"s"]}),e.jsxs(ae.Item,{label:"Mode Switch",children:[(((ge=a.report_config)==null?void 0:ge.status_change_interval_ms)??6e4)/1e3,"s"]}),e.jsxs(ae.Item,{label:"Speed Range",children:[Math.round((((rt=(Ae=a.report_config)==null?void 0:Ae.speed_range_mps)==null?void 0:rt[0])??8)*3.6)," - ",Math.round((((re=(se=a.report_config)==null?void 0:se.speed_range_mps)==null?void 0:re[1])??33)*3.6)," km/h"]})]})}),b.length>0&&e.jsx(U,{className:"ios-card",title:_("Vehicle Status"),children:e.jsx(ve,{size:"small",dataSource:b,rowKey:"vin",pagination:!1,columns:[{title:"",width:12,render:($,de,_e)=>e.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:ss[_e%ss.length]}})},{title:"VIN",dataIndex:"vin",ellipsis:!0,render:$=>e.jsx("span",{style:{fontSize:11,fontFamily:"monospace"},children:$})},{title:"Speed",render:($,de)=>de.current?`${(de.current.speed_mps*3.6).toFixed(0)} km/h`:"-"},{title:"Mode",render:($,de)=>de.current?e.jsx(K,{color:"blue",style:{fontSize:10},children:de.current.driving_mode}):"-"},{title:"Trail",render:($,de)=>e.jsxs("span",{style:{fontSize:11,color:"var(--text-muted)"},children:[de.trail.length," pts"]})}]})})]})]})]})}const Xe={projects:["ptc-projects"],tasks:t=>["ptc-tasks",t],overview:["ptc-overview"],overviewProject:t=>["ptc-overview",t],overviewTask:t=>["ptc-overview-task",t],bindings:t=>["ptc-bindings",t],binding:t=>["ptc-binding",t],builds:t=>["ptc-builds",t],cars:t=>["ptc-cars",t],tags:t=>["ptc-tags",t],drives:t=>["ptc-drives",t],driveFilter:t=>["ptc-drive-filter",t]};function _a(t){return O({queryKey:[...Xe.projects,t],queryFn:()=>bu(t)})}function wa(t){return O({queryKey:Xe.tasks(t==null?void 0:t.project_id),queryFn:()=>ku(t)})}function Ir(){return O({queryKey:Xe.overview,queryFn:()=>_r()})}function Fa(t,s=!0){return O({queryKey:Xe.overviewProject(t),queryFn:()=>_r(t),enabled:s})}function ep(t,s=!0){return O({queryKey:Xe.overviewTask(t),queryFn:()=>Au(t),enabled:s})}function Tr(t){return O({queryKey:Xe.builds(t),queryFn:()=>Tu(t)})}function Rr(t){return O({queryKey:Xe.cars(t),queryFn:()=>Ru(t)})}function Pr(t){return O({queryKey:Xe.tags(t),queryFn:()=>Pu(t)})}function tp(t,s=!0){return O({queryKey:Xe.driveFilter(t),queryFn:()=>Eu(t),enabled:s})}function sp(){const t=Se();return pe({mutationFn:s=>Su(s),onSuccess:()=>{t.invalidateQueries({queryKey:Xe.projects}),t.invalidateQueries({queryKey:Xe.overview})}})}function np(){const t=Se();return pe({mutationFn:s=>Cu(s),onSuccess:()=>{t.invalidateQueries({queryKey:["ptc"]})}})}function ap(){const t=Se();return pe({mutationFn:({id:s,data:n})=>_u(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:["ptc"]})}})}function ip(){const t=Se();return pe({mutationFn:s=>wu(s),onSuccess:()=>{t.invalidateQueries({queryKey:["ptc"]})}})}function rp(){const t=Se();return pe({mutationFn:({id:s,data:n})=>Fu(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:["ptc"]})}})}function lp(){const t=Se();return pe({mutationFn:s=>Iu(s),onSuccess:()=>{t.invalidateQueries({queryKey:["ptc"]})}})}const Xs=300;function Zs(t,s){const[n,a]=d.useState(t);return d.useEffect(()=>{const i=setTimeout(()=>a(t),s);return()=>clearTimeout(i)},[t,s]),n}function op({filters:t,onChange:s}){const[n,a]=d.useState(""),[i,r]=d.useState(""),[l,o]=d.useState(""),[p,h]=d.useState(""),u=Zs(n,Xs),c=Zs(i,Xs),g=Zs(l,Xs),m=Zs(p,Xs),{data:k=[]}=_a(u),{data:x=[]}=wa({project_id:t.project_id}),{data:v=[]}=Tr(c),{data:b=[]}=Rr({q:m,build_id:t.build_id,tag_id:t.tag_id}),{data:w=[]}=Pr(g),_=(j,F)=>((F==null?void 0:F.label)??"").toLowerCase().includes(j.toLowerCase());return e.jsxs("div",{className:"ptc-filter-bar",children:[e.jsx(V,{allowClear:!0,showSearch:!0,placeholder:"Project",value:t.project_id||null,onChange:j=>s({...t,project_id:j??void 0,task_id:void 0}),onSearch:a,filterOption:_,options:k.map(j=>({value:j.project_id,label:j.name}))}),e.jsx(V,{allowClear:!0,showSearch:!0,placeholder:"Task",value:t.task_id||null,onChange:j=>s({...t,task_id:j??void 0}),filterOption:_,options:x.map(j=>({value:j.task_id,label:j.name})),disabled:!t.project_id}),e.jsx(V,{allowClear:!0,showSearch:!0,placeholder:"Build",value:t.build_id||null,onChange:j=>s({...t,build_id:j??void 0}),onSearch:r,filterOption:_,options:v.map(j=>({value:j.build_id,label:j.version_tag}))}),e.jsx(V,{allowClear:!0,showSearch:!0,placeholder:"Car",value:t.car_id||null,onChange:j=>s({...t,car_id:j??void 0}),onSearch:h,filterOption:_,options:b.map(j=>({value:j.car_id,label:j.name||j.vin||j.car_id}))}),e.jsx(V,{allowClear:!0,showSearch:!0,placeholder:"Tag",value:t.tag_id||null,onChange:j=>s({...t,tag_id:j??void 0}),onSearch:o,filterOption:_,options:w.map(j=>({value:j.tag_id,label:j.name}))}),e.jsx(Y,{placeholder:"Drive",value:t.drive_q??"",onChange:j=>s({...t,drive_q:j.target.value||void 0}),allowClear:!0,style:{minWidth:160}})]})}function cp({task:t,onTaskClick:s}){const n=t.start_date??null,a=t.end_date??null,i=n||a;return e.jsxs(U,{className:"ptc-task-card",title:t.name,onClick:()=>s(t.task_id),children:[i&&e.jsx("div",{className:"ptc-task-card-timeline",children:e.jsx("div",{className:"ptc-task-card-timeline-bar",style:{width:"50%"}})}),e.jsxs("div",{className:"ptc-task-card-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-value",children:t.build_count}),e.jsx("div",{children:"Builds"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-value",children:t.car_count}),e.jsx("div",{children:"Cars"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-value",children:t.tag_count}),e.jsx("div",{children:"Tags"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-value",children:t.total_mileage}),e.jsx("div",{children:"km"})]})]}),e.jsxs("div",{className:"ptc-task-card-footer",children:[e.jsx("span",{children:t.binding_status??"â€”"}),e.jsx("span",{children:t.updated_at?new Date(t.updated_at).toLocaleDateString():""})]})]})}function dp({projectId:t,isExpanded:s,onTaskClick:n,filters:a}){const{data:i,isLoading:r}=Fa(t,s);if(!s)return null;if(r)return e.jsx(Ke,{});let l=(i==null?void 0:i.tasks)??[];return a!=null&&a.task_id&&(l=l.filter(o=>o.task_id===a.task_id)),e.jsx(e.Fragment,{children:l.map(o=>e.jsx(cp,{task:o,onTaskClick:n},o.task_id))})}function up({projects:t,onTaskClick:s,filters:n}){const[a,i]=d.useState([]);return e.jsx(an,{className:"ptc-project-collapse",activeKey:a,onChange:r=>i(Array.isArray(r)?r:[r]),children:t.map(r=>e.jsx(an.Panel,{header:e.jsxs("span",{children:[r.name,r.task_count!=null&&e.jsxs("span",{style:{marginLeft:8,opacity:.7,fontSize:13},children:["(",r.task_count," tasks)"]})]}),children:e.jsx(dp,{projectId:r.project_id,isExpanded:a.includes(r.project_id),onTaskClick:s,filters:n})},r.project_id))})}const hp=["æ•°æ®å¼‚å¸¸","é‡å¤","ä¸ç›¸å…³","è®¾å¤‡æ•…éšœ","å…¶ä»–"];function pp({open:t,onClose:s,bindingId:n,carId:a,drives:i,onSave:r}){const[l,o]=d.useState([]),[p,h]=d.useState("");d.useEffect(()=>{t&&(o(JSON.parse(JSON.stringify(i))),h(""))},[t,i]);const u=l.filter(x=>!p||x.drive_id.toLowerCase().includes(p.toLowerCase())),c=(x,v)=>{o(b=>b.map(w=>w.drive_id===x?{...w,selected:v,...v?{}:{deselect_reason_preset:void 0,deselect_reason_text:void 0}}:w))},g=(x,v)=>{o(b=>b.map(w=>w.drive_id===x?{...w,deselect_reason_preset:v}:w))},m=(x,v)=>{o(b=>b.map(w=>w.drive_id===x?{...w,deselect_reason_text:v}:w))},k=()=>{const x=l.map(v=>({drive_id:v.drive_id,selected:v.selected,...v.selected?{}:{deselect_reason_preset:v.deselect_reason_preset,deselect_reason_text:v.deselect_reason_text}}));r(x),s()};return e.jsxs(Xr,{title:"Drive Selection",width:520,open:t,onClose:s,className:"ptc-drive-popup",footer:e.jsx(z,{type:"primary",onClick:k,children:"Save"}),children:[e.jsx(Y.Search,{placeholder:"Filter by drive_id",value:p,onChange:x=>h(x.target.value),allowClear:!0,style:{marginBottom:16}}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:u.map(x=>e.jsxs("div",{className:"drive-item",children:[e.jsx(Mi,{checked:x.selected,onChange:v=>c(x.drive_id,v.target.checked)}),e.jsxs("div",{className:"drive-item-info",children:[e.jsx("div",{children:x.drive_id}),x.detail&&e.jsxs("div",{className:"drive-item-meta",children:[x.detail.date," Â· ",x.detail.mileage_km," km Â· XL: ",x.detail.xl_events," Â· L: ",x.detail.l_events]}),!x.selected&&e.jsxs("div",{className:"deselect-reason",style:{marginTop:8},children:[e.jsx(V,{placeholder:"Reason preset",value:x.deselect_reason_preset,onChange:v=>g(x.drive_id,v),options:hp.map(v=>({label:v,value:v})),style:{width:"100%",marginBottom:8}}),e.jsx(gn,{title:[x.deselect_reason_preset,x.deselect_reason_text].filter(Boolean).join(" Â· ")||void 0,children:e.jsx(Y.TextArea,{placeholder:"Free text reason",value:x.deselect_reason_text,onChange:v=>m(x.drive_id,v.target.value),rows:2})})]})]})]},x.drive_id))})]})}function mp({taskId:t,open:s,onClose:n,editable:a=!1}){var x;const{data:i,isLoading:r}=ep(t??"",s&&!!t),l=rp(),[o,p]=d.useState(null),h=i==null?void 0:i.task,u=i==null?void 0:i.binding,c=v=>{o&&l.mutate({id:o.bindingId,data:{car_id:o.carId,drive_updates:v}},{onSuccess:()=>{p(null)}})},g=((x=u==null?void 0:u.cars)==null?void 0:x.map(v=>{const b=[...new Set(v.drives.map(F=>{var T;return(T=F.detail)==null?void 0:T.build_id}).filter(Boolean))],w=[...new Set(v.drives.map(F=>{var T;return(T=F.detail)==null?void 0:T.tag_id}).filter(Boolean))],_=v.drives.filter(F=>F.selected).length,j=v.drives.length;return{key:v.car_id,car_id:v.car_id,build_ids:b.join(", ")||"â€”",tag_ids:w.join(", ")||"â€”",driveCount:`${_} / ${j}`,drives:v.drives,updated_at:u.updated_at}}))??[],m=[{title:"Build",dataIndex:"build_ids",key:"build_ids"},{title:"Car",dataIndex:"car_id",key:"car_id"},{title:"Tag",dataIndex:"tag_ids",key:"tag_ids"},{title:"Drive",dataIndex:"driveCount",key:"drive",render:(v,b)=>e.jsx(z,{type:"link",style:{padding:0},onClick:()=>u&&p({bindingId:u.binding_id,carId:b.car_id,drives:b.drives}),children:b.driveCount})},{title:"Edit time",dataIndex:"updated_at",key:"updated_at",render:v=>v?new Date(v).toLocaleString():"â€”"}],k=(u==null?void 0:u.status)==="Draft"?e.jsx(K,{color:"gold",children:"Draft"}):(u==null?void 0:u.status)==="Published"?e.jsx(K,{color:"green",children:"Published"}):null;return e.jsxs(e.Fragment,{children:[e.jsx($e,{wrapClassName:"ptc-task-modal",width:900,destroyOnClose:!0,open:s,onCancel:n,title:e.jsxs("span",{children:[(h==null?void 0:h.name)??"Task"," ",k]}),footer:a?e.jsx(z,{type:"primary",onClick:n,children:"Save"}):null,children:r?e.jsx("div",{style:{textAlign:"center",padding:48},children:e.jsx(Ke,{})}):u?e.jsx(ve,{columns:m,dataSource:g,pagination:!1,size:"small"}):e.jsx(ce,{description:"No binding"})}),e.jsx(pp,{open:!!o,onClose:()=>p(null),bindingId:(o==null?void 0:o.bindingId)??"",carId:(o==null?void 0:o.carId)??"",drives:(o==null?void 0:o.drives)??[],onSave:c})]})}function yi(t,s){const[n,a]=d.useState(t);return d.useEffect(()=>{const i=setTimeout(()=>a(t),s);return()=>clearTimeout(i)},[t,s]),n}function fp({open:t,onClose:s,onSuccess:n}){const[a,i]=d.useState(""),[r,l]=d.useState(""),[o,p]=d.useState(null),[h,u]=d.useState(null),[c,g]=d.useState(!1),[m,k]=d.useState(!1),x=yi(a,300),v=yi(r,300),{data:b=[]}=_a(x),{data:w=[]}=wa(o?{project_id:o}:{q:v}),_=sp(),j=np(),F=ap();d.useEffect(()=>{t||(i(""),l(""),p(null),u(null),g(!1),k(!1))},[t]);const T=b.map(B=>({value:B.project_id,label:B.name})),y=w.map(B=>({value:B.task_id,label:B.name,project_id:B.project_id})),I=w.find(B=>B.task_id===h),P=m&&!!(I!=null&&I.project_id)&&a.trim().length>0,{data:C}=Fa((I==null?void 0:I.project_id)??"",P),S=(B,W)=>{i((W==null?void 0:W.label)??B),p(B),g(!!b.find(ge=>ge.project_id===B)),l(""),u(null),k(!1)},E=(B,W)=>{l((W==null?void 0:W.label)??B),u(B),k(!!w.find(ge=>ge.task_id===B))},N=async()=>{var re;const B=a.trim(),W=r.trim();if(!B||!W)return;const ge=!c&&!m,Ae=c&&!m,rt=!c&&m&&(I==null?void 0:I.project_id);if(c&&m){n==null||n(),s();return}if(ge){try{const $=await _.mutateAsync(B);await j.mutateAsync({name:W,project_id:$.project_id}),n==null||n(),s()}catch{}return}if(Ae){try{await j.mutateAsync({name:W,project_id:o}),n==null||n(),s()}catch{}return}if(rt){const $=(I==null?void 0:I.name)??r,de=((re=C==null?void 0:C.project)==null?void 0:re.name)??"unknown";$e.confirm({title:"Move Task",content:`Task '${$}' belongs to Project '${de}'. Move to '${B}'?`,onOk:async()=>{try{const _e=await _.mutateAsync(B);await F.mutateAsync({id:h,data:{project_id:_e.project_id}}),n==null||n(),s()}catch{}}})}},Q=a.trim().length>0&&r.trim().length>0,oe=_.isPending||j.isPending||F.isPending;return e.jsx($e,{title:"Add Project / Task",open:t,onCancel:s,destroyOnClose:!0,footer:[e.jsx(z,{onClick:s,children:"Cancel"},"cancel"),e.jsx(z,{type:"primary",disabled:!Q||oe,onClick:N,children:"Save"},"save")],children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsx(Da,{placeholder:"Project",value:a,onChange:B=>{i(B),p(null),g(!1)},onSelect:(B,W)=>S(B,W),options:T,style:{width:"100%"},filterOption:()=>!0}),e.jsx(Da,{placeholder:"Task",value:r,onChange:B=>{l(B),u(null),k(!1)},onSelect:(B,W)=>E(B,W),options:y,style:{width:"100%"},filterOption:()=>!0})]})})}function gp({open:t,onClose:s,taskId:n,taskName:a,onSuccess:i}){const[r,l]=d.useState([]),[o,p]=d.useState([]),[h,u]=d.useState([]),[c,g]=d.useState(!1),[m,k]=d.useState([]),x={builds:r.length?r.join(","):void 0,cars:o.length?o.join(","):void 0,tags:h.length?h.join(","):void 0},v=r.length>0||o.length>0||h.length>0,{data:b=[]}=Tr(),{data:w=[]}=Rr({build_id:r[0],tag_id:h[0]}),{data:_=[]}=Pr(),{data:j,isLoading:F}=tp(x,c&&!!v),T=ip(),y=()=>{v&&g(!0)},I=W=>{if(!n)return;const ge=c&&j?m:o,Ae={builds:r,cars:o,tags:h};T.mutate({task_id:n,filter_criteria:Ae,car_ids:ge,status:W},{onSuccess:()=>{i==null||i(),s()}})},P=(W,ge)=>((ge==null?void 0:ge.label)??"").toLowerCase().includes(W.toLowerCase()),C=b.map(W=>({value:W.build_id,label:W.version_tag})),S=w.map(W=>({value:W.car_id,label:W.name||W.vin||W.car_id})),E=_.map(W=>({value:W.tag_id,label:W.name})),N=(j??[]).map(W=>({key:W.car_id,car_id:W.car_id,drive_count:W.drive_count,total_mileage:W.total_mileage,date_range:W.date_range?`${W.date_range.start} â€“ ${W.date_range.end}`:"â€”"})),Q=[{title:"Car ID",dataIndex:"car_id",key:"car_id"},{title:"Drive Count",dataIndex:"drive_count",key:"drive_count"},{title:"Total Mileage",dataIndex:"total_mileage",key:"total_mileage"},{title:"Date Range",dataIndex:"date_range",key:"date_range"}],oe={selectedRowKeys:m,onChange:W=>k(W)},B=T.isPending;return e.jsx($e,{title:`Add Binding${a?`: ${a}`:""}`,open:t,onCancel:s,width:700,destroyOnClose:!0,footer:[e.jsx(z,{onClick:s,children:"Cancel"},"cancel"),e.jsx(z,{onClick:()=>I("Draft"),loading:B,disabled:!n,children:"Save as Draft"},"draft"),e.jsx(z,{type:"primary",onClick:()=>I("Published"),loading:B,disabled:!n,children:"Publish"},"publish")],children:e.jsxs("div",{className:"ptc-binding-config",children:[e.jsxs("div",{className:"filter-section",children:[e.jsx(V,{mode:"multiple",showSearch:!0,placeholder:"Builds",value:r,onChange:l,options:C,filterOption:P,style:{width:"100%",marginBottom:12}}),e.jsx(V,{mode:"multiple",showSearch:!0,placeholder:"Cars",value:o,onChange:p,options:S,filterOption:P,style:{width:"100%",marginBottom:12}}),e.jsx(V,{mode:"multiple",showSearch:!0,placeholder:"Tags",value:h,onChange:u,options:E,filterOption:P,style:{width:"100%",marginBottom:12}}),e.jsx(z,{type:"primary",onClick:y,disabled:!v,children:"Search"})]}),c&&e.jsx("div",{className:"car-selection",children:F?e.jsx(Ke,{}):e.jsx(ve,{columns:Q,dataSource:N,rowSelection:oe,pagination:!1,size:"small"})})]})})}function yp(){const[t,s]=d.useState({}),[n,a]=d.useState(null),[i,r]=d.useState(!1),[l,o]=d.useState(!1),[p,h]=d.useState(!1),[u,c]=d.useState(!1),[g,m]=d.useState(null),[k,x]=d.useState(),[v,b]=d.useState(!1),[w,_]=d.useState(!1),[j,F]=d.useState(),[T,y]=d.useState(),{data:I,isLoading:P}=Ir(),{data:C}=_a(),{data:S}=wa(j?{project_id:j}:void 0),E=lp(),Q=(Array.isArray(I)?I:[]).filter(se=>!(t.project_id&&se.project_id!==t.project_id)),oe=d.useCallback(se=>{a(se),o(!1),r(!0)},[]),B=d.useCallback(()=>{b(!0),F(void 0),y(void 0)},[]),W=d.useCallback(()=>{b(!0),F(void 0),y(void 0)},[]),ge=d.useCallback(()=>{_(!0),F(void 0),y(void 0)},[]),Ae=d.useCallback(se=>{if(T){if(se==="add"){m(T);const re=S==null?void 0:S.find($=>$.task_id===T);x(re==null?void 0:re.name),c(!0)}else a(T),o(!0),r(!0);b(!1)}},[T,S]),rt=d.useCallback(async()=>{if(T){try{await E.mutateAsync(T),ie.success("Binding deleted")}catch{ie.error("Failed to delete binding")}_(!1)}},[T,E]);return e.jsxs("div",{className:"ptc-page",children:[e.jsx("h2",{children:"PTC Binding"}),e.jsx(op,{filters:t,onChange:s}),e.jsxs(Z,{className:"ptc-actions",wrap:!0,children:[e.jsx(z,{icon:e.jsx(At,{}),onClick:()=>h(!0),children:"Add Project / Task"}),e.jsx(z,{icon:e.jsx(At,{}),onClick:B,children:"Add Binding"}),e.jsx(z,{icon:e.jsx(Zr,{}),onClick:W,children:"Edit Binding"}),e.jsx(z,{icon:e.jsx(en,{}),danger:!0,onClick:ge,children:"Delete Binding"})]}),P?e.jsx(Ke,{size:"large",style:{display:"block",textAlign:"center",marginTop:60}}):e.jsx(up,{projects:Q,onTaskClick:oe,filters:t}),e.jsx(mp,{taskId:n,open:i,onClose:()=>r(!1),editable:l}),e.jsx(fp,{open:p,onClose:()=>h(!1)}),e.jsx(gp,{open:u,onClose:()=>c(!1),taskId:g,taskName:k}),e.jsx($e,{title:"Select Project / Task",open:v,onCancel:()=>b(!1),onOk:()=>Ae(u?"add":"edit"),okText:"Continue",footer:[e.jsx(z,{onClick:()=>b(!1),children:"Cancel"},"cancel"),e.jsx(z,{type:"primary",onClick:()=>Ae("add"),disabled:!T,children:"Add Binding"},"add"),e.jsx(z,{onClick:()=>Ae("edit"),disabled:!T,children:"Edit Binding"},"edit")],children:e.jsxs(Z,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsx(V,{style:{width:"100%"},placeholder:"Select Project",showSearch:!0,allowClear:!0,value:j,onChange:F,filterOption:(se,re)=>{var $;return($=re==null?void 0:re.label)==null?void 0:$.toLowerCase().includes(se.toLowerCase())},options:C==null?void 0:C.map(se=>({value:se.project_id,label:se.name}))}),e.jsx(V,{style:{width:"100%"},placeholder:"Select Task",showSearch:!0,allowClear:!0,value:T,onChange:y,filterOption:(se,re)=>{var $;return($=re==null?void 0:re.label)==null?void 0:$.toLowerCase().includes(se.toLowerCase())},options:S==null?void 0:S.map(se=>({value:se.task_id,label:se.name})),disabled:!j})]})}),e.jsx($e,{title:"Delete Binding",open:w,onCancel:()=>_(!1),onOk:rt,okText:"Delete",okButtonProps:{danger:!0,disabled:!T},children:e.jsxs(Z,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsx(V,{style:{width:"100%"},placeholder:"Select Project",showSearch:!0,allowClear:!0,value:j,onChange:F,filterOption:(se,re)=>{var $;return($=re==null?void 0:re.label)==null?void 0:$.toLowerCase().includes(se.toLowerCase())},options:C==null?void 0:C.map(se=>({value:se.project_id,label:se.name}))}),e.jsx(V,{style:{width:"100%"},placeholder:"Select Task",showSearch:!0,allowClear:!0,value:T,onChange:y,filterOption:(se,re)=>{var $;return($=re==null?void 0:re.label)==null?void 0:$.toLowerCase().includes(se.toLowerCase())},options:S==null?void 0:S.map(se=>({value:se.task_id,label:se.name})),disabled:!j})]})})]})}function xp(){const[t,s]=d.useState(),{data:n,isLoading:a}=Ir(),{data:i,isLoading:r}=Fa(t||"",!!t),l=d.useMemo(()=>t&&i&&"tasks"in i?i.tasks.filter(g=>g.binding_status==="Published"):[],[t,i]),o=d.useMemo(()=>{const g=l.reduce((b,w)=>b+w.total_mileage,0),m=l.reduce((b,w)=>b+w.car_count,0),k=l.reduce((b,w)=>b+w.build_count,0),x=l.reduce((b,w)=>b+w.hotline_count,0),v=l.length>0?g/l.length:0;return{totalMileage:g,totalCars:m,totalBuilds:k,totalHotlines:x,avgMileage:v,taskCount:l.length}},[l]),p=d.useMemo(()=>l.map(g=>({name:g.name.length>20?g.name.slice(0,20)+"â€¦":g.name,mileage:Math.round(g.total_mileage),cars:g.car_count,hotlines:g.hotline_count})),[l]),h=a||r,u=Array.isArray(n)?n.map(g=>({value:g.project_id,label:g.name})):[],c=[{title:"Task",dataIndex:"name",key:"name",ellipsis:!0},{title:"Mileage (km)",dataIndex:"total_mileage",key:"mileage",render:g=>Math.round(g).toLocaleString()},{title:"Cars",dataIndex:"car_count",key:"cars"},{title:"Builds",dataIndex:"build_count",key:"builds"},{title:"Tags",dataIndex:"tag_count",key:"tags"},{title:"Hotlines",dataIndex:"hotline_count",key:"hotlines"},{title:"Date Range",key:"range",render:(g,m)=>m.start_date&&m.end_date?`${new Date(m.start_date).toLocaleDateString()} - ${new Date(m.end_date).toLocaleDateString()}`:"â€”"}];return e.jsxs("div",{className:"ptc-page",children:[e.jsx("h2",{children:"PTC KPI"}),e.jsx("div",{style:{marginBottom:24},children:e.jsx(V,{style:{width:300},placeholder:"Select Project",showSearch:!0,allowClear:!0,value:t,onChange:s,filterOption:(g,m)=>{var k;return(k=m==null?void 0:m.label)==null?void 0:k.toLowerCase().includes(g.toLowerCase())},options:u})}),h?e.jsx(Ke,{size:"large",style:{display:"block",textAlign:"center",marginTop:60}}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"ptc-kpi-grid",children:[e.jsxs(U,{className:"ptc-kpi-card",children:[e.jsx("div",{className:"stat-label",children:"Published Tasks"}),e.jsx("div",{className:"stat-number",children:o.taskCount})]}),e.jsxs(U,{className:"ptc-kpi-card",children:[e.jsx("div",{className:"stat-label",children:"Total Mileage (km)"}),e.jsx("div",{className:"stat-number",children:Math.round(o.totalMileage).toLocaleString()})]}),e.jsxs(U,{className:"ptc-kpi-card",children:[e.jsx("div",{className:"stat-label",children:"Total Cars"}),e.jsx("div",{className:"stat-number",children:o.totalCars})]}),e.jsxs(U,{className:"ptc-kpi-card",children:[e.jsx("div",{className:"stat-label",children:"Total Builds"}),e.jsx("div",{className:"stat-number",children:o.totalBuilds})]}),e.jsxs(U,{className:"ptc-kpi-card",children:[e.jsx("div",{className:"stat-label",children:"Avg Mileage / Task"}),e.jsx("div",{className:"stat-number",children:Math.round(o.avgMileage).toLocaleString()})]}),e.jsxs(U,{className:"ptc-kpi-card",children:[e.jsx("div",{className:"stat-label",children:"Total Hotlines"}),e.jsx("div",{className:"stat-number",children:o.totalHotlines})]})]}),p.length>0&&e.jsx(U,{style:{marginBottom:24},children:e.jsx(zt,{width:"100%",height:320,children:e.jsxs(Rs,{data:p,margin:{top:10,right:20,left:0,bottom:40},children:[e.jsx(Xt,{strokeDasharray:"3 3"}),e.jsx(yt,{dataKey:"name",angle:-30,textAnchor:"end",height:80}),e.jsx(Je,{}),e.jsx(Me,{}),e.jsx(it,{}),e.jsx(mt,{dataKey:"mileage",fill:"#76b900",name:"Mileage (km)"}),e.jsx(mt,{dataKey:"cars",fill:"#1890ff",name:"Cars"}),e.jsx(mt,{dataKey:"hotlines",fill:"#ff4d4f",name:"Hotlines"})]})})}),e.jsx(U,{title:"Published Tasks Detail",children:e.jsx(ve,{dataSource:l,columns:c,rowKey:"task_id",pagination:{pageSize:20},size:"small"})})]}):e.jsx(ce,{description:"Select a project to view KPI"})]})}const vp="https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",jp='&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>';function Sn({center:t=[31.23,121.47],zoom:s=11,style:n={width:"100%",height:"100%",minHeight:400},children:a}){return e.jsxs(aa,{center:t,zoom:s,style:n,scrollWheelZoom:!0,children:[e.jsx(ia,{url:vp,attribution:jp}),a]})}const Gt={Manual:"#8c8c8c",ACC:"#1890ff",LCC:"#52c41a",HighwayPilot:"#fa8c16",UrbanPilot:"#722ed1",Standby:"#595959",Autonomous:"#13c2c2"},Er={Blocker:"#f5222d",High:"#fa8c16",Medium:"#fadb14",Low:"#8c8c8c"};function Ar(t){return Gt[t]??"#8c8c8c"}function bp(t){return Er[t]??"#8c8c8c"}function Sp(t){const s=`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="${t}" stroke="#fff" stroke-width="2" opacity="0.9"/><circle cx="12" cy="12" r="4" fill="#fff"/></svg>`;return gs.divIcon({html:s,className:"",iconSize:[24,24],iconAnchor:[12,12]})}function zr({vin:t,lat:s,lng:n,drivingMode:a,speed:i,onClick:r}){const l=Ar(a??"Manual");return e.jsx(ra,{position:[s,n],icon:Sp(l),eventHandlers:{click:r},children:e.jsx(la,{children:e.jsxs("div",{style:{fontSize:12,lineHeight:1.6,color:"#fff",minWidth:120},children:[e.jsx("strong",{children:t}),e.jsx("br",{}),"Mode: ",a??"â€”",e.jsx("br",{}),"Speed: ",i!=null?`${i.toFixed(1)} m/s`:"â€”"]})})})}const kp="",Cp=`${kp}/api/sse/vehicles`,_p={Offline:"#8E8E93",Idle:"#007AFF",Active:"#34C759",Maintenance:"#FF9500"},xi=["#76B900","#007AFF","#FF9500","#AF52DE","#FF3B30","#5AC8FA","#FFCC00","#8E8E93"];function wp(){const t=Nt(),[s,n]=d.useState(),[a,i]=d.useState(),[r,l]=d.useState(),[o,p]=d.useState(),{data:h,isLoading:u}=O({queryKey:["vehicles"],queryFn:()=>ja(),refetchInterval:15e3}),{data:c}=O({queryKey:["fleet-distribution"],queryFn:zd}),{data:g}=O({queryKey:["fleet-status-distribution"],queryFn:Md}),[m,k]=d.useState({}),x=d.useRef(null);d.useEffect(()=>{const y=new EventSource(Cp);return x.current=y,y.onmessage=I=>{try{const P=JSON.parse(I.data),C=P.vin;if(!C)return;k(S=>({...S,[C]:{currentLocation:P.current_location,currentSpeed:P.current_speed_mps,drivingMode:P.driving_mode,status:P.current_status}}))}catch{}},()=>{y.close()}},[]);const v=(h??[]).map(y=>{const I=m[y.vin];return I?{...y,...I}:y}),b=v.filter(y=>!(s&&y.plateType!==s||a&&y.modelCode!==a||r&&y.status!==r||o&&y.drivingMode!==o)),w=b.filter(y=>{var I,P;return((I=y.currentLocation)==null?void 0:I.lat)&&((P=y.currentLocation)==null?void 0:P.lng)}),_=d.useMemo(()=>{const y=v,I=y.filter(E=>E.status==="Active"||E.status==="Idle").length,P=y.filter(E=>E.status==="Maintenance").length,C=y.filter(E=>E.status==="Active").length,S=y.length>0?Math.round(C/y.length*100):0;return{total:y.length,online:I,issues:P,uptime:S}},[v]),j=[{label:"Total Vehicles",value:_.total,color:"#76B900"},{label:"Online",value:_.online,color:"#007AFF"},{label:"Issues",value:_.issues,color:"#FF9500"},{label:"Avg Uptime",value:`${_.uptime}%`,color:"#34C759"}],F=[{title:"VIN",dataIndex:"vin",key:"vin",width:180,render:y=>e.jsx(qe,{to:`/fleet/vehicles/${y}`,mono:!0,children:y})},{title:"Plate",dataIndex:"plateType",key:"plateType",width:100,render:y=>y?e.jsx(K,{children:y==="permanent"?"Perm":"Temp"}):"â€”"},{title:"Model",dataIndex:"modelCode",key:"modelCode",width:100,render:y=>y??"â€”"},{title:"Status",dataIndex:"status",key:"status",width:100,render:y=>e.jsx(K,{color:_p[y]??"#8E8E93",children:y})},{title:"Mode",dataIndex:"drivingMode",key:"drivingMode",width:120,render:y=>y?e.jsx(K,{color:Gt[y],children:y}):"â€”"},{title:"Speed",dataIndex:"currentSpeed",key:"speed",width:100,render:y=>y!=null?`${y.toFixed(1)} m/s`:"â€”"},{title:"Platform",dataIndex:"platform",key:"platform",width:120,render:y=>y??"â€”"}],T=y=>{const I=Math.floor(y/36e5),P=Math.floor(y%36e5/6e4);return I>0?`${I}h ${P}m`:`${P}m`};return e.jsxs("div",{children:[e.jsx(jt,{title:"Fleet Dashboard",subtitle:`${v.length} vehicles`}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16,marginBottom:20},children:j.map(y=>e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:y.label}),e.jsx("span",{className:"stat-card-value",style:{color:y.color},children:y.value})]},y.label))}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(Z,{size:"small",wrap:!0,children:[e.jsx(V,{allowClear:!0,placeholder:"Plate",style:{width:110},value:s,onChange:n,options:[{value:"permanent",label:"Perm"},{value:"temporary",label:"Temp"}]}),e.jsx(V,{allowClear:!0,placeholder:"Model",style:{width:120},value:a,onChange:i,options:((c==null?void 0:c.model_code)??[]).map(y=>({value:y.name,label:y.name}))}),e.jsx(V,{allowClear:!0,placeholder:"Status",style:{width:120},value:r,onChange:l,options:["Offline","Idle","Active","Maintenance"].map(y=>({value:y,label:y}))}),e.jsx(V,{allowClear:!0,placeholder:"Mode",style:{width:130},value:o,onChange:p,options:Object.keys(Gt).map(y=>({value:y,label:y}))})]})}),e.jsxs("div",{className:"ios-card",style:{display:"flex",gap:0,overflow:"hidden",marginBottom:20},children:[e.jsxs("div",{style:{flex:"0 0 60%",borderRight:"1px solid var(--border-secondary)"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border-secondary)",fontWeight:600,fontSize:"0.9375rem",color:"var(--text-primary)"},children:"Live Map"}),e.jsx("div",{style:{height:460},children:e.jsx(Sn,{children:w.map(y=>e.jsx(zr,{vin:y.vin,lat:y.currentLocation.lat,lng:y.currentLocation.lng,drivingMode:y.drivingMode,speed:y.currentSpeed,onClick:()=>t(`/fleet/vehicles/${y.vin}`)},y.vin))})})]}),e.jsxs("div",{style:{flex:"0 0 40%",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border-secondary)",fontWeight:600,fontSize:"0.9375rem",color:"var(--text-primary)"},children:["Vehicles",e.jsx("span",{style:{fontWeight:400,fontSize:"0.8125rem",color:"var(--text-muted)",marginLeft:8},children:b.length})]}),e.jsx("div",{style:{flex:1,overflow:"auto"},children:e.jsx(ve,{dataSource:b,columns:F,rowKey:"vin",size:"small",loading:u,scroll:{y:410},pagination:!1,onRow:y=>({onClick:()=>t(`/fleet/vehicles/${y.vin}`),style:{cursor:"pointer"}})})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16},children:[e.jsxs("div",{className:"ios-card",style:{padding:20},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.9375rem",color:"var(--text-primary)",marginBottom:16},children:"Plate Type"}),e.jsx(zt,{width:"100%",height:200,children:e.jsxs(yn,{children:[e.jsx(xn,{data:(c==null?void 0:c.plate_type)??[],dataKey:"count",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,label:({name:y,count:I})=>`${y}: ${I}`,children:((c==null?void 0:c.plate_type)??[]).map((y,I)=>e.jsx(fs,{fill:xi[I%xi.length]},I))}),e.jsx(Me,{})]})})]}),e.jsxs("div",{className:"ios-card",style:{padding:20},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.9375rem",color:"var(--text-primary)",marginBottom:16},children:"Model Distribution"}),e.jsx(zt,{width:"100%",height:200,children:e.jsxs(Rs,{data:(c==null?void 0:c.model_code)??[],children:[e.jsx(yt,{dataKey:"name",tick:{fill:"var(--text-muted)",fontSize:11}}),e.jsx(Je,{tick:{fill:"var(--text-muted)",fontSize:11}}),e.jsx(Me,{}),e.jsx(mt,{dataKey:"count",fill:"#76B900",radius:[4,4,0,0]})]})})]}),e.jsxs("div",{className:"ios-card",style:{padding:20},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.9375rem",color:"var(--text-primary)",marginBottom:16},children:"Status Duration Distribution"}),e.jsx(zt,{width:"100%",height:200,children:e.jsxs(Rs,{data:g??[],layout:"vertical",children:[e.jsx(yt,{type:"number",tick:{fill:"var(--text-muted)",fontSize:11},tickFormatter:y=>T(y)}),e.jsx(Je,{dataKey:"driving_mode",type:"category",tick:{fill:"var(--text-muted)",fontSize:11},width:90}),e.jsx(Me,{formatter:y=>T(y)}),e.jsx(mt,{dataKey:"total_duration_ms",fill:"#34C759",radius:[0,4,4,0]})]})})]})]})]})}function Fp(t){const s=t[0];if(!s)return[];const n=[];let a=s.driving_mode,i=[[s.location.lat,s.location.lng]],r=s.speed_mps,l=s.timestamp;for(let p=1;p<t.length;p++){const h=t[p],u=t[p-1];h.driving_mode!==a&&(n.push({mode:a,positions:[...i],startTime:l,endTime:u.timestamp,avgSpeed:r/i.length}),a=h.driving_mode,i=[[u.location.lat,u.location.lng]],r=0,l=h.timestamp),i.push([h.location.lat,h.location.lng]),r+=h.speed_mps}const o=t[t.length-1];return n.push({mode:a,positions:i,startTime:l,endTime:o.timestamp,avgSpeed:r/i.length}),n}function Mr({points:t}){const s=Fp(t);return e.jsx(e.Fragment,{children:s.map((n,a)=>e.jsx(Ps,{positions:n.positions,pathOptions:{color:Ar(n.mode),weight:3,opacity:.85},children:e.jsx(rn,{sticky:!0,children:e.jsxs("div",{style:{fontSize:11,lineHeight:1.5},children:[e.jsx("strong",{children:n.mode}),e.jsx("br",{}),"Avg speed: ",n.avgSpeed.toFixed(1)," m/s",e.jsx("br",{}),n.startTime&&new Date(n.startTime).toLocaleTimeString()," â†’ ",n.endTime&&new Date(n.endTime).toLocaleTimeString()]})})},a))})}const Ip={Offline:"#8E8E93",Idle:"#007AFF",Active:"#34C759",Maintenance:"#FF9500"},Tp={Manual:"#8E8E93",ACC:"#007AFF",LCC:"#76B900",HighwayPilot:"#FF9500",UrbanPilot:"#AF52DE",Standby:"#636366",Autonomous:"#5AC8FA"};function Rp(){const{vin:t}=bs(),s=Nt(),{data:n,isLoading:a}=O({queryKey:["vehicle",t],queryFn:()=>Pd(t),enabled:!!t}),{data:i}=O({queryKey:["vehicle-status-dist",t],queryFn:()=>Ed(t),enabled:!!t}),{data:r}=O({queryKey:["vehicle-trajectory",t],queryFn:()=>Ad(t,{limit:"2000"}),enabled:!!t}),{data:l}=O({queryKey:["vehicle-runs",t],queryFn:()=>Ks({vehicleVin:t}),enabled:!!t});if(a)return e.jsx("div",{style:{textAlign:"center",padding:80},children:e.jsx(Ke,{size:"large"})});if(!n)return e.jsx(ce,{description:"Vehicle not found"});const o=m=>{const k=Math.floor(m/36e5),x=Math.floor(m%36e5/6e4);return k>0?`${k}h ${x}m`:`${x}m`},p=(i??[]).map(m=>({name:m.driving_mode,value:m.total_duration_ms,mileage:m.total_mileage_km})),h=(l??[]).filter(m=>m.status==="Active"||m.status==="Scheduled"),u=m=>e.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:600,color:"var(--text-primary)"},children:m}),c={color:"var(--text-secondary)",fontWeight:500},g={color:"var(--text-primary)"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsx(jt,{title:n.vin,subtitle:n.modelCode??n.platform??""}),e.jsxs(fe,{gutter:[16,16],children:[e.jsx(q,{xs:24,lg:12,children:e.jsx(U,{title:u("Vehicle Info"),size:"small",className:"ios-card",children:e.jsxs(ae,{column:2,size:"small",labelStyle:c,contentStyle:g,children:[e.jsx(ae.Item,{label:"VIN",children:n.vin}),e.jsx(ae.Item,{label:"Plate Type",children:n.plateType==="permanent"?"Perm":n.plateType==="temporary"?"Temp":"â€”"}),e.jsx(ae.Item,{label:"Model Code",children:n.modelCode??"â€”"}),e.jsx(ae.Item,{label:"Platform",children:n.platform??"â€”"}),e.jsx(ae.Item,{label:"SoC Arch",children:n.socArchitecture??"â€”"}),e.jsx(ae.Item,{label:"Sensor Suite",children:n.sensorSuiteVersion??"â€”"}),n.componentVersions&&Object.entries(n.componentVersions).map(([m,k])=>e.jsx(ae.Item,{label:m,children:k},m))]})})}),e.jsx(q,{xs:24,lg:12,children:e.jsx(U,{title:u("Real-time Status"),size:"small",className:"ios-card",children:e.jsxs(ae,{column:2,size:"small",labelStyle:c,contentStyle:g,children:[e.jsx(ae.Item,{label:"Status",children:e.jsx(K,{color:Ip[n.status],children:n.status})}),e.jsx(ae.Item,{label:"Mode",children:n.drivingMode?e.jsx(K,{color:Gt[n.drivingMode],children:n.drivingMode}):"â€”"}),e.jsx(ae.Item,{label:"Speed",children:n.currentSpeed!=null?`${n.currentSpeed.toFixed(1)} m/s`:"â€”"}),e.jsx(ae.Item,{label:"Battery",children:n.fuelOrBatteryLevel!=null?`${n.fuelOrBatteryLevel}%`:"â€”"}),e.jsx(ae.Item,{label:"Location",span:2,children:n.currentLocation?`${n.currentLocation.lat.toFixed(5)}, ${n.currentLocation.lng.toFixed(5)}`:"â€”"}),e.jsx(ae.Item,{label:"Last Heartbeat",children:n.lastHeartbeat?new Date(n.lastHeartbeat).toLocaleString():"â€”"})]})})})]}),e.jsxs(fe,{gutter:[16,16],children:[e.jsx(q,{xs:24,lg:8,children:e.jsx(U,{title:u("Active Tasks"),size:"small",className:"ios-card",style:{height:320},children:h.length===0?e.jsx(ce,{description:"No active tasks",image:ce.PRESENTED_IMAGE_SIMPLE}):e.jsx(ve,{dataSource:h,columns:[{title:"Run",dataIndex:"id",key:"id",render:m=>e.jsxs("a",{onClick:()=>s(`/runs/${m}`),children:[m.slice(0,12),"â€¦"]})},{title:"Task",dataIndex:"taskId",key:"task",render:m=>e.jsxs("a",{onClick:()=>s(`/tasks/${m}`),children:[m.slice(0,12),"â€¦"]})},{title:"Status",dataIndex:"status",key:"status",render:m=>e.jsx(K,{color:m==="Active"?"#34C759":"#007AFF",children:m})}],rowKey:"id",size:"small",pagination:!1,scroll:{y:220}})})}),e.jsx(q,{xs:24,lg:8,children:e.jsx(U,{title:u("Driving Mode Distribution"),size:"small",className:"ios-card",style:{height:320},children:e.jsx(zt,{width:"100%",height:260,children:e.jsxs(yn,{children:[e.jsx(xn,{data:p,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,label:({name:m})=>m,children:p.map((m,k)=>e.jsx(fs,{fill:Tp[m.name]??Gt[m.name]??"#8E8E93"},k))}),e.jsx(Me,{formatter:m=>o(m)}),e.jsx(it,{})]})})})}),e.jsx(q,{xs:24,lg:8,children:e.jsx(U,{title:u("Mode Mileage (km)"),size:"small",className:"ios-card",style:{height:320},children:e.jsx(ve,{dataSource:i??[],columns:[{title:"Mode",dataIndex:"driving_mode",key:"mode",render:m=>e.jsx(K,{color:Gt[m],children:m})},{title:"Duration",dataIndex:"total_duration_ms",key:"dur",render:m=>o(m)},{title:"Mileage",dataIndex:"total_mileage_km",key:"km",render:m=>`${m.toFixed(2)} km`}],rowKey:"driving_mode",size:"small",pagination:!1,scroll:{y:220}})})})]}),e.jsx(U,{title:u("Recent Trajectory"),size:"small",className:"ios-card",children:e.jsx("div",{style:{height:400},children:e.jsxs(Sn,{center:n.currentLocation?[n.currentLocation.lat,n.currentLocation.lng]:void 0,zoom:13,children:[(r==null?void 0:r.data)&&e.jsx(Mr,{points:r.data}),n.currentLocation&&e.jsx(zr,{vin:n.vin,lat:n.currentLocation.lat,lng:n.currentLocation.lng,drivingMode:n.drivingMode,speed:n.currentSpeed})]})})})]})}const{RangePicker:Pp}=Ts;function Ep(){const[t,s]=d.useState(),[n,a]=d.useState(),[i,r]=d.useState(),[l,o]=d.useState(),[p,h]=d.useState(null),[u,c]=d.useState(),{data:g}=O({queryKey:["projects"],queryFn:()=>ks()}),{data:m}=O({queryKey:["tasks",t],queryFn:()=>qs(t?{projectId:t}:void 0)}),{data:k}=O({queryKey:["runs",n],queryFn:()=>Ks(n?{taskId:n}:void 0)}),{data:x}=O({queryKey:["vehicles-list"],queryFn:()=>ja()}),{data:v,isLoading:b}=O({queryKey:["trajectory",u],queryFn:()=>Nd(u),enabled:!!u}),w=()=>{const T={};l&&(T.vin=l),i?T.run_id=i:n?T.task_id=n:t&&(T.project_id=t),p&&(T.start_time=p[0].toISOString(),T.end_time=p[1].toISOString()),c(T)},_=(v==null?void 0:v.data)??[],j=_.length>0?_[Math.floor(_.length/2)]:void 0,F=j?[j.location.lat,j.location.lng]:void 0;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsx(jt,{title:"Trajectory Query",subtitle:"Vehicle trajectory by project/task/run/vin"}),e.jsx(U,{size:"small",className:"ios-card",children:e.jsxs(Z,{wrap:!0,size:"middle",children:[e.jsx(V,{allowClear:!0,placeholder:"Project",style:{width:180},value:t,onChange:T=>{s(T),a(void 0),r(void 0)},options:(g??[]).map(T=>({value:T.id,label:T.name})),showSearch:!0,optionFilterProp:"label"}),e.jsx(V,{allowClear:!0,placeholder:"Task",style:{width:180},value:n,onChange:T=>{a(T),r(void 0)},options:(m??[]).map(T=>({value:T.id,label:T.title})),showSearch:!0,optionFilterProp:"label"}),e.jsx(V,{allowClear:!0,placeholder:"Run",style:{width:180},value:i,onChange:r,options:(k??[]).map(T=>({value:T.id,label:T.id.slice(0,16)})),showSearch:!0}),e.jsx(V,{allowClear:!0,placeholder:"Vehicle",style:{width:180},value:l,onChange:o,options:(x??[]).map(T=>({value:T.vin,label:T.vin})),showSearch:!0,optionFilterProp:"label"}),e.jsx(Pp,{showTime:!0,value:p,onChange:T=>h(T)}),e.jsx(z,{type:"primary",onClick:w,loading:b,children:"Search"})]})}),e.jsx(U,{size:"small",className:"ios-card",bodyStyle:{padding:0,height:"calc(100vh - 280px)",minHeight:500},children:u?b?e.jsx("div",{style:{textAlign:"center",paddingTop:100},children:e.jsx(Ke,{size:"large"})}):_.length===0?e.jsx(ce,{description:"No trajectory points found",style:{paddingTop:100}}):e.jsx(Sn,{center:F,zoom:13,style:{width:"100%",height:"100%"},children:e.jsx(Mr,{points:_})}):e.jsx(ce,{description:"Set filters and click Search",style:{paddingTop:100}})}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[Object.entries(Gt).map(([T,y])=>e.jsx(K,{color:y,children:T},T)),v&&e.jsxs(K,{children:["Total: ",v.total," points"]})]})]})}function Ap(t){const s=`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="28" viewBox="0 0 20 28"><path d="M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z" fill="${t}" stroke="#fff" stroke-width="1.5"/><circle cx="10" cy="10" r="4" fill="#fff"/></svg>`;return gs.divIcon({html:s,className:"",iconSize:[20,28],iconAnchor:[10,28],popupAnchor:[0,-28]})}function zp({issue:t}){var n,a;if(!((n=t.location)!=null&&n.lat)||!((a=t.location)!=null&&a.lng))return null;const s=bp(t.severity);return e.jsx(ra,{position:[t.location.lat,t.location.lng],icon:Ap(s),children:e.jsx(la,{children:e.jsxs("div",{style:{fontSize:12,lineHeight:1.6,color:"#fff",minWidth:160},children:[e.jsx("strong",{children:t.issue_id}),e.jsx("br",{}),"Category: ",t.category??"â€”",e.jsx("br",{}),"Severity: ",e.jsx("span",{style:{color:s},children:t.severity}),e.jsx("br",{}),t.description&&e.jsxs("span",{children:[t.description.slice(0,80),t.description.length>80?"â€¦":"",e.jsx("br",{})]}),t.triggered_at&&e.jsxs(e.Fragment,{children:["Time: ",new Date(t.triggered_at).toLocaleString(),e.jsx("br",{})]}),e.jsx("a",{href:`/issues/${t.issue_id}`,style:{color:"#1890ff"},children:"View Detail â†’"})]})})})}const{RangePicker:Mp}=Ts;function Np(){const[t,s]=d.useState(),[n,a]=d.useState(),[i,r]=d.useState(),[l,o]=d.useState(),[p,h]=d.useState(null),[u,c]=d.useState(),{data:g}=O({queryKey:["projects"],queryFn:()=>ks()}),{data:m}=O({queryKey:["tasks",t],queryFn:()=>qs(t?{projectId:t}:void 0)}),{data:k}=O({queryKey:["runs",n],queryFn:()=>Ks(n?{taskId:n}:void 0)}),{data:x}=O({queryKey:["vehicles-list-im"],queryFn:()=>ja()}),{data:v,isLoading:b}=O({queryKey:["issue-locations",u],queryFn:()=>Od(u),enabled:!!u}),w=()=>{const y={};l&&(y.vin=l),i?y.run_id=i:n?y.task_id=n:t&&(y.project_id=t),p&&(y.start_time=p[0].toISOString(),y.end_time=p[1].toISOString()),c(y)},j=((v==null?void 0:v.data)??[]).filter(y=>{var I,P;return((I=y.location)==null?void 0:I.lat)&&((P=y.location)==null?void 0:P.lng)}),F=j[0],T=F!=null&&F.location?[F.location.lat,F.location.lng]:void 0;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsx(jt,{title:"Issue Map",subtitle:"Issue locations on map"}),e.jsx(U,{size:"small",className:"ios-card",children:e.jsxs(Z,{wrap:!0,size:"middle",children:[e.jsx(V,{allowClear:!0,placeholder:"Project",style:{width:180},value:t,onChange:y=>{s(y),a(void 0),r(void 0)},options:(g??[]).map(y=>({value:y.id,label:y.name})),showSearch:!0,optionFilterProp:"label"}),e.jsx(V,{allowClear:!0,placeholder:"Task",style:{width:180},value:n,onChange:y=>{a(y),r(void 0)},options:(m??[]).map(y=>({value:y.id,label:y.title})),showSearch:!0,optionFilterProp:"label"}),e.jsx(V,{allowClear:!0,placeholder:"Run",style:{width:180},value:i,onChange:r,options:(k??[]).map(y=>({value:y.id,label:y.id.slice(0,16)})),showSearch:!0}),e.jsx(V,{allowClear:!0,placeholder:"Vehicle",style:{width:180},value:l,onChange:o,options:(x??[]).map(y=>({value:y.vin,label:y.vin})),showSearch:!0,optionFilterProp:"label"}),e.jsx(Mp,{showTime:!0,value:p,onChange:y=>h(y)}),e.jsx(z,{type:"primary",onClick:w,loading:b,children:"Search"})]})}),e.jsx(U,{size:"small",className:"ios-card",bodyStyle:{padding:0,height:"calc(100vh - 280px)",minHeight:500},children:u?b?e.jsx("div",{style:{textAlign:"center",paddingTop:100},children:e.jsx(Ke,{size:"large"})}):j.length===0?e.jsx(ce,{description:"No issues with location found",style:{paddingTop:100}}):e.jsx(Sn,{center:T,zoom:12,style:{width:"100%",height:"100%"},children:j.map(y=>e.jsx(zp,{issue:y},y.issue_id))}):e.jsx(ce,{description:"Set filters and click Search",style:{paddingTop:100}})}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[Object.entries(Er).map(([y,I])=>e.jsx(K,{color:I,children:y},y)),v&&e.jsxs(K,{children:["Total: ",v.total," issues, ",j.length," with GPS"]})]})]})}function Op(){return e.jsx(yo,{children:e.jsxs(he,{element:e.jsx(yd,{}),children:[e.jsx(he,{index:!0,element:e.jsx(Va,{to:"/projects",replace:!0})}),e.jsx(he,{path:"projects",element:e.jsx(Ou,{})}),e.jsx(he,{path:"projects/:id",element:e.jsx(Bu,{})}),e.jsx(he,{path:"tasks",element:e.jsx(Wu,{})}),e.jsx(he,{path:"tasks/:id",element:e.jsx(Vu,{})}),e.jsx(he,{path:"runs",element:e.jsx(Qu,{})}),e.jsx(he,{path:"runs/:id",element:e.jsx(Gu,{})}),e.jsx(he,{path:"issues",element:e.jsx(Yu,{})}),e.jsx(he,{path:"issues/:id",element:e.jsx(th,{})}),e.jsx(he,{path:"kpi",element:e.jsx(zh,{})}),e.jsx(he,{path:"traceability",element:e.jsx(Lh,{})}),e.jsx(he,{path:"auto-triage",element:e.jsx(qh,{})}),e.jsx(he,{path:"ptc",element:e.jsx(Va,{to:"/ptc/binding",replace:!0})}),e.jsx(he,{path:"ptc/binding",element:e.jsx(yp,{})}),e.jsx(he,{path:"ptc/kpi",element:e.jsx(xp,{})}),e.jsx(he,{path:"simulation",element:e.jsx(Jh,{})}),e.jsx(he,{path:"simulation/:id",element:e.jsx(Zh,{})}),e.jsx(he,{path:"fleet",element:e.jsx(wp,{})}),e.jsx(he,{path:"fleet/vehicles/:vin",element:e.jsx(Rp,{})}),e.jsx(he,{path:"fleet/trajectory",element:e.jsx(Ep,{})}),e.jsx(he,{path:"fleet/issues-map",element:e.jsx(Np,{})})]})})}const Dp=new jc({defaultOptions:{queries:{staleTime:3e4,retry:1,refetchOnWindowFocus:!1}}}),Lp={algorithm:sl.defaultAlgorithm,token:{colorPrimary:"#76B900",colorInfo:"#007AFF",colorSuccess:"#34C759",colorWarning:"#FF9500",colorError:"#FF3B30",colorBgContainer:"#FFFFFF",colorBgElevated:"#FFFFFF",colorBgLayout:"#F5F5F7",colorBorder:"#D1D1D6",colorBorderSecondary:"#E5E5EA",colorText:"#1D1D1F",colorTextSecondary:"#6E6E73",colorTextTertiary:"#AEAEB2",colorTextQuaternary:"#C7C7CC",borderRadius:12,borderRadiusLG:16,borderRadiusSM:8,fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif",fontSize:14,controlHeight:36,wireframe:!1},components:{Layout:{headerBg:"#FFFFFF",siderBg:"#FFFFFF",bodyBg:"#F5F5F7",triggerBg:"#E5E5EA"},Menu:{itemBg:"transparent",subMenuItemBg:"transparent",itemSelectedBg:"rgba(118, 185, 0, 0.08)",itemHoverBg:"#F0F0F2",itemColor:"#6E6E73",itemSelectedColor:"#76B900",itemBorderRadius:10,itemMarginInline:8,iconSize:16},Table:{headerBg:"#F5F5F7",headerColor:"#6E6E73",rowHoverBg:"#F0F0F2",borderColor:"#E5E5EA",cellPaddingBlock:12,cellPaddingInline:16},Card:{colorBgContainer:"#FFFFFF",colorBorderSecondary:"#E5E5EA"},Button:{primaryShadow:"0 2px 8px rgba(118, 185, 0, 0.20)",defaultBg:"#FFFFFF",defaultBorderColor:"#D1D1D6",borderRadius:12,borderRadiusLG:12},Input:{colorBgContainer:"#FFFFFF",activeBorderColor:"#76B900",hoverBorderColor:"#D1D1D6"},Select:{colorBgContainer:"#FFFFFF",optionSelectedBg:"rgba(118, 185, 0, 0.08)"},Tag:{borderRadiusSM:999},Descriptions:{colorSplit:"#E5E5EA",titleColor:"#6E6E73",contentColor:"#1D1D1F"},Timeline:{dotBorderWidth:2,tailColor:"#E5E5EA"},Breadcrumb:{separatorColor:"#AEAEB2",linkColor:"#6E6E73",linkHoverColor:"#1D1D1F",lastItemColor:"#1D1D1F"},Statistic:{titleFontSize:12,contentFontSize:28},Progress:{remainingColor:"#E5E5EA"},Tabs:{inkBarColor:"#76B900",itemSelectedColor:"#76B900",itemColor:"#6E6E73",itemHoverColor:"#1D1D1F"},Collapse:{headerBg:"#F5F5F7",contentBg:"#FFFFFF"},Modal:{contentBg:"#FFFFFF",headerBg:"#FFFFFF"}}};el.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx($o,{children:e.jsx(bc,{client:Dp,children:e.jsx(tl,{theme:Lp,children:e.jsx(nl,{children:e.jsx(Du,{children:e.jsx(Op,{})})})})})})}));
