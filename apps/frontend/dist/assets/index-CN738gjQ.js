const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B-futPCK.js","assets/recharts-B_IAjnGN.js","assets/antd-DmOTwRbj.js"])))=>i.map(i=>d[i]);
var Si=Object.defineProperty;var Rn=t=>{throw TypeError(t)};var ki=(t,s,r)=>s in t?Si(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var In=(t,s,r)=>ki(t,typeof s!="symbol"?s+"":s,r),yr=(t,s,r)=>s.has(t)||Rn("Cannot "+r);var m=(t,s,r)=>(yr(t,s,"read from private field"),r?r.call(t):s.get(t)),z=(t,s,r)=>s.has(t)?Rn("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,r),A=(t,s,r,n)=>(yr(t,s,"write to private field"),n?n.call(t,r):s.set(t,r),r),q=(t,s,r)=>(yr(t,s,"access private method"),r);var Ks=(t,s,r,n)=>({set _(a){A(t,s,a,r)},get _(){return m(t,s,n)}});import{r as h,D as Ci,A as _i,L as wi,B as Fi,F as M,d as O,e as Qt,f as ce,C as N,S as ee,I as G,h as cr,i as se,j as Qr,k as ja,l as ba,E as ne,m as xe,M as us,n as Rs,T as we,o as B,P as Gr,s as te,p as Kt,q as Ri,t as Jr,u as K,v as Z,w as Ut,x as Yr,y as Ii,z as Sa,G as Ti,H as Ei,J as Vt,K as Pi,N as gr,O as xr,Q as Ai,U as ka,V as zi,W as Ca,X as _a,Y as wr,Z as Mi,_ as Tn,$ as Ni,a0 as Wt,a1 as vr,a2 as Oi,a3 as Li,a4 as Di,a5 as Bi,a6 as $i}from"./antd-DmOTwRbj.js";import{R as Lt,L as wa,C as hs,X as Ct,Y as Je,T as ze,a as ot,b as Xr,B as Zs,c as ls,d as os,e as qi,f as Ki,P as Wi,g as Ui,h as Vi,i as Hi,j as dr,k as ur,S as Qi,l as Gi,A as Fa,m as Fr,n as Ji}from"./recharts-B_IAjnGN.js";import{M as Zr,T as en,P as Is,a as tn,b as sn,C as Rr,c as er,u as Yi,L as cs,d as Xi}from"./maps-R38sN0PA.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();var jr={exports:{}},_s={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var En;function Zi(){if(En)return _s;En=1;var t=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function r(n,a,i){var l=null;if(i!==void 0&&(l=""+i),a.key!==void 0&&(l=""+a.key),"key"in a){i={};for(var o in a)o!=="key"&&(i[o]=a[o])}else i=a;return a=i.ref,{$$typeof:t,type:n,key:l,ref:a!==void 0?a:null,props:i}}return _s.Fragment=s,_s.jsx=r,_s.jsxs=r,_s}var Pn;function el(){return Pn||(Pn=1,jr.exports=Zi()),jr.exports}var e=el();/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var An="popstate";function tl(t={}){function s(n,a){let{pathname:i,search:l,hash:o}=n.location;return Ir("",{pathname:i,search:l,hash:o},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function r(n,a){return typeof a=="string"?a:Ts(a)}return rl(s,r,null,t)}function ie(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function qe(t,s){if(!t){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function sl(){return Math.random().toString(36).substring(2,10)}function zn(t,s){return{usr:t.state,key:t.key,idx:s}}function Ir(t,s,r=null,n){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof s=="string"?ps(s):s,state:r,key:s&&s.key||n||sl()}}function Ts({pathname:t="/",search:s="",hash:r=""}){return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function ps(t){let s={};if(t){let r=t.indexOf("#");r>=0&&(s.hash=t.substring(r),t=t.substring(0,r));let n=t.indexOf("?");n>=0&&(s.search=t.substring(n),t=t.substring(0,n)),t&&(s.pathname=t)}return s}function rl(t,s,r,n={}){let{window:a=document.defaultView,v5Compat:i=!1}=n,l=a.history,o="POP",p=null,d=u();d==null&&(d=0,l.replaceState({...l.state,idx:d},""));function u(){return(l.state||{idx:null}).idx}function c(){o="POP";let b=u(),v=b==null?null:b-d;d=b,p&&p({action:o,location:j.location,delta:v})}function g(b,v){o="PUSH";let R=Ir(j.location,b,v);d=u()+1;let _=zn(R,d),S=j.createHref(R);try{l.pushState(_,"",S)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;a.location.assign(S)}i&&p&&p({action:o,location:j.location,delta:1})}function f(b,v){o="REPLACE";let R=Ir(j.location,b,v);d=u();let _=zn(R,d),S=j.createHref(R);l.replaceState(_,"",S),i&&p&&p({action:o,location:j.location,delta:0})}function k(b){return nl(b)}let j={get action(){return o},get location(){return t(a,l)},listen(b){if(p)throw new Error("A history only accepts one active listener");return a.addEventListener(An,c),p=b,()=>{a.removeEventListener(An,c),p=null}},createHref(b){return s(a,b)},createURL:k,encodeLocation(b){let v=k(b);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:g,replace:f,go(b){return l.go(b)}};return j}function nl(t,s=!1){let r="http://localhost";typeof window<"u"&&(r=window.location.origin!=="null"?window.location.origin:window.location.href),ie(r,"No window.location.(origin|href) available to create URL");let n=typeof t=="string"?t:Ts(t);return n=n.replace(/ $/,"%20"),!s&&n.startsWith("//")&&(n=r+n),new URL(n,r)}function Ra(t,s,r="/"){return al(t,s,r,!1)}function al(t,s,r,n){let a=typeof s=="string"?ps(s):s,i=it(a.pathname||"/",r);if(i==null)return null;let l=Ia(t);il(l);let o=null;for(let p=0;o==null&&p<l.length;++p){let d=gl(i);o=fl(l[p],d,n)}return o}function Ia(t,s=[],r=[],n="",a=!1){let i=(l,o,p=a,d)=>{let u={relativePath:d===void 0?l.path||"":d,caseSensitive:l.caseSensitive===!0,childrenIndex:o,route:l};if(u.relativePath.startsWith("/")){if(!u.relativePath.startsWith(n)&&p)return;ie(u.relativePath.startsWith(n),`Absolute route path "${u.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(n.length)}let c=nt([n,u.relativePath]),g=r.concat(u);l.children&&l.children.length>0&&(ie(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${c}".`),Ia(l.children,s,g,c,p)),!(l.path==null&&!l.index)&&s.push({path:c,score:pl(c,l.index),routesMeta:g})};return t.forEach((l,o)=>{var p;if(l.path===""||!((p=l.path)!=null&&p.includes("?")))i(l,o);else for(let d of Ta(l.path))i(l,o,!0,d)}),s}function Ta(t){let s=t.split("/");if(s.length===0)return[];let[r,...n]=s,a=r.endsWith("?"),i=r.replace(/\?$/,"");if(n.length===0)return a?[i,""]:[i];let l=Ta(n.join("/")),o=[];return o.push(...l.map(p=>p===""?i:[i,p].join("/"))),a&&o.push(...l),o.map(p=>t.startsWith("/")&&p===""?"/":p)}function il(t){t.sort((s,r)=>s.score!==r.score?r.score-s.score:ml(s.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}var ll=/^:[\w-]+$/,ol=3,cl=2,dl=1,ul=10,hl=-2,Mn=t=>t==="*";function pl(t,s){let r=t.split("/"),n=r.length;return r.some(Mn)&&(n+=hl),s&&(n+=cl),r.filter(a=>!Mn(a)).reduce((a,i)=>a+(ll.test(i)?ol:i===""?dl:ul),n)}function ml(t,s){return t.length===s.length&&t.slice(0,-1).every((n,a)=>n===s[a])?t[t.length-1]-s[s.length-1]:0}function fl(t,s,r=!1){let{routesMeta:n}=t,a={},i="/",l=[];for(let o=0;o<n.length;++o){let p=n[o],d=o===n.length-1,u=i==="/"?s:s.slice(i.length)||"/",c=tr({path:p.relativePath,caseSensitive:p.caseSensitive,end:d},u),g=p.route;if(!c&&d&&r&&!n[n.length-1].route.index&&(c=tr({path:p.relativePath,caseSensitive:p.caseSensitive,end:!1},u)),!c)return null;Object.assign(a,c.params),l.push({params:a,pathname:nt([i,c.pathname]),pathnameBase:bl(nt([i,c.pathnameBase])),route:g}),c.pathnameBase!=="/"&&(i=nt([i,c.pathnameBase]))}return l}function tr(t,s){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=yl(t.path,t.caseSensitive,t.end),a=s.match(r);if(!a)return null;let i=a[0],l=i.replace(/(.)\/+$/,"$1"),o=a.slice(1);return{params:n.reduce((d,{paramName:u,isOptional:c},g)=>{if(u==="*"){let k=o[g]||"";l=i.slice(0,i.length-k.length).replace(/(.)\/+$/,"$1")}const f=o[g];return c&&!f?d[u]=void 0:d[u]=(f||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:l,pattern:t}}function yl(t,s=!1,r=!0){qe(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let n=[],a="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,o,p)=>(n.push({paramName:o,isOptional:p!=null}),p?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(n.push({paramName:"*"}),a+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?a+="\\/*$":t!==""&&t!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,s?void 0:"i"),n]}function gl(t){try{return t.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return qe(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${s}).`),t}}function it(t,s){if(s==="/")return t;if(!t.toLowerCase().startsWith(s.toLowerCase()))return null;let r=s.endsWith("/")?s.length-1:s.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}var xl=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function vl(t,s="/"){let{pathname:r,search:n="",hash:a=""}=typeof t=="string"?ps(t):t,i;return r?(r=r.replace(/\/\/+/g,"/"),r.startsWith("/")?i=Nn(r.substring(1),"/"):i=Nn(r,s)):i=s,{pathname:i,search:Sl(n),hash:kl(a)}}function Nn(t,s){let r=s.replace(/\/+$/,"").split("/");return t.split("/").forEach(a=>{a===".."?r.length>1&&r.pop():a!=="."&&r.push(a)}),r.length>1?r.join("/"):"/"}function br(t,s,r,n){return`Cannot include a '${t}' character in a manually specified \`to.${s}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function jl(t){return t.filter((s,r)=>r===0||s.route.path&&s.route.path.length>0)}function rn(t){let s=jl(t);return s.map((r,n)=>n===s.length-1?r.pathname:r.pathnameBase)}function nn(t,s,r,n=!1){let a;typeof t=="string"?a=ps(t):(a={...t},ie(!a.pathname||!a.pathname.includes("?"),br("?","pathname","search",a)),ie(!a.pathname||!a.pathname.includes("#"),br("#","pathname","hash",a)),ie(!a.search||!a.search.includes("#"),br("#","search","hash",a)));let i=t===""||a.pathname==="",l=i?"/":a.pathname,o;if(l==null)o=r;else{let c=s.length-1;if(!n&&l.startsWith("..")){let g=l.split("/");for(;g[0]==="..";)g.shift(),c-=1;a.pathname=g.join("/")}o=c>=0?s[c]:"/"}let p=vl(a,o),d=l&&l!=="/"&&l.endsWith("/"),u=(i||l===".")&&r.endsWith("/");return!p.pathname.endsWith("/")&&(d||u)&&(p.pathname+="/"),p}var nt=t=>t.join("/").replace(/\/\/+/g,"/"),bl=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Sl=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,kl=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,Cl=class{constructor(t,s,r,n=!1){this.status=t,this.statusText=s||"",this.internal=n,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}};function _l(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function wl(t){return t.map(s=>s.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Ea=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Pa(t,s){let r=t;if(typeof r!="string"||!xl.test(r))return{absoluteURL:void 0,isExternal:!1,to:r};let n=r,a=!1;if(Ea)try{let i=new URL(window.location.href),l=r.startsWith("//")?new URL(i.protocol+r):new URL(r),o=it(l.pathname,s);l.origin===i.origin&&o!=null?r=o+l.search+l.hash:a=!0}catch{qe(!1,`<Link to="${r}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:n,isExternal:a,to:r}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Aa=["POST","PUT","PATCH","DELETE"];new Set(Aa);var Fl=["GET",...Aa];new Set(Fl);var ms=h.createContext(null);ms.displayName="DataRouter";var hr=h.createContext(null);hr.displayName="DataRouterState";var Rl=h.createContext(!1),za=h.createContext({isTransitioning:!1});za.displayName="ViewTransition";var Il=h.createContext(new Map);Il.displayName="Fetchers";var Tl=h.createContext(null);Tl.displayName="Await";var Te=h.createContext(null);Te.displayName="Navigation";var Ls=h.createContext(null);Ls.displayName="Location";var Ne=h.createContext({outlet:null,matches:[],isDataRoute:!1});Ne.displayName="Route";var an=h.createContext(null);an.displayName="RouteError";var Ma="REACT_ROUTER_ERROR",El="REDIRECT",Pl="ROUTE_ERROR_RESPONSE";function Al(t){if(t.startsWith(`${Ma}:${El}:{`))try{let s=JSON.parse(t.slice(28));if(typeof s=="object"&&s&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.location=="string"&&typeof s.reloadDocument=="boolean"&&typeof s.replace=="boolean")return s}catch{}}function zl(t){if(t.startsWith(`${Ma}:${Pl}:{`))try{let s=JSON.parse(t.slice(40));if(typeof s=="object"&&s&&typeof s.status=="number"&&typeof s.statusText=="string")return new Cl(s.status,s.statusText,s.data)}catch{}}function Ml(t,{relative:s}={}){ie(fs(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:n}=h.useContext(Te),{hash:a,pathname:i,search:l}=Ds(t,{relative:s}),o=i;return r!=="/"&&(o=i==="/"?r:nt([r,i])),n.createHref({pathname:o,search:l,hash:a})}function fs(){return h.useContext(Ls)!=null}function Ke(){return ie(fs(),"useLocation() may be used only in the context of a <Router> component."),h.useContext(Ls).location}var Na="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Oa(t){h.useContext(Te).static||h.useLayoutEffect(t)}function _t(){let{isDataRoute:t}=h.useContext(Ne);return t?Jl():Nl()}function Nl(){ie(fs(),"useNavigate() may be used only in the context of a <Router> component.");let t=h.useContext(ms),{basename:s,navigator:r}=h.useContext(Te),{matches:n}=h.useContext(Ne),{pathname:a}=Ke(),i=JSON.stringify(rn(n)),l=h.useRef(!1);return Oa(()=>{l.current=!0}),h.useCallback((p,d={})=>{if(qe(l.current,Na),!l.current)return;if(typeof p=="number"){r.go(p);return}let u=nn(p,JSON.parse(i),a,d.relative==="path");t==null&&s!=="/"&&(u.pathname=u.pathname==="/"?s:nt([s,u.pathname])),(d.replace?r.replace:r.push)(u,d.state,d)},[s,r,i,a,t])}var Ol=h.createContext(null);function Ll(t){let s=h.useContext(Ne).outlet;return h.useMemo(()=>s&&h.createElement(Ol.Provider,{value:t},s),[s,t])}function ys(){let{matches:t}=h.useContext(Ne),s=t[t.length-1];return s?s.params:{}}function Ds(t,{relative:s}={}){let{matches:r}=h.useContext(Ne),{pathname:n}=Ke(),a=JSON.stringify(rn(r));return h.useMemo(()=>nn(t,JSON.parse(a),n,s==="path"),[t,a,n,s])}function Dl(t,s){return La(t,s)}function La(t,s,r,n,a){var R;ie(fs(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=h.useContext(Te),{matches:l}=h.useContext(Ne),o=l[l.length-1],p=o?o.params:{},d=o?o.pathname:"/",u=o?o.pathnameBase:"/",c=o&&o.route;{let _=c&&c.path||"";Ba(d,!c||_.endsWith("*")||_.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${_}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_}"> to <Route path="${_==="/"?"*":`${_}/*`}">.`)}let g=Ke(),f;if(s){let _=typeof s=="string"?ps(s):s;ie(u==="/"||((R=_.pathname)==null?void 0:R.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${_.pathname}" was given in the \`location\` prop.`),f=_}else f=g;let k=f.pathname||"/",j=k;if(u!=="/"){let _=u.replace(/^\//,"").split("/");j="/"+k.replace(/^\//,"").split("/").slice(_.length).join("/")}let b=Ra(t,{pathname:j});qe(c||b!=null,`No routes matched location "${f.pathname}${f.search}${f.hash}" `),qe(b==null||b[b.length-1].route.element!==void 0||b[b.length-1].route.Component!==void 0||b[b.length-1].route.lazy!==void 0,`Matched leaf route at location "${f.pathname}${f.search}${f.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let v=Wl(b&&b.map(_=>Object.assign({},_,{params:Object.assign({},p,_.params),pathname:nt([u,i.encodeLocation?i.encodeLocation(_.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?u:nt([u,i.encodeLocation?i.encodeLocation(_.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_.pathnameBase])})),l,r,n,a);return s&&v?h.createElement(Ls.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...f},navigationType:"POP"}},v):v}function Bl(){let t=Gl(),s=_l(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,n="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:n},i={padding:"2px 4px",backgroundColor:n},l=null;return console.error("Error handled by React Router default ErrorBoundary:",t),l=h.createElement(h.Fragment,null,h.createElement("p",null,"ðŸ’¿ Hey developer ðŸ‘‹"),h.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",h.createElement("code",{style:i},"ErrorBoundary")," or"," ",h.createElement("code",{style:i},"errorElement")," prop on your route.")),h.createElement(h.Fragment,null,h.createElement("h2",null,"Unexpected Application Error!"),h.createElement("h3",{style:{fontStyle:"italic"}},s),r?h.createElement("pre",{style:a},r):null,l)}var $l=h.createElement(Bl,null),Da=class extends h.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,s){return s.location!==t.location||s.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:s.error,location:s.location,revalidation:t.revalidation||s.revalidation}}componentDidCatch(t,s){this.props.onError?this.props.onError(t,s):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const r=zl(t.digest);r&&(t=r)}let s=t!==void 0?h.createElement(Ne.Provider,{value:this.props.routeContext},h.createElement(an.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?h.createElement(ql,{error:t},s):s}};Da.contextType=Rl;var Sr=new WeakMap;function ql({children:t,error:s}){let{basename:r}=h.useContext(Te);if(typeof s=="object"&&s&&"digest"in s&&typeof s.digest=="string"){let n=Al(s.digest);if(n){let a=Sr.get(s);if(a)throw a;let i=Pa(n.location,r);if(Ea&&!Sr.get(s))if(i.isExternal||n.reloadDocument)window.location.href=i.absoluteURL||i.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:n.replace}));throw Sr.set(s,l),l}return h.createElement("meta",{httpEquiv:"refresh",content:`0;url=${i.absoluteURL||i.to}`})}}return t}function Kl({routeContext:t,match:s,children:r}){let n=h.useContext(ms);return n&&n.static&&n.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=s.route.id),h.createElement(Ne.Provider,{value:t},r)}function Wl(t,s=[],r=null,n=null,a=null){if(t==null){if(!r)return null;if(r.errors)t=r.matches;else if(s.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let i=t,l=r==null?void 0:r.errors;if(l!=null){let u=i.findIndex(c=>c.route.id&&(l==null?void 0:l[c.route.id])!==void 0);ie(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),i=i.slice(0,Math.min(i.length,u+1))}let o=!1,p=-1;if(r)for(let u=0;u<i.length;u++){let c=i[u];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(p=u),c.route.id){let{loaderData:g,errors:f}=r,k=c.route.loader&&!g.hasOwnProperty(c.route.id)&&(!f||f[c.route.id]===void 0);if(c.route.lazy||k){o=!0,p>=0?i=i.slice(0,p+1):i=[i[0]];break}}}let d=r&&n?(u,c)=>{var g,f;n(u,{location:r.location,params:((f=(g=r.matches)==null?void 0:g[0])==null?void 0:f.params)??{},unstable_pattern:wl(r.matches),errorInfo:c})}:void 0;return i.reduceRight((u,c,g)=>{let f,k=!1,j=null,b=null;r&&(f=l&&c.route.id?l[c.route.id]:void 0,j=c.route.errorElement||$l,o&&(p<0&&g===0?(Ba("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),k=!0,b=null):p===g&&(k=!0,b=c.route.hydrateFallbackElement||null)));let v=s.concat(i.slice(0,g+1)),R=()=>{let _;return f?_=j:k?_=b:c.route.Component?_=h.createElement(c.route.Component,null):c.route.element?_=c.route.element:_=u,h.createElement(Kl,{match:c,routeContext:{outlet:u,matches:v,isDataRoute:r!=null},children:_})};return r&&(c.route.ErrorBoundary||c.route.errorElement||g===0)?h.createElement(Da,{location:r.location,revalidation:r.revalidation,component:j,error:f,children:R(),routeContext:{outlet:null,matches:v,isDataRoute:!0},onError:d}):R()},null)}function ln(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Ul(t){let s=h.useContext(ms);return ie(s,ln(t)),s}function Vl(t){let s=h.useContext(hr);return ie(s,ln(t)),s}function Hl(t){let s=h.useContext(Ne);return ie(s,ln(t)),s}function on(t){let s=Hl(t),r=s.matches[s.matches.length-1];return ie(r.route.id,`${t} can only be used on routes that contain a unique "id"`),r.route.id}function Ql(){return on("useRouteId")}function Gl(){var n;let t=h.useContext(an),s=Vl("useRouteError"),r=on("useRouteError");return t!==void 0?t:(n=s.errors)==null?void 0:n[r]}function Jl(){let{router:t}=Ul("useNavigate"),s=on("useNavigate"),r=h.useRef(!1);return Oa(()=>{r.current=!0}),h.useCallback(async(a,i={})=>{qe(r.current,Na),r.current&&(typeof a=="number"?await t.navigate(a):await t.navigate(a,{fromRouteId:s,...i}))},[t,s])}var On={};function Ba(t,s,r){!s&&!On[t]&&(On[t]=!0,qe(!1,r))}h.memo(Yl);function Yl({routes:t,future:s,state:r,onError:n}){return La(t,void 0,r,n,s)}function Xl({to:t,replace:s,state:r,relative:n}){ie(fs(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=h.useContext(Te);qe(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=h.useContext(Ne),{pathname:l}=Ke(),o=_t(),p=nn(t,rn(i),l,n==="path"),d=JSON.stringify(p);return h.useEffect(()=>{o(JSON.parse(d),{replace:s,state:r,relative:n})},[o,d,n,s,r]),null}function Zl(t){return Ll(t.context)}function ue(t){ie(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function eo({basename:t="/",children:s=null,location:r,navigationType:n="POP",navigator:a,static:i=!1,unstable_useTransitions:l}){ie(!fs(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),p=h.useMemo(()=>({basename:o,navigator:a,static:i,unstable_useTransitions:l,future:{}}),[o,a,i,l]);typeof r=="string"&&(r=ps(r));let{pathname:d="/",search:u="",hash:c="",state:g=null,key:f="default"}=r,k=h.useMemo(()=>{let j=it(d,o);return j==null?null:{location:{pathname:j,search:u,hash:c,state:g,key:f},navigationType:n}},[o,d,u,c,g,f,n]);return qe(k!=null,`<Router basename="${o}"> is not able to match the URL "${d}${u}${c}" because it does not start with the basename, so the <Router> won't render anything.`),k==null?null:h.createElement(Te.Provider,{value:p},h.createElement(Ls.Provider,{children:s,value:k}))}function to({children:t,location:s}){return Dl(Tr(t),s)}function Tr(t,s=[]){let r=[];return h.Children.forEach(t,(n,a)=>{if(!h.isValidElement(n))return;let i=[...s,a];if(n.type===h.Fragment){r.push.apply(r,Tr(n.props.children,i));return}ie(n.type===ue,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ie(!n.props.index||!n.props.children,"An index route cannot have child routes.");let l={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,middleware:n.props.middleware,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(l.children=Tr(n.props.children,i)),r.push(l)}),r}var Js="get",Ys="application/x-www-form-urlencoded";function pr(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function so(t){return pr(t)&&t.tagName.toLowerCase()==="button"}function ro(t){return pr(t)&&t.tagName.toLowerCase()==="form"}function no(t){return pr(t)&&t.tagName.toLowerCase()==="input"}function ao(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function io(t,s){return t.button===0&&(!s||s==="_self")&&!ao(t)}var Ws=null;function lo(){if(Ws===null)try{new FormData(document.createElement("form"),0),Ws=!1}catch{Ws=!0}return Ws}var oo=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function kr(t){return t!=null&&!oo.has(t)?(qe(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ys}"`),null):t}function co(t,s){let r,n,a,i,l;if(ro(t)){let o=t.getAttribute("action");n=o?it(o,s):null,r=t.getAttribute("method")||Js,a=kr(t.getAttribute("enctype"))||Ys,i=new FormData(t)}else if(so(t)||no(t)&&(t.type==="submit"||t.type==="image")){let o=t.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let p=t.getAttribute("formaction")||o.getAttribute("action");if(n=p?it(p,s):null,r=t.getAttribute("formmethod")||o.getAttribute("method")||Js,a=kr(t.getAttribute("formenctype"))||kr(o.getAttribute("enctype"))||Ys,i=new FormData(o,t),!lo()){let{name:d,type:u,value:c}=t;if(u==="image"){let g=d?`${d}.`:"";i.append(`${g}x`,"0"),i.append(`${g}y`,"0")}else d&&i.append(d,c)}}else{if(pr(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=Js,n=null,a=Ys,l=t}return i&&a==="text/plain"&&(l=i,i=void 0),{action:n,method:r.toLowerCase(),encType:a,formData:i,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function cn(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function uo(t,s,r,n){let a=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r?a.pathname.endsWith("/")?a.pathname=`${a.pathname}_.${n}`:a.pathname=`${a.pathname}.${n}`:a.pathname==="/"?a.pathname=`_root.${n}`:s&&it(a.pathname,s)==="/"?a.pathname=`${s.replace(/\/$/,"")}/_root.${n}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${n}`,a}async function ho(t,s){if(t.id in s)return s[t.id];try{let r=await import(t.module);return s[t.id]=r,r}catch(r){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function po(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function mo(t,s,r){let n=await Promise.all(t.map(async a=>{let i=s.routes[a.route.id];if(i){let l=await ho(i,r);return l.links?l.links():[]}return[]}));return xo(n.flat(1).filter(po).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function Ln(t,s,r,n,a,i){let l=(p,d)=>r[d]?p.route.id!==r[d].route.id:!0,o=(p,d)=>{var u;return r[d].pathname!==p.pathname||((u=r[d].route.path)==null?void 0:u.endsWith("*"))&&r[d].params["*"]!==p.params["*"]};return i==="assets"?s.filter((p,d)=>l(p,d)||o(p,d)):i==="data"?s.filter((p,d)=>{var c;let u=n.routes[p.route.id];if(!u||!u.hasLoader)return!1;if(l(p,d)||o(p,d))return!0;if(p.route.shouldRevalidate){let g=p.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:((c=r[0])==null?void 0:c.params)||{},nextUrl:new URL(t,window.origin),nextParams:p.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function fo(t,s,{includeHydrateFallback:r}={}){return yo(t.map(n=>{let a=s.routes[n.route.id];if(!a)return[];let i=[a.module];return a.clientActionModule&&(i=i.concat(a.clientActionModule)),a.clientLoaderModule&&(i=i.concat(a.clientLoaderModule)),r&&a.hydrateFallbackModule&&(i=i.concat(a.hydrateFallbackModule)),a.imports&&(i=i.concat(a.imports)),i}).flat(1))}function yo(t){return[...new Set(t)]}function go(t){let s={},r=Object.keys(t).sort();for(let n of r)s[n]=t[n];return s}function xo(t,s){let r=new Set;return new Set(s),t.reduce((n,a)=>{let i=JSON.stringify(go(a));return r.has(i)||(r.add(i),n.push({key:i,link:a})),n},[])}function $a(){let t=h.useContext(ms);return cn(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function vo(){let t=h.useContext(hr);return cn(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var dn=h.createContext(void 0);dn.displayName="FrameworkContext";function qa(){let t=h.useContext(dn);return cn(t,"You must render this element inside a <HydratedRouter> element"),t}function jo(t,s){let r=h.useContext(dn),[n,a]=h.useState(!1),[i,l]=h.useState(!1),{onFocus:o,onBlur:p,onMouseEnter:d,onMouseLeave:u,onTouchStart:c}=s,g=h.useRef(null);h.useEffect(()=>{if(t==="render"&&l(!0),t==="viewport"){let j=v=>{v.forEach(R=>{l(R.isIntersecting)})},b=new IntersectionObserver(j,{threshold:.5});return g.current&&b.observe(g.current),()=>{b.disconnect()}}},[t]),h.useEffect(()=>{if(n){let j=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(j)}}},[n]);let f=()=>{a(!0)},k=()=>{a(!1),l(!1)};return r?t!=="intent"?[i,g,{}]:[i,g,{onFocus:ws(o,f),onBlur:ws(p,k),onMouseEnter:ws(d,f),onMouseLeave:ws(u,k),onTouchStart:ws(c,f)}]:[!1,g,{}]}function ws(t,s){return r=>{t&&t(r),r.defaultPrevented||s(r)}}function bo({page:t,...s}){let{router:r}=$a(),n=h.useMemo(()=>Ra(r.routes,t,r.basename),[r.routes,t,r.basename]);return n?h.createElement(ko,{page:t,matches:n,...s}):null}function So(t){let{manifest:s,routeModules:r}=qa(),[n,a]=h.useState([]);return h.useEffect(()=>{let i=!1;return mo(t,s,r).then(l=>{i||a(l)}),()=>{i=!0}},[t,s,r]),n}function ko({page:t,matches:s,...r}){let n=Ke(),{future:a,manifest:i,routeModules:l}=qa(),{basename:o}=$a(),{loaderData:p,matches:d}=vo(),u=h.useMemo(()=>Ln(t,s,d,i,n,"data"),[t,s,d,i,n]),c=h.useMemo(()=>Ln(t,s,d,i,n,"assets"),[t,s,d,i,n]),g=h.useMemo(()=>{if(t===n.pathname+n.search+n.hash)return[];let j=new Set,b=!1;if(s.forEach(R=>{var S;let _=i.routes[R.route.id];!_||!_.hasLoader||(!u.some(w=>w.route.id===R.route.id)&&R.route.id in p&&((S=l[R.route.id])!=null&&S.shouldRevalidate)||_.hasClientLoader?b=!0:j.add(R.route.id))}),j.size===0)return[];let v=uo(t,o,a.unstable_trailingSlashAwareDataRequests,"data");return b&&j.size>0&&v.searchParams.set("_routes",s.filter(R=>j.has(R.route.id)).map(R=>R.route.id).join(",")),[v.pathname+v.search]},[o,a.unstable_trailingSlashAwareDataRequests,p,n,i,u,s,t,l]),f=h.useMemo(()=>fo(c,i),[c,i]),k=So(c);return h.createElement(h.Fragment,null,g.map(j=>h.createElement("link",{key:j,rel:"prefetch",as:"fetch",href:j,...r})),f.map(j=>h.createElement("link",{key:j,rel:"modulepreload",href:j,...r})),k.map(({key:j,link:b})=>h.createElement("link",{key:j,nonce:r.nonce,...b,crossOrigin:b.crossOrigin??r.crossOrigin})))}function Co(...t){return s=>{t.forEach(r=>{typeof r=="function"?r(s):r!=null&&(r.current=s)})}}var _o=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{_o&&(window.__reactRouterVersion="7.13.0")}catch{}function wo({basename:t,children:s,unstable_useTransitions:r,window:n}){let a=h.useRef();a.current==null&&(a.current=tl({window:n,v5Compat:!0}));let i=a.current,[l,o]=h.useState({action:i.action,location:i.location}),p=h.useCallback(d=>{r===!1?o(d):h.startTransition(()=>o(d))},[r]);return h.useLayoutEffect(()=>i.listen(p),[i,p]),h.createElement(eo,{basename:t,children:s,location:l.location,navigationType:l.action,navigator:i,unstable_useTransitions:r})}var Ka=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,lt=h.forwardRef(function({onClick:s,discover:r="render",prefetch:n="none",relative:a,reloadDocument:i,replace:l,state:o,target:p,to:d,preventScrollReset:u,viewTransition:c,unstable_defaultShouldRevalidate:g,...f},k){let{basename:j,unstable_useTransitions:b}=h.useContext(Te),v=typeof d=="string"&&Ka.test(d),R=Pa(d,j);d=R.to;let _=Ml(d,{relative:a}),[S,w,T]=jo(n,f),y=To(d,{replace:l,state:o,target:p,preventScrollReset:u,relative:a,viewTransition:c,unstable_defaultShouldRevalidate:g,unstable_useTransitions:b});function I(C){s&&s(C),C.defaultPrevented||y(C)}let E=h.createElement("a",{...f,...T,href:R.absoluteURL||_,onClick:R.isExternal||i?s:I,ref:Co(k,w),target:p,"data-discover":!v&&r==="render"?"true":void 0});return S&&!v?h.createElement(h.Fragment,null,E,h.createElement(bo,{page:_})):E});lt.displayName="Link";var Fo=h.forwardRef(function({"aria-current":s="page",caseSensitive:r=!1,className:n="",end:a=!1,style:i,to:l,viewTransition:o,children:p,...d},u){let c=Ds(l,{relative:d.relative}),g=Ke(),f=h.useContext(hr),{navigator:k,basename:j}=h.useContext(Te),b=f!=null&&Mo(c)&&o===!0,v=k.encodeLocation?k.encodeLocation(c).pathname:c.pathname,R=g.pathname,_=f&&f.navigation&&f.navigation.location?f.navigation.location.pathname:null;r||(R=R.toLowerCase(),_=_?_.toLowerCase():null,v=v.toLowerCase()),_&&j&&(_=it(_,j)||_);const S=v!=="/"&&v.endsWith("/")?v.length-1:v.length;let w=R===v||!a&&R.startsWith(v)&&R.charAt(S)==="/",T=_!=null&&(_===v||!a&&_.startsWith(v)&&_.charAt(v.length)==="/"),y={isActive:w,isPending:T,isTransitioning:b},I=w?s:void 0,E;typeof n=="function"?E=n(y):E=[n,w?"active":null,T?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let C=typeof i=="function"?i(y):i;return h.createElement(lt,{...d,"aria-current":I,className:E,ref:u,style:C,to:l,viewTransition:o},typeof p=="function"?p(y):p)});Fo.displayName="NavLink";var Ro=h.forwardRef(({discover:t="render",fetcherKey:s,navigate:r,reloadDocument:n,replace:a,state:i,method:l=Js,action:o,onSubmit:p,relative:d,preventScrollReset:u,viewTransition:c,unstable_defaultShouldRevalidate:g,...f},k)=>{let{unstable_useTransitions:j}=h.useContext(Te),b=Ao(),v=zo(o,{relative:d}),R=l.toLowerCase()==="get"?"get":"post",_=typeof o=="string"&&Ka.test(o),S=w=>{if(p&&p(w),w.defaultPrevented)return;w.preventDefault();let T=w.nativeEvent.submitter,y=(T==null?void 0:T.getAttribute("formmethod"))||l,I=()=>b(T||w.currentTarget,{fetcherKey:s,method:y,navigate:r,replace:a,state:i,relative:d,preventScrollReset:u,viewTransition:c,unstable_defaultShouldRevalidate:g});j&&r!==!1?h.startTransition(()=>I()):I()};return h.createElement("form",{ref:k,method:R,action:v,onSubmit:n?p:S,...f,"data-discover":!_&&t==="render"?"true":void 0})});Ro.displayName="Form";function Io(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Wa(t){let s=h.useContext(ms);return ie(s,Io(t)),s}function To(t,{target:s,replace:r,state:n,preventScrollReset:a,relative:i,viewTransition:l,unstable_defaultShouldRevalidate:o,unstable_useTransitions:p}={}){let d=_t(),u=Ke(),c=Ds(t,{relative:i});return h.useCallback(g=>{if(io(g,s)){g.preventDefault();let f=r!==void 0?r:Ts(u)===Ts(c),k=()=>d(t,{replace:f,state:n,preventScrollReset:a,relative:i,viewTransition:l,unstable_defaultShouldRevalidate:o});p?h.startTransition(()=>k()):k()}},[u,d,c,r,n,s,t,a,i,l,o,p])}var Eo=0,Po=()=>`__${String(++Eo)}__`;function Ao(){let{router:t}=Wa("useSubmit"),{basename:s}=h.useContext(Te),r=Ql(),n=t.fetch,a=t.navigate;return h.useCallback(async(i,l={})=>{let{action:o,method:p,encType:d,formData:u,body:c}=co(i,s);if(l.navigate===!1){let g=l.fetcherKey||Po();await n(g,r,l.action||o,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:u,body:c,formMethod:l.method||p,formEncType:l.encType||d,flushSync:l.flushSync})}else await a(l.action||o,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:u,body:c,formMethod:l.method||p,formEncType:l.encType||d,replace:l.replace,state:l.state,fromRouteId:r,flushSync:l.flushSync,viewTransition:l.viewTransition})},[n,a,s,r])}function zo(t,{relative:s}={}){let{basename:r}=h.useContext(Te),n=h.useContext(Ne);ie(n,"useFormAction must be used inside a RouteContext");let[a]=n.matches.slice(-1),i={...Ds(t||".",{relative:s})},l=Ke();if(t==null){i.search=l.search;let o=new URLSearchParams(i.search),p=o.getAll("index");if(p.some(u=>u==="")){o.delete("index"),p.filter(c=>c).forEach(c=>o.append("index",c));let u=o.toString();i.search=u?`?${u}`:""}}return(!t||t===".")&&a.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(i.pathname=i.pathname==="/"?r:nt([r,i.pathname])),Ts(i)}function Mo(t,{relative:s}={}){let r=h.useContext(za);ie(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=Wa("useViewTransitionState"),a=Ds(t,{relative:s});if(!r.isTransitioning)return!1;let i=it(r.currentLocation.pathname,n)||r.currentLocation.pathname,l=it(r.nextLocation.pathname,n)||r.nextLocation.pathname;return tr(a.pathname,l)!=null||tr(a.pathname,i)!=null}var gs=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},No={setTimeout:(t,s)=>setTimeout(t,s),clearTimeout:t=>clearTimeout(t),setInterval:(t,s)=>setInterval(t,s),clearInterval:t=>clearInterval(t)},pt,Hr,ca,Oo=(ca=class{constructor(){z(this,pt,No);z(this,Hr,!1)}setTimeoutProvider(t){A(this,pt,t)}setTimeout(t,s){return m(this,pt).setTimeout(t,s)}clearTimeout(t){m(this,pt).clearTimeout(t)}setInterval(t,s){return m(this,pt).setInterval(t,s)}clearInterval(t){m(this,pt).clearInterval(t)}},pt=new WeakMap,Hr=new WeakMap,ca),Rt=new Oo;function Lo(t){setTimeout(t,0)}var $t=typeof window>"u"||"Deno"in globalThis;function Se(){}function Do(t,s){return typeof t=="function"?t(s):t}function Er(t){return typeof t=="number"&&t>=0&&t!==1/0}function Ua(t,s){return Math.max(t+(s||0)-Date.now(),0)}function kt(t,s){return typeof t=="function"?t(s):t}function Pe(t,s){return typeof t=="function"?t(s):t}function Dn(t,s){const{type:r="all",exact:n,fetchStatus:a,predicate:i,queryKey:l,stale:o}=t;if(l){if(n){if(s.queryHash!==un(l,s.options))return!1}else if(!Es(s.queryKey,l))return!1}if(r!=="all"){const p=s.isActive();if(r==="active"&&!p||r==="inactive"&&p)return!1}return!(typeof o=="boolean"&&s.isStale()!==o||a&&a!==s.state.fetchStatus||i&&!i(s))}function Bn(t,s){const{exact:r,status:n,predicate:a,mutationKey:i}=t;if(i){if(!s.options.mutationKey)return!1;if(r){if(qt(s.options.mutationKey)!==qt(i))return!1}else if(!Es(s.options.mutationKey,i))return!1}return!(n&&s.state.status!==n||a&&!a(s))}function un(t,s){return((s==null?void 0:s.queryKeyHashFn)||qt)(t)}function qt(t){return JSON.stringify(t,(s,r)=>Pr(r)?Object.keys(r).sort().reduce((n,a)=>(n[a]=r[a],n),{}):r)}function Es(t,s){return t===s?!0:typeof t!=typeof s?!1:t&&s&&typeof t=="object"&&typeof s=="object"?Object.keys(s).every(r=>Es(t[r],s[r])):!1}var Bo=Object.prototype.hasOwnProperty;function Va(t,s,r=0){if(t===s)return t;if(r>500)return s;const n=$n(t)&&$n(s);if(!n&&!(Pr(t)&&Pr(s)))return s;const i=(n?t:Object.keys(t)).length,l=n?s:Object.keys(s),o=l.length,p=n?new Array(o):{};let d=0;for(let u=0;u<o;u++){const c=n?u:l[u],g=t[c],f=s[c];if(g===f){p[c]=g,(n?u<i:Bo.call(t,c))&&d++;continue}if(g===null||f===null||typeof g!="object"||typeof f!="object"){p[c]=f;continue}const k=Va(g,f,r+1);p[c]=k,k===g&&d++}return i===o&&d===i?t:p}function sr(t,s){if(!s||Object.keys(t).length!==Object.keys(s).length)return!1;for(const r in t)if(t[r]!==s[r])return!1;return!0}function $n(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Pr(t){if(!qn(t))return!1;const s=t.constructor;if(s===void 0)return!0;const r=s.prototype;return!(!qn(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function qn(t){return Object.prototype.toString.call(t)==="[object Object]"}function $o(t){return new Promise(s=>{Rt.setTimeout(s,t)})}function Ar(t,s,r){return typeof r.structuralSharing=="function"?r.structuralSharing(t,s):r.structuralSharing!==!1?Va(t,s):s}function qo(t,s,r=0){const n=[...t,s];return r&&n.length>r?n.slice(1):n}function Ko(t,s,r=0){const n=[s,...t];return r&&n.length>r?n.slice(0,-1):n}var hn=Symbol();function Ha(t,s){return!t.queryFn&&(s!=null&&s.initialPromise)?()=>s.initialPromise:!t.queryFn||t.queryFn===hn?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function pn(t,s){return typeof t=="function"?t(...s):!!t}function Wo(t,s,r){let n=!1,a;return Object.defineProperty(t,"signal",{enumerable:!0,get:()=>(a??(a=s()),n||(n=!0,a.aborted?r():a.addEventListener("abort",r,{once:!0})),a)}),t}var It,mt,Gt,da,Uo=(da=class extends gs{constructor(){super();z(this,It);z(this,mt);z(this,Gt);A(this,Gt,s=>{if(!$t&&window.addEventListener){const r=()=>s();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){m(this,mt)||this.setEventListener(m(this,Gt))}onUnsubscribe(){var s;this.hasListeners()||((s=m(this,mt))==null||s.call(this),A(this,mt,void 0))}setEventListener(s){var r;A(this,Gt,s),(r=m(this,mt))==null||r.call(this),A(this,mt,s(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(s){m(this,It)!==s&&(A(this,It,s),this.onFocus())}onFocus(){const s=this.isFocused();this.listeners.forEach(r=>{r(s)})}isFocused(){var s;return typeof m(this,It)=="boolean"?m(this,It):((s=globalThis.document)==null?void 0:s.visibilityState)!=="hidden"}},It=new WeakMap,mt=new WeakMap,Gt=new WeakMap,da),mn=new Uo;function zr(){let t,s;const r=new Promise((a,i)=>{t=a,s=i});r.status="pending",r.catch(()=>{});function n(a){Object.assign(r,a),delete r.resolve,delete r.reject}return r.resolve=a=>{n({status:"fulfilled",value:a}),t(a)},r.reject=a=>{n({status:"rejected",reason:a}),s(a)},r}var Vo=Lo;function Ho(){let t=[],s=0,r=o=>{o()},n=o=>{o()},a=Vo;const i=o=>{s?t.push(o):a(()=>{r(o)})},l=()=>{const o=t;t=[],o.length&&a(()=>{n(()=>{o.forEach(p=>{r(p)})})})};return{batch:o=>{let p;s++;try{p=o()}finally{s--,s||l()}return p},batchCalls:o=>(...p)=>{i(()=>{o(...p)})},schedule:i,setNotifyFunction:o=>{r=o},setBatchNotifyFunction:o=>{n=o},setScheduler:o=>{a=o}}}var pe=Ho(),Jt,ft,Yt,ua,Qo=(ua=class extends gs{constructor(){super();z(this,Jt,!0);z(this,ft);z(this,Yt);A(this,Yt,s=>{if(!$t&&window.addEventListener){const r=()=>s(!0),n=()=>s(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}}})}onSubscribe(){m(this,ft)||this.setEventListener(m(this,Yt))}onUnsubscribe(){var s;this.hasListeners()||((s=m(this,ft))==null||s.call(this),A(this,ft,void 0))}setEventListener(s){var r;A(this,Yt,s),(r=m(this,ft))==null||r.call(this),A(this,ft,s(this.setOnline.bind(this)))}setOnline(s){m(this,Jt)!==s&&(A(this,Jt,s),this.listeners.forEach(n=>{n(s)}))}isOnline(){return m(this,Jt)}},Jt=new WeakMap,ft=new WeakMap,Yt=new WeakMap,ua),rr=new Qo;function Go(t){return Math.min(1e3*2**t,3e4)}function Qa(t){return(t??"online")==="online"?rr.isOnline():!0}var Mr=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function Ga(t){let s=!1,r=0,n;const a=zr(),i=()=>a.status!=="pending",l=j=>{var b;if(!i()){const v=new Mr(j);g(v),(b=t.onCancel)==null||b.call(t,v)}},o=()=>{s=!0},p=()=>{s=!1},d=()=>mn.isFocused()&&(t.networkMode==="always"||rr.isOnline())&&t.canRun(),u=()=>Qa(t.networkMode)&&t.canRun(),c=j=>{i()||(n==null||n(),a.resolve(j))},g=j=>{i()||(n==null||n(),a.reject(j))},f=()=>new Promise(j=>{var b;n=v=>{(i()||d())&&j(v)},(b=t.onPause)==null||b.call(t)}).then(()=>{var j;n=void 0,i()||(j=t.onContinue)==null||j.call(t)}),k=()=>{if(i())return;let j;const b=r===0?t.initialPromise:void 0;try{j=b??t.fn()}catch(v){j=Promise.reject(v)}Promise.resolve(j).then(c).catch(v=>{var T;if(i())return;const R=t.retry??($t?0:3),_=t.retryDelay??Go,S=typeof _=="function"?_(r,v):_,w=R===!0||typeof R=="number"&&r<R||typeof R=="function"&&R(r,v);if(s||!w){g(v);return}r++,(T=t.onFail)==null||T.call(t,r,v),$o(S).then(()=>d()?void 0:f()).then(()=>{s?g(v):k()})})};return{promise:a,status:()=>a.status,cancel:l,continue:()=>(n==null||n(),a),cancelRetry:o,continueRetry:p,canStart:u,start:()=>(u()?k():f().then(k),a)}}var Tt,ha,Ja=(ha=class{constructor(){z(this,Tt)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Er(this.gcTime)&&A(this,Tt,Rt.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??($t?1/0:300*1e3))}clearGcTimeout(){m(this,Tt)&&(Rt.clearTimeout(m(this,Tt)),A(this,Tt,void 0))}},Tt=new WeakMap,ha),Et,Xt,Ee,Pt,me,As,At,Be,Xe,pa,Jo=(pa=class extends Ja{constructor(s){super();z(this,Be);z(this,Et);z(this,Xt);z(this,Ee);z(this,Pt);z(this,me);z(this,As);z(this,At);A(this,At,!1),A(this,As,s.defaultOptions),this.setOptions(s.options),this.observers=[],A(this,Pt,s.client),A(this,Ee,m(this,Pt).getQueryCache()),this.queryKey=s.queryKey,this.queryHash=s.queryHash,A(this,Et,Wn(this.options)),this.state=s.state??m(this,Et),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var s;return(s=m(this,me))==null?void 0:s.promise}setOptions(s){if(this.options={...m(this,As),...s},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const r=Wn(this.options);r.data!==void 0&&(this.setState(Kn(r.data,r.dataUpdatedAt)),A(this,Et,r))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&m(this,Ee).remove(this)}setData(s,r){const n=Ar(this.state.data,s,this.options);return q(this,Be,Xe).call(this,{data:n,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),n}setState(s,r){q(this,Be,Xe).call(this,{type:"setState",state:s,setStateOptions:r})}cancel(s){var n,a;const r=(n=m(this,me))==null?void 0:n.promise;return(a=m(this,me))==null||a.cancel(s),r?r.then(Se).catch(Se):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(m(this,Et))}isActive(){return this.observers.some(s=>Pe(s.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===hn||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(s=>kt(s.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(s=>s.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(s=0){return this.state.data===void 0?!0:s==="static"?!1:this.state.isInvalidated?!0:!Ua(this.state.dataUpdatedAt,s)}onFocus(){var r;const s=this.observers.find(n=>n.shouldFetchOnWindowFocus());s==null||s.refetch({cancelRefetch:!1}),(r=m(this,me))==null||r.continue()}onOnline(){var r;const s=this.observers.find(n=>n.shouldFetchOnReconnect());s==null||s.refetch({cancelRefetch:!1}),(r=m(this,me))==null||r.continue()}addObserver(s){this.observers.includes(s)||(this.observers.push(s),this.clearGcTimeout(),m(this,Ee).notify({type:"observerAdded",query:this,observer:s}))}removeObserver(s){this.observers.includes(s)&&(this.observers=this.observers.filter(r=>r!==s),this.observers.length||(m(this,me)&&(m(this,At)?m(this,me).cancel({revert:!0}):m(this,me).cancelRetry()),this.scheduleGc()),m(this,Ee).notify({type:"observerRemoved",query:this,observer:s}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||q(this,Be,Xe).call(this,{type:"invalidate"})}async fetch(s,r){var p,d,u,c,g,f,k,j,b,v,R,_;if(this.state.fetchStatus!=="idle"&&((p=m(this,me))==null?void 0:p.status())!=="rejected"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(m(this,me))return m(this,me).continueRetry(),m(this,me).promise}if(s&&this.setOptions(s),!this.options.queryFn){const S=this.observers.find(w=>w.options.queryFn);S&&this.setOptions(S.options)}const n=new AbortController,a=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(A(this,At,!0),n.signal)})},i=()=>{const S=Ha(this.options,r),T=(()=>{const y={client:m(this,Pt),queryKey:this.queryKey,meta:this.meta};return a(y),y})();return A(this,At,!1),this.options.persister?this.options.persister(S,T,this):S(T)},o=(()=>{const S={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:m(this,Pt),state:this.state,fetchFn:i};return a(S),S})();(d=this.options.behavior)==null||d.onFetch(o,this),A(this,Xt,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((u=o.fetchOptions)==null?void 0:u.meta))&&q(this,Be,Xe).call(this,{type:"fetch",meta:(c=o.fetchOptions)==null?void 0:c.meta}),A(this,me,Ga({initialPromise:r==null?void 0:r.initialPromise,fn:o.fetchFn,onCancel:S=>{S instanceof Mr&&S.revert&&this.setState({...m(this,Xt),fetchStatus:"idle"}),n.abort()},onFail:(S,w)=>{q(this,Be,Xe).call(this,{type:"failed",failureCount:S,error:w})},onPause:()=>{q(this,Be,Xe).call(this,{type:"pause"})},onContinue:()=>{q(this,Be,Xe).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0}));try{const S=await m(this,me).start();if(S===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(S),(f=(g=m(this,Ee).config).onSuccess)==null||f.call(g,S,this),(j=(k=m(this,Ee).config).onSettled)==null||j.call(k,S,this.state.error,this),S}catch(S){if(S instanceof Mr){if(S.silent)return m(this,me).promise;if(S.revert){if(this.state.data===void 0)throw S;return this.state.data}}throw q(this,Be,Xe).call(this,{type:"error",error:S}),(v=(b=m(this,Ee).config).onError)==null||v.call(b,S,this),(_=(R=m(this,Ee).config).onSettled)==null||_.call(R,this.state.data,S,this),S}finally{this.scheduleGc()}}},Et=new WeakMap,Xt=new WeakMap,Ee=new WeakMap,Pt=new WeakMap,me=new WeakMap,As=new WeakMap,At=new WeakMap,Be=new WeakSet,Xe=function(s){const r=n=>{switch(s.type){case"failed":return{...n,fetchFailureCount:s.failureCount,fetchFailureReason:s.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...Ya(n.data,this.options),fetchMeta:s.meta??null};case"success":const a={...n,...Kn(s.data,s.dataUpdatedAt),dataUpdateCount:n.dataUpdateCount+1,...!s.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return A(this,Xt,s.manual?a:void 0),a;case"error":const i=s.error;return{...n,error:i,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...s.state}}};this.state=r(this.state),pe.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),m(this,Ee).notify({query:this,type:"updated",action:s})})},pa);function Ya(t,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Qa(s.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Kn(t,s){return{data:t,dataUpdatedAt:s??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Wn(t){const s=typeof t.initialData=="function"?t.initialData():t.initialData,r=s!==void 0,n=r?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var Ce,H,zs,be,zt,Zt,Ze,yt,Ms,es,ts,Mt,Nt,gt,ss,re,Fs,Nr,Or,Lr,Dr,Br,$r,qr,Xa,ma,Yo=(ma=class extends gs{constructor(s,r){super();z(this,re);z(this,Ce);z(this,H);z(this,zs);z(this,be);z(this,zt);z(this,Zt);z(this,Ze);z(this,yt);z(this,Ms);z(this,es);z(this,ts);z(this,Mt);z(this,Nt);z(this,gt);z(this,ss,new Set);this.options=r,A(this,Ce,s),A(this,yt,null),A(this,Ze,zr()),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(m(this,H).addObserver(this),Un(m(this,H),this.options)?q(this,re,Fs).call(this):this.updateResult(),q(this,re,Dr).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Kr(m(this,H),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Kr(m(this,H),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,q(this,re,Br).call(this),q(this,re,$r).call(this),m(this,H).removeObserver(this)}setOptions(s){const r=this.options,n=m(this,H);if(this.options=m(this,Ce).defaultQueryOptions(s),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Pe(this.options.enabled,m(this,H))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");q(this,re,qr).call(this),m(this,H).setOptions(this.options),r._defaulted&&!sr(this.options,r)&&m(this,Ce).getQueryCache().notify({type:"observerOptionsUpdated",query:m(this,H),observer:this});const a=this.hasListeners();a&&Vn(m(this,H),n,this.options,r)&&q(this,re,Fs).call(this),this.updateResult(),a&&(m(this,H)!==n||Pe(this.options.enabled,m(this,H))!==Pe(r.enabled,m(this,H))||kt(this.options.staleTime,m(this,H))!==kt(r.staleTime,m(this,H)))&&q(this,re,Nr).call(this);const i=q(this,re,Or).call(this);a&&(m(this,H)!==n||Pe(this.options.enabled,m(this,H))!==Pe(r.enabled,m(this,H))||i!==m(this,gt))&&q(this,re,Lr).call(this,i)}getOptimisticResult(s){const r=m(this,Ce).getQueryCache().build(m(this,Ce),s),n=this.createResult(r,s);return Zo(this,n)&&(A(this,be,n),A(this,Zt,this.options),A(this,zt,m(this,H).state)),n}getCurrentResult(){return m(this,be)}trackResult(s,r){return new Proxy(s,{get:(n,a)=>(this.trackProp(a),r==null||r(a),a==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&m(this,Ze).status==="pending"&&m(this,Ze).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,a))})}trackProp(s){m(this,ss).add(s)}getCurrentQuery(){return m(this,H)}refetch({...s}={}){return this.fetch({...s})}fetchOptimistic(s){const r=m(this,Ce).defaultQueryOptions(s),n=m(this,Ce).getQueryCache().build(m(this,Ce),r);return n.fetch().then(()=>this.createResult(n,r))}fetch(s){return q(this,re,Fs).call(this,{...s,cancelRefetch:s.cancelRefetch??!0}).then(()=>(this.updateResult(),m(this,be)))}createResult(s,r){var E;const n=m(this,H),a=this.options,i=m(this,be),l=m(this,zt),o=m(this,Zt),d=s!==n?s.state:m(this,zs),{state:u}=s;let c={...u},g=!1,f;if(r._optimisticResults){const C=this.hasListeners(),x=!C&&Un(s,r),P=C&&Vn(s,n,r,a);(x||P)&&(c={...c,...Ya(u.data,s.options)}),r._optimisticResults==="isRestoring"&&(c.fetchStatus="idle")}let{error:k,errorUpdatedAt:j,status:b}=c;f=c.data;let v=!1;if(r.placeholderData!==void 0&&f===void 0&&b==="pending"){let C;i!=null&&i.isPlaceholderData&&r.placeholderData===(o==null?void 0:o.placeholderData)?(C=i.data,v=!0):C=typeof r.placeholderData=="function"?r.placeholderData((E=m(this,ts))==null?void 0:E.state.data,m(this,ts)):r.placeholderData,C!==void 0&&(b="success",f=Ar(i==null?void 0:i.data,C,r),g=!0)}if(r.select&&f!==void 0&&!v)if(i&&f===(l==null?void 0:l.data)&&r.select===m(this,Ms))f=m(this,es);else try{A(this,Ms,r.select),f=r.select(f),f=Ar(i==null?void 0:i.data,f,r),A(this,es,f),A(this,yt,null)}catch(C){A(this,yt,C)}m(this,yt)&&(k=m(this,yt),f=m(this,es),j=Date.now(),b="error");const R=c.fetchStatus==="fetching",_=b==="pending",S=b==="error",w=_&&R,T=f!==void 0,I={status:b,fetchStatus:c.fetchStatus,isPending:_,isSuccess:b==="success",isError:S,isInitialLoading:w,isLoading:w,data:f,dataUpdatedAt:c.dataUpdatedAt,error:k,errorUpdatedAt:j,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>d.dataUpdateCount||c.errorUpdateCount>d.errorUpdateCount,isFetching:R,isRefetching:R&&!_,isLoadingError:S&&!T,isPaused:c.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:S&&T,isStale:fn(s,r),refetch:this.refetch,promise:m(this,Ze),isEnabled:Pe(r.enabled,s)!==!1};if(this.options.experimental_prefetchInRender){const C=I.data!==void 0,x=I.status==="error"&&!C,P=le=>{x?le.reject(I.error):C&&le.resolve(I.data)},D=()=>{const le=A(this,Ze,I.promise=zr());P(le)},Y=m(this,Ze);switch(Y.status){case"pending":s.queryHash===n.queryHash&&P(Y);break;case"fulfilled":(x||I.data!==Y.value)&&D();break;case"rejected":(!x||I.error!==Y.reason)&&D();break}}return I}updateResult(){const s=m(this,be),r=this.createResult(m(this,H),this.options);if(A(this,zt,m(this,H).state),A(this,Zt,this.options),m(this,zt).data!==void 0&&A(this,ts,m(this,H)),sr(r,s))return;A(this,be,r);const n=()=>{if(!s)return!0;const{notifyOnChangeProps:a}=this.options,i=typeof a=="function"?a():a;if(i==="all"||!i&&!m(this,ss).size)return!0;const l=new Set(i??m(this,ss));return this.options.throwOnError&&l.add("error"),Object.keys(m(this,be)).some(o=>{const p=o;return m(this,be)[p]!==s[p]&&l.has(p)})};q(this,re,Xa).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&q(this,re,Dr).call(this)}},Ce=new WeakMap,H=new WeakMap,zs=new WeakMap,be=new WeakMap,zt=new WeakMap,Zt=new WeakMap,Ze=new WeakMap,yt=new WeakMap,Ms=new WeakMap,es=new WeakMap,ts=new WeakMap,Mt=new WeakMap,Nt=new WeakMap,gt=new WeakMap,ss=new WeakMap,re=new WeakSet,Fs=function(s){q(this,re,qr).call(this);let r=m(this,H).fetch(this.options,s);return s!=null&&s.throwOnError||(r=r.catch(Se)),r},Nr=function(){q(this,re,Br).call(this);const s=kt(this.options.staleTime,m(this,H));if($t||m(this,be).isStale||!Er(s))return;const n=Ua(m(this,be).dataUpdatedAt,s)+1;A(this,Mt,Rt.setTimeout(()=>{m(this,be).isStale||this.updateResult()},n))},Or=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(m(this,H)):this.options.refetchInterval)??!1},Lr=function(s){q(this,re,$r).call(this),A(this,gt,s),!($t||Pe(this.options.enabled,m(this,H))===!1||!Er(m(this,gt))||m(this,gt)===0)&&A(this,Nt,Rt.setInterval(()=>{(this.options.refetchIntervalInBackground||mn.isFocused())&&q(this,re,Fs).call(this)},m(this,gt)))},Dr=function(){q(this,re,Nr).call(this),q(this,re,Lr).call(this,q(this,re,Or).call(this))},Br=function(){m(this,Mt)&&(Rt.clearTimeout(m(this,Mt)),A(this,Mt,void 0))},$r=function(){m(this,Nt)&&(Rt.clearInterval(m(this,Nt)),A(this,Nt,void 0))},qr=function(){const s=m(this,Ce).getQueryCache().build(m(this,Ce),this.options);if(s===m(this,H))return;const r=m(this,H);A(this,H,s),A(this,zs,s.state),this.hasListeners()&&(r==null||r.removeObserver(this),s.addObserver(this))},Xa=function(s){pe.batch(()=>{s.listeners&&this.listeners.forEach(r=>{r(m(this,be))}),m(this,Ce).getQueryCache().notify({query:m(this,H),type:"observerResultsUpdated"})})},ma);function Xo(t,s){return Pe(s.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&s.retryOnMount===!1)}function Un(t,s){return Xo(t,s)||t.state.data!==void 0&&Kr(t,s,s.refetchOnMount)}function Kr(t,s,r){if(Pe(s.enabled,t)!==!1&&kt(s.staleTime,t)!=="static"){const n=typeof r=="function"?r(t):r;return n==="always"||n!==!1&&fn(t,s)}return!1}function Vn(t,s,r,n){return(t!==s||Pe(n.enabled,t)===!1)&&(!r.suspense||t.state.status!=="error")&&fn(t,r)}function fn(t,s){return Pe(s.enabled,t)!==!1&&t.isStaleByTime(kt(s.staleTime,t))}function Zo(t,s){return!sr(t.getCurrentResult(),s)}function Hn(t){return{onFetch:(s,r)=>{var u,c,g,f,k;const n=s.options,a=(g=(c=(u=s.fetchOptions)==null?void 0:u.meta)==null?void 0:c.fetchMore)==null?void 0:g.direction,i=((f=s.state.data)==null?void 0:f.pages)||[],l=((k=s.state.data)==null?void 0:k.pageParams)||[];let o={pages:[],pageParams:[]},p=0;const d=async()=>{let j=!1;const b=_=>{Wo(_,()=>s.signal,()=>j=!0)},v=Ha(s.options,s.fetchOptions),R=async(_,S,w)=>{if(j)return Promise.reject();if(S==null&&_.pages.length)return Promise.resolve(_);const y=(()=>{const x={client:s.client,queryKey:s.queryKey,pageParam:S,direction:w?"backward":"forward",meta:s.options.meta};return b(x),x})(),I=await v(y),{maxPages:E}=s.options,C=w?Ko:qo;return{pages:C(_.pages,I,E),pageParams:C(_.pageParams,S,E)}};if(a&&i.length){const _=a==="backward",S=_?ec:Qn,w={pages:i,pageParams:l},T=S(n,w);o=await R(w,T,_)}else{const _=t??i.length;do{const S=p===0?l[0]??n.initialPageParam:Qn(n,o);if(p>0&&S==null)break;o=await R(o,S),p++}while(p<_)}return o};s.options.persister?s.fetchFn=()=>{var j,b;return(b=(j=s.options).persister)==null?void 0:b.call(j,d,{client:s.client,queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},r)}:s.fetchFn=d}}}function Qn(t,{pages:s,pageParams:r}){const n=s.length-1;return s.length>0?t.getNextPageParam(s[n],s,r[n],r):void 0}function ec(t,{pages:s,pageParams:r}){var n;return s.length>0?(n=t.getPreviousPageParam)==null?void 0:n.call(t,s[0],s,r[0],r):void 0}var Ns,He,ge,Ot,Qe,ht,fa,tc=(fa=class extends Ja{constructor(s){super();z(this,Qe);z(this,Ns);z(this,He);z(this,ge);z(this,Ot);A(this,Ns,s.client),this.mutationId=s.mutationId,A(this,ge,s.mutationCache),A(this,He,[]),this.state=s.state||Za(),this.setOptions(s.options),this.scheduleGc()}setOptions(s){this.options=s,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(s){m(this,He).includes(s)||(m(this,He).push(s),this.clearGcTimeout(),m(this,ge).notify({type:"observerAdded",mutation:this,observer:s}))}removeObserver(s){A(this,He,m(this,He).filter(r=>r!==s)),this.scheduleGc(),m(this,ge).notify({type:"observerRemoved",mutation:this,observer:s})}optionalRemove(){m(this,He).length||(this.state.status==="pending"?this.scheduleGc():m(this,ge).remove(this))}continue(){var s;return((s=m(this,Ot))==null?void 0:s.continue())??this.execute(this.state.variables)}async execute(s){var l,o,p,d,u,c,g,f,k,j,b,v,R,_,S,w,T,y;const r=()=>{q(this,Qe,ht).call(this,{type:"continue"})},n={client:m(this,Ns),meta:this.options.meta,mutationKey:this.options.mutationKey};A(this,Ot,Ga({fn:()=>this.options.mutationFn?this.options.mutationFn(s,n):Promise.reject(new Error("No mutationFn found")),onFail:(I,E)=>{q(this,Qe,ht).call(this,{type:"failed",failureCount:I,error:E})},onPause:()=>{q(this,Qe,ht).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>m(this,ge).canRun(this)}));const a=this.state.status==="pending",i=!m(this,Ot).canStart();try{if(a)r();else{q(this,Qe,ht).call(this,{type:"pending",variables:s,isPaused:i}),m(this,ge).config.onMutate&&await m(this,ge).config.onMutate(s,this,n);const E=await((o=(l=this.options).onMutate)==null?void 0:o.call(l,s,n));E!==this.state.context&&q(this,Qe,ht).call(this,{type:"pending",context:E,variables:s,isPaused:i})}const I=await m(this,Ot).start();return await((d=(p=m(this,ge).config).onSuccess)==null?void 0:d.call(p,I,s,this.state.context,this,n)),await((c=(u=this.options).onSuccess)==null?void 0:c.call(u,I,s,this.state.context,n)),await((f=(g=m(this,ge).config).onSettled)==null?void 0:f.call(g,I,null,this.state.variables,this.state.context,this,n)),await((j=(k=this.options).onSettled)==null?void 0:j.call(k,I,null,s,this.state.context,n)),q(this,Qe,ht).call(this,{type:"success",data:I}),I}catch(I){try{await((v=(b=m(this,ge).config).onError)==null?void 0:v.call(b,I,s,this.state.context,this,n))}catch(E){Promise.reject(E)}try{await((_=(R=this.options).onError)==null?void 0:_.call(R,I,s,this.state.context,n))}catch(E){Promise.reject(E)}try{await((w=(S=m(this,ge).config).onSettled)==null?void 0:w.call(S,void 0,I,this.state.variables,this.state.context,this,n))}catch(E){Promise.reject(E)}try{await((y=(T=this.options).onSettled)==null?void 0:y.call(T,void 0,I,s,this.state.context,n))}catch(E){Promise.reject(E)}throw q(this,Qe,ht).call(this,{type:"error",error:I}),I}finally{m(this,ge).runNext(this)}}},Ns=new WeakMap,He=new WeakMap,ge=new WeakMap,Ot=new WeakMap,Qe=new WeakSet,ht=function(s){const r=n=>{switch(s.type){case"failed":return{...n,failureCount:s.failureCount,failureReason:s.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:s.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:s.isPaused,status:"pending",variables:s.variables,submittedAt:Date.now()};case"success":return{...n,data:s.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:s.error,failureCount:n.failureCount+1,failureReason:s.error,isPaused:!1,status:"error"}}};this.state=r(this.state),pe.batch(()=>{m(this,He).forEach(n=>{n.onMutationUpdate(s)}),m(this,ge).notify({mutation:this,type:"updated",action:s})})},fa);function Za(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var et,$e,Os,ya,sc=(ya=class extends gs{constructor(s={}){super();z(this,et);z(this,$e);z(this,Os);this.config=s,A(this,et,new Set),A(this,$e,new Map),A(this,Os,0)}build(s,r,n){const a=new tc({client:s,mutationCache:this,mutationId:++Ks(this,Os)._,options:s.defaultMutationOptions(r),state:n});return this.add(a),a}add(s){m(this,et).add(s);const r=Us(s);if(typeof r=="string"){const n=m(this,$e).get(r);n?n.push(s):m(this,$e).set(r,[s])}this.notify({type:"added",mutation:s})}remove(s){if(m(this,et).delete(s)){const r=Us(s);if(typeof r=="string"){const n=m(this,$e).get(r);if(n)if(n.length>1){const a=n.indexOf(s);a!==-1&&n.splice(a,1)}else n[0]===s&&m(this,$e).delete(r)}}this.notify({type:"removed",mutation:s})}canRun(s){const r=Us(s);if(typeof r=="string"){const n=m(this,$e).get(r),a=n==null?void 0:n.find(i=>i.state.status==="pending");return!a||a===s}else return!0}runNext(s){var n;const r=Us(s);if(typeof r=="string"){const a=(n=m(this,$e).get(r))==null?void 0:n.find(i=>i!==s&&i.state.isPaused);return(a==null?void 0:a.continue())??Promise.resolve()}else return Promise.resolve()}clear(){pe.batch(()=>{m(this,et).forEach(s=>{this.notify({type:"removed",mutation:s})}),m(this,et).clear(),m(this,$e).clear()})}getAll(){return Array.from(m(this,et))}find(s){const r={exact:!0,...s};return this.getAll().find(n=>Bn(r,n))}findAll(s={}){return this.getAll().filter(r=>Bn(s,r))}notify(s){pe.batch(()=>{this.listeners.forEach(r=>{r(s)})})}resumePausedMutations(){const s=this.getAll().filter(r=>r.state.isPaused);return pe.batch(()=>Promise.all(s.map(r=>r.continue().catch(Se))))}},et=new WeakMap,$e=new WeakMap,Os=new WeakMap,ya);function Us(t){var s;return(s=t.options.scope)==null?void 0:s.id}var tt,xt,_e,st,at,Xs,Wr,ga,rc=(ga=class extends gs{constructor(r,n){super();z(this,at);z(this,tt);z(this,xt);z(this,_e);z(this,st);A(this,tt,r),this.setOptions(n),this.bindMethods(),q(this,at,Xs).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(r){var a;const n=this.options;this.options=m(this,tt).defaultMutationOptions(r),sr(this.options,n)||m(this,tt).getMutationCache().notify({type:"observerOptionsUpdated",mutation:m(this,_e),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&qt(n.mutationKey)!==qt(this.options.mutationKey)?this.reset():((a=m(this,_e))==null?void 0:a.state.status)==="pending"&&m(this,_e).setOptions(this.options)}onUnsubscribe(){var r;this.hasListeners()||(r=m(this,_e))==null||r.removeObserver(this)}onMutationUpdate(r){q(this,at,Xs).call(this),q(this,at,Wr).call(this,r)}getCurrentResult(){return m(this,xt)}reset(){var r;(r=m(this,_e))==null||r.removeObserver(this),A(this,_e,void 0),q(this,at,Xs).call(this),q(this,at,Wr).call(this)}mutate(r,n){var a;return A(this,st,n),(a=m(this,_e))==null||a.removeObserver(this),A(this,_e,m(this,tt).getMutationCache().build(m(this,tt),this.options)),m(this,_e).addObserver(this),m(this,_e).execute(r)}},tt=new WeakMap,xt=new WeakMap,_e=new WeakMap,st=new WeakMap,at=new WeakSet,Xs=function(){var n;const r=((n=m(this,_e))==null?void 0:n.state)??Za();A(this,xt,{...r,isPending:r.status==="pending",isSuccess:r.status==="success",isError:r.status==="error",isIdle:r.status==="idle",mutate:this.mutate,reset:this.reset})},Wr=function(r){pe.batch(()=>{var n,a,i,l,o,p,d,u;if(m(this,st)&&this.hasListeners()){const c=m(this,xt).variables,g=m(this,xt).context,f={client:m(this,tt),meta:this.options.meta,mutationKey:this.options.mutationKey};if((r==null?void 0:r.type)==="success"){try{(a=(n=m(this,st)).onSuccess)==null||a.call(n,r.data,c,g,f)}catch(k){Promise.reject(k)}try{(l=(i=m(this,st)).onSettled)==null||l.call(i,r.data,null,c,g,f)}catch(k){Promise.reject(k)}}else if((r==null?void 0:r.type)==="error"){try{(p=(o=m(this,st)).onError)==null||p.call(o,r.error,c,g,f)}catch(k){Promise.reject(k)}try{(u=(d=m(this,st)).onSettled)==null||u.call(d,void 0,r.error,c,g,f)}catch(k){Promise.reject(k)}}}this.listeners.forEach(c=>{c(m(this,xt))})})},ga),Ge,xa,nc=(xa=class extends gs{constructor(s={}){super();z(this,Ge);this.config=s,A(this,Ge,new Map)}build(s,r,n){const a=r.queryKey,i=r.queryHash??un(a,r);let l=this.get(i);return l||(l=new Jo({client:s,queryKey:a,queryHash:i,options:s.defaultQueryOptions(r),state:n,defaultOptions:s.getQueryDefaults(a)}),this.add(l)),l}add(s){m(this,Ge).has(s.queryHash)||(m(this,Ge).set(s.queryHash,s),this.notify({type:"added",query:s}))}remove(s){const r=m(this,Ge).get(s.queryHash);r&&(s.destroy(),r===s&&m(this,Ge).delete(s.queryHash),this.notify({type:"removed",query:s}))}clear(){pe.batch(()=>{this.getAll().forEach(s=>{this.remove(s)})})}get(s){return m(this,Ge).get(s)}getAll(){return[...m(this,Ge).values()]}find(s){const r={exact:!0,...s};return this.getAll().find(n=>Dn(r,n))}findAll(s={}){const r=this.getAll();return Object.keys(s).length>0?r.filter(n=>Dn(s,n)):r}notify(s){pe.batch(()=>{this.listeners.forEach(r=>{r(s)})})}onFocus(){pe.batch(()=>{this.getAll().forEach(s=>{s.onFocus()})})}onOnline(){pe.batch(()=>{this.getAll().forEach(s=>{s.onOnline()})})}},Ge=new WeakMap,xa),oe,vt,jt,rs,ns,bt,as,is,va,ac=(va=class{constructor(t={}){z(this,oe);z(this,vt);z(this,jt);z(this,rs);z(this,ns);z(this,bt);z(this,as);z(this,is);A(this,oe,t.queryCache||new nc),A(this,vt,t.mutationCache||new sc),A(this,jt,t.defaultOptions||{}),A(this,rs,new Map),A(this,ns,new Map),A(this,bt,0)}mount(){Ks(this,bt)._++,m(this,bt)===1&&(A(this,as,mn.subscribe(async t=>{t&&(await this.resumePausedMutations(),m(this,oe).onFocus())})),A(this,is,rr.subscribe(async t=>{t&&(await this.resumePausedMutations(),m(this,oe).onOnline())})))}unmount(){var t,s;Ks(this,bt)._--,m(this,bt)===0&&((t=m(this,as))==null||t.call(this),A(this,as,void 0),(s=m(this,is))==null||s.call(this),A(this,is,void 0))}isFetching(t){return m(this,oe).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return m(this,vt).findAll({...t,status:"pending"}).length}getQueryData(t){var r;const s=this.defaultQueryOptions({queryKey:t});return(r=m(this,oe).get(s.queryHash))==null?void 0:r.state.data}ensureQueryData(t){const s=this.defaultQueryOptions(t),r=m(this,oe).build(this,s),n=r.state.data;return n===void 0?this.fetchQuery(t):(t.revalidateIfStale&&r.isStaleByTime(kt(s.staleTime,r))&&this.prefetchQuery(s),Promise.resolve(n))}getQueriesData(t){return m(this,oe).findAll(t).map(({queryKey:s,state:r})=>{const n=r.data;return[s,n]})}setQueryData(t,s,r){const n=this.defaultQueryOptions({queryKey:t}),a=m(this,oe).get(n.queryHash),i=a==null?void 0:a.state.data,l=Do(s,i);if(l!==void 0)return m(this,oe).build(this,n).setData(l,{...r,manual:!0})}setQueriesData(t,s,r){return pe.batch(()=>m(this,oe).findAll(t).map(({queryKey:n})=>[n,this.setQueryData(n,s,r)]))}getQueryState(t){var r;const s=this.defaultQueryOptions({queryKey:t});return(r=m(this,oe).get(s.queryHash))==null?void 0:r.state}removeQueries(t){const s=m(this,oe);pe.batch(()=>{s.findAll(t).forEach(r=>{s.remove(r)})})}resetQueries(t,s){const r=m(this,oe);return pe.batch(()=>(r.findAll(t).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...t},s)))}cancelQueries(t,s={}){const r={revert:!0,...s},n=pe.batch(()=>m(this,oe).findAll(t).map(a=>a.cancel(r)));return Promise.all(n).then(Se).catch(Se)}invalidateQueries(t,s={}){return pe.batch(()=>(m(this,oe).findAll(t).forEach(r=>{r.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},s)))}refetchQueries(t,s={}){const r={...s,cancelRefetch:s.cancelRefetch??!0},n=pe.batch(()=>m(this,oe).findAll(t).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let i=a.fetch(void 0,r);return r.throwOnError||(i=i.catch(Se)),a.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(n).then(Se)}fetchQuery(t){const s=this.defaultQueryOptions(t);s.retry===void 0&&(s.retry=!1);const r=m(this,oe).build(this,s);return r.isStaleByTime(kt(s.staleTime,r))?r.fetch(s):Promise.resolve(r.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(Se).catch(Se)}fetchInfiniteQuery(t){return t.behavior=Hn(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(Se).catch(Se)}ensureInfiniteQueryData(t){return t.behavior=Hn(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return rr.isOnline()?m(this,vt).resumePausedMutations():Promise.resolve()}getQueryCache(){return m(this,oe)}getMutationCache(){return m(this,vt)}getDefaultOptions(){return m(this,jt)}setDefaultOptions(t){A(this,jt,t)}setQueryDefaults(t,s){m(this,rs).set(qt(t),{queryKey:t,defaultOptions:s})}getQueryDefaults(t){const s=[...m(this,rs).values()],r={};return s.forEach(n=>{Es(t,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(t,s){m(this,ns).set(qt(t),{mutationKey:t,defaultOptions:s})}getMutationDefaults(t){const s=[...m(this,ns).values()],r={};return s.forEach(n=>{Es(t,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(t){if(t._defaulted)return t;const s={...m(this,jt).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return s.queryHash||(s.queryHash=un(s.queryKey,s)),s.refetchOnReconnect===void 0&&(s.refetchOnReconnect=s.networkMode!=="always"),s.throwOnError===void 0&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.queryFn===hn&&(s.enabled=!1),s}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...m(this,jt).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){m(this,oe).clear(),m(this,vt).clear()}},oe=new WeakMap,vt=new WeakMap,jt=new WeakMap,rs=new WeakMap,ns=new WeakMap,bt=new WeakMap,as=new WeakMap,is=new WeakMap,va),ei=h.createContext(void 0),We=t=>{const s=h.useContext(ei);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},ic=({client:t,children:s})=>(h.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),e.jsx(ei.Provider,{value:t,children:s})),ti=h.createContext(!1),lc=()=>h.useContext(ti);ti.Provider;function oc(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var cc=h.createContext(oc()),dc=()=>h.useContext(cc),uc=(t,s,r)=>{const n=r!=null&&r.state.error&&typeof t.throwOnError=="function"?pn(t.throwOnError,[r.state.error,r]):t.throwOnError;(t.suspense||t.experimental_prefetchInRender||n)&&(s.isReset()||(t.retryOnMount=!1))},hc=t=>{h.useEffect(()=>{t.clearReset()},[t])},pc=({result:t,errorResetBoundary:s,throwOnError:r,query:n,suspense:a})=>t.isError&&!s.isReset()&&!t.isFetching&&n&&(a&&t.data===void 0||pn(r,[t.error,n])),mc=t=>{if(t.suspense){const r=a=>a==="static"?a:Math.max(a??1e3,1e3),n=t.staleTime;t.staleTime=typeof n=="function"?(...a)=>r(n(...a)):r(n),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},fc=(t,s)=>t.isLoading&&t.isFetching&&!s,yc=(t,s)=>(t==null?void 0:t.suspense)&&s.isPending,Gn=(t,s,r)=>s.fetchOptimistic(t).catch(()=>{r.clearReset()});function gc(t,s,r){var g,f,k,j;const n=lc(),a=dc(),i=We(),l=i.defaultQueryOptions(t);(f=(g=i.getDefaultOptions().queries)==null?void 0:g._experimental_beforeQuery)==null||f.call(g,l);const o=i.getQueryCache().get(l.queryHash);l._optimisticResults=n?"isRestoring":"optimistic",mc(l),uc(l,a,o),hc(a);const p=!i.getQueryCache().get(l.queryHash),[d]=h.useState(()=>new s(i,l)),u=d.getOptimisticResult(l),c=!n&&t.subscribed!==!1;if(h.useSyncExternalStore(h.useCallback(b=>{const v=c?d.subscribe(pe.batchCalls(b)):Se;return d.updateResult(),v},[d,c]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),h.useEffect(()=>{d.setOptions(l)},[l,d]),yc(l,u))throw Gn(l,d,a);if(pc({result:u,errorResetBoundary:a,throwOnError:l.throwOnError,query:o,suspense:l.suspense}))throw u.error;if((j=(k=i.getDefaultOptions().queries)==null?void 0:k._experimental_afterQuery)==null||j.call(k,l,u),l.experimental_prefetchInRender&&!$t&&fc(u,n)){const b=p?Gn(l,d,a):o==null?void 0:o.promise;b==null||b.catch(Se).finally(()=>{d.updateResult()})}return l.notifyOnChangeProps?u:d.trackResult(u)}function $(t,s){return gc(t,Yo)}function ye(t,s){const r=We(),[n]=h.useState(()=>new rc(r,t));h.useEffect(()=>{n.setOptions(t)},[n,t]);const a=h.useSyncExternalStore(h.useCallback(l=>n.subscribe(pe.batchCalls(l)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),i=h.useCallback((l,o)=>{n.mutate(l,o).catch(Se)},[n]);if(a.error&&pn(n.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:i,mutateAsync:a.mutate}}/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xc=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),si=(...t)=>t.filter((s,r,n)=>!!s&&s.trim()!==""&&n.indexOf(s)===r).join(" ").trim();/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var vc={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jc=h.forwardRef(({color:t="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:a="",children:i,iconNode:l,...o},p)=>h.createElement("svg",{ref:p,...vc,width:s,height:s,stroke:t,strokeWidth:n?Number(r)*24/Number(s):r,className:si("lucide",a),...o},[...l.map(([d,u])=>h.createElement(d,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=(t,s)=>{const r=h.forwardRef(({className:n,...a},i)=>h.createElement(jc,{ref:i,iconNode:s,className:si(`lucide-${xc(t)}`,n),...a}));return r.displayName=`${t}`,r};/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bc=W("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sc=W("Bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kc=W("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cc=W("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=W("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _c=W("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=W("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wc=W("CircleMinus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ri=W("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fc=W("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rc=W("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ic=W("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=W("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tc=W("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yn=W("FolderKanban",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ec=W("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pc=W("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ac=W("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zc=W("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mc=W("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nc=W("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oc=W("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lc=W("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dc=W("MonitorPlay",[["path",{d:"M10 7.75a.75.75 0 0 1 1.142-.638l3.664 2.249a.75.75 0 0 1 0 1.278l-3.664 2.25a.75.75 0 0 1-1.142-.64z",key:"1pctta"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",key:"x3v2xh"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bc=W("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $c=W("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ni=W("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=W("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ai=W("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qc=W("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kc=W("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=W("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wc=W("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=W("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uc=W("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ii=W("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const li=W("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vc=W("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),oi=[{label:"Core",key:"core",paths:["/projects","/tasks","/runs","/issues"],items:[{path:"/projects",label:"Projects"},{path:"/tasks",label:"Tasks"},{path:"/runs",label:"Runs"},{path:"/issues",label:"Issues"}]},{label:"Fleet",key:"fleet",paths:["/fleet"],items:[{path:"/fleet",label:"Fleet Overview"},{path:"/fleet/trajectory",label:"Trajectory"},{path:"/fleet/issues-map",label:"Issue Map"}]},{label:"Analytics",key:"analytics",paths:["/kpi","/traceability","/auto-triage"],items:[{path:"/kpi",label:"KPI Dashboard"},{path:"/traceability",label:"Traceability"},{path:"/auto-triage",label:"Auto-Triage"}]},{label:"Simulation",key:"simulation",paths:["/simulation"],items:[{path:"/simulation",label:"Simulation"}]}];function Hc(t){for(const s of oi)if(s.paths.some(r=>t===r||t.startsWith(r+"/")))return s.key;return null}function Qc(){const{pathname:t}=Ke(),s=_t(),r=Hc(t);return e.jsxs("nav",{className:"topnav",children:[e.jsx("div",{className:"topnav-logo",children:"N"}),e.jsx("span",{className:"topnav-title",children:"Nvidopia"}),e.jsx("div",{className:"topnav-nav",children:oi.map(n=>{const a=r===n.key;if(n.items.length===1){const l=n.items[0];return e.jsx("button",{className:`topnav-item${a?" active":""}`,onClick:()=>l&&s(l.path),children:n.label},n.key)}const i=n.items.map(l=>({key:l.path,label:l.label,onClick:()=>s(l.path)}));return e.jsx(Ci,{menu:{items:i},placement:"bottomLeft",children:e.jsxs("button",{className:`topnav-item${a?" active":""}`,children:[n.label,e.jsx(_c,{size:14,style:{marginLeft:4,opacity:.5}})]})},n.key)})}),e.jsxs("div",{className:"topnav-right",children:[e.jsx("button",{className:"topnav-icon-btn",title:"Search (Cmd+K)",children:e.jsx(Kc,{size:18})}),e.jsx("button",{className:"topnav-icon-btn",title:"Notifications",children:e.jsx(Sc,{size:18})}),e.jsx(_i,{size:32,style:{background:"var(--brand-green)",cursor:"pointer",fontSize:"0.8rem",fontWeight:600},children:"U"})]})]})}const Gc=[{prefixes:["/projects","/tasks","/runs","/issues"],tabs:[{path:"/projects",label:"Projects"},{path:"/tasks",label:"Tasks"},{path:"/runs",label:"Runs"},{path:"/issues",label:"Issues"}]},{prefixes:["/fleet"],tabs:[{path:"/fleet",label:"Fleet Overview"},{path:"/fleet/trajectory",label:"Trajectory"},{path:"/fleet/issues-map",label:"Issue Map"}]},{prefixes:["/kpi","/traceability","/auto-triage"],tabs:[{path:"/kpi",label:"KPI Dashboard"},{path:"/traceability",label:"Traceability"},{path:"/auto-triage",label:"Auto-Triage"}]},{prefixes:["/simulation"],tabs:[{path:"/simulation",label:"Simulation"}]}];function Jc(t){for(const s of Gc)for(const r of s.prefixes)if(t===r||t.startsWith(r+"/"))return s;return null}function Yc(t,s){return s==="/fleet"?t==="/fleet"||t.startsWith("/fleet/vehicles"):t===s||t.startsWith(s+"/")}function Xc(){const{pathname:t}=Ke(),s=_t(),r=Jc(t);return!r||r.tabs.length<=1?null:e.jsx("div",{className:"secondary-tabs",children:r.tabs.map(n=>e.jsx("button",{className:`secondary-tab${Yc(t,n.path)?" active":""}`,onClick:()=>s(n.path),children:n.label},n.path))})}const{Content:Zc}=wi,ed={projects:"Projects",tasks:"Tasks",runs:"Runs",issues:"Issues",kpi:"KPI Dashboard",traceability:"Traceability","auto-triage":"Auto-Triage",simulation:"Simulation",fleet:"Fleet",vehicles:"Vehicle",trajectory:"Trajectory","issues-map":"Issue Map"};function td(){const{pathname:t}=Ke(),s=t.split("/").filter(Boolean),r=[{title:e.jsx(lt,{to:"/",children:e.jsx(Pc,{size:15,strokeWidth:2})})},...s.map((n,a)=>{const i="/"+s.slice(0,a+1).join("/"),l=ed[n]??n;return{title:a===s.length-1?e.jsx("span",{children:l}):e.jsx(lt,{to:i,children:l})}})];return e.jsx(Fi,{items:r})}function sd(){return e.jsxs("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(Qc,{}),e.jsx(Xc,{}),e.jsxs(Zc,{style:{padding:"20px 24px",minHeight:"calc(100vh - var(--header-height) - var(--secondary-tab-height))"},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(td,{})}),e.jsx("div",{className:"animate-fade-in",children:e.jsx(Zl,{})})]})]})}const rd="/api";class nd extends Error{constructor(s,r){super(r),this.status=s,this.name="ApiError"}}function J(t,s=""){return typeof t=="string"?t:s}function V(t){return typeof t=="string"?t:void 0}function rt(t){return typeof t=="number"?t:void 0}function mr(t,s){const r={};for(const[n,a]of Object.entries(t))!s.has(n)&&!n.startsWith("_")&&(r[n]=a);return t.extra&&typeof t.extra=="object"&&Object.assign(r,t.extra),r}const ad=new Set(["id","project_id","name","description","status","vehicle_platform","soc_architecture","sensor_suite_version","software_baseline_version","target_mileage_km","start_date","end_date","extra","createdAt","created_at","updatedAt","updated_at","__v"]);function ci(t){return{id:J(t.id??t.project_id),name:J(t.name,"Unnamed Project"),description:V(t.description),status:J(t.status,"Planning"),vehicle_platform:V(t.vehicle_platform),soc_architecture:V(t.soc_architecture),sensor_suite_version:V(t.sensor_suite_version),software_baseline_version:V(t.software_baseline_version),target_mileage_km:rt(t.target_mileage_km),start_date:V(t.start_date),extra:mr(t,ad),createdAt:J(t.createdAt??t.created_at,new Date().toISOString()),updatedAt:J(t.updatedAt??t.updated_at,new Date().toISOString())}}const id=new Set(["id","task_id","project_id","projectId","name","title","description","stage","status","task_type","taskType","priority","assignee","assigned_to","execution_region","executionRegion","target_vehicle_count","targetVehicleCount","simulation_ref","simulation_status","extra","createdAt","created_at","updatedAt","updated_at","__v"]);function di(t){return{id:J(t.id??t.task_id),projectId:J(t.projectId??t.project_id),title:J(t.title??t.name??t.task_id,"Untitled Task"),description:V(t.description),stage:J(t.stage??t.status,"Pending"),taskType:V(t.task_type??t.taskType),priority:J(t.priority,"Medium"),assignee:V(t.assignee??t.assigned_to),executionRegion:V(t.execution_region??t.executionRegion),targetVehicleCount:rt(t.target_vehicle_count??t.targetVehicleCount),extra:mr(t,id),createdAt:J(t.createdAt??t.created_at,new Date().toISOString()),updatedAt:J(t.updatedAt??t.updated_at,new Date().toISOString())}}const ld=new Set(["id","run_id","task_id","taskId","vehicle_vin","vehicleIds","driver_id","start_time","startedAt","end_time","completedAt","total_auto_mileage_km","software_version_hash","hardware_heartbeat_version","status","result","simulation_ref","simulation_status","extra","createdAt","created_at","updatedAt","updated_at","__v"]);function ui(t){const s=V(t.vehicle_vin);return{id:J(t.id??t.run_id),taskId:J(t.taskId??t.task_id),status:J(t.status,"Scheduled"),vehicleIds:Array.isArray(t.vehicleIds)?t.vehicleIds:s?[s]:[],startedAt:V(t.startedAt??t.start_time),completedAt:V(t.completedAt??t.end_time),totalAutoMileageKm:rt(t.total_auto_mileage_km),result:V(t.result),extra:mr(t,ld),createdAt:J(t.createdAt??t.created_at,new Date().toISOString()),updatedAt:J(t.updatedAt??t.updated_at,new Date().toISOString())}}const od=new Set(["id","issue_id","run_id","runId","task_id","taskId","title","description","status","severity","category","assignee","assigned_to","module","assigned_module","takeover_type","takeoverType","gps_coordinates","gps_lat","gps_lng","data_snapshot_uri","data_snapshot_url","trigger_timestamp","fault_codes","environment_tags","triage_mode","triage_hint","triage_source","fix_commit_id","fix_version_hash","rejection_reason","vehicle_dynamics","extra","createdAt","created_at","updatedAt","updated_at","__v"]);function hi(t){const s=J(t.id??t.issue_id),r=V(t.category),n=t.gps_coordinates;return{id:s,title:J(t.title,r?`${r} (${s})`:`Issue ${s}`),description:V(t.description),status:J(t.status,"New"),severity:J(t.severity,"Medium"),category:r,runId:V(t.runId??t.run_id),taskId:V(t.taskId??t.task_id),assignee:V(t.assignee??t.assigned_to),module:V(t.module??t.assigned_module),takeoverType:V(t.takeover_type??t.takeoverType),gpsLat:rt(t.gps_lat)??rt(n==null?void 0:n.lat),gpsLng:rt(t.gps_lng)??rt(n==null?void 0:n.lng),dataSnapshotUri:V(t.data_snapshot_uri??t.data_snapshot_url),triggerTimestamp:V(t.trigger_timestamp),faultCodes:Array.isArray(t.fault_codes)?t.fault_codes:void 0,environmentTags:Array.isArray(t.environment_tags)?t.environment_tags:void 0,triageMode:V(t.triage_mode),triageHint:V(t.triage_hint),fixCommitId:V(t.fix_commit_id),rejectionReason:V(t.rejection_reason),vehicleDynamics:t.vehicle_dynamics,extra:mr(t,od),createdAt:J(t.createdAt??t.created_at,new Date().toISOString()),updatedAt:J(t.updatedAt??t.updated_at,new Date().toISOString())}}function cd(t){return{id:J(t.id??t.transition_id),fromStatus:J(t.from_status??t.fromStatus??t.from),toStatus:J(t.to_status??t.toStatus??t.to),triggeredBy:J(t.triggered_by??t.triggeredBy),transitionedAt:V(t.transitioned_at??t.created_at),reason:V(t.reason)}}async function L(t,s){const r=await fetch(`${rd}${t}`,{...s,headers:{"Content-Type":"application/json",...s==null?void 0:s.headers}});if(!r.ok){const n=await r.text().catch(()=>"");throw new nd(r.status,n||r.statusText)}if(r.status!==204)return r.json()}function ve(t){if(!t)return"";const s={projectId:"project_id",taskId:"task_id",runId:"run_id",vehicleVin:"vehicle_vin",startDate:"start_date",endDate:"end_date",timeRange:"time_range"},r=Object.fromEntries(Object.entries(t).filter(([,a])=>a!==void 0&&a!=="").map(([a,i])=>[s[a]??a,i])),n=new URLSearchParams(r).toString();return n?`?${n}`:""}async function xs(t){const s=ve(t),r=await L(`/projects${s}`);return(Array.isArray(r)?r:r.data??r.items??[]).map(a=>ci(a))}function pi(t){return L(`/projects/${t}`).then(ci)}function dd(t){return L("/projects",{method:"POST",body:JSON.stringify(t)})}function ud(t,s){return L(`/projects/${t}`,{method:"PUT",body:JSON.stringify(s)})}async function Bs(t){const s=ve(t),r=await L(`/tasks${s}`);return(Array.isArray(r)?r:r.data??[]).map(a=>di(a))}function hd(t){return L(`/tasks/${t}`).then(di)}function pd(t){return L("/tasks",{method:"POST",body:JSON.stringify(t)})}function md(t){return L(`/tasks/${t}/advance-stage`,{method:"PUT"})}async function $s(t){const s=ve(t),r=await L(`/runs${s}`);return(Array.isArray(r)?r:r.data??[]).map(a=>ui(a))}function fd(t){return L(`/runs/${t}`).then(ui)}function mi(t){return{id:J(t.vin??t._id??t.id),vin:J(t.vin),name:J(t.vin??t.name,"Unknown"),status:J(t.current_status??t.status,"Offline"),platform:V(t.vehicle_platform??t.platform),plateType:V(t.plate_type),modelCode:V(t.model_code),socArchitecture:V(t.soc_architecture),sensorSuiteVersion:V(t.sensor_suite_version),componentVersions:t.component_versions,currentSpeed:rt(t.current_speed_mps),drivingMode:V(t.driving_mode),currentLocation:t.current_location,fuelOrBatteryLevel:rt(t.fuel_or_battery_level),lastHeartbeat:V(t.last_heartbeat),updatedAt:V(t.updated_at??t.updatedAt)}}async function yn(t){const s=ve(t),r=await L(`/vehicles${s}`);return(Array.isArray(r)?r:r.data??[]).map(a=>mi(a))}function yd(t){return L(`/vehicles/${t}`).then(mi)}function gd(t,s){return L(`/vehicles/${t}/status-distribution${ve(s)}`)}function xd(t,s){return L(`/vehicles/${t}/trajectory${ve(s)}`)}function vd(){return L("/fleet/distribution")}function jd(){return L("/fleet/status-distribution")}function bd(t){return L(`/trajectory/query${ve(t)}`)}function Sd(t){return L(`/trajectory/issues${ve(t)}`)}async function kd(t){const s=ve(t),r=await L(`/issues${s}`);return(Array.isArray(r)?r:r.data??[]).map(a=>hi(a))}function Cd(t){return L(`/issues/${t}`).then(hi)}function _d(t,s){return L(`/issues/${t}/transition`,{method:"PUT",body:JSON.stringify(s)})}function wd(t,s){return L(`/issues/${t}/triage`,{method:"POST",body:JSON.stringify({assigned_to:s.assignee,assigned_module:s.module,triggered_by:s.triggered_by??"ui-user"})})}async function Fd(t){const s=await L(`/issues/${t}/transitions`);return{items:(Array.isArray(s)?s:s.items??[]).map(cd)}}function Rd(t){return L(`/traceability/forward/${t}`)}function Id(t){return L(`/traceability/backward/${t}`)}const Td=Rd,Ed=Id;function Pd(t){return L("/traceability/coverage").then(s=>({total:Number(s.total??s.total_requirements??0),covered:Number(s.covered??s.covered_requirements??0),percentage:Number(s.percentage??s.coverage_percentage??0),details:Array.isArray(s.details)?s.details:[]}))}function Ad(t){return L(`/kpi/mpi${ve(t)}`)}function zd(t){return L(`/kpi/mttr${ve(t)}`)}function Md(t){return L(`/kpi/regression-pass-rate${ve(t)}`)}function Nd(t){return L(`/kpi/fleet-utilization${ve(t)}`)}function Od(t){return L(`/kpi/issue-convergence${ve(t)}`).then(s=>{const r=Array.isArray(s.series)?s.series:[];return{value:Number(s.value??0),unit:J(s.unit,""),points:r.map(n=>({timestamp:J(n.date),value:Number(n.new_issues??0),dimensions:{open_count:Number(n.new_issues??0),closed_count:Number(n.closed_issues??0)}})),...s}})}function Ld(t){return L(`/issues/${t}/snapshot`)}function Dd(t){return L(`/issues/${t}/timeseries`)}function Bd(t){const s=t?`/schema/fields/${t}`:"/schema/fields";return L(s)}function $d(){return L("/kpi/definitions")}function qd(t){return L("/kpi/definitions",{method:"POST",body:JSON.stringify(t)})}function Kd(t,s){return L(`/kpi/definitions/${t}`,{method:"PUT",body:JSON.stringify(s)})}function Wd(t){return L(`/kpi/definitions/${t}`,{method:"DELETE"})}function Ud(t,s){return L(`/kpi/custom/${t}/evaluate${ve(s)}`)}function Vd(t){return L("/kpi/custom/preview",{method:"POST",body:JSON.stringify(t)})}function Hd(t){return L("/kpi/definitions/import",{method:"POST",body:JSON.stringify(t)})}function Qd(t){return L(`/simulations${ve(t)}`)}function Gd(t){return L(`/simulations/${t}`)}function Jd(t){return L("/simulations",{method:"POST",body:JSON.stringify(t)})}function Yd(t){return L(`/simulations/${t}`,{method:"DELETE"})}function Ur(t){return L(`/simulations/${t}/start`,{method:"POST"})}function Xd(t){return L(`/simulations/${t}/pause`,{method:"POST"})}function Zd(t){return L(`/simulations/${t}/resume`,{method:"POST"})}function eu(t){return L(`/simulations/${t}/stop`,{method:"POST"})}function tu(t){return L(`/simulations/${t}/stats`)}function su(t,s=30){return L(`/simulations/${t}/vehicles?tail=${s}`)}function ru(t){return L("/simulations/generate-routes",{method:"POST",body:JSON.stringify(t)})}function nu(t){return L("/simulations/generate-fleet",{method:"POST",body:JSON.stringify(t)})}function au(t){return L("/simulations/snap-routes",{method:"POST",body:JSON.stringify({routes:t})})}const Re={Planning:"blue",Active:"purple",Completed:"green",Archived:"default",Frozen:"cyan",Pending:"default",InProgress:"gold",Cancelled:"default",Scheduled:"blue",Aborted:"red",New:"blue",Triage:"purple",Assigned:"geekblue",Fixed:"green",RegressionTracking:"cyan",Closed:"default",Reopened:"orange",Rejected:"red",backlog:"default",ready:"blue","in-progress":"gold",review:"purple",done:"green",pending:"default",queued:"blue",running:"gold",passed:"green",failed:"red",cancelled:"default",open:"blue",triaged:"purple",fixed:"green",verified:"cyan",closed:"default","wont-fix":"red",duplicate:"default"},lr={Pending:"default",Smoke:"cyan",Gray:"gold",Freeze:"orange",GoLive:"green",backlog:"default",ready:"blue","in-progress":"gold",review:"purple",done:"green"},or={Critical:"red",High:"orange",Medium:"gold",Low:"blue",critical:"red",high:"orange",medium:"gold",low:"blue"},Vr={Blocker:"red",Critical:"red",High:"orange",Medium:"gold",Low:"blue",Trivial:"green",blocker:"red",critical:"red",high:"orange",medium:"gold",low:"blue",trivial:"green",Minor:"gold",Major:"orange"};function ct({title:t,subtitle:s,action:r}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24},children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:t}),s&&e.jsx("p",{className:"page-subtitle",children:s})]}),r]})}function Me({to:t,children:s,mono:r,style:n}){return e.jsx(lt,{to:t,style:{color:"var(--text-primary)",fontWeight:500,transition:"color 0.2s ease",...r?{fontFamily:"var(--font-mono)"}:{},...n},children:s})}const iu={Planning:{bg:"#E8F0FE",text:"#1A73E8"},Active:{bg:"#F3E8FF",text:"#7C3AED"},Completed:{bg:"#ECFDF5",text:"#059669"},Archived:{bg:"#F3F4F6",text:"#6B7280"},Frozen:{bg:"#E0F7FA",text:"#0097A7"}};function lu({status:t}){const s=iu[t]??{bg:"#F3F4F6",text:"#6B7280"};return e.jsx("span",{style:{display:"inline-block",padding:"2px 12px",borderRadius:9999,fontSize:"0.75rem",fontWeight:600,background:s.bg,color:s.text,lineHeight:"20px"},children:t})}function ou({project:t}){const r={Planning:15,Active:55,Frozen:40,Completed:100,Archived:100}[t.status]??30;return e.jsx(Me,{to:`/projects/${t.id}`,style:{textDecoration:"none",display:"block"},children:e.jsxs("div",{className:"ios-card ios-card-interactive",style:{padding:20,height:"100%",cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:700,color:"var(--text-primary)",lineHeight:1.3},children:t.name}),e.jsx(lu,{status:t.status})]}),e.jsxs("div",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",marginBottom:16,lineHeight:1.6},children:[t.vehicle_platform&&e.jsxs("div",{children:[e.jsx("span",{style:{fontWeight:500},children:"Platform:"})," ",t.vehicle_platform]}),t.soc_architecture&&e.jsxs("div",{children:[e.jsx("span",{style:{fontWeight:500},children:"SoC:"})," ",t.soc_architecture]}),t.description&&e.jsx("div",{style:{marginTop:4,color:"var(--text-muted)"},children:t.description})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem",color:"var(--text-muted)",marginBottom:4},children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[r,"%"]})]}),e.jsx(Gr,{percent:r,showInfo:!1,strokeColor:"#76B900",trailColor:"#F0F0F0",size:"small"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",gap:12,fontSize:"0.75rem",color:"var(--text-muted)"},children:[t.target_mileage_km!=null&&e.jsxs("span",{children:[t.target_mileage_km.toLocaleString()," km target"]}),t.sensor_suite_version&&e.jsxs("span",{children:["Sensor ",t.sensor_suite_version]})]}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)"},children:new Date(t.updatedAt).toLocaleDateString()})]})]})})}function cu(){const[t,s]=h.useState(""),[r,n]=h.useState(),[a,i]=h.useState(!1),[l,o]=h.useState("grid"),[p]=M.useForm(),d=We(),{data:u,isLoading:c}=$({queryKey:["projects"],queryFn:()=>xs()}),g=ye({mutationFn:v=>{var _;const R=`PROJ-${crypto.randomUUID().slice(0,6).toUpperCase()}`;return dd({project_id:R,name:v.name,vehicle_platform:v.vehicle_platform,soc_architecture:v.soc_architecture,sensor_suite_version:v.sensor_suite_version,software_baseline_version:v.software_baseline_version,start_date:(_=v.start_date)==null?void 0:_.toISOString(),target_mileage_km:v.target_mileage_km,status:v.status??"Planning"})},onSuccess:()=>{d.invalidateQueries({queryKey:["projects"]}),i(!1),p.resetFields(),te.success("Project created")},onError:v=>{te.error(v.message||"Failed to create project")}}),f=u==null?void 0:u.filter(v=>!(t&&!v.name.toLowerCase().includes(t.toLowerCase())||r&&v.status!==r)),k=h.useMemo(()=>{const v=u??[];return{total:v.length,active:v.filter(R=>R.status==="Active").length,completed:v.filter(R=>R.status==="Completed").length,archived:v.filter(R=>R.status==="Archived").length}},[u]),j=[{title:"Name",dataIndex:"name",key:"name",render:(v,R)=>e.jsx(Me,{to:`/projects/${R.id}`,children:v})},{title:"Status",dataIndex:"status",key:"status",width:130,render:v=>e.jsx(B,{color:Re[v]??"default",children:v})},{title:"Platform",dataIndex:"vehicle_platform",key:"vehicle_platform",width:140,render:v=>v??"â€”"},{title:"Created",dataIndex:"createdAt",key:"createdAt",width:140,render:v=>new Date(v).toLocaleDateString()},{title:"Updated",dataIndex:"updatedAt",key:"updatedAt",width:140,render:v=>new Date(v).toLocaleDateString()}],b=[{label:"Total Projects",value:k.total,color:"#76B900"},{label:"Active",value:k.active,color:"#7C3AED"},{label:"Completed",value:k.completed,color:"#059669"},{label:"Archived",value:k.archived,color:"#6B7280"}];return e.jsxs("div",{children:[e.jsx(ct,{title:"Projects",subtitle:"Manage autonomous driving test projects",action:e.jsx(O,{className:"btn-primary-green",icon:e.jsx(Qt,{}),size:"large",onClick:()=>i(!0),children:"New Project"})}),e.jsx(ce,{gutter:16,style:{marginBottom:24},children:b.map(v=>e.jsx(N,{xs:12,sm:6,children:e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-card-label",children:v.label}),e.jsx("div",{className:"stat-card-value",style:{color:v.color},children:v.value})]})},v.label))}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexWrap:"wrap",gap:12},children:[e.jsxs(ee,{wrap:!0,children:[e.jsx(G,{placeholder:"Search projects...",prefix:e.jsx(cr,{style:{color:"var(--text-muted)"}}),value:t,onChange:v=>s(v.target.value),allowClear:!0,style:{width:280}}),e.jsx(se,{placeholder:"Filter by status",allowClear:!0,value:r,onChange:n,style:{width:160},options:[{value:"Planning",label:"Planning"},{value:"Active",label:"Active"},{value:"Frozen",label:"Frozen"},{value:"Completed",label:"Completed"},{value:"Archived",label:"Archived"}]})]}),e.jsx(Qr,{value:l,onChange:v=>o(v),options:[{value:"grid",icon:e.jsx(ja,{})},{value:"list",icon:e.jsx(ba,{})}]})]}),l==="grid"?(!f||f.length===0)&&!c?e.jsx("div",{className:"ios-card",style:{padding:48,textAlign:"center"},children:e.jsx(ne,{image:e.jsx(Yn,{size:48,style:{color:"var(--text-muted)",opacity:.4}}),description:e.jsx("span",{style:{color:"var(--text-muted)"},children:"No projects yet. Create your first project to get started."})})}):e.jsx(ce,{gutter:[16,16],children:(f??[]).map(v=>e.jsx(N,{xs:24,sm:12,lg:8,children:e.jsx(ou,{project:v})},v.id))}):e.jsx("div",{className:"ios-card",style:{overflow:"hidden"},children:e.jsx(xe,{columns:j,dataSource:f,rowKey:"id",loading:c,pagination:{pageSize:15,showSizeChanger:!1},locale:{emptyText:e.jsx(ne,{image:e.jsx(Yn,{size:48,style:{color:"var(--text-muted)",opacity:.4}}),description:e.jsx("span",{style:{color:"var(--text-muted)"},children:"No projects yet. Create your first project to get started."})})}})}),e.jsx(us,{title:"New Project",open:a,onCancel:()=>i(!1),onOk:()=>p.submit(),confirmLoading:g.isPending,okText:"Create",width:600,children:e.jsxs(M,{form:p,layout:"vertical",onFinish:v=>g.mutate(v),children:[e.jsx(M.Item,{name:"name",label:"Project Name",rules:[{required:!0,message:"Please enter project name"}],children:e.jsx(G,{placeholder:"e.g. V2.0 Urban Pilot"})}),e.jsx(M.Item,{name:"vehicle_platform",label:"Vehicle Platform",rules:[{required:!0}],children:e.jsx(G,{placeholder:"e.g. EP40"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsx(M.Item,{name:"soc_architecture",label:"SoC Architecture",rules:[{required:!0}],children:e.jsx(G,{placeholder:"e.g. Orin-X Dual"})}),e.jsx(M.Item,{name:"sensor_suite_version",label:"Sensor Suite Version",rules:[{required:!0}],children:e.jsx(G,{placeholder:"e.g. SS-4.0"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsx(M.Item,{name:"software_baseline_version",label:"SW Baseline Version",rules:[{required:!0}],children:e.jsx(G,{placeholder:"e.g. v3.1.0-rc1"})}),e.jsx(M.Item,{name:"start_date",label:"Start Date",rules:[{required:!0}],children:e.jsx(Rs,{style:{width:"100%"}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsx(M.Item,{name:"target_mileage_km",label:"Target Mileage (km)",children:e.jsx(we,{min:0,style:{width:"100%"},placeholder:"Optional"})}),e.jsx(M.Item,{name:"status",label:"Initial Status",initialValue:"Planning",children:e.jsx(se,{options:[{value:"Planning",label:"Planning"},{value:"Active",label:"Active"}]})})]})]})})]})}function qs(){return e.jsx("div",{style:{display:"flex",justifyContent:"center",padding:80},children:e.jsx(Kt,{size:"large"})})}function gn({entity:t}){return e.jsx(ne,{description:`${t} not found`,style:{padding:80}})}function he(){return e.jsx("span",{style:{color:"var(--text-muted)"},children:"â€”"})}class du extends h.Component{constructor(){super(...arguments);In(this,"state",{hasError:!1})}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,n){console.error("[ErrorBoundary]",r,n.componentStack)}render(){var r;return this.state.hasError?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(Ri,{status:"error",title:"Something went wrong",subTitle:((r=this.state.error)==null?void 0:r.message)??"An unexpected error occurred",extra:e.jsx(O,{type:"primary",onClick:()=>{this.setState({hasError:!1,error:void 0}),window.location.reload()},children:"Reload Page"})})}):this.props.children}}function xn(t,s,r){const{data:n,isLoading:a,error:i}=$({queryKey:[t,s],queryFn:()=>r(s),enabled:!!s});return{data:n,isLoading:a,error:i}}const uu={Planning:["Active"],Active:["Frozen","Completed"],Frozen:["Active","Completed"],Completed:["Archived"],Archived:[]},Cr=t=>e.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:600,fontSize:"1rem",color:"var(--text-primary)",letterSpacing:"-0.01em"},children:t});function ut({label:t,children:s}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid var(--border-secondary)"},children:[e.jsx("span",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",fontWeight:500},children:t}),e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-primary)",fontWeight:500,textAlign:"right"},children:s})]})}function hu(){const{id:t}=ys(),s=We(),[r,n]=h.useState("overview"),{data:a,isLoading:i}=xn("project",t,pi),{data:l}=$({queryKey:["tasks",{projectId:t}],queryFn:()=>Bs({projectId:t}),enabled:!!t}),o=ye({mutationFn:c=>ud(t,{status:c}),onSuccess:()=>{s.invalidateQueries({queryKey:["project",t]}),s.invalidateQueries({queryKey:["projects"]}),te.success("Status updated")},onError:c=>te.error(c.message||"Failed to update status")});if(i)return e.jsx(qs,{});if(!a)return e.jsx(gn,{entity:"Project"});const p=uu[a.status]??[],d=(l==null?void 0:l.length)??0,u=[{title:"Title",dataIndex:"title",key:"title",render:(c,g)=>e.jsx(Me,{to:`/tasks/${g.id}`,children:c})},{title:"Stage",dataIndex:"stage",key:"stage",width:120,render:c=>e.jsx(B,{color:lr[c]??"default",children:c})},{title:"Priority",dataIndex:"priority",key:"priority",width:110,render:c=>e.jsx(B,{color:or[c]??"default",children:c})},{title:"Type",dataIndex:"taskType",key:"taskType",width:100,render:c=>c?e.jsx(B,{children:c}):e.jsx(he,{})}];return e.jsxs("div",{style:{maxWidth:1280,margin:"0 auto"},children:[e.jsxs(lt,{to:"/projects",style:{display:"inline-flex",alignItems:"center",gap:6,color:"var(--text-secondary)",marginBottom:20,fontSize:13,fontWeight:500},children:[e.jsx(Jr,{})," Back to Projects"]}),e.jsxs("div",{className:"ios-card",style:{padding:"24px",marginBottom:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:"1.5rem",fontWeight:700,color:"var(--text-primary)",margin:0,letterSpacing:"-0.02em"},children:a.name}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:4},children:a.description??"No description"})]}),e.jsxs(ee,{size:8,wrap:!0,children:[e.jsx(B,{color:Re[a.status]??"blue",style:{fontSize:13,padding:"3px 14px",borderRadius:9999},children:a.status}),p.map(c=>e.jsxs(O,{size:"small",loading:o.isPending,onClick:()=>o.mutate(c),style:{borderRadius:9999,fontWeight:500,borderColor:"var(--border-primary)",color:"var(--text-secondary)"},children:["â†’ ",c]},c))]})]}),d>0&&e.jsxs("div",{style:{marginTop:20},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)",fontWeight:500},children:"Progress"}),e.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)",fontWeight:500},children:[(l==null?void 0:l.filter(c=>c.stage==="GoLive"||c.stage==="done").length)??0," / ",d," completed"]})]}),e.jsx("div",{style:{height:6,background:"var(--bg-hover)",borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${((l==null?void 0:l.filter(c=>c.stage==="GoLive"||c.stage==="done").length)??0)/d*100}%`,background:"var(--brand-green)",borderRadius:3,transition:"width 0.3s ease"}})})]}),e.jsxs("div",{style:{display:"flex",gap:32,marginTop:20,paddingTop:16,borderTop:"1px solid var(--border-secondary)"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,fontFamily:"var(--font-display)",color:"var(--text-primary)"},children:d}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-muted)",fontWeight:500},children:"Tasks"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,fontFamily:"var(--font-display)",color:"var(--text-primary)"},children:a.target_mileage_km!=null?a.target_mileage_km.toLocaleString():"â€”"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-muted)",fontWeight:500},children:"Target KM"})]})]})]}),e.jsx("div",{style:{display:"flex",gap:4,marginBottom:24},children:["overview","tasks"].map(c=>e.jsx("button",{className:`secondary-tab ${r===c?"active":""}`,onClick:()=>n(c),children:c==="overview"?"Overview":`Tasks (${d})`},c))}),r==="overview"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 380px",gap:24,alignItems:"start"},children:[e.jsxs("div",{className:"ios-card",style:{overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 24px",borderBottom:"1px solid var(--border-secondary)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Cr("Tasks"),e.jsx("button",{onClick:()=>n("tasks"),style:{background:"none",border:"none",color:"var(--brand-green)",fontSize:13,fontWeight:500,cursor:"pointer"},children:"View All"})]}),e.jsx(xe,{columns:u,dataSource:l==null?void 0:l.slice(0,5),rowKey:"id",pagination:!1,locale:{emptyText:e.jsx(ne,{description:"No tasks for this project yet"})}})]}),e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[Cr("Details"),e.jsxs("div",{style:{marginTop:12},children:[e.jsx(ut,{label:"Status",children:e.jsx(B,{color:Re[a.status]??"blue",style:{margin:0},children:a.status})}),e.jsx(ut,{label:"Vehicle Platform",children:a.vehicle_platform??e.jsx(he,{})}),e.jsx(ut,{label:"SoC Architecture",children:a.soc_architecture??e.jsx(he,{})}),e.jsx(ut,{label:"Sensor Suite",children:a.sensor_suite_version??e.jsx(he,{})}),e.jsx(ut,{label:"SW Baseline",children:a.software_baseline_version??e.jsx(he,{})}),e.jsx(ut,{label:"Target Mileage",children:a.target_mileage_km!=null?`${a.target_mileage_km.toLocaleString()} km`:e.jsx(he,{})}),e.jsx(ut,{label:"Start Date",children:a.start_date?new Date(a.start_date).toLocaleDateString():e.jsx(he,{})}),e.jsx(ut,{label:"Created",children:new Date(a.createdAt).toLocaleString()}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0"},children:[e.jsx("span",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",fontWeight:500},children:"Last Updated"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-primary)",fontWeight:500},children:new Date(a.updatedAt).toLocaleString()})]})]})]})]}),r==="tasks"&&e.jsxs("div",{className:"ios-card",style:{overflow:"hidden"},children:[e.jsx("div",{style:{padding:"16px 24px",borderBottom:"1px solid var(--border-secondary)"},children:Cr("All Tasks")}),e.jsx(xe,{columns:u,dataSource:l,rowKey:"id",pagination:!1,locale:{emptyText:e.jsx(ne,{description:"No tasks for this project yet"})}})]})]})}const pu={Critical:{bg:"#FEE2E2",text:"#DC2626"},High:{bg:"#FFF7ED",text:"#EA580C"},Medium:{bg:"#FFFBEB",text:"#D97706"},Low:{bg:"#EFF6FF",text:"#2563EB"}},mu={Daily:{bg:"#E8F0FE",text:"#1A73E8"},Smoke:{bg:"#E0F7FA",text:"#0097A7"},Gray:{bg:"#FFF3E0",text:"#E65100"},Freeze:{bg:"#F3E8FF",text:"#7C3AED"},Retest:{bg:"#FCE4EC",text:"#C62828"}};function Zn({label:t,colors:s}){return e.jsx("span",{style:{display:"inline-block",padding:"2px 10px",borderRadius:9999,fontSize:"0.6875rem",fontWeight:600,background:s.bg,color:s.text,lineHeight:"18px",whiteSpace:"nowrap"},children:t})}const ea=[{key:"Pending",title:"Pending",accent:"#6B7280"},{key:"InProgress",title:"In Progress",accent:"#D97706"},{key:"Completed",title:"Completed",accent:"#059669"},{key:"Cancelled",title:"Cancelled",accent:"#9CA3AF"}];function fu({task:t,projectName:s}){const r=pu[t.priority]??{bg:"#F3F4F6",text:"#6B7280"},n=t.taskType?mu[t.taskType]??{bg:"#F3F4F6",text:"#6B7280"}:null;return e.jsx(Me,{to:`/tasks/${t.id}`,style:{textDecoration:"none",display:"block"},children:e.jsxs("div",{className:"ios-card ios-card-interactive",style:{padding:14,cursor:"pointer",marginBottom:10},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.875rem",color:"var(--text-primary)",marginBottom:8,lineHeight:1.4},children:t.title}),s&&e.jsx("div",{style:{marginBottom:8},children:e.jsx("span",{style:{display:"inline-block",padding:"1px 8px",borderRadius:9999,fontSize:"0.6875rem",fontWeight:500,background:"#F0FDF0",color:"#76B900",border:"1px solid #D4EDDA",lineHeight:"18px"},children:s})}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:10},children:[e.jsx(Zn,{label:t.priority,colors:r}),n&&t.taskType&&e.jsx(Zn,{label:t.taskType,colors:n})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.75rem",color:"var(--text-muted)"},children:[e.jsx("span",{children:t.assignee??"Unassigned"}),e.jsx("span",{children:new Date(t.updatedAt).toLocaleDateString()})]})]})})}function yu(){const[t,s]=h.useState(""),[r,n]=h.useState(),[a,i]=h.useState(!1),[l,o]=h.useState("kanban"),[p]=M.useForm(),d=We(),{data:u,isLoading:c}=$({queryKey:["tasks"],queryFn:()=>Bs()}),{data:g}=$({queryKey:["projects"],queryFn:()=>xs()}),f=ye({mutationFn:S=>{const w=`TASK-${crypto.randomUUID().slice(0,6).toUpperCase()}`;return pd({task_id:w,project_id:S.project_id,name:S.name,task_type:S.task_type,priority:S.priority??"Medium",execution_region:S.execution_region,target_vehicle_count:S.target_vehicle_count})},onSuccess:()=>{d.invalidateQueries({queryKey:["tasks"]}),i(!1),p.resetFields(),te.success("Task created")},onError:S=>{te.error(S.message||"Failed to create task")}}),k=h.useMemo(()=>{const S=new Map;return(g??[]).forEach(w=>S.set(w.id,w.name)),S},[g]),j=u==null?void 0:u.filter(S=>!(t&&!S.title.toLowerCase().includes(t.toLowerCase())||r&&S.stage!==r)),b=h.useMemo(()=>{const S=u??[];return{total:S.length,pending:S.filter(w=>w.stage==="Pending").length,inProgress:S.filter(w=>w.stage==="InProgress").length,completed:S.filter(w=>w.stage==="Completed").length}},[u]),v=h.useMemo(()=>{const S={};for(const w of ea)S[w.key]=[];for(const w of j??[])(S[w.stage]??S.Pending).push(w);return S},[j]),R=[{title:"Title",dataIndex:"title",key:"title",render:(S,w)=>e.jsx(Me,{to:`/tasks/${w.id}`,children:S})},{title:"Stage",dataIndex:"stage",key:"stage",width:130,render:S=>e.jsx(B,{color:lr[S]??"default",children:S})},{title:"Priority",dataIndex:"priority",key:"priority",width:110,render:S=>e.jsx(B,{color:or[S]??"default",children:S})},{title:"Assignee",dataIndex:"assignee",key:"assignee",width:140,render:S=>S??e.jsx(he,{})},{title:"Updated",dataIndex:"updatedAt",key:"updatedAt",width:140,render:S=>new Date(S).toLocaleDateString()}],_=[{label:"Total Tasks",value:b.total,color:"#76B900"},{label:"Pending",value:b.pending,color:"#6B7280"},{label:"In Progress",value:b.inProgress,color:"#D97706"},{label:"Completed",value:b.completed,color:"#059669"}];return e.jsxs("div",{children:[e.jsx(ct,{title:"Tasks",subtitle:"Track test campaign tasks through their lifecycle",action:e.jsx(O,{className:"btn-primary-green",icon:e.jsx(Qt,{}),size:"large",onClick:()=>i(!0),children:"New Task"})}),e.jsx(ce,{gutter:16,style:{marginBottom:24},children:_.map(S=>e.jsx(N,{xs:12,sm:6,children:e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-card-label",children:S.label}),e.jsx("div",{className:"stat-card-value",style:{color:S.color},children:S.value})]})},S.label))}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexWrap:"wrap",gap:12},children:[e.jsxs(ee,{wrap:!0,children:[e.jsx(G,{placeholder:"Search tasks...",prefix:e.jsx(cr,{style:{color:"var(--text-muted)"}}),value:t,onChange:S=>s(S.target.value),allowClear:!0,style:{width:280}}),e.jsx(se,{placeholder:"Filter by status",allowClear:!0,value:r,onChange:n,style:{width:160},options:[{value:"Pending",label:"Pending"},{value:"InProgress",label:"In Progress"},{value:"Completed",label:"Completed"},{value:"Cancelled",label:"Cancelled"}]})]}),e.jsx(Qr,{value:l,onChange:S=>o(S),options:[{value:"kanban",icon:e.jsx(zc,{size:16}),label:"Kanban"},{value:"list",icon:e.jsx(Nc,{size:16}),label:"List"}]})]}),l==="kanban"?e.jsx("div",{style:{display:"flex",gap:12,overflowX:"auto",paddingBottom:8},children:ea.map(S=>{const w=v[S.key]??[];return e.jsxs("div",{style:{flex:"1 1 0",minWidth:260,background:"#F9FAFB",borderRadius:12,padding:12,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12,paddingLeft:4},children:[e.jsx("span",{style:{width:8,height:8,borderRadius:9999,background:S.accent,display:"inline-block"}}),e.jsx("span",{style:{fontWeight:600,fontSize:"0.875rem",color:"var(--text-primary)"},children:S.title}),e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",minWidth:22,height:22,borderRadius:9999,background:"#E5E7EB",fontSize:"0.75rem",fontWeight:600,color:"#6B7280"},children:w.length})]}),e.jsx("div",{style:{flex:1},children:w.length===0?e.jsx("div",{style:{padding:"24px 8px",textAlign:"center",color:"var(--text-muted)",fontSize:"0.8125rem"},children:"No tasks"}):w.map(T=>e.jsx(fu,{task:T,projectName:k.get(T.projectId)},T.id))})]},S.key)})}):e.jsx("div",{className:"ios-card",style:{overflow:"hidden"},children:e.jsx(xe,{columns:R,dataSource:j,rowKey:"id",loading:c,pagination:{pageSize:15,showSizeChanger:!1},locale:{emptyText:e.jsx(ne,{image:e.jsx(Mc,{size:48,style:{color:"var(--text-muted)",opacity:.4}}),description:e.jsx("span",{style:{color:"var(--text-muted)"},children:"No tasks yet. Create tasks to plan and track your test activities."})})}})}),e.jsx(us,{title:"New Task",open:a,onCancel:()=>i(!1),onOk:()=>p.submit(),confirmLoading:f.isPending,okText:"Create",width:560,children:e.jsxs(M,{form:p,layout:"vertical",onFinish:S=>f.mutate(S),children:[e.jsx(M.Item,{name:"project_id",label:"Project",rules:[{required:!0,message:"Please select a project"}],children:e.jsx(se,{placeholder:"Select project",showSearch:!0,optionFilterProp:"label",options:(g??[]).map(S=>({value:S.id,label:S.name}))})}),e.jsx(M.Item,{name:"name",label:"Task Name",rules:[{required:!0,message:"Please enter task name"}],children:e.jsx(G,{placeholder:"e.g. Highway Daily Mileage"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsx(M.Item,{name:"task_type",label:"Task Type",rules:[{required:!0,message:"Please select type"}],children:e.jsx(se,{placeholder:"Select type",options:[{value:"Daily",label:"Daily"},{value:"Smoke",label:"Smoke"},{value:"Gray",label:"Gray"},{value:"Freeze",label:"Freeze"},{value:"Retest",label:"Retest"}]})}),e.jsx(M.Item,{name:"priority",label:"Priority",initialValue:"Medium",children:e.jsx(se,{options:[{value:"Low",label:"Low"},{value:"Medium",label:"Medium"},{value:"High",label:"High"},{value:"Critical",label:"Critical"}]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsx(M.Item,{name:"execution_region",label:"Execution Region",children:e.jsx(G,{placeholder:"e.g. Shanghai Lingang"})}),e.jsx(M.Item,{name:"target_vehicle_count",label:"Target Vehicle Count",children:e.jsx(we,{min:1,style:{width:"100%"},placeholder:"Optional"})})]})]})})]})}const gu=["Completed","Cancelled"],ta=t=>e.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:600,fontSize:"1rem",color:"var(--text-primary)",letterSpacing:"-0.01em"},children:t});function Ft({label:t,children:s}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid var(--border-secondary)"},children:[e.jsx("span",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",fontWeight:500},children:t}),e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-primary)",fontWeight:500,textAlign:"right"},children:s})]})}function xu(){const{id:t}=ys(),s=We(),{data:r,isLoading:n}=xn("task",t,hd),{data:a}=$({queryKey:["runs",{taskId:t}],queryFn:()=>$s({taskId:t}),enabled:!!t}),{data:i}=$({queryKey:["project",r==null?void 0:r.projectId],queryFn:()=>pi(r.projectId),enabled:!!(r!=null&&r.projectId)}),l=ye({mutationFn:()=>md(t),onSuccess:()=>{s.invalidateQueries({queryKey:["task",t]}),s.invalidateQueries({queryKey:["tasks"]}),te.success("Status advanced")},onError:d=>te.error(d.message||"Failed to advance status")});if(n)return e.jsx(qs,{});if(!r)return e.jsx(gn,{entity:"Task"});const o=!gu.includes(r.stage),p=[{title:"Run ID",dataIndex:"id",key:"id",width:120,render:d=>e.jsx(Me,{to:`/runs/${d}`,mono:!0,children:d.slice(0,8)})},{title:"Status",dataIndex:"status",key:"status",width:120,render:d=>e.jsx(B,{color:Re[d]??"default",children:d})},{title:"Result",dataIndex:"result",key:"result",width:100,render:d=>d??e.jsx(he,{})},{title:"Started",dataIndex:"startedAt",key:"startedAt",render:d=>d?new Date(d).toLocaleString():e.jsx(he,{})}];return e.jsxs("div",{style:{maxWidth:1280,margin:"0 auto"},children:[e.jsxs(lt,{to:"/tasks",style:{display:"inline-flex",alignItems:"center",gap:6,color:"var(--text-secondary)",marginBottom:20,fontSize:13,fontWeight:500},children:[e.jsx(Jr,{})," Back to Tasks"]}),e.jsx("div",{className:"ios-card",style:{padding:"24px",marginBottom:24},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontFamily:"var(--font-display)",fontSize:"1.5rem",fontWeight:700,color:"var(--text-primary)",margin:0,letterSpacing:"-0.02em"},children:r.title}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:4},children:r.description??"No description"})]}),e.jsxs(ee,{size:8,children:[e.jsx(B,{color:lr[r.stage]??"default",style:{fontSize:13,padding:"3px 14px",borderRadius:9999},children:r.stage}),e.jsx(B,{color:or[r.priority]??"default",style:{fontSize:13,padding:"3px 14px",borderRadius:9999},children:r.priority}),o&&e.jsx("button",{className:"btn-primary-green",onClick:()=>l.mutate(),disabled:l.isPending,children:l.isPending?"Advancingâ€¦":"Advance Stage â†’"})]})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 380px",gap:24,alignItems:"start"},children:[e.jsxs("div",{className:"ios-card",style:{overflow:"hidden"},children:[e.jsx("div",{style:{padding:"16px 24px",borderBottom:"1px solid var(--border-secondary)"},children:ta("Test Runs")}),e.jsx(xe,{columns:p,dataSource:a,rowKey:"id",pagination:!1,locale:{emptyText:e.jsx(ne,{description:"No runs executed yet"})}})]}),e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[ta("Details"),e.jsxs("div",{style:{marginTop:12},children:[e.jsx(Ft,{label:"Stage",children:e.jsx(B,{color:lr[r.stage]??"default",style:{margin:0},children:r.stage})}),e.jsx(Ft,{label:"Task Type",children:r.taskType?e.jsx(B,{style:{margin:0},children:r.taskType}):e.jsx(he,{})}),e.jsx(Ft,{label:"Priority",children:e.jsx(B,{color:or[r.priority]??"default",style:{margin:0},children:r.priority})}),e.jsx(Ft,{label:"Project",children:r.projectId?e.jsx(Me,{to:`/projects/${r.projectId}`,children:(i==null?void 0:i.name)??r.projectId.slice(0,8)}):e.jsx(he,{})}),e.jsx(Ft,{label:"Execution Region",children:r.executionRegion??e.jsx(he,{})}),e.jsx(Ft,{label:"Target Vehicles",children:r.targetVehicleCount??e.jsx(he,{})}),e.jsx(Ft,{label:"Created",children:new Date(r.createdAt).toLocaleString()}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0"},children:[e.jsx("span",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",fontWeight:500},children:"Updated"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-primary)",fontWeight:500},children:new Date(r.updatedAt).toLocaleString()})]})]})]})]})]})}const vu={Completed:e.jsx(ar,{size:15,style:{color:"#34C759",verticalAlign:"middle",marginRight:4}}),Aborted:e.jsx(ri,{size:15,style:{color:"#FF3B30",verticalAlign:"middle",marginRight:4}}),Active:e.jsx(Oc,{size:15,style:{color:"#007AFF",verticalAlign:"middle",marginRight:4},className:"spin-icon"}),Scheduled:e.jsx(wc,{size:15,style:{color:"#8E8E93",verticalAlign:"middle",marginRight:4}})};function ju(){const{data:t,isLoading:s}=$({queryKey:["runs"],queryFn:()=>$s()}),r=h.useMemo(()=>t?{total:t.length,running:t.filter(i=>i.status==="Active"||i.status==="running").length,passed:t.filter(i=>i.result==="passed"||i.result==="pass"||i.status==="Completed").length,failed:t.filter(i=>i.result==="failed"||i.result==="fail"||i.status==="Aborted").length}:{total:0,running:0,passed:0,failed:0},[t]),n=r.passed+r.failed||1,a=[{title:"Run ID",dataIndex:"id",key:"id",width:120,render:i=>e.jsx(Me,{to:`/runs/${i}`,mono:!0,children:i.slice(0,8)})},{title:"Task",dataIndex:"taskId",key:"taskId",width:120,render:i=>i?e.jsx(Me,{to:`/tasks/${i}`,mono:!0,children:i.slice(0,8)}):e.jsx(he,{})},{title:"Status",dataIndex:"status",key:"status",width:140,render:i=>e.jsxs("span",{style:{display:"inline-flex",alignItems:"center"},children:[vu[i]??null,e.jsx(B,{color:Re[i]??"default",style:{margin:0},children:i})]})},{title:"Result",dataIndex:"result",key:"result",width:100,render:i=>i??e.jsx(he,{})},{title:"Vehicles",dataIndex:"vehicleIds",key:"vehicles",width:90,render:i=>(i==null?void 0:i.length)??0},{title:"Started",dataIndex:"startedAt",key:"startedAt",width:160,render:i=>i?new Date(i).toLocaleString():e.jsx(he,{})},{title:"Completed",dataIndex:"completedAt",key:"completedAt",width:160,render:i=>i?new Date(i).toLocaleString():e.jsx(he,{})}];return e.jsxs("div",{children:[e.jsx(ct,{title:"Test Runs",subtitle:"Monitor and manage test execution runs"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16,marginBottom:24},children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Total Runs"}),e.jsx("span",{className:"stat-card-value",children:r.total})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Running"}),e.jsx("span",{className:"stat-card-value",style:{color:"#007AFF"},children:r.running})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Passed"}),e.jsx("span",{className:"stat-card-value",style:{color:"#34C759"},children:r.passed})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Failed"}),e.jsx("span",{className:"stat-card-value",style:{color:"#FF3B30"},children:r.failed})]})]}),e.jsx("div",{className:"ios-card",style:{overflow:"hidden"},children:e.jsx(xe,{columns:a,dataSource:t,rowKey:"id",loading:s,pagination:{pageSize:15,showSizeChanger:!1},scroll:{x:900},locale:{emptyText:e.jsx(ne,{image:e.jsx(ir,{size:48,style:{color:"#8E8E93",opacity:.4}}),description:e.jsx("span",{style:{color:"#8E8E93"},children:"No test runs yet. Runs will appear here once tasks are executed."})})}})}),r.total>0&&e.jsxs("div",{className:"ios-card",style:{marginTop:16,padding:"14px 20px"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:500,color:"#86868B",marginBottom:8,fontFamily:"Inter, sans-serif"},children:"Result Distribution"}),e.jsxs("div",{style:{display:"flex",height:8,borderRadius:4,overflow:"hidden",background:"#E5E5EA"},children:[e.jsx("div",{style:{width:`${r.passed/n*100}%`,background:"#34C759",transition:"width 0.4s ease"}}),e.jsx("div",{style:{width:`${r.failed/n*100}%`,background:"#FF3B30",transition:"width 0.4s ease"}})]}),e.jsxs("div",{style:{display:"flex",gap:20,marginTop:8,fontSize:12,color:"#86868B",fontFamily:"Inter, sans-serif"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:"#34C759",display:"inline-block"}}),"Passed ",r.passed]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:"#FF3B30",display:"inline-block"}}),"Failed ",r.failed]})]})]})]})}function bu(){var l;const{id:t}=ys(),{data:s,isLoading:r}=xn("run",t,fd);if(r)return e.jsx(qs,{});if(!s)return e.jsx(gn,{entity:"Run"});const n={color:"var(--text-secondary)",fontWeight:500},a={color:"var(--text-primary)"},i=o=>e.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:600,color:"var(--text-primary)"},children:o});return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"page-title",children:["Run ",s.id.slice(0,8)]}),e.jsx("p",{className:"page-subtitle",children:"Detailed execution information"})]}),e.jsx(B,{color:Re[s.status]??"default",style:{fontSize:14,padding:"4px 12px"},children:s.status})]}),e.jsxs(ce,{gutter:[24,24],children:[e.jsx(N,{xs:24,lg:16,children:e.jsx(K,{title:i("Run Overview"),className:"ios-card",children:e.jsxs(Z,{column:{xs:1,sm:2},size:"small",colon:!1,labelStyle:n,contentStyle:a,children:[e.jsx(Z.Item,{label:"Run ID",children:e.jsx("code",{style:{color:"var(--brand-green)",fontSize:13,fontFamily:"var(--font-mono)"},children:s.id})}),e.jsx(Z.Item,{label:"Task",children:s.taskId?e.jsx(Me,{to:`/tasks/${s.taskId}`,mono:!0,children:s.taskId}):"â€”"}),e.jsx(Z.Item,{label:"Status",children:e.jsx(B,{color:Re[s.status]??"default",children:s.status})}),e.jsx(Z.Item,{label:"Result",children:s.result??"â€”"}),e.jsx(Z.Item,{label:"Vehicles",children:((l=s.vehicleIds)==null?void 0:l.length)??0}),e.jsx(Z.Item,{label:"Started",children:s.startedAt?new Date(s.startedAt).toLocaleString():"â€”"}),e.jsx(Z.Item,{label:"Completed",children:s.completedAt?new Date(s.completedAt).toLocaleString():"â€”"})]})})}),e.jsx(N,{xs:24,lg:8,children:e.jsx(K,{title:i("Timeline"),className:"ios-card",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:"var(--ios-green)",flexShrink:0}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)",fontWeight:500},children:"Started"}),e.jsx("div",{style:{fontSize:13,color:"var(--text-primary)"},children:s.startedAt?new Date(s.startedAt).toLocaleString():"â€”"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:s.completedAt?"var(--ios-blue)":"var(--text-muted)",flexShrink:0}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)",fontWeight:500},children:"Completed"}),e.jsx("div",{style:{fontSize:13,color:"var(--text-primary)"},children:s.completedAt?new Date(s.completedAt).toLocaleString():"â€”"})]})]})]})})})]})]})}const Su={Critical:"#FF3B30",Blocker:"#FF3B30",High:"#FF9500",Medium:"#FFCC00",Low:"#007AFF",Trivial:"#8E8E93"};function ku(){const[t,s]=h.useState(""),[r,n]=h.useState(),[a,i]=h.useState(),{data:l,isLoading:o}=$({queryKey:["issues"],queryFn:()=>kd()}),p=l==null?void 0:l.filter(c=>!(t&&!c.title.toLowerCase().includes(t.toLowerCase())||r&&c.status!==r||a&&c.severity!==a)),d=h.useMemo(()=>{if(!l)return{open:0,inProgress:0,resolved:0,total:0};const c=new Set(["New","Triage","Assigned","Reopened"]),g=new Set(["InProgress"]),f=new Set(["Fixed","Closed","Rejected","RegressionTracking"]);return{open:l.filter(k=>c.has(k.status)).length,inProgress:l.filter(k=>g.has(k.status)).length,resolved:l.filter(k=>f.has(k.status)).length,total:l.length}},[l]),u=[{title:"Title",dataIndex:"title",key:"title",ellipsis:!0,render:(c,g)=>e.jsx(Me,{to:`/issues/${g.id}`,children:c})},{title:"Status",dataIndex:"status",key:"status",width:150,render:c=>e.jsx(B,{color:Re[c]??"default",children:c})},{title:"Severity",dataIndex:"severity",key:"severity",width:130,render:c=>e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:Su[c]??"#8E8E93",flexShrink:0}}),e.jsx(B,{color:Vr[c]??"default",style:{margin:0},children:c})]})},{title:"Assignee",dataIndex:"assignee",key:"assignee",width:140,render:c=>c??e.jsx(he,{})},{title:"Updated",dataIndex:"updatedAt",key:"updatedAt",width:140,render:c=>new Date(c).toLocaleDateString()}];return e.jsxs("div",{children:[e.jsx(ct,{title:"Issues",subtitle:"Track defects and issues found during testing",action:e.jsx(O,{type:"primary",icon:e.jsx(Qt,{}),size:"large",className:"btn-primary-green",children:"Report Issue"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16,marginBottom:20},children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Open"}),e.jsx("span",{className:"stat-card-value",style:{color:"#FF9500"},children:d.open})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"In Progress"}),e.jsx("span",{className:"stat-card-value",style:{color:"#007AFF"},children:d.inProgress})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Resolved"}),e.jsx("span",{className:"stat-card-value",style:{color:"#34C759"},children:d.resolved})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:"Total"}),e.jsx("span",{className:"stat-card-value",children:d.total})]})]}),e.jsxs(ee,{direction:"vertical",size:12,style:{width:"100%"},children:[e.jsxs(ee,{wrap:!0,children:[e.jsx(G,{placeholder:"Search issues...",prefix:e.jsx(cr,{style:{color:"#8E8E93"}}),value:t,onChange:c=>s(c.target.value),allowClear:!0,style:{width:280}}),e.jsx(se,{placeholder:"Status",allowClear:!0,value:r,onChange:n,style:{width:160},options:[{value:"New",label:"New"},{value:"Triage",label:"Triage"},{value:"Assigned",label:"Assigned"},{value:"InProgress",label:"In Progress"},{value:"Fixed",label:"Fixed"},{value:"RegressionTracking",label:"Regression"},{value:"Closed",label:"Closed"},{value:"Reopened",label:"Reopened"},{value:"Rejected",label:"Rejected"}]}),e.jsx(se,{placeholder:"Severity",allowClear:!0,value:a,onChange:i,style:{width:140},options:[{value:"Critical",label:"Critical"},{value:"High",label:"High"},{value:"Medium",label:"Medium"},{value:"Low",label:"Low"},{value:"Trivial",label:"Trivial"}]})]}),e.jsx("div",{className:"ios-card",style:{overflow:"hidden"},children:e.jsx(xe,{columns:u,dataSource:p,rowKey:"id",loading:o,pagination:{pageSize:15,showSizeChanger:!1},size:"small",locale:{emptyText:e.jsx(ne,{image:e.jsx(Cc,{size:48,style:{color:"#8E8E93",opacity:.4}}),description:e.jsx("span",{style:{color:"#8E8E93"},children:"No issues reported. Issues from test runs will appear here."})})}})})]})]})}const sa=["#007AFF","#34C759","#FF9500","#AF52DE","#5AC8FA","#FF3B30","#FFCC00","#6E6E73"],Cu={Triage:"btn-triage",Assigned:"btn-assigned",InProgress:"btn-in-progress",Fixed:"btn-fixed",RegressionTracking:"btn-regression",Closed:"btn-closed",Reopened:"btn-reopened",Rejected:"btn-rejected"};function _u({channel:t}){const{chartData:s,valueKeys:r}=h.useMemo(()=>{const n=new Set;return{chartData:t.data_points.map(i=>{const l={t:i.t/1e3};for(const[o,p]of Object.entries(i.values))typeof p=="number"&&(l[o]=p,n.add(o));return l}),valueKeys:Array.from(n)}},[t.data_points]);return r.length===0?e.jsx(ne,{description:"No numeric data",image:ne.PRESENTED_IMAGE_SIMPLE}):e.jsx(Lt,{width:"100%",height:250,children:e.jsxs(wa,{data:s,children:[e.jsx(hs,{strokeDasharray:"3 3",stroke:"var(--border-secondary)"}),e.jsx(Ct,{dataKey:"t",tick:{fill:"var(--text-muted)",fontSize:11},unit:"s"}),e.jsx(Je,{tick:{fill:"var(--text-muted)",fontSize:11}}),e.jsx(ze,{contentStyle:{background:"var(--bg-surface)",border:"1px solid var(--border-secondary)",borderRadius:10,boxShadow:"var(--shadow-md)"},labelStyle:{color:"var(--text-muted)"}}),e.jsx(ot,{}),r.map((n,a)=>e.jsx(Xr,{type:"monotone",dataKey:n,stroke:sa[a%sa.length],dot:!1,strokeWidth:1.5},n))]})})}const wu={New:["Triage","Rejected"],Triage:["Assigned","Rejected"],Assigned:["InProgress"],InProgress:["Fixed"],Fixed:["RegressionTracking"],RegressionTracking:["Closed","Reopened"],Reopened:["InProgress"],Closed:[],Rejected:[]},Ue=t=>e.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:600,fontSize:"1rem",color:"var(--text-primary)",letterSpacing:"-0.01em"},children:t});function De({label:t,children:s}){return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid var(--border-secondary)"},children:[e.jsx("span",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",fontWeight:500},children:t}),e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-primary)",fontWeight:500,textAlign:"right",maxWidth:"60%"},children:s})]})}function Ve({label:t,value:s}){return e.jsxs("div",{style:{textAlign:"center",padding:"12px 8px"},children:[e.jsx("div",{style:{fontSize:"1.125rem",fontWeight:700,fontFamily:"var(--font-mono)",color:"var(--text-primary)"},children:s??"â€”"}),e.jsx("div",{style:{fontSize:"0.6875rem",color:"var(--text-muted)",marginTop:2,fontWeight:500,textTransform:"uppercase",letterSpacing:"0.04em"},children:t})]})}function Fu(){var _,S,w,T,y,I,E,C;const{id:t}=ys(),s=We(),[r,n]=h.useState(!1),[a]=M.useForm(),[i,l]=h.useState(""),{data:o,isLoading:p,error:d}=$({queryKey:["issue",t],queryFn:()=>Cd(t),enabled:!!t}),{data:u}=$({queryKey:["issue-transitions",t],queryFn:()=>Fd(t),enabled:!!t}),c=ye({mutationFn:({toStatus:x,reason:P})=>_d(t,{to_status:x,triggered_by:"ui-user",reason:P}),onSuccess:()=>{s.invalidateQueries({queryKey:["issue",t]}),s.invalidateQueries({queryKey:["issue-transitions",t]}),l("")}}),g=ye({mutationFn:x=>wd(t,x),onSuccess:()=>{s.invalidateQueries({queryKey:["issue",t]}),s.invalidateQueries({queryKey:["issue-transitions",t]}),n(!1),a.resetFields()}}),{data:f}=$({queryKey:["issue-snapshot",t],queryFn:()=>Ld(t),enabled:!!t}),{data:k}=$({queryKey:["issue-timeseries",t],queryFn:()=>Dd(t),enabled:!!t}),j=h.useMemo(()=>{if(!k)return{};const x={};for(const P of k){const D=P.channel_type||"other";(x[D]??(x[D]=[])).push(P)}return x},[k]);if(p)return e.jsx(qs,{});if(d||!o)return e.jsx(Ut,{type:"error",message:"Failed to load issue",showIcon:!0,style:{borderRadius:12}});const b=o.status,v=wu[b]??[],R=b==="Triage";return e.jsxs("div",{style:{maxWidth:1280,margin:"0 auto"},children:[e.jsxs(lt,{to:"/issues",style:{display:"inline-flex",alignItems:"center",gap:6,color:"var(--text-secondary)",marginBottom:20,fontSize:13,fontWeight:500},children:[e.jsx(Jr,{})," Back to Issues"]}),e.jsx("div",{className:"ios-card",style:{padding:"20px 24px",marginBottom:24},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:10,background:"rgba(255, 59, 48, 0.08)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ii,{size:20,style:{color:"var(--ios-red)"}})}),e.jsxs("div",{children:[e.jsxs("h1",{style:{fontFamily:"var(--font-display)",fontSize:"1.25rem",fontWeight:700,color:"var(--text-primary)",margin:0,letterSpacing:"-0.01em"},children:["Issue ",o.id.slice(0,12)]}),e.jsx("code",{style:{fontSize:11,color:"var(--text-muted)"},children:o.id})]})]}),e.jsxs(ee,{size:8,children:[e.jsx(B,{color:Vr[o.severity]??"default",style:{fontSize:13,padding:"2px 12px",borderRadius:9999},children:o.severity}),e.jsx(B,{color:Re[b]??"default",style:{fontSize:13,padding:"2px 12px",borderRadius:9999},children:b})]})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 380px",gap:24,alignItems:"start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24,minWidth:0},children:[o.description&&e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[Ue("Description"),e.jsx("p",{style:{marginTop:12,color:"var(--text-secondary)",fontSize:"0.9rem",lineHeight:1.7},children:o.description})]}),(o.triageMode||o.triageHint)&&e.jsx("div",{className:"hint-box",children:e.jsxs("dl",{style:{display:"flex",flexDirection:"column",gap:6,margin:0},children:[e.jsx("dt",{children:"Triage Hints"}),o.triageMode&&e.jsxs("dd",{children:["Mode: ",e.jsx("strong",{children:o.triageMode})]}),o.triageHint&&e.jsxs("dd",{children:["Hint: ",e.jsx("strong",{children:o.triageHint})]})]})}),v.length>0&&e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[Ue("Transition"),e.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:13,margin:"12px 0 16px"},children:["Current: ",e.jsx(B,{color:Re[b],children:b})," â€” Choose next state:"]}),e.jsx(G,{placeholder:"Reason (optional)",value:i,onChange:x=>l(x.target.value),style:{marginBottom:16,maxWidth:400,borderRadius:8}}),e.jsx(ee,{wrap:!0,children:v.map(x=>R&&x==="Assigned"?e.jsx(Yr,{title:"Assign owner and module",children:e.jsx("button",{className:"btn-primary-green",onClick:()=>n(!0),children:"Assign (Triage)"})},x):e.jsx(O,{className:Cu[x]??"",onClick:()=>c.mutate({toStatus:x,reason:i||void 0}),loading:c.isPending,style:{borderRadius:9999,fontWeight:500},children:x},x))}),c.isError&&e.jsx(Ut,{type:"error",message:"Transition failed",style:{marginTop:12,borderRadius:8}})]}),e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[Ue("Audit Trail"),e.jsx("div",{style:{marginTop:16},children:u!=null&&u.items&&u.items.length>0?e.jsx("div",{children:u.items.map((x,P)=>e.jsxs("div",{className:"audit-trail-item",children:[e.jsx("div",{className:"audit-trail-dot",children:e.jsx(Ii,{})}),e.jsxs("div",{children:[e.jsxs(ee,{size:4,children:[e.jsx(B,{color:Re[x.fromStatus]??"default",style:{fontSize:11},children:x.fromStatus}),e.jsx("span",{style:{color:"var(--text-muted)"},children:"â†’"}),e.jsx(B,{color:Re[x.toStatus]??"default",style:{fontSize:11},children:x.toStatus})]}),e.jsxs("div",{className:"audit-trail-meta",children:["by ",x.triggeredBy," Â· ",x.transitionedAt?new Date(x.transitionedAt).toLocaleString():"â€”"]}),x.reason&&e.jsxs("div",{className:"audit-trail-reason",children:["â€œ",x.reason,"â€"]})]})]},P))}):e.jsx("div",{style:{color:"var(--text-muted)",fontSize:13},children:"No transitions recorded yet."})})]}),e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[Ue("Vehicle Dynamics Snapshot"),f?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:1,marginTop:16,background:"var(--border-secondary)",borderRadius:8,overflow:"hidden"},children:[e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(Ve,{label:"Speed (m/s)",value:(_=f.speed_mps)==null?void 0:_.toFixed(2)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(Ve,{label:"Accel (m/sÂ²)",value:(S=f.acceleration_mps2)==null?void 0:S.toFixed(3)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(Ve,{label:"Lat Accel (m/sÂ²)",value:(w=f.lateral_acceleration_mps2)==null?void 0:w.toFixed(3)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(Ve,{label:"Yaw (Â°/s)",value:(T=f.yaw_rate_dps)==null?void 0:T.toFixed(2)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(Ve,{label:"Heading (Â°)",value:(y=f.heading_deg)==null?void 0:y.toFixed(2)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(Ve,{label:"Steering (Â°)",value:(I=f.steering_angle_deg)==null?void 0:I.toFixed(2)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(Ve,{label:"Throttle (%)",value:(E=f.throttle_pct)==null?void 0:E.toFixed(1)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(Ve,{label:"Brake (bar)",value:(C=f.brake_pressure_bar)==null?void 0:C.toFixed(2)})}),e.jsx("div",{style:{background:"var(--bg-surface)"},children:e.jsx(Ve,{label:"Gear",value:f.gear})}),e.jsx("div",{style:{background:"var(--bg-surface)",gridColumn:"span 2"},children:e.jsx(Ve,{label:"Quaternion",value:f.quaternion?`${f.quaternion.w.toFixed(3)}, ${f.quaternion.x.toFixed(3)}, ${f.quaternion.y.toFixed(3)}, ${f.quaternion.z.toFixed(3)}`:null})})]}):e.jsx(ne,{description:"No snapshot data",image:ne.PRESENTED_IMAGE_SIMPLE,style:{marginTop:16}})]}),k&&k.length>0&&e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[Ue("Time-Series Data"),e.jsx("div",{style:{marginTop:16},children:e.jsx(Sa,{items:Object.entries(j).map(([x,P])=>({key:x,label:e.jsx(B,{children:x}),children:e.jsx(ee,{direction:"vertical",size:16,style:{width:"100%"},children:P.map(D=>e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text-secondary)",marginBottom:8},children:D.channel}),e.jsx(_u,{channel:D})]},D.channel))})}))})})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[Ue("Properties"),e.jsxs("div",{style:{marginTop:12},children:[e.jsx(De,{label:"Severity",children:e.jsx(B,{color:Vr[o.severity]??"default",style:{margin:0},children:o.severity})}),e.jsx(De,{label:"Status",children:e.jsx(B,{color:Re[b]??"default",style:{margin:0},children:b})}),e.jsx(De,{label:"Assignee",children:o.assignee??"â€”"}),e.jsx(De,{label:"Module",children:o.module??"â€”"}),e.jsx(De,{label:"Category",children:o.category??"â€”"}),e.jsx(De,{label:"Takeover Type",children:o.takeoverType??"â€”"}),o.gpsLat!=null&&o.gpsLng!=null&&e.jsx(De,{label:"GPS",children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[e.jsx(Ti,{style:{color:"var(--ios-blue)",fontSize:12}}),e.jsxs("code",{style:{fontSize:12},children:[Number(o.gpsLat).toFixed(6),", ",Number(o.gpsLng).toFixed(6)]})]})}),e.jsx(De,{label:"Triggered At",children:o.triggerTimestamp?new Date(o.triggerTimestamp).toLocaleString():"â€”"}),e.jsx(De,{label:"Created",children:o.createdAt?new Date(o.createdAt).toLocaleString():"â€”"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0"},children:[e.jsx("span",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",fontWeight:500},children:"Updated"}),e.jsx("span",{style:{fontSize:"0.875rem",color:"var(--text-primary)",fontWeight:500},children:o.updatedAt?new Date(o.updatedAt).toLocaleString():"â€”"})]})]})]}),e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[Ue("Related"),e.jsxs("div",{style:{marginTop:12},children:[e.jsx(De,{label:"Run",children:o.runId?e.jsxs(lt,{to:`/runs/${o.runId}`,style:{color:"var(--brand-green)",fontWeight:500,fontSize:13},children:[o.runId.slice(0,8),"â€¦"]}):"â€”"}),o.dataSnapshotUri&&e.jsx(De,{label:"Snapshot",children:e.jsxs("a",{href:o.dataSnapshotUri,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--ios-blue)",fontWeight:500,fontSize:13},children:["View ",e.jsx(Ei,{})]})})]})]}),o.faultCodes&&o.faultCodes.length>0&&e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[Ue("Fault Codes"),e.jsx("div",{style:{marginTop:12,display:"flex",flexWrap:"wrap",gap:6},children:o.faultCodes.map(x=>e.jsx("span",{className:"chip chip-red",children:x},x))})]}),o.environmentTags&&o.environmentTags.length>0&&e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[Ue("Environment Tags"),e.jsx("div",{style:{marginTop:12,display:"flex",flexWrap:"wrap",gap:6},children:o.environmentTags.map(x=>e.jsx("span",{className:"chip chip-gray",children:x},x))})]}),e.jsxs("div",{className:"ios-card",style:{padding:"20px 24px"},children:[Ue("Attachments"),e.jsx("div",{style:{marginTop:12,color:"var(--text-muted)",fontSize:13},children:"No attachments yet."})]})]})]}),e.jsx(us,{title:"Triage Assignment",open:r,onCancel:()=>n(!1),onOk:()=>a.submit(),confirmLoading:g.isPending,okText:"Assign & Transition",children:e.jsxs(M,{form:a,layout:"vertical",onFinish:x=>g.mutate(x),children:[e.jsx(M.Item,{name:"assignee",label:"Assign To",rules:[{required:!0,message:"Please enter assignee"}],children:e.jsx(G,{placeholder:"Developer name"})}),e.jsx(M.Item,{name:"module",label:"Module",rules:[{required:!0,message:"Please enter module"}],children:e.jsx(G,{placeholder:"e.g. perception, planning"})})]})})]})}const ds=["#76B900","#007AFF","#FF9500","#34C759","#AF52DE","#5AC8FA","#FF3B30","#FFCC00","#FF2D55","#00C7BE"],ke="rgba(0,0,0,0.06)",Ie="#6E6E73",vs={contentStyle:{background:"#FFFFFF",border:"1px solid #E5E5EA",borderRadius:12,backdropFilter:"blur(20px)",color:"#1D1D1F",fontFamily:"'Fira Code', monospace",fontSize:11,boxShadow:"0 4px 12px rgba(0,0,0,0.08)"}};function Ae(t,s){return t.color||ds[s%ds.length]}function Ru(t){return t.some(s=>s.axisId==="right")}function vn({thresholds:t}){return!t||t.length===0?null:e.jsx(e.Fragment,{children:t.map((s,r)=>e.jsx(Ji,{y:s.value,yAxisId:"left",stroke:s.color||"#ff0044",strokeDasharray:"6 3",strokeWidth:1.5,label:{value:s.label??`${s.value}`,fill:s.color||"#ff0044",fontSize:10,position:"right"}},r))})}function jn({xField:t,yFields:s,children:r,thresholds:n}){const a=Ru(s);return e.jsxs(e.Fragment,{children:[e.jsx(hs,{strokeDasharray:"3 3",stroke:ke}),e.jsx(Ct,{dataKey:t,tick:{fontSize:11,fill:Ie},stroke:ke}),e.jsx(Je,{yAxisId:"left",tick:{fontSize:11,fill:Ie},stroke:ke}),a&&e.jsx(Je,{yAxisId:"right",orientation:"right",tick:{fontSize:11,fill:Ie},stroke:ke}),e.jsx(ze,{...vs}),e.jsx(ot,{}),e.jsx(vn,{thresholds:n}),r]})}function Iu({data:t,xField:s,yFields:r,thresholds:n}){return e.jsx(Zs,{data:t,children:e.jsx(jn,{xField:s,yFields:r,thresholds:n,children:r.map((a,i)=>e.jsx(ls,{dataKey:a.key,name:a.label||a.key,fill:Ae(a,i),yAxisId:a.axisId||"left",radius:[6,6,0,0],fillOpacity:.85},a.key))})})}function Tu({data:t,xField:s,yFields:r,thresholds:n}){return e.jsx(wa,{data:t,children:e.jsx(jn,{xField:s,yFields:r,thresholds:n,children:r.map((a,i)=>e.jsx(Xr,{type:"monotone",dataKey:a.key,name:a.label||a.key,stroke:Ae(a,i),yAxisId:a.axisId||"left",strokeWidth:2,dot:{r:3,fill:Ae(a,i)},activeDot:{r:5,stroke:Ae(a,i),filter:`drop-shadow(0 0 4px ${Ae(a,i)})`}},a.key))})})}function Eu({data:t,xField:s,yFields:r,thresholds:n}){return e.jsxs(Fa,{data:t,children:[e.jsx("defs",{children:r.map((a,i)=>{const l=Ae(a,i);return e.jsxs("linearGradient",{id:`areaGrad-${a.key}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:l,stopOpacity:.3}),e.jsx("stop",{offset:"100%",stopColor:l,stopOpacity:0})]},a.key)})}),e.jsx(jn,{xField:s,yFields:r,thresholds:n,children:r.map((a,i)=>e.jsx(Fr,{type:"monotone",dataKey:a.key,name:a.label||a.key,stroke:Ae(a,i),fill:`url(#areaGrad-${a.key})`,yAxisId:a.axisId||"left",strokeWidth:2},a.key))})]})}function Pu({data:t,xField:s,yFields:r}){var n,a,i;return e.jsxs(Qi,{children:[e.jsx(hs,{strokeDasharray:"3 3",stroke:ke}),e.jsx(Ct,{dataKey:s,name:s,tick:{fontSize:11,fill:Ie},stroke:ke}),e.jsx(Je,{dataKey:(n=r[0])==null?void 0:n.key,name:((a=r[0])==null?void 0:a.label)||((i=r[0])==null?void 0:i.key),tick:{fontSize:11,fill:Ie},stroke:ke}),e.jsx(ze,{...vs}),e.jsx(ot,{}),r.map((l,o)=>e.jsx(Gi,{name:l.label||l.key,data:t,fill:Ae(l,o),fillOpacity:.7},l.key))]})}function Au({data:t,xField:s,yFields:r}){var a;const n=((a=r[0])==null?void 0:a.key)??"value";return e.jsxs(dr,{children:[e.jsx(ze,{...vs}),e.jsx(ot,{}),e.jsx(ur,{data:t,dataKey:n,nameKey:s||"name",cx:"50%",cy:"50%",innerRadius:"40%",outerRadius:"75%",strokeWidth:1,stroke:"rgba(0,0,0,0.06)",label:({name:i,percent:l})=>`${i} ${(l*100).toFixed(0)}%`,children:t.map((i,l)=>e.jsx(os,{fill:ds[l%ds.length],fillOpacity:.85},l))})]})}function zu({data:t,yFields:s}){var o,p,d;const r=Number(((p=t[0])==null?void 0:p[((o=s[0])==null?void 0:o.key)??"value"])??0),a=Math.min(100,Math.max(0,r/100*100)),i=a>=80?"#34d399":a>=50?"#fbbf24":"#f87171",l=[{name:"value",value:a},{name:"remaining",value:100-a}];return e.jsxs(dr,{children:[e.jsxs(ur,{data:l,cx:"50%",cy:"70%",startAngle:180,endAngle:0,innerRadius:"60%",outerRadius:"85%",dataKey:"value",strokeWidth:0,children:[e.jsx(os,{fill:i}),e.jsx(os,{fill:"rgba(0,0,0,0.04)"})]}),e.jsx("text",{x:"50%",y:"62%",textAnchor:"middle",fill:i,style:{fontSize:24,fontFamily:"'Fira Code', monospace",fontWeight:700},children:r.toFixed(1)}),e.jsx("text",{x:"50%",y:"78%",textAnchor:"middle",fill:"#6E6E73",style:{fontSize:11,fontFamily:"'Fira Code', monospace"},children:((d=s[0])==null?void 0:d.label)||"Value"})]})}function Mu({data:t,xField:s,yFields:r}){return e.jsxs(Ki,{data:t,cx:"50%",cy:"50%",outerRadius:"75%",children:[e.jsx(Wi,{stroke:ke}),e.jsx(Ui,{dataKey:s,tick:{fontSize:11,fill:Ie}}),e.jsx(Vi,{tick:{fontSize:10,fill:Ie}}),e.jsx(ze,{...vs}),e.jsx(ot,{}),r.map((n,a)=>e.jsx(Hi,{name:n.label||n.key,dataKey:n.key,stroke:Ae(n,a),fill:Ae(n,a),fillOpacity:.2,strokeWidth:2},n.key))]})}function Nu({data:t,xField:s,yFields:r,thresholds:n}){return e.jsxs(qi,{data:t,children:[e.jsx(hs,{strokeDasharray:"3 3",stroke:ke}),e.jsx(Ct,{dataKey:s,tick:{fontSize:11,fill:Ie},stroke:ke}),e.jsx(Je,{yAxisId:"left",tick:{fontSize:11,fill:Ie},stroke:ke}),e.jsx(Je,{yAxisId:"right",orientation:"right",tick:{fontSize:11,fill:Ie},stroke:ke}),e.jsx(ze,{...vs}),e.jsx(ot,{}),e.jsx(vn,{thresholds:n}),r.map((a,i)=>{const l=a.axisId||(i===0?"left":"right");return i===0?e.jsx(ls,{dataKey:a.key,name:a.label||a.key,fill:Ae(a,i),yAxisId:l,radius:[6,6,0,0],fillOpacity:.85},a.key):e.jsx(Xr,{type:"monotone",dataKey:a.key,name:a.label||a.key,stroke:Ae(a,i),yAxisId:l,strokeWidth:2,dot:{r:3}},a.key)})]})}function Ou({data:t,xField:s,yFields:r}){var l,o;const n=((l=r[0])==null?void 0:l.key)??"value",a=[...t].sort((p,d)=>Number(d[n]??0)-Number(p[n]??0)),i=Number(((o=a[0])==null?void 0:o[n])??1);return e.jsx("div",{style:{padding:"20px 0"},children:a.map((p,d)=>{const u=Number(p[n]??0),c=Math.max(10,u/i*100),g=ds[d%ds.length];return e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:8,justifyContent:"center"},children:[e.jsx("span",{style:{width:100,textAlign:"right",paddingRight:12,fontSize:11,color:Ie,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontFamily:"'Fira Code', monospace"},children:String(p[s||"name"]??`Step ${d+1}`)}),e.jsx("div",{style:{width:`${c}%`,maxWidth:400,height:28,background:g,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",color:"#000",fontSize:10,fontWeight:700,opacity:.85,transition:"width 0.3s ease",fontFamily:"'Fira Code', monospace"},children:u})]},d)})})}function Lu({data:t,xField:s,yFields:r,thresholds:n}){var o,p;const a=((o=r[0])==null?void 0:o.key)??"value";let i=0;const l=t.map(d=>{const u=Number(d[a]??0),c=i;return i+=u,{...d,_wf_start:c,_wf_end:i,_wf_value:u}});return e.jsxs(Zs,{data:l,children:[e.jsx(hs,{strokeDasharray:"3 3",stroke:ke}),e.jsx(Ct,{dataKey:s,tick:{fontSize:11,fill:Ie},stroke:ke}),e.jsx(Je,{yAxisId:"left",tick:{fontSize:11,fill:Ie},stroke:ke}),e.jsx(ze,{...vs}),e.jsx(ot,{}),e.jsx(vn,{thresholds:n}),e.jsx(ls,{dataKey:"_wf_start",stackId:"wf",fill:"transparent",yAxisId:"left"}),e.jsx(ls,{dataKey:"_wf_value",stackId:"wf",name:((p=r[0])==null?void 0:p.label)||a,yAxisId:"left",radius:[6,6,0,0],children:l.map((d,u)=>e.jsx(os,{fill:Number(d._wf_value)>=0?"#34d399":"#f87171",fillOpacity:.85},u))})]})}const Du={bar:Iu,line:Tu,area:Eu,scatter:Pu,pie:Au,gauge:zu,radar:Mu,dual_axes:Nu,funnel:Ou,waterfall:Lu};function Bu(t){const{chartType:s,data:r,title:n}=t,a=Du[s];return!a||!r.length?e.jsx(K,{className:"ios-card",children:e.jsx(ne,{description:r.length===0?"No data":`Unknown chart type: ${s}`})}):e.jsx(K,{className:"ios-card",title:n?e.jsx("span",{className:"font-display",style:{fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em"},children:n}):void 0,children:e.jsx(Lt,{width:"100%",height:340,children:e.jsx(a,{...t})})})}function ra({title:t,value:s,unit:r,loading:n}){return e.jsx(K,{className:"ios-card",style:{height:"100%"},children:n?e.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:e.jsx(Kt,{})}):e.jsx(Vt,{title:e.jsx("span",{className:"font-display",style:{fontWeight:600,fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em"},children:t}),value:s??void 0,precision:2,suffix:r?e.jsx("span",{style:{fontSize:12,color:"var(--text-muted)"},children:r}):void 0,valueStyle:{fontFamily:"var(--font-mono)",fontWeight:700,color:"var(--accent-strong)"},formatter:a=>a==null?"â€”":String(a)})})}function $u({groups:t,title:s}){const r=h.useMemo(()=>{const a=new Set;return t.forEach(l=>Object.keys(l.group).forEach(o=>a.add(o))),[...[...a].map(l=>({title:e.jsx("span",{style:{fontFamily:"var(--font-mono)"},children:l}),dataIndex:["group",l],key:l,render:o=>String(o??"â€”")})),{title:e.jsx("span",{style:{fontFamily:"var(--font-mono)"},children:"Value"}),dataIndex:"value",key:"_value",align:"right",render:l=>e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontWeight:600,color:"var(--accent-strong)"},children:l.toLocaleString(void 0,{maximumFractionDigits:2})})}]},[t]),n=h.useMemo(()=>t.map((a,i)=>({...a,_key:String(i)})),[t]);return e.jsx(K,{className:"ios-card",title:s?e.jsx("span",{className:"font-display",style:{fontWeight:600},children:s}):void 0,children:e.jsx(xe,{dataSource:n,columns:r,rowKey:"_key",pagination:t.length>20?{pageSize:20,size:"small"}:!1,size:"small"})})}function fi(t,s=""){return t.map(r=>{const n=s?`${s}.${r.name}`:r.name,a=r.children&&r.children.length>0;return{title:`${r.name} (${r.type})`,value:n,selectable:!a,children:a?fi(r.children,n):void 0}})}function qu({entity:t,value:s,onChange:r}){const{data:n,isLoading:a}=$({queryKey:["schema-fields",t],queryFn:()=>Bd(t),enabled:!!t}),i=h.useMemo(()=>{if(!n)return[];const l="fields"in n?n:void 0;return l?fi(l.fields):[]},[n]);return e.jsx(Pi,{value:s||void 0,onChange:r,treeData:i,loading:a,placeholder:t?"Select field...":"Choose entity first",disabled:!t,showSearch:!0,treeDefaultExpandAll:!0,style:{width:"100%"},dropdownStyle:{maxHeight:360,overflow:"auto"},popupClassName:"ios-card-elevated"})}const na=[{value:"project",label:"Project"},{value:"task",label:"Task"},{value:"run",label:"Run"},{value:"issue",label:"Issue"},{value:"cross",label:"Cross-Entity"}],Ku=[{value:"sum",label:"Sum"},{value:"avg",label:"Average"},{value:"count",label:"Count"},{value:"min",label:"Min"},{value:"max",label:"Max"},{value:"distinct_count",label:"Distinct Count"},{value:"raw",label:"Raw"},{value:"percentile_50",label:"P50 (Median)"},{value:"percentile_90",label:"P90"},{value:"percentile_99",label:"P99"},{value:"stddev",label:"Std Dev"}],Wu=[{value:"stat",label:"Stat Card"},{value:"table",label:"Table"},{value:"bar",label:"Bar Chart"},{value:"line",label:"Line Chart"},{value:"area",label:"Area Chart"},{value:"scatter",label:"Scatter Plot"},{value:"pie",label:"Pie Chart"},{value:"gauge",label:"Gauge"},{value:"radar",label:"Radar"},{value:"dual_axes",label:"Dual Axes (Bar+Line)"},{value:"funnel",label:"Funnel"},{value:"waterfall",label:"Waterfall"}],Uu=[{label:"+",value:" + ",title:"Add"},{label:"âˆ’",value:" - ",title:"Subtract"},{label:"Ã—",value:" * ",title:"Multiply"},{label:"Ã·",value:" / ",title:"Divide"},{label:"(",value:"(",title:"Open paren"},{label:")",value:")",title:"Close paren"},{label:"âˆš",value:"sqrt(",title:"Square root"},{label:"xÂ²",value:"^2",title:"Square"},{label:"pow",value:"pow(",title:"Power"},{label:"abs",value:"abs(",title:"Absolute value"},{label:"log",value:"log(",title:"Natural log"},{label:"round",value:"round(",title:"Round"},{label:"ceil",value:"ceil(",title:"Ceiling"},{label:"floor",value:"floor(",title:"Floor"},{label:"min",value:"min(",title:"Minimum"},{label:"max",value:"max(",title:"Maximum"}],Vu=[{name:"Issue Count by Category (Bar)",template:{name:"Issue Count by Category",data_source:"issue",formula:"issue_count",variables:[{name:"issue_count",source_entity:"issue",field:"issue_id",aggregation:"count"}],visualization:{chart_type:"bar",x_axis:{field:"category"},y_axes:[{variable:"value",label:"Issues"}]}}},{name:"Issue Severity Distribution (Pie)",template:{name:"Issue Severity Distribution",data_source:"issue",formula:"severity_count",variables:[{name:"severity_count",source_entity:"issue",field:"issue_id",aggregation:"count"}],visualization:{chart_type:"pie",x_axis:{field:"severity"},y_axes:[{variable:"value",label:"Count"}]}}},{name:"Total Mileage by Task (Bar)",template:{name:"Total Mileage by Task",data_source:"run",formula:"total_km",variables:[{name:"total_km",source_entity:"run",field:"total_auto_mileage_km",aggregation:"sum"}],visualization:{chart_type:"bar",x_axis:{field:"task_id"},y_axes:[{variable:"value",label:"Mileage (km)"}]}}},{name:"Fleet Utilization Gauge",template:{name:"Fleet Utilization",data_source:"run",formula:"utilization",variables:[{name:"utilization",source_entity:"run",field:"total_auto_mileage_km",aggregation:"avg"}],visualization:{chart_type:"gauge",y_axes:[{variable:"value",label:"Utilization %"}]}}}],Hu=[{value:"left",label:"Left"},{value:"right",label:"Right"}],je={fontFamily:"var(--font-mono)",fontWeight:500};function Vs(){return{name:"",source_entity:"",field:"",aggregation:"count"}}function Hs(){return{variable:"",label:"",color:"",axis_id:"left"}}function Qu({open:t,onClose:s,onSaved:r,editingDef:n}){const[a]=M.useForm(),[i,l]=h.useState(!1),[o,p]=h.useState(!1),[d,u]=h.useState(null),[c,g]=h.useState([Vs()]),[f,k]=h.useState([Hs()]),[j,b]=h.useState("issue"),[v,R]=h.useState([]);h.useEffect(()=>{var C,x;t&&(n?(a.setFieldsValue({name:n.name,description:n.description,data_source:n.data_source,formula:n.formula,chart_type:n.visualization.chart_type,x_axis_field:(C=n.visualization.x_axis)==null?void 0:C.field}),b(n.data_source),g(n.variables.length>0?n.variables.map(P=>({...P})):[Vs()]),k(n.visualization.y_axes&&n.visualization.y_axes.length>0?n.visualization.y_axes.map(P=>({variable:P.variable,label:P.label??"",color:P.color??"",axis_id:P.axis_id??"left"})):[Hs()]),R(((x=n.visualization.thresholds)==null?void 0:x.map(P=>({value:P.value,label:P.label??"",color:P.color??"#ef4444"})))??[])):(a.resetFields(),g([Vs()]),k([Hs()]),R([]),b("issue"),u(null)))},[t,n,a]);const _=(C,x)=>{g(P=>P.map((D,Y)=>Y===C?{...D,...x}:D))},S=C=>{g(x=>x.length<=1?x:x.filter((P,D)=>D!==C))},w=(C,x)=>{k(P=>P.map((D,Y)=>Y===C?{...D,...x}:D))},T=C=>{k(x=>x.length<=1?x:x.filter((P,D)=>D!==C))},y=()=>{const C=a.getFieldsValue();return{name:C.name,description:C.description,data_source:C.data_source,formula:C.formula,variables:c.filter(x=>x.name&&x.field),visualization:{chart_type:C.chart_type||"stat",x_axis:C.x_axis_field?{field:C.x_axis_field}:void 0,y_axes:f.filter(x=>x.variable).map(x=>({variable:x.variable,label:x.label||void 0,color:x.color||void 0,axis_id:x.axis_id||void 0})),thresholds:v.length>0?v.filter(x=>x.value!=null).map(x=>({value:x.value,label:x.label||void 0,color:x.color||"#ef4444"})):void 0,format:C.format_suffix?{suffix:C.format_suffix,precision:C.format_precision}:void 0},enabled:!0}},I=async()=>{try{const C=a.getFieldsValue();if(!C.formula){te.warning("Enter a formula first");return}p(!0);const x=await Vd({formula:C.formula,variables:c.filter(P=>P.name&&P.field)});u(x)}catch(C){const x=C instanceof Error?C.message:"Preview failed";te.error(x)}finally{p(!1)}},E=async()=>{try{await a.validateFields(),l(!0);const C=y();n?(await Kd(n.kpi_id,C),te.success("KPI definition updated")):(await qd(C),te.success("KPI definition created")),r(),s()}catch(C){if(C&&typeof C=="object"&&"errorFields"in C)return;const x=C instanceof Error?C.message:"Save failed";te.error(x)}finally{l(!1)}};return e.jsx(us,{open:t,onCancel:s,title:e.jsx("span",{className:"font-display",style:{fontWeight:600},children:n?"Edit KPI Definition":"New KPI Definition"}),width:780,footer:e.jsxs(ee,{children:[e.jsx(O,{onClick:s,children:"Cancel"}),e.jsx(O,{icon:e.jsx(Ai,{}),onClick:I,loading:o,children:"Preview"}),e.jsx(O,{type:"primary",onClick:E,loading:i,children:n?"Update":"Create"})]}),destroyOnClose:!0,children:e.jsxs(M,{form:a,layout:"vertical",requiredMark:"optional",children:[!n&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{...je,fontSize:12,color:"var(--text-muted)",marginBottom:6},children:"Quick Start from Template"}),e.jsx(ee,{wrap:!0,size:[6,6],children:Vu.map(C=>e.jsx(O,{size:"small",onClick:()=>{var P,D,Y,le;const x=C.template;a.setFieldsValue({name:x.name,data_source:x.data_source,formula:x.formula,chart_type:(P=x.visualization)==null?void 0:P.chart_type,x_axis_field:(Y=(D=x.visualization)==null?void 0:D.x_axis)==null?void 0:Y.field}),x.data_source&&b(x.data_source),x.variables&&g(x.variables.map(de=>({...de}))),(le=x.visualization)!=null&&le.y_axes&&k(x.visualization.y_axes.map(de=>({variable:de.variable??"",label:de.label??"",color:de.color??"",axis_id:de.axis_id??"left"})))},children:C.name},C.name))})]}),e.jsxs(ce,{gutter:16,children:[e.jsx(N,{span:16,children:e.jsx(M.Item,{name:"name",label:e.jsx("span",{style:je,children:"Name"}),rules:[{required:!0,message:"Name is required"}],children:e.jsx(G,{placeholder:"e.g. Issue Resolution Rate"})})}),e.jsx(N,{span:8,children:e.jsx(M.Item,{name:"data_source",label:e.jsx("span",{style:je,children:"Data Source"}),rules:[{required:!0}],initialValue:"issue",children:e.jsx(se,{options:na,onChange:C=>b(C)})})})]}),e.jsx(M.Item,{name:"description",label:e.jsx("span",{style:je,children:"Description"}),children:e.jsx(G.TextArea,{rows:2,placeholder:"What does this KPI measure?"})}),e.jsx(gr,{titlePlacement:"left",style:{...je,fontSize:13},children:"Variables"}),c.map((C,x)=>e.jsx(K,{size:"small",className:"ios-card",style:{marginBottom:12},extra:c.length>1&&e.jsx(O,{type:"text",size:"small",icon:e.jsx(xr,{}),danger:!0,onClick:()=>S(x)}),children:e.jsxs(ce,{gutter:12,children:[e.jsx(N,{span:5,children:e.jsx(G,{placeholder:"Variable name",value:C.name,onChange:P=>_(x,{name:P.target.value})})}),e.jsx(N,{span:5,children:e.jsx(se,{value:C.source_entity||void 0,onChange:P=>_(x,{source_entity:P,field:""}),placeholder:"Entity",options:na,style:{width:"100%"}})}),e.jsx(N,{span:8,children:e.jsx(qu,{entity:C.source_entity||j,value:C.field,onChange:P=>_(x,{field:P})})}),e.jsx(N,{span:6,children:e.jsx(se,{value:C.aggregation,onChange:P=>_(x,{aggregation:P}),options:Ku,style:{width:"100%"}})})]})},x)),e.jsx(O,{type:"dashed",icon:e.jsx(Qt,{}),onClick:()=>g(C=>[...C,Vs()]),block:!0,style:{marginBottom:16},children:"Add Variable"}),e.jsx(M.Item,{name:"formula",label:e.jsx("span",{style:je,children:"Formula"}),rules:[{required:!0,message:"Formula is required"}],extra:e.jsx("span",{style:{color:"var(--text-muted)",fontSize:12},children:"Reference variables by name, e.g. closed_count / total_count * 100"}),children:e.jsx(G.TextArea,{rows:2,placeholder:"closed_count / total_count * 100",style:{fontFamily:"monospace"}})}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("div",{style:{...je,fontSize:12,color:"var(--text-muted)",marginBottom:6},children:"Operator Palette"}),e.jsxs(ee,{wrap:!0,size:[4,4],children:[Uu.map(C=>e.jsx(O,{size:"small",title:C.title,style:{fontFamily:"monospace",minWidth:36},onClick:()=>{const x=a.getFieldValue("formula")||"";a.setFieldsValue({formula:x+C.value})},children:C.label},C.value)),c.filter(C=>C.name).map(C=>e.jsx(O,{size:"small",type:"dashed",style:{fontFamily:"monospace",color:"var(--accent-strong)"},onClick:()=>{const x=a.getFieldValue("formula")||"";a.setFieldsValue({formula:x+C.name})},children:C.name},`var-${C.name}`))]})]}),e.jsx(gr,{titlePlacement:"left",style:{...je,fontSize:13},children:"Visualization"}),e.jsxs(ce,{gutter:16,children:[e.jsx(N,{span:8,children:e.jsx(M.Item,{name:"chart_type",label:e.jsx("span",{style:je,children:"Chart Type"}),initialValue:"stat",children:e.jsx(se,{options:Wu})})}),e.jsx(N,{span:16,children:e.jsx(M.Item,{name:"x_axis_field",label:e.jsx("span",{style:je,children:"X-Axis Field"}),children:e.jsx(G,{placeholder:"e.g. date, category, status"})})})]}),e.jsx("div",{style:{...je,fontSize:13,marginBottom:8},children:"Y-Axes"}),f.map((C,x)=>e.jsx(K,{size:"small",className:"ios-card",style:{marginBottom:12},extra:f.length>1&&e.jsx(O,{type:"text",size:"small",icon:e.jsx(xr,{}),danger:!0,onClick:()=>T(x)}),children:e.jsxs(ce,{gutter:12,children:[e.jsx(N,{span:7,children:e.jsx(G,{placeholder:"Variable ref",value:C.variable,onChange:P=>w(x,{variable:P.target.value})})}),e.jsx(N,{span:7,children:e.jsx(G,{placeholder:"Label",value:C.label,onChange:P=>w(x,{label:P.target.value})})}),e.jsx(N,{span:5,children:e.jsx(G,{placeholder:"#6366f1",value:C.color,onChange:P=>w(x,{color:P.target.value})})}),e.jsx(N,{span:5,children:e.jsx(se,{value:C.axis_id,onChange:P=>w(x,{axis_id:P}),options:Hu,style:{width:"100%"}})})]})},x)),e.jsx(O,{type:"dashed",icon:e.jsx(Qt,{}),onClick:()=>k(C=>[...C,Hs()]),block:!0,style:{marginBottom:16},children:"Add Y-Axis"}),e.jsx("div",{style:{...je,fontSize:13,marginBottom:8},children:"Thresholds (Reference Lines)"}),v.map((C,x)=>e.jsx(K,{size:"small",className:"ios-card",style:{marginBottom:8},children:e.jsxs(ce,{gutter:8,children:[e.jsx(N,{span:8,children:e.jsx(G,{type:"number",placeholder:"Value",value:C.value,onChange:P=>{const D=[...v];D[x]={...D[x],value:Number(P.target.value)},R(D)}})}),e.jsx(N,{span:8,children:e.jsx(G,{placeholder:"Label",value:C.label,onChange:P=>{const D=[...v];D[x]={...D[x],label:P.target.value},R(D)}})}),e.jsx(N,{span:5,children:e.jsx(G,{placeholder:"#ef4444",value:C.color,onChange:P=>{const D=[...v];D[x]={...D[x],color:P.target.value},R(D)}})}),e.jsx(N,{span:3,children:e.jsx(O,{type:"text",danger:!0,size:"small",icon:e.jsx(xr,{}),onClick:()=>R(v.filter((P,D)=>D!==x))})})]})},x)),e.jsx(O,{type:"dashed",size:"small",icon:e.jsx(Qt,{}),onClick:()=>R([...v,{value:0,label:"",color:"#ef4444"}]),style:{marginBottom:16},children:"Add Threshold"}),e.jsxs(ce,{gutter:16,style:{marginBottom:16},children:[e.jsx(N,{span:8,children:e.jsx(M.Item,{name:"format_suffix",label:e.jsx("span",{style:je,children:"Unit Suffix"}),children:e.jsx(G,{placeholder:"%, km, hours"})})}),e.jsx(N,{span:8,children:e.jsx(M.Item,{name:"format_precision",label:e.jsx("span",{style:je,children:"Precision"}),children:e.jsx(se,{options:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"}],placeholder:"Auto",allowClear:!0})})})]}),d&&e.jsxs(e.Fragment,{children:[e.jsx(gr,{titlePlacement:"left",style:{...je,fontSize:13},children:"Preview Result"}),e.jsx(K,{size:"small",className:"ios-card",children:d.error?e.jsx("span",{style:{color:"var(--danger)"},children:d.error}):e.jsxs("div",{children:[e.jsx("span",{style:{fontFamily:"var(--font-mono)",color:"var(--text-muted)",marginRight:8},children:"Value:"}),e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontWeight:700,fontSize:18,color:"var(--accent-strong)"},children:d.value!=null?d.value.toLocaleString():"â€”"}),d.groups&&d.groups.length>0&&e.jsxs("div",{style:{marginTop:8,fontSize:12,color:"var(--text-secondary)"},children:[d.groups.length," group(s) returned"]})]})})]})]})})}const{Text:_r}=ka,{Dragger:Gu}=zi,Ju={dashboards:[{dashboard_id:"demo-quality",name:"Quality Metrics",description:"Issue quality analysis dashboard",kpis:[{name:"Issues by Severity",data_source:"issue",variables:[{name:"count",source_entity:"issue",field:"issue_id",aggregation:"count"}],formula:"count",group_by:["severity"],vchart_spec:{type:"pie",categoryField:"severity",valueField:"value",legends:{visible:!0,orient:"right"},label:{visible:!0}}},{name:"Issues by Category (Bar)",data_source:"issue",variables:[{name:"total",source_entity:"issue",field:"issue_id",aggregation:"count"}],formula:"total",group_by:["category"],vchart_spec:{type:"bar",xField:"category",yField:"value",label:{visible:!0,position:"top"}}},{name:"Issue Status Distribution",data_source:"issue",variables:[{name:"cnt",source_entity:"issue",field:"issue_id",aggregation:"count"}],formula:"cnt",group_by:["status"],vchart_spec:{type:"rose",categoryField:"status",valueField:"value",legends:{visible:!0}}}]},{dashboard_id:"demo-fleet",name:"Fleet Analytics",kpis:[{name:"Mileage by Task Type",data_source:"run",variables:[{name:"mileage",source_entity:"run",field:"total_auto_mileage_km",aggregation:"sum"}],formula:"mileage",group_by:["status"],vchart_spec:{type:"bar",xField:"status",yField:"value",seriesField:"status",label:{visible:!0}}}]}]};function Yu({open:t,onClose:s,onImported:r}){const n=We(),[a,i]=h.useState(null),[l,o]=h.useState(null),[p,d]=h.useState(null),u=ye({mutationFn:j=>Hd(j),onSuccess:j=>{d(j),n.invalidateQueries({queryKey:["kpi-definitions"]}),te.success(`Imported ${j.summary.created} KPIs, updated ${j.summary.updated}`)},onError:j=>{te.error(j.message||"Import failed")}}),c=h.useCallback(j=>{o(null),i(null),d(null);const b=new FileReader;return b.onload=v=>{var R;try{const _=JSON.parse((R=v.target)==null?void 0:R.result);if(!_.dashboards||!Array.isArray(_.dashboards)){o('JSON must contain a "dashboards" array at the top level.');return}const S=_.dashboards.map(w=>({id:w.dashboard_id??"(unnamed)",name:w.name??"(unnamed)",kpiCount:Array.isArray(w.kpis)?w.kpis.length:0}));i({raw:_,dashboardCount:_.dashboards.length,totalKpis:S.reduce((w,T)=>w+T.kpiCount,0),dashboards:S})}catch{o("Invalid JSON file. Please check the syntax.")}},b.readAsText(j),!1},[]),g=()=>{const j=new Blob([JSON.stringify(Ju,null,2)],{type:"application/json"}),b=URL.createObjectURL(j),v=document.createElement("a");v.href=b,v.download="kpi-dashboard-example.json",v.click(),URL.revokeObjectURL(b)},f=()=>{i(null),o(null),d(null),s()},k=()=>{a!=null&&a.raw&&u.mutate(a.raw)};return e.jsxs(us,{open:t,title:e.jsxs(ee,{children:[e.jsx(Tc,{size:16,style:{color:"var(--accent)"}}),e.jsx("span",{className:"font-display",style:{fontWeight:600},children:"Import KPI Dashboards"})]}),onCancel:f,width:640,footer:p?e.jsx(O,{type:"primary",onClick:()=>{f(),r()},children:"Done"}):e.jsxs(ee,{children:[e.jsx(O,{onClick:f,children:"Cancel"}),e.jsxs(O,{type:"primary",onClick:k,disabled:!a||u.isPending,loading:u.isPending,children:["Import ",a?`(${a.totalKpis} KPIs)`:""]})]}),children:[!p&&e.jsxs(e.Fragment,{children:[e.jsx(Gu,{accept:".json",showUploadList:!1,beforeUpload:c,style:{background:"var(--bg-surface)",borderColor:"var(--border-primary)",borderStyle:"dashed",borderRadius:16},children:e.jsxs("div",{style:{padding:"20px 0"},children:[e.jsx(li,{size:32,style:{color:"var(--accent)",marginBottom:10}}),e.jsx("p",{style:{color:"var(--text-primary)",fontSize:12,marginBottom:4},children:"Drop JSON file here or click to browse"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:11},children:"Supports batch import of multiple dashboards with VChart specs"})]})}),e.jsx("div",{style:{marginTop:12,textAlign:"right"},children:e.jsx(O,{type:"link",size:"small",icon:e.jsx(Ic,{size:12}),onClick:g,style:{color:"var(--accent-strong)",fontSize:11},children:"Download sample JSON"})}),l&&e.jsx(Ut,{type:"error",showIcon:!0,icon:e.jsx(ri,{size:16}),message:l,style:{marginTop:12}}),a&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx(Ut,{type:"success",showIcon:!0,icon:e.jsx(ar,{size:16}),message:`Parsed ${a.dashboardCount} dashboard(s), ${a.totalKpis} KPI(s)`}),e.jsx(Ca,{ghost:!0,style:{marginTop:8},items:a.dashboards.map(j=>({key:j.id,label:e.jsxs(ee,{children:[e.jsx(_r,{style:{color:"var(--text-primary)"},children:j.name}),e.jsxs(B,{color:"cyan",children:[j.kpiCount," KPIs"]})]}),children:e.jsxs(_r,{style:{color:"var(--text-muted)",fontSize:11},children:["Dashboard ID: ",e.jsx("code",{children:j.id})]})}))})]})]}),p&&e.jsxs("div",{children:[e.jsx(Ut,{type:p.summary.failed>0?"warning":"success",showIcon:!0,icon:p.summary.failed>0?e.jsx(ii,{size:16}):e.jsx(ar,{size:16}),message:`Created: ${p.summary.created}, Updated: ${p.summary.updated}, Failed: ${p.summary.failed}`}),p.results.map(j=>e.jsxs("div",{style:{marginTop:12},children:[e.jsx(_r,{strong:!0,style:{color:"var(--text-primary)"},children:j.dashboard_id}),e.jsxs("div",{style:{marginLeft:12,marginTop:4},children:[j.created.length>0&&e.jsx("div",{children:j.created.map(b=>e.jsx(B,{color:"green",children:b},b))}),j.failed.length>0&&e.jsx("div",{style:{marginTop:4},children:j.failed.map((b,v)=>e.jsx(Ut,{type:"error",message:`${b.name}: ${b.error}`,style:{marginBottom:4,fontSize:12},banner:!0},v))})]})]},j.dashboard_id))]})]})}const Xu="modulepreload",Zu=function(t){return"/"+t},aa={},eh=function(s,r,n){let a=Promise.resolve();if(r&&r.length>0){let l=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),p=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=l(r.map(d=>{if(d=Zu(d),d in aa)return;aa[d]=!0;const u=d.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${c}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":Xu,u||(g.as="script"),g.crossOrigin="",g.href=d,p&&g.setAttribute("nonce",p),document.head.appendChild(g),u)return new Promise((f,k)=>{g.addEventListener("load",f),g.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(l){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=l,window.dispatchEvent(o),!o.defaultPrevented)throw l}return a.then(l=>{for(const o of l||[])o.status==="rejected"&&i(o.reason);return s().catch(i)})},yi=["#8b929a","#60a5fa","#34d399","#fbbf24","#f87171","#a78bfa","#fb923c","#22d3ee","#e879f9","#4ade80"],th={background:"transparent",colorScheme:{default:yi},series:{bar:{style:{fillOpacity:.85}},line:{style:{lineWidth:2}},area:{style:{fillOpacity:.2}},pie:{style:{stroke:"rgba(255,255,255,0.06)",lineWidth:1}}},component:{axis:{domainLine:{style:{stroke:"rgba(255,255,255,0.1)"}},grid:{style:{stroke:"rgba(255,255,255,0.05)",lineDash:[3,3]}},label:{style:{fill:"#505660",fontSize:10}},title:{style:{fill:"#8b929a",fontSize:11}}},legend:{item:{label:{style:{fill:"#8b929a",fontSize:10}}}},tooltip:{panel:{style:{background:"rgba(24,25,30,0.95)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0,0,0,0.3)"}},titleLabel:{style:{fill:"#e4e7eb",fontSize:11}},contentLabel:{style:{fill:"#8b929a",fontSize:10}},contentValue:{style:{fill:"#e4e7eb",fontSize:10}}}}};let St=null;const sh=async()=>St||(St=(await eh(()=>import("./index-B-futPCK.js"),__vite__mapDeps([0,1,2]))).default,St);function rh({spec:t,data:s,title:r,height:n=340,loading:a}){const i=h.useRef(null),l=h.useRef(null),[o,p]=h.useState(!!St);h.useEffect(()=>{St||sh().then(()=>p(!0))},[]);const d=h.useMemo(()=>{const u={...t};return s&&s.length>0&&(Array.isArray(u.data)?u.data=u.data.map((c,g)=>g===0?{...c,values:s}:c):u.data&&typeof u.data=="object"?u.data={...u.data,values:s}:u.data={id:"kpiData",values:s}),u.background="transparent",u.padding=u.padding??12,u.width=void 0,u.height=n,u.color||(u.color=yi),u.theme={...th},u},[t,s,n]);return h.useEffect(()=>{if(!i.current||!o||!St)return;if(l.current){l.current.updateSpec(d);return}const u=new St(d,{dom:i.current});return u.renderSync(),l.current=u,()=>{u.release(),l.current=null}},[d,o]),a||!o?e.jsx(K,{className:"ios-card",children:e.jsx("div",{style:{display:"flex",justifyContent:"center",padding:40},children:e.jsx(Kt,{})})}):!t||!t.type?e.jsx(K,{className:"ios-card",children:e.jsx(ne,{description:"Invalid VChart spec"})}):e.jsx(K,{className:"ios-card",title:r?e.jsx("span",{className:"font-display",style:{fontWeight:600},children:r}):void 0,children:e.jsx("div",{ref:i,style:{width:"100%",height:n}})})}const Dt={background:"#FFFFFF",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.08)",border:"none",padding:20};function ia(t){return t>=80?"#34C759":t>=50?"#FF9500":"#FF3B30"}function nh({projectId:t,startDate:s,endDate:r,interval:n}){const a={project_id:t,start_date:s||void 0,end_date:r||void 0},{data:i}=$({queryKey:["kpi-mpi",t,s,r],queryFn:()=>Ad(a),enabled:!!t}),{data:l}=$({queryKey:["kpi-mttr",t,s,r],queryFn:()=>zd(a),enabled:!!t}),{data:o}=$({queryKey:["kpi-rpr",t],queryFn:()=>Md({project_id:t}),enabled:!!t}),{data:p}=$({queryKey:["kpi-fleet",t,s,r],queryFn:()=>Nd(a),enabled:!!t}),{data:d}=$({queryKey:["kpi-convergence",t,s,r,n],queryFn:()=>Od({...a,interval:n}),enabled:!!t}),u=h.useMemo(()=>{var f;return((f=d==null?void 0:d.points)==null?void 0:f.map(k=>{var j,b;return{timestamp:k.timestamp,open:Number(((j=k.dimensions)==null?void 0:j.open_count)??k.value??0),closed:Number(((b=k.dimensions)==null?void 0:b.closed_count)??0)}}))??[]},[d]),c=[{title:"Miles Per Intervention",value:i==null?void 0:i.value,unit:"km"},{title:"Mean Time To Resolution",value:l==null?void 0:l.value,unit:"hours"}],g=[{title:"Regression Pass Rate",value:o==null?void 0:o.value,unit:"%"},{title:"Fleet Utilization",value:p==null?void 0:p.value,unit:"%"}];return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16,marginBottom:24},children:[c.map(f=>e.jsx("div",{className:"ios-card",style:Dt,children:e.jsx(Vt,{title:e.jsx("span",{style:{fontWeight:600,fontSize:11,textTransform:"uppercase",letterSpacing:"0.06em",color:"#8E8E93"},children:f.title}),value:f.value!=null?Number(f.value):void 0,precision:1,suffix:e.jsx("span",{style:{fontSize:12,color:"#8E8E93"},children:f.unit}),valueStyle:{fontFamily:"var(--font-mono)",fontWeight:700,color:"#76B900"}})},f.title)),g.map(f=>{const k=f.value!=null?Number(f.value):null;return e.jsxs("div",{className:"ios-card",style:Dt,children:[e.jsx("div",{style:{fontWeight:600,fontSize:11,color:"#8E8E93",marginBottom:6,textTransform:"uppercase",letterSpacing:"0.06em"},children:f.title}),e.jsxs("div",{style:{fontFamily:"var(--font-mono)",fontSize:28,fontWeight:700,color:k!=null?ia(k):"#1C1C1E",marginBottom:8},children:[k!=null?k.toFixed(1):"â€”",e.jsx("span",{style:{fontSize:12,color:"#8E8E93",marginLeft:4},children:f.unit})]}),e.jsx(Gr,{percent:k!=null?Math.min(100,Math.max(0,k)):0,showInfo:!1,strokeColor:k!=null?ia(k):"#34C759",size:"small"})]},f.title)}),e.jsxs("div",{className:"ios-card",style:{...Dt,gridColumn:"span 2",minHeight:340},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,color:"#1C1C1E",marginBottom:16,textTransform:"uppercase",letterSpacing:"0.05em"},children:"Issue Convergence"}),u.length>0?e.jsx(Lt,{width:"100%",height:280,children:e.jsxs(Fa,{data:u,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"openGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#FF3B30",stopOpacity:.15}),e.jsx("stop",{offset:"100%",stopColor:"#FF3B30",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"closedGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#76B900",stopOpacity:.15}),e.jsx("stop",{offset:"100%",stopColor:"#76B900",stopOpacity:0})]})]}),e.jsx(hs,{strokeDasharray:"3 3",stroke:"rgba(0,0,0,0.06)"}),e.jsx(Ct,{dataKey:"timestamp",tick:{fontSize:10,fill:"#8E8E93"},tickFormatter:f=>new Date(f).toLocaleDateString(),stroke:"rgba(0,0,0,0.06)"}),e.jsx(Je,{tick:{fontSize:10,fill:"#8E8E93"},stroke:"rgba(0,0,0,0.06)"}),e.jsx(ze,{labelFormatter:f=>new Date(f).toLocaleDateString(),contentStyle:{background:"#FFFFFF",border:"1px solid rgba(0,0,0,0.08)",borderRadius:12,color:"#1C1C1E",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),e.jsx(ot,{}),e.jsx(Fr,{type:"monotone",dataKey:"open",stroke:"#FF3B30",fill:"url(#openGrad)",name:"Open",strokeWidth:2}),e.jsx(Fr,{type:"monotone",dataKey:"closed",stroke:"#76B900",fill:"url(#closedGrad)",name:"Closed",strokeWidth:2})]})}):e.jsx(ne,{description:"No convergence data available"})]})]})}function ah({def:t,projectId:s}){var o,p,d,u,c,g,f;const r={};s&&(r.project_id=s);const{data:n,isLoading:a}=$({queryKey:["kpi-custom",t.kpi_id,s],queryFn:()=>Ud(t.kpi_id,r),enabled:t.enabled}),i=t.renderer==="vchart"&&t.vchart_spec,l=((o=t.visualization)==null?void 0:o.chart_type)??"stat";if(i&&t.vchart_spec){const k=n!=null&&n.groups?n.groups.map(j=>({...j.group,value:j.value})):(n==null?void 0:n.value)!=null?[{value:n.value}]:[];return e.jsx(rh,{spec:t.vchart_spec,data:k,title:t.name,loading:a})}if(l==="stat")return e.jsx(ra,{title:t.name,value:(n==null?void 0:n.value)??null,loading:a});if(l==="table"&&(n!=null&&n.groups))return e.jsx(K,{className:"ios-card",style:Dt,title:e.jsx("span",{style:{fontWeight:600,color:"#1C1C1E"},children:t.name}),children:e.jsx($u,{groups:n.groups})});if(n!=null&&n.groups&&n.groups.length>0){const k=n.groups.map(R=>({...R.group,value:R.value})),j=((d=(p=t.visualization)==null?void 0:p.x_axis)==null?void 0:d.field)??Object.keys(((u=n.groups[0])==null?void 0:u.group)??{})[0]??"group",b=((g=(c=t.visualization)==null?void 0:c.y_axes)==null?void 0:g.map(R=>({key:R.variable??"value",label:R.label,color:R.color,axisId:R.axis_id})))??[{key:"value",label:t.name}],v=(f=t.visualization)==null?void 0:f.thresholds;return e.jsx(K,{className:"ios-card",style:Dt,title:e.jsx("span",{style:{fontWeight:600,color:"#1C1C1E"},children:t.name}),children:e.jsx(Bu,{chartType:l,data:k,xField:j,yFields:b,thresholds:v})})}return e.jsx(ra,{title:t.name,value:(n==null?void 0:n.value)??null,loading:a})}function ih(){const t=We(),[s,r]=h.useState(""),[n,a]=h.useState(""),[i,l]=h.useState(""),[o,p]=h.useState("day"),[d,u]=h.useState(!0),[c,g]=h.useState(!1),[f,k]=h.useState(!1),[j,b]=h.useState(),{data:v}=$({queryKey:["projects"],queryFn:()=>xs({})}),{data:R}=$({queryKey:["kpi-definitions"],queryFn:$d}),_=ye({mutationFn:w=>Wd(w),onSuccess:()=>t.invalidateQueries({queryKey:["kpi-definitions"]})}),S=h.useMemo(()=>{if(!R)return new Map;const w=new Map;for(const T of R.filter(y=>y.enabled)){const y=T.dashboard_id??"__ungrouped__",I=w.get(y)??[];I.push(T),w.set(y,I)}return w},[R]);return e.jsxs("div",{style:{background:"#F5F5F7",minHeight:"100vh"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24,flexWrap:"wrap",gap:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx(nr,{size:24,style:{color:"#76B900"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",style:{margin:0,color:"#1C1C1E"},children:"KPI Overview"}),e.jsx("p",{style:{margin:0,color:"#8E8E93",fontSize:13},children:"Key performance indicators for autonomous driving test campaigns"})]})]}),e.jsxs(ee,{wrap:!0,children:[e.jsx(se,{value:s||void 0,onChange:r,placeholder:"Select Project",style:{width:200},allowClear:!0,options:v==null?void 0:v.map(w=>({value:w.id,label:w.name}))}),e.jsx(Rs,{placeholder:"Start date",onChange:(w,T)=>a(typeof T=="string"?T:""),style:{width:140}}),e.jsx(Rs,{placeholder:"End date",onChange:(w,T)=>l(typeof T=="string"?T:""),style:{width:140}}),e.jsx(se,{value:o,onChange:w=>p(w),style:{width:110},options:[{value:"day",label:"Daily"},{value:"week",label:"Weekly"},{value:"month",label:"Monthly"}]})]})]}),e.jsx("div",{className:"ios-card",style:{...Dt,marginBottom:24},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,marginBottom:4,textTransform:"uppercase",letterSpacing:"0.06em",color:"#1C1C1E"},children:"Panel Configuration"}),e.jsxs(ee,{children:[e.jsx("span",{style:{color:"#8E8E93",fontSize:12},children:"Built-in metrics"}),e.jsx(_a,{size:"small",checked:d,onChange:u})]})]}),e.jsxs(ee,{children:[e.jsx(O,{icon:e.jsx(li,{size:14}),onClick:()=>k(!0),style:{borderColor:"#E5E5EA",color:"#76B900",borderRadius:8},children:"Import JSON"}),e.jsx(O,{type:"primary",icon:e.jsx(ai,{size:14}),onClick:()=>{b(void 0),g(!0)},style:{background:"#76B900",borderColor:"#76B900",borderRadius:8},children:"Add Custom KPI"})]})]})}),!s&&e.jsxs("div",{className:"ios-card",style:{...Dt,textAlign:"center",padding:"48px 20px"},children:[e.jsx(Uc,{size:48,style:{color:"#C7C7CC",marginBottom:16}}),e.jsx("p",{style:{color:"#8E8E93",fontSize:14,margin:0},children:"Select a project to view KPI metrics"})]}),s&&e.jsxs(e.Fragment,{children:[d&&e.jsx(nh,{projectId:s,startDate:n,endDate:i,interval:o}),S.size>0&&e.jsxs("div",{style:{marginTop:24},children:[e.jsx("div",{style:{fontWeight:600,fontSize:13,marginBottom:12,color:"#1C1C1E",textTransform:"uppercase",letterSpacing:"0.04em"},children:"Custom KPIs"}),Array.from(S.entries()).map(([w,T])=>{var C;const y=(C=T[0])==null?void 0:C.dashboard_name,I=w!=="__ungrouped__",E=e.jsx(ce,{gutter:[16,16],children:T.map(x=>{var D;const P=x.renderer==="vchart"||((D=x.visualization)==null?void 0:D.chart_type)!=="stat";return e.jsx(N,{xs:24,md:P?24:8,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(ah,{def:x,projectId:s}),e.jsxs("div",{style:{position:"absolute",top:8,right:8,display:"flex",gap:4},children:[e.jsx(O,{size:"small",type:"text",icon:e.jsx(ni,{size:12}),onClick:()=>{b(x),g(!0)},style:{color:"#8E8E93"}}),e.jsx(wr,{title:"Delete this KPI?",onConfirm:()=>_.mutate(x.kpi_id),okText:"Delete",cancelText:"Cancel",children:e.jsx(O,{size:"small",type:"text",danger:!0,icon:e.jsx(Ps,{size:12})})})]})]})},x.kpi_id)})});return I?e.jsx(Ca,{ghost:!0,defaultActiveKey:[w],style:{marginBottom:16},items:[{key:w,label:e.jsxs(ee,{children:[e.jsx("span",{style:{color:"#1C1C1E",fontWeight:600},children:y??w}),e.jsxs(B,{color:"cyan",children:[T.length," KPIs"]}),T.some(x=>x.renderer==="vchart")&&e.jsx(B,{color:"magenta",children:"VChart"})]}),children:E}]},w):e.jsx("div",{children:E},w)})]})]}),e.jsx(Qu,{open:c,onClose:()=>{g(!1),b(void 0)},onSaved:()=>{t.invalidateQueries({queryKey:["kpi-definitions"]}),g(!1),b(void 0)},editingDef:j}),e.jsx(Yu,{open:f,onClose:()=>k(!1),onImported:()=>t.invalidateQueries({queryKey:["kpi-definitions"]})})]})}const lh={requirement:"#007AFF",commit:"#AF52DE",build:"#FF9500",project:"#76B900",task:"#FFCC00",run:"#34C759",issue:"#FF3B30"},oh={requirement:"REQ",commit:"CMT",build:"BLD",project:"PRJ",task:"TSK",run:"RUN",issue:"ISS"};function ch({percentage:t,covered:s,total:r}){const n=t!=null?Number(t):0,a=120,i=10,l=(a-i)/2,o=2*Math.PI*l,p=o-n/100*o,d=n>=80?"#34C759":n>=50?"#FF9500":"#FF3B30";return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:32},children:[e.jsxs("div",{style:{position:"relative",width:a,height:a,flexShrink:0},children:[e.jsxs("svg",{width:a,height:a,style:{transform:"rotate(-90deg)"},children:[e.jsx("circle",{cx:a/2,cy:a/2,r:l,fill:"none",stroke:"var(--border-secondary)",strokeWidth:i}),e.jsx("circle",{cx:a/2,cy:a/2,r:l,fill:"none",stroke:d,strokeWidth:i,strokeDasharray:o,strokeDashoffset:p,strokeLinecap:"round",style:{transition:"stroke-dashoffset 0.6s ease"}})]}),e.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{style:{fontFamily:"var(--font-mono)",fontSize:24,fontWeight:700,color:"var(--text-primary)",lineHeight:1},children:t!=null?`${n.toFixed(0)}`:"â€”"}),e.jsx("span",{style:{fontSize:11,color:"var(--text-muted)",fontWeight:500},children:"%"})]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text-primary)",marginBottom:4},children:"Requirement Verification"}),e.jsxs("div",{style:{fontSize:13,color:"var(--text-secondary)",marginBottom:12},children:[s," of ",r," requirements verified"]}),e.jsx(Gr,{percent:n,showInfo:!1,strokeColor:d,size:"small",style:{maxWidth:280}}),e.jsxs("div",{style:{display:"flex",gap:16,marginTop:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:"#34C759"}}),e.jsxs("span",{style:{fontSize:12,color:"var(--text-muted)"},children:["Covered (",s,")"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:"var(--border-primary)"}}),e.jsxs("span",{style:{fontSize:12,color:"var(--text-muted)"},children:["Remaining (",r-s,")"]})]})]})]})]})}function dh({nodes:t,links:s}){return e.jsx("div",{style:{overflowX:"auto",padding:"16px 0"},children:e.jsx("div",{style:{display:"flex",alignItems:"flex-start",minWidth:"max-content"},children:t.map((r,n)=>{const a=r.type,i=lh[a]??"#6E6E73",l=oh[a]??"?",o=n<s.length?s[n]:null;return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:100,maxWidth:140},children:[e.jsx(Yr,{title:`${a}: ${r.id}`,children:e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:i,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:700,color:a==="task"?"#1D1D1F":"#fff",fontFamily:"var(--font-mono)",boxShadow:`0 2px 8px ${i}40`,cursor:"default",flexShrink:0},children:l})}),e.jsx(B,{style:{marginTop:8,fontSize:11,fontWeight:500,borderColor:`${i}30`,color:a==="task"?"#8B7500":i,background:`${i}10`,borderRadius:"var(--radius-full)",maxWidth:130,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a}),e.jsx("div",{style:{marginTop:4,fontSize:11,color:"var(--text-secondary)",fontFamily:"var(--font-mono)",maxWidth:130,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"center"},children:r.label||r.id})]}),n<t.length-1&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",alignSelf:"flex-start",paddingTop:18,minWidth:60},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx("div",{style:{flex:1,height:2,background:"var(--border-primary)"}}),e.jsx("div",{style:{width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:"6px solid var(--border-primary)"}})]}),o&&e.jsx("span",{style:{fontSize:10,color:"var(--text-muted)",marginTop:4,fontStyle:"italic",whiteSpace:"nowrap"},children:o.relationship})]})]},n)})})})}function uh(){const[t,s]=h.useState("forward"),[r,n]=h.useState(""),[a,i]=h.useState(""),{data:l,isLoading:o}=$({queryKey:["trace-forward",a],queryFn:()=>Td(a),enabled:t==="forward"&&!!a}),{data:p,isLoading:d}=$({queryKey:["trace-backward",a],queryFn:()=>Ed(a),enabled:t==="backward"&&!!a}),{data:u}=$({queryKey:["trace-coverage"],queryFn:()=>Pd()}),c=()=>{i(r.trim())},g=t==="forward"?l:p,f=t==="forward"?o:d,k=(g==null?void 0:g.links)??[];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:4},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:10,background:"rgba(118, 185, 0, 0.10)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ec,{size:20,style:{color:"#76B900"}})}),e.jsx("h1",{className:"page-title",children:"Traceability"})]}),e.jsx("p",{className:"page-subtitle",style:{marginBottom:24},children:"End-to-end links between requirements, tasks, runs, and issues for coverage and impact analysis."}),u&&e.jsx(K,{className:"ios-card-elevated",style:{marginBottom:24,border:"none"},children:e.jsx(ch,{percentage:u.percentage!=null?Number(u.percentage):null,covered:Number(u.covered??0),total:Number(u.total??0)})}),e.jsx(Sa,{activeKey:t,onChange:j=>{s(j),i(""),n("")},items:[{key:"forward",label:"Forward Trace"},{key:"backward",label:"Backward Trace"}],style:{marginBottom:16}}),e.jsxs(ee.Compact,{style:{width:"100%",maxWidth:500,marginBottom:24},children:[e.jsx(G,{value:r,onChange:j=>n(j.target.value),placeholder:t==="forward"?"Enter Requirement ID...":"Enter Issue ID...",onPressEnter:c,size:"large"}),e.jsx(O,{type:"primary",icon:e.jsx(cr,{}),onClick:c,disabled:!r.trim(),size:"large",style:{background:"#76B900",borderColor:"#76B900"},children:"Trace"})]}),f&&e.jsx(qs,{}),g&&g.nodes&&g.nodes.length>0&&e.jsx(K,{className:"ios-card",title:e.jsxs("span",{className:"font-display",style:{fontWeight:600},children:[t==="forward"?"Forward":"Backward"," Trace from"," ",e.jsx("code",{style:{color:"#76B900",background:"rgba(118,185,0,0.08)",padding:"2px 8px",borderRadius:6,fontSize:13},children:g.origin_id})]}),extra:e.jsxs(B,{style:{borderRadius:"var(--radius-full)",fontWeight:500},children:[g.nodes.length," nodes"]}),children:e.jsx(dh,{nodes:g.nodes,links:k})}),a&&!f&&g&&(!g.nodes||g.nodes.length===0)&&e.jsx(K,{className:"ios-card",children:e.jsx(ne,{description:`No trace results found for "${a}"`})})]})}const hh=["Rule-based classification","ML severity prediction","Auto-assignment to team","Historical pattern matching"],ph=[{label:"Severity",value:"P1 â€” Critical",color:"#FF3B30"},{label:"Category",value:"Perception > LiDAR",color:"#007AFF"},{label:"Assigned Team",value:"Sensor Fusion",color:"#AF52DE"},{label:"Confidence",value:"92%",color:"#34C759"}];function mh(){return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:4},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:10,background:"rgba(175, 82, 222, 0.10)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Xn,{size:20,style:{color:"#AF52DE"}})}),e.jsx("h1",{className:"page-title",children:"Auto-Triage"}),e.jsx("span",{style:{display:"inline-flex",alignItems:"center",gap:4,background:"rgba(175, 82, 222, 0.08)",color:"#AF52DE",fontSize:11,fontWeight:600,padding:"3px 10px",borderRadius:"var(--radius-full)",letterSpacing:"0.02em"},children:"Beta"})]}),e.jsx("p",{className:"page-subtitle",style:{marginBottom:24},children:"Intelligent automated issue classification and assignment powered by rule engine and ML models."}),e.jsxs(K,{className:"ios-card-elevated",style:{marginBottom:24,border:"none"},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text-primary)",marginBottom:12,display:"flex",alignItems:"center",gap:8},children:[e.jsx(kc,{size:16,style:{color:"#AF52DE"}}),"AI Issue Analysis"]}),e.jsx("textarea",{placeholder:"Describe an issue or paste error logs...",disabled:!0,style:{width:"100%",minHeight:120,padding:16,border:"1px solid var(--border-secondary)",borderRadius:"var(--radius-sm)",background:"var(--bg-deep)",color:"var(--text-muted)",fontSize:14,fontFamily:"var(--font-body)",resize:"vertical",outline:"none"}}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:12},children:e.jsx(Yr,{title:"Feature in development",children:e.jsxs("button",{className:"btn-primary-green",disabled:!0,style:{opacity:.5,cursor:"not-allowed",display:"flex",alignItems:"center",gap:6},children:[e.jsx(Xn,{size:14}),"Analyze"]})})}),e.jsxs("div",{style:{marginTop:20,padding:16,background:"var(--bg-deep)",borderRadius:"var(--radius-sm)",border:"1px dashed var(--border-primary)"},children:[e.jsx("div",{style:{fontSize:11,fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:12},children:"Analysis Preview"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))",gap:12},children:ph.map(t=>e.jsxs("div",{style:{background:"var(--bg-surface)",border:"1px solid var(--border-secondary)",borderRadius:"var(--radius-xs)",padding:"12px 14px"},children:[e.jsx("div",{style:{fontSize:10,fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.04em",marginBottom:4},children:t.label}),e.jsx("div",{style:{fontSize:14,fontWeight:600,color:t.color},children:t.value})]},t.label))}),e.jsx("div",{style:{textAlign:"center",marginTop:12,fontSize:12,color:"var(--text-muted)",fontStyle:"italic"},children:"Sample output â€” actual results will appear here once enabled"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:24},children:[e.jsxs(K,{className:"ios-card",style:{border:"none"},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text-primary)",marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[e.jsx(Fc,{size:16,style:{color:"#FF9500"}}),"Recent Analyses"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"32px 0",color:"var(--text-muted)"},children:[e.jsx(Ac,{size:36,style:{color:"var(--border-primary)",marginBottom:12}}),e.jsx("span",{style:{fontSize:13,fontWeight:500},children:"No analyses yet"}),e.jsx("span",{style:{fontSize:12,marginTop:4},children:"Past triage results will appear here"})]})]}),e.jsxs(K,{className:"ios-card",style:{border:"none"},children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text-primary)",marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[e.jsx(nr,{size:16,style:{color:"#34C759"}}),"Triage Accuracy"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"32px 0",color:"var(--text-muted)"},children:[e.jsx("div",{style:{width:48,height:48,borderRadius:12,background:"rgba(52, 199, 89, 0.06)",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:12},children:e.jsx(nr,{size:24,style:{color:"var(--border-primary)"}})}),e.jsx("span",{style:{fontSize:13,fontWeight:500},children:"Coming Soon"}),e.jsx("span",{style:{fontSize:12,marginTop:4},children:"Accuracy metrics available after first analyses"})]})]})]}),e.jsxs(K,{className:"ios-card",style:{border:"none"},children:[e.jsx("div",{style:{fontSize:11,fontWeight:600,color:"var(--text-muted)",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:16},children:"Planned Capabilities"}),e.jsx(ee,{direction:"vertical",size:12,style:{width:"100%"},children:hh.map(t=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx(ar,{size:16,style:{color:"var(--text-muted)",opacity:.4,flexShrink:0}}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:14},children:t})]},t))})]})]})}const Qs=["#6366f1","#22c55e","#f59e0b","#ef4444","#3b82f6","#ec4899","#14b8a6","#a855f7"],fh=(t,s)=>cs.divIcon({className:"",html:`<div style="width:20px;height:20px;border-radius:50%;background:${t};border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:bold;color:#fff">${s+1}</div>`,iconSize:[20,20],iconAnchor:[10,10]});function yh({onAdd:t}){return Yi({click(s){t(s.latlng.lat,s.latlng.lng)}}),null}function gh({routes:t,onChange:s,mode:r,startPoint:n}){const[a,i]=h.useState(!1),[l,o]=h.useState(-1),[p,d]=h.useState(!1),u=t.length>0&&t[0].waypoints.length>0?[t[0].waypoints[0].lat,t[0].waypoints[0].lng]:n?[n.lat,n.lng]:[31.23,121.47],c=r==="custom"||p,g=l>=0&&l<t.length?l:t.length>0?t.length-1:-1,f=h.useCallback((y,I)=>{if(!c)return;const E=[...t];if(E.length===0)E.push({route_id:`ROUTE-${Date.now().toString(36)}`,name:"Route 1",waypoints:[{lat:y,lng:I}]});else{const C=g>=0?g:E.length-1,x={...E[C],waypoints:[...E[C].waypoints,{lat:y,lng:I}]};delete x.road,E[C]=x}s(E)},[t,s,c,g]),k=(y,I)=>{const E=[...t],C={...E[y],waypoints:E[y].waypoints.filter((x,P)=>P!==I)};delete C.road,E[y]=C,s(E)},j=(y,I,E,C)=>{const x=[...t],P=[...x[y].waypoints];P[I]={lat:E,lng:C};const D={...x[y],waypoints:P};delete D.road,x[y]=D,s(x)},b=()=>{const y=t.length;s([...t,{route_id:`ROUTE-${Date.now().toString(36)}`,name:`Route ${y+1}`,waypoints:[]}]),o(y)},v=y=>{s(t.filter((I,E)=>E!==y)),l>=t.length-1&&o(Math.max(0,t.length-2))},R=async()=>{if(t.filter(I=>I.waypoints.length>=2).length===0){te.warning("Each route needs at least 2 waypoints to plan a road route");return}i(!0);try{const I=await au(t);s(I.routes),te.success(`${I.routes.length} route(s) snapped to real roads`)}catch(I){te.error(`Road planning failed: ${I.message}`)}finally{i(!1)}},_=()=>{d(!p),!p&&t.length>0&&o(t.length-1)},S=t.some(y=>y.road),w=t.reduce((y,I)=>{var E;return y+(((E=I.road)==null?void 0:E.total_distance_m)??0)},0),T=t.reduce((y,I)=>{var E;return y+(((E=I.road)==null?void 0:E.total_duration_s)??0)},0);return t.length===0&&r==="random"?e.jsx("div",{style:{marginTop:16},children:e.jsx(ne,{description:"Click 'Generate Routes' above to preview"})}):e.jsxs("div",{style:{marginTop:16},children:[e.jsx(Kt,{spinning:a,tip:"Snapping routes to real roads via OSRM...",children:e.jsx("div",{style:{height:400,marginBottom:12,position:"relative"},children:e.jsxs(Zr,{center:u,zoom:12,style:{height:"100%",width:"100%",borderRadius:8},children:[e.jsx(en,{url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:"Â© CartoDB"}),c&&e.jsx(yh,{onAdd:f}),t.map((y,I)=>{var D;const E=Qs[I%Qs.length],C=(D=y.road)==null?void 0:D.coordinates,x=C??y.waypoints,P=I===g;return e.jsxs("span",{children:[e.jsx(Is,{positions:x.map(Y=>[Y.lat,Y.lng]),pathOptions:{color:E,weight:C?4:3,opacity:P?.9:.4,dashArray:C?void 0:"8 4"}}),C&&y.waypoints.length>0&&e.jsx(Is,{positions:y.waypoints.map(Y=>[Y.lat,Y.lng]),pathOptions:{color:E,weight:1,opacity:.3,dashArray:"4 4"}}),y.waypoints.map((Y,le)=>e.jsx(tn,{position:[Y.lat,Y.lng],icon:fh(E,le),draggable:c,eventHandlers:{dragend:de=>{const dt=de.target.getLatLng();j(I,le,dt.lat,dt.lng)}},children:e.jsx(sn,{children:e.jsxs("div",{style:{fontSize:12,minWidth:180},children:[e.jsx("strong",{children:y.name||y.route_id})," â€” WP ",le+1,e.jsx("br",{}),e.jsxs(ee,{size:4,style:{marginTop:4},children:[e.jsx(we,{size:"small",style:{width:90},step:1e-4,value:Number(Y.lat.toFixed(5)),onChange:de=>de!=null&&j(I,le,de,Y.lng)}),e.jsx(we,{size:"small",style:{width:90},step:1e-4,value:Number(Y.lng.toFixed(5)),onChange:de=>de!=null&&j(I,le,Y.lat,de)})]}),c&&e.jsx("div",{style:{marginTop:4},children:e.jsx(O,{size:"small",type:"text",danger:!0,icon:e.jsx(Ps,{size:10}),onClick:()=>k(I,le),children:"Remove"})})]})})},`wp-${y.route_id}-${le}`)),x.length>0&&e.jsx(Rr,{center:[x[0].lat,x[0].lng],radius:7,pathOptions:{color:"#fff",fillColor:E,fillOpacity:1,weight:2},children:e.jsxs(er,{children:[y.name||y.route_id," (Start)"]})}),x.length>1&&e.jsx(Rr,{center:[x[x.length-1].lat,x[x.length-1].lng],radius:7,pathOptions:{color:"#fff",fillColor:"#ef4444",fillOpacity:1,weight:2},children:e.jsxs(er,{children:[y.name||y.route_id," (End)"]})})]},y.route_id)})]})})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8,flexWrap:"wrap",gap:8},children:[e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:12},children:[t.length," route(s) Â· ",c?"Click map to add waypoints Â· Drag to move":"View only",S&&e.jsxs("span",{style:{marginLeft:8},children:[e.jsx(Mi,{status:"success",text:"",style:{marginRight:4}}),"Road-planned Â· ",(w/1e3).toFixed(1)," km Â· ~",Math.round(T/60)," min"]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[t.length>0&&t.some(y=>y.waypoints.length>=2)&&e.jsx(O,{size:"small",type:S?"default":"primary",icon:e.jsx(Bc,{size:12}),loading:a,onClick:R,children:S?"Re-plan Roads":"Plan on Roads"}),r==="random"&&t.length>0&&e.jsx(O,{size:"small",type:p?"primary":"default",icon:p?e.jsx(Vc,{size:12}):e.jsx(ni,{size:12}),onClick:_,children:p?"Done Editing":"Edit Waypoints"}),c&&e.jsx(O,{size:"small",icon:e.jsx(Lc,{size:12}),onClick:b,children:"New Route"})]})]}),e.jsx(Tn,{size:"small",dataSource:t,renderItem:(y,I)=>{const E=I===g&&c;return e.jsx(Tn.Item,{style:{cursor:c?"pointer":void 0,background:E?"rgba(99,102,241,0.1)":void 0,borderRadius:4},onClick:()=>c&&o(I),actions:c?[e.jsx(O,{size:"small",type:"text",danger:!0,icon:e.jsx(Ps,{size:12}),onClick:C=>{C.stopPropagation(),v(I)}})]:void 0,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1},children:[e.jsx(B,{color:Qs[I%Qs.length],children:y.name||y.route_id}),e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:12},children:[y.waypoints.length," waypoints"]}),y.road&&e.jsxs(ka.Text,{type:"success",style:{fontSize:11},children:[(y.road.total_distance_m/1e3).toFixed(1)," km Â· ",y.road.coordinates.length," pts"]}),E&&e.jsx(B,{color:"processing",style:{fontSize:10},children:"Active"})]})})}})]})}function xh({vehicles:t,projects:s,tasks:r,assignments:n,onChange:a}){const i=(u,c)=>n.some(g=>g.vin===u&&g.task_id===c),l=(u,c,g)=>{i(u,c)?a(n.filter(f=>!(f.vin===u&&f.task_id===c))):a([...n,{vin:u,project_id:g,task_id:c}])},o=()=>{if(r.length===0)return;const u=r[0],c=s.find(g=>g.id===u.projectId);c&&a(t.map(g=>({vin:g.vin,project_id:c.id,task_id:u.id})))},p=()=>{const u=[];t.forEach((c,g)=>{const f=r[g%r.length],k=s.find(j=>j.id===f.projectId);k&&u.push({vin:c.vin,project_id:k.id,task_id:f.id})}),a(u)},d=[{title:"Vehicle",dataIndex:"vin",key:"vin",fixed:"left",width:180,render:u=>e.jsx("code",{style:{fontSize:11},children:u})},...r.map(u=>{const c=s.find(g=>g.id===u.projectId);return{title:e.jsxs("div",{style:{textAlign:"center",fontSize:11},children:[e.jsx("div",{children:e.jsx(B,{color:"blue",style:{fontSize:10},children:(c==null?void 0:c.name)??u.projectId})}),e.jsx("div",{children:u.title})]}),key:u.id,width:140,render:(g,f)=>e.jsx("div",{style:{textAlign:"center"},children:e.jsx(Ni,{checked:i(f.vin,u.id),onChange:()=>l(f.vin,u.id,u.projectId)})})}})];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:12},children:[n.length," assignment(s)"]}),e.jsxs(ee,{size:"small",children:[e.jsx(O,{size:"small",onClick:o,children:"All â†’ First Task"}),e.jsx(O,{size:"small",onClick:p,children:"Round Robin"})]})]}),e.jsx(xe,{size:"small",dataSource:t,columns:d,rowKey:"vin",pagination:!1,scroll:{x:"max-content"}})]})}const vh={Draft:{bg:"#F3F4F6",text:"#6B7280"},Running:{bg:"#ECFDF5",text:"#059669"},Paused:{bg:"#FEF3C7",text:"#D97706"},Completed:{bg:"#E8F0FE",text:"#1A73E8"},Aborted:{bg:"#FEE2E2",text:"#DC2626"}};function jh({status:t}){const s=vh[t]??{bg:"#F3F4F6",text:"#6B7280"};return e.jsx("span",{style:{display:"inline-block",padding:"2px 12px",borderRadius:9999,fontSize:"0.75rem",fontWeight:600,background:s.bg,color:s.text,lineHeight:"20px"},children:t})}const bh={Draft:"default",Running:"processing",Paused:"warning",Completed:"success",Aborted:"error"};function Sh(){var Cs;const t=_t(),s=We(),[r,n]=h.useState(!1),[a,i]=h.useState(0),[l]=M.useForm(),[o,p]=h.useState("grid"),[d,u]=h.useState("random"),[c,g]=h.useState("random"),[f,k]=h.useState(!0),[j,b]=h.useState([]),[v,R]=h.useState([]),[_,S]=h.useState([]),[w,T]=h.useState([]),[y,I]=h.useState([]),{data:E,isLoading:C}=$({queryKey:["simulations"],queryFn:()=>Qd()}),{data:x}=$({queryKey:["projects"],queryFn:()=>xs({})}),{data:P}=$({queryKey:["tasks"],queryFn:()=>Bs({})}),[D,Y]=h.useState(!1),le=ye({mutationFn:F=>Jd(F),onSuccess:async F=>{if(s.invalidateQueries({queryKey:["simulations"]}),n(!1),Ss(),D&&F.session_id)try{await Ur(F.session_id),s.invalidateQueries({queryKey:["simulations"]}),te.success("Simulation created & started")}catch{te.warning("Created but failed to start â€” start it manually")}else te.success("Simulation saved as draft");Y(!1)},onError:F=>{te.error(`Failed to create simulation: ${F.message}`),Y(!1)}}),de=ye({mutationFn:F=>Yd(F),onSuccess:()=>{s.invalidateQueries({queryKey:["simulations"]}),te.success("Deleted")}}),dt=ye({mutationFn:F=>Ur(F),onSuccess:()=>{s.invalidateQueries({queryKey:["simulations"]}),te.success("Simulation started")}}),js=ye({mutationFn:F=>nu(F),onSuccess:F=>b(F.vehicles)}),bs=ye({mutationFn:F=>ru(F),onSuccess:F=>{R(F.routes);const X=F.routes.some(Q=>Q.road);te.success(`${F.routes.length} route(s) generated${X?" with road planning":""}`)},onError:F=>te.error(`Route generation failed: ${F.message}`)});function Ss(){i(0),u("random"),g("random"),k(!0),b([]),R([]),S([]),T([]),I([]),l.resetFields()}function ks(){const F=l.getFieldsValue(!0),X={name:F.name||"New Simulation",fleet_config:{mode:d,vehicle_count:F.vehicle_count??5,vehicles:d==="custom"?j:void 0,vehicle_template:d==="random"?{vehicle_platform:F.platform,soc_architecture:F.soc,sensor_suite_version:F.sensor}:void 0},route_config:{mode:c,routes:v.length>0?v.map(Q=>({route_id:Q.route_id,name:Q.name,waypoints:Q.waypoints,road:Q.road?{total_distance_m:Q.road.total_distance_m,total_duration_s:Q.road.total_duration_s,coordinates:Q.road.coordinates??[],segments:Q.road.segments??[]}:void 0})):void 0,random_config:c==="random"?{start_point:{lat:F.start_lat??31.2304,lng:F.start_lng??121.4737},radius_km:F.radius_km??10,min_waypoints:F.min_waypoints??5,max_waypoints:F.max_waypoints??15}:void 0},report_config:{telemetry_interval_ms:(F.telemetry_interval??3)*1e3,issue_interval_range_ms:[(F.issue_min??30)*1e3,(F.issue_max??120)*1e3],status_change_interval_ms:(F.mode_switch??60)*1e3,speed_range_mps:[Math.round((F.speed_min??30)/3.6),Math.round((F.speed_max??120)/3.6)]},assignments:f?[]:_};le.mutate(X)}const wt=h.useMemo(()=>{const F=E??[];return{total:F.length,running:F.filter(X=>X.status==="Running").length,queued:F.filter(X=>X.status==="Draft"||X.status==="Paused").length,completed:F.filter(X=>X.status==="Completed").length}},[E]),U=[{label:"Total",value:wt.total,color:"#76B900"},{label:"Running",value:wt.running,color:"#34C759"},{label:"Queued / Draft",value:wt.queued,color:"#FF9500"},{label:"Completed",value:wt.completed,color:"#007AFF"}],ae=[{title:"Name",dataIndex:"name",key:"name",render:(F,X)=>e.jsx("a",{onClick:()=>t(`/simulation/${X.session_id}`),children:F})},{title:"Status",dataIndex:"status",key:"status",render:F=>e.jsx(B,{color:bh[F]||"default",children:F})},{title:"Vehicles",key:"vehicles",render:(F,X)=>{var Q,Le,fe;return((Q=X.fleet_config)==null?void 0:Q.vehicle_count)??((fe=(Le=X.fleet_config)==null?void 0:Le.vehicles)==null?void 0:fe.length)??0}},{title:"Telemetry Sent",key:"telemetry",render:(F,X)=>{var Q;return((Q=X.stats)==null?void 0:Q.telemetry_sent)??0}},{title:"Issues Sent",key:"issues",render:(F,X)=>{var Q;return((Q=X.stats)==null?void 0:Q.issues_sent)??0}},{title:"Mileage (km)",key:"mileage",render:(F,X)=>{var Q;return(((Q=X.stats)==null?void 0:Q.total_mileage_km)??0).toFixed(1)}},{title:"Actions",key:"actions",render:(F,X)=>e.jsxs(ee,{size:"small",children:[e.jsx(O,{size:"small",icon:e.jsx(Jn,{size:12}),onClick:()=>t(`/simulation/${X.session_id}`)}),X.status==="Draft"&&e.jsx(O,{size:"small",type:"primary",icon:e.jsx(ir,{size:12}),onClick:()=>dt.mutate(X.session_id)}),e.jsx(wr,{title:"Delete simulation?",onConfirm:()=>de.mutate(X.session_id),children:e.jsx(O,{size:"small",danger:!0,icon:e.jsx(Ps,{size:12})})})]})}],Fe=(P==null?void 0:P.filter(F=>w.includes(F.projectId)))??[];function Oe({session:F}){var Le,fe,bn,Sn,kn,Cn,_n,wn,Fn;const X=((Le=F.fleet_config)==null?void 0:Le.vehicle_count)??((bn=(fe=F.fleet_config)==null?void 0:fe.vehicles)==null?void 0:bn.length)??0,Q=((Sn=F.route_config)==null?void 0:Sn.mode)??"random";return e.jsxs("div",{className:"ios-card ios-card-interactive",style:{padding:20,height:"100%",cursor:"pointer",display:"flex",flexDirection:"column"},onClick:()=>t(`/simulation/${F.session_id}`),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:700,color:"var(--text-primary)",lineHeight:1.3,flex:1,marginRight:8},children:F.name}),e.jsx(jh,{status:F.status})]}),e.jsxs("div",{style:{fontSize:"0.8125rem",color:"var(--text-secondary)",marginBottom:16,lineHeight:1.8,flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(Rc,{size:13,style:{color:"var(--text-muted)"}}),e.jsxs("span",{children:[X," vehicle",X!==1?"s":""," (",(kn=F.fleet_config)==null?void 0:kn.mode,")"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(qc,{size:13,style:{color:"var(--text-muted)"}}),e.jsxs("span",{children:["Routes: ",Q,(Cn=F.route_config)!=null&&Cn.routes?` (${F.route_config.routes.length})`:""]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(nr,{size:13,style:{color:"var(--text-muted)"}}),e.jsxs("span",{children:[(((_n=F.stats)==null?void 0:_n.total_mileage_km)??0).toFixed(1)," km driven"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:12,fontSize:"0.75rem",color:"var(--text-muted)",marginBottom:14,flexWrap:"wrap"},children:[e.jsxs("span",{children:["Telemetry: ",((wn=F.stats)==null?void 0:wn.telemetry_sent)??0]}),e.jsxs("span",{children:["Issues: ",((Fn=F.stats)==null?void 0:Fn.issues_sent)??0]})]}),e.jsxs("div",{style:{display:"flex",gap:6,borderTop:"1px solid var(--border-secondary)",paddingTop:12},onClick:bi=>bi.stopPropagation(),children:[e.jsx(O,{size:"small",icon:e.jsx(Jn,{size:12}),onClick:()=>t(`/simulation/${F.session_id}`),children:"View"}),F.status==="Draft"&&e.jsx(O,{size:"small",type:"primary",icon:e.jsx(ir,{size:12}),onClick:()=>dt.mutate(F.session_id),children:"Start"}),e.jsx(wr,{title:"Delete simulation?",onConfirm:()=>de.mutate(F.session_id),children:e.jsx(O,{size:"small",danger:!0,icon:e.jsx(Ps,{size:12})})})]})]})}const Ye=[{title:"Fleet",content:e.jsxs("div",{children:[e.jsx(M.Item,{label:"Simulation Name",name:"name",rules:[{required:!0}],children:e.jsx(G,{placeholder:"My Fleet Simulation"})}),e.jsx(M.Item,{label:"Fleet Mode",children:e.jsxs(Wt.Group,{value:d,onChange:F=>u(F.target.value),children:[e.jsx(Wt.Button,{value:"random",children:"Random"}),e.jsx(Wt.Button,{value:"custom",children:"Custom"})]})}),d==="random"?e.jsxs(e.Fragment,{children:[e.jsx(M.Item,{label:"Vehicle Count",name:"vehicle_count",initialValue:5,children:e.jsx(vr,{min:1,max:100})}),e.jsxs(ce,{gutter:16,children:[e.jsx(N,{span:8,children:e.jsx(M.Item,{label:"Platform",name:"platform",children:e.jsx(G,{placeholder:"ORIN-X"})})}),e.jsx(N,{span:8,children:e.jsx(M.Item,{label:"SoC",name:"soc",children:e.jsx(G,{placeholder:"Orin-SoC-A"})})}),e.jsx(N,{span:8,children:e.jsx(M.Item,{label:"Sensor Suite",name:"sensor",children:e.jsx(G,{placeholder:"LiDAR-v4"})})})]}),e.jsx(O,{onClick:()=>js.mutate({count:l.getFieldValue("vehicle_count")??5,template:{vehicle_platform:l.getFieldValue("platform"),soc_architecture:l.getFieldValue("soc"),sensor_suite_version:l.getFieldValue("sensor")}}),loading:js.isPending,children:"Preview Fleet"}),j.length>0&&e.jsx(xe,{size:"small",dataSource:j,rowKey:"vin",columns:[{title:"VIN",dataIndex:"vin"},{title:"Platform",dataIndex:"vehicle_platform"},{title:"Model",dataIndex:"model_code"}],pagination:!1,style:{marginTop:12}})]}):e.jsx(xe,{size:"small",dataSource:j,rowKey:"vin",columns:[{title:"VIN",dataIndex:"vin",render:(F,X,Q)=>e.jsx(G,{size:"small",value:F,onChange:Le=>{const fe=[...j];fe[Q]={...fe[Q],vin:Le.target.value},b(fe)}})},{title:"Platform",dataIndex:"vehicle_platform",render:(F,X,Q)=>e.jsx(G,{size:"small",value:F,onChange:Le=>{const fe=[...j];fe[Q]={...fe[Q],vehicle_platform:Le.target.value},b(fe)}})},{title:"Model",dataIndex:"model_code",render:(F,X,Q)=>e.jsx(G,{size:"small",value:F,onChange:Le=>{const fe=[...j];fe[Q]={...fe[Q],model_code:Le.target.value},b(fe)}})}],pagination:!1,footer:()=>e.jsx(O,{size:"small",onClick:()=>b([...j,{vin:`SIM-${Date.now().toString(36)}`,plate_type:"temporary",model_code:"AD-SUV-01",vehicle_platform:"ORIN-X",sensor_suite_version:"LiDAR-v4",soc_architecture:"Orin-SoC-A"}]),children:"Add Vehicle"})})]})},{title:"Project/Task",content:e.jsxs("div",{children:[e.jsxs(M.Item,{label:"Use Default Project",children:[e.jsx(_a,{checked:f,onChange:k}),e.jsx("span",{style:{marginLeft:8,color:"var(--text-muted)",fontSize:12},children:"Auto-create a simulation-specific project and task"})]}),!f&&e.jsxs(e.Fragment,{children:[e.jsx(M.Item,{label:"Select Projects",children:e.jsx(se,{mode:"multiple",value:w,onChange:T,placeholder:"Select projects",options:(x==null?void 0:x.map(F=>({value:F.id,label:F.name})))??[],style:{width:"100%"}})}),e.jsx(M.Item,{label:"Select Tasks",children:e.jsx(se,{mode:"multiple",value:y,onChange:I,placeholder:"Select tasks",options:Fe.map(F=>({value:F.id,label:`${F.title} (${F.taskType??F.stage})`}))??[],style:{width:"100%"}})}),j.length>0&&y.length>0&&e.jsx(xh,{vehicles:j,projects:(x==null?void 0:x.filter(F=>w.includes(F.id)))??[],tasks:Fe.filter(F=>y.includes(F.id)),assignments:_,onChange:S})]})]})},{title:"Routes",content:e.jsxs("div",{children:[e.jsx(M.Item,{label:"Route Mode",children:e.jsxs(Wt.Group,{value:c,onChange:F=>g(F.target.value),children:[e.jsx(Wt.Button,{value:"random",children:"Random"}),e.jsx(Wt.Button,{value:"custom",children:"Custom"})]})}),c==="random"?e.jsxs(e.Fragment,{children:[e.jsxs(ce,{gutter:16,children:[e.jsx(N,{span:6,children:e.jsx(M.Item,{label:"Start Lat",name:"start_lat",initialValue:31.2304,children:e.jsx(we,{style:{width:"100%"},step:.001})})}),e.jsx(N,{span:6,children:e.jsx(M.Item,{label:"Start Lng",name:"start_lng",initialValue:121.4737,children:e.jsx(we,{style:{width:"100%"},step:.001})})}),e.jsx(N,{span:6,children:e.jsx(M.Item,{label:"Target Distance (km)",name:"target_distance_km",initialValue:500,tooltip:"Total road distance target. Set 0 to use radius mode.",children:e.jsx(we,{min:0,max:2e3,style:{width:"100%"}})})}),e.jsx(N,{span:6,children:e.jsx(M.Item,{label:"Radius (km)",name:"radius_km",initialValue:10,tooltip:"Only used when Target Distance is 0",children:e.jsx(we,{min:1,max:500,style:{width:"100%"}})})})]}),e.jsxs(ce,{gutter:16,children:[e.jsx(N,{span:12,children:e.jsx(M.Item,{label:"Min Waypoints",name:"min_waypoints",initialValue:3,children:e.jsx(we,{min:2,max:10,style:{width:"100%"}})})}),e.jsx(N,{span:12,children:e.jsx(M.Item,{label:"Max Waypoints",name:"max_waypoints",initialValue:8,children:e.jsx(we,{min:2,max:10,style:{width:"100%"}})})})]}),e.jsx(O,{onClick:()=>bs.mutate({start_point:{lat:l.getFieldValue("start_lat")??31.2304,lng:l.getFieldValue("start_lng")??121.4737},radius_km:l.getFieldValue("radius_km")??10,count:j.length||l.getFieldValue("vehicle_count")||5,min_waypoints:l.getFieldValue("min_waypoints")??3,max_waypoints:l.getFieldValue("max_waypoints")??8,target_distance_km:l.getFieldValue("target_distance_km")??500}),loading:bs.isPending,children:"Generate Routes"})]}):null,e.jsx(gh,{routes:v,onChange:R,mode:c,startPoint:c==="random"?{lat:l.getFieldValue("start_lat")??31.2304,lng:l.getFieldValue("start_lng")??121.4737}:void 0})]})},{title:"Reporting",content:e.jsxs("div",{children:[e.jsx(M.Item,{label:"Telemetry Interval (seconds)",name:"telemetry_interval",initialValue:3,children:e.jsx(vr,{min:1,max:30})}),e.jsxs(ce,{gutter:16,children:[e.jsx(N,{span:12,children:e.jsx(M.Item,{label:"Issue Min Interval (sec)",name:"issue_min",initialValue:30,children:e.jsx(we,{min:5,max:600,style:{width:"100%"}})})}),e.jsx(N,{span:12,children:e.jsx(M.Item,{label:"Issue Max Interval (sec)",name:"issue_max",initialValue:120,children:e.jsx(we,{min:10,max:600,style:{width:"100%"}})})})]}),e.jsx(M.Item,{label:"Driving Mode Switch Interval (sec)",name:"mode_switch",initialValue:60,children:e.jsx(vr,{min:10,max:300})}),e.jsxs(ce,{gutter:16,children:[e.jsx(N,{span:12,children:e.jsx(M.Item,{label:"Min Speed (km/h)",name:"speed_min",initialValue:30,children:e.jsx(we,{min:5,max:200,style:{width:"100%"}})})}),e.jsx(N,{span:12,children:e.jsx(M.Item,{label:"Max Speed (km/h)",name:"speed_max",initialValue:120,children:e.jsx(we,{min:10,max:200,style:{width:"100%"}})})})]})]})},{title:"Review",content:e.jsx("div",{children:e.jsx("div",{className:"ios-card",style:{padding:20,marginBottom:16},children:e.jsxs(ce,{gutter:[16,8],children:[e.jsxs(N,{span:12,children:[e.jsx("strong",{children:"Name:"})," ",l.getFieldValue("name")||"New Simulation"]}),e.jsxs(N,{span:12,children:[e.jsx("strong",{children:"Fleet:"})," ",d==="random"?`${l.getFieldValue("vehicle_count")??5} random vehicles`:`${j.length} custom vehicles`]}),e.jsxs(N,{span:12,children:[e.jsx("strong",{children:"Routes:"})," ",c==="random"?"Auto-generated":`${v.length} custom routes`]}),e.jsxs(N,{span:12,children:[e.jsx("strong",{children:"Project:"})," ",f?"Auto-create":`${w.length} selected`]}),e.jsxs(N,{span:12,children:[e.jsx("strong",{children:"Telemetry:"})," every ",l.getFieldValue("telemetry_interval")??3,"s"]}),e.jsxs(N,{span:12,children:[e.jsx("strong",{children:"Speed:"})," ",l.getFieldValue("speed_min")??30," - ",l.getFieldValue("speed_max")??120," km/h"]})]})})})}];return e.jsxs("div",{children:[e.jsx(ct,{title:"Fleet Simulation",subtitle:"Simulate vehicle fleets for demo and stress testing",action:e.jsx(O,{className:"btn-primary-green",icon:e.jsx(ai,{size:14}),size:"large",onClick:()=>{Ss(),n(!0)},children:"New Simulation"})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16,marginBottom:20},children:U.map(F=>e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:F.label}),e.jsx("span",{className:"stat-card-value",style:{color:F.color},children:F.value})]},F.label))}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:16},children:e.jsx(Qr,{value:o,onChange:F=>p(F),options:[{value:"grid",icon:e.jsx(ja,{})},{value:"list",icon:e.jsx(ba,{})}]})}),o==="grid"?(!E||E.length===0)&&!C?e.jsx("div",{className:"ios-card",style:{padding:48,textAlign:"center"},children:e.jsx(ne,{image:e.jsx(Dc,{size:48,style:{color:"var(--text-muted)",opacity:.4}}),description:e.jsx("span",{style:{color:"var(--text-muted)"},children:"No simulations yet. Create your first simulation to get started."})})}):e.jsx(ce,{gutter:[16,16],children:(E??[]).map(F=>e.jsx(N,{xs:24,sm:12,lg:8,children:e.jsx(Oe,{session:F})},F.session_id))}):e.jsx("div",{className:"ios-card",style:{overflow:"hidden"},children:e.jsx(xe,{dataSource:E??[],columns:ae,rowKey:"session_id",loading:C,pagination:{pageSize:10},size:"middle"})}),e.jsxs(us,{open:r,onCancel:()=>n(!1),width:900,title:"Create Simulation",footer:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(O,{disabled:a===0,onClick:()=>i(a-1),children:"Previous"}),e.jsxs(ee,{children:[a<Ye.length-1&&e.jsx(O,{type:"primary",onClick:()=>i(a+1),children:"Next"}),a===Ye.length-1&&e.jsxs(e.Fragment,{children:[e.jsx(O,{onClick:()=>{Y(!1),ks()},loading:le.isPending&&!D,children:"Save as Draft"}),e.jsx(O,{type:"primary",onClick:()=>{Y(!0),ks()},loading:le.isPending&&D,children:"Create & Start"})]})]})]}),destroyOnClose:!0,children:[e.jsx(Oi,{current:a,items:Ye.map(F=>({title:F.title})),style:{marginBottom:24},size:"small"}),e.jsx(M,{form:l,layout:"vertical",children:(Cs=Ye[a])==null?void 0:Cs.content})]})]})}const kh={Draft:"default",Running:"processing",Paused:"warning",Completed:"success",Aborted:"error"},Ht=["#22c55e","#3b82f6","#f59e0b","#ef4444","#ec4899","#14b8a6","#a855f7","#6366f1"],Gs=["#6366f1","#22c55e","#f59e0b","#ef4444","#3b82f6","#ec4899","#14b8a6","#a855f7"];function la(t,s){return cs.divIcon({className:"",html:`<div style="width:22px;height:22px;display:flex;align-items:center;justify-content:center;transform:rotate(${s}deg)">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="${t}" stroke="#fff" stroke-width="1.5">
        <path d="M12 2L6 12l6 4 6-4z"/>
      </svg>
    </div>`,iconSize:[22,22],iconAnchor:[11,11]})}function Ch({vehicles:t}){const s=Xi(),r=h.useRef(new Map);return h.useEffect(()=>{const n=new Set;t.forEach((a,i)=>{if(!a.current)return;n.add(a.vin);const l=Ht[i%Ht.length],o=cs.latLng(a.current.lat,a.current.lng),p=a.current.heading_deg??0,d=r.current.get(a.vin);if(d)d.setLatLng(o),d.setIcon(la(l,p));else{const c=cs.marker(o,{icon:la(l,p)}).bindTooltip(`${a.vin}<br/>${(a.current.speed_mps*3.6).toFixed(0)} km/h Â· ${a.current.driving_mode}`,{direction:"top",offset:[0,-12]}).addTo(s);r.current.set(a.vin,c)}r.current.get(a.vin).setTooltipContent(`${a.vin}<br/>${(a.current.speed_mps*3.6).toFixed(0)} km/h Â· ${a.current.driving_mode}`)}),r.current.forEach((a,i)=>{n.has(i)||(a.remove(),r.current.delete(i))})},[t,s]),h.useEffect(()=>()=>{r.current.forEach(n=>n.remove()),r.current.clear()},[]),null}function _h(){var w,T,y,I,E,C,x,P,D,Y,le,de,dt,js,bs,Ss,ks,wt;const{id:t}=ys(),s=_t(),r=We(),{data:n,isLoading:a}=$({queryKey:["simulation",t],queryFn:()=>Gd(t),enabled:!!t,refetchInterval:U=>{const ae=U.state.data;return(ae==null?void 0:ae.status)==="Running"?5e3:!1}}),{data:i}=$({queryKey:["simulation-stats",t],queryFn:()=>tu(t),enabled:!!t&&(n==null?void 0:n.status)==="Running",refetchInterval:3e3}),l=(n==null?void 0:n.status)==="Running",o=(n==null?void 0:n.status)==="Completed",{data:p}=$({queryKey:["simulation-vehicles",t],queryFn:()=>su(t,50),enabled:!!t&&(l||o),refetchInterval:l?3e3:!1}),d=()=>{r.invalidateQueries({queryKey:["simulation",t]}),r.invalidateQueries({queryKey:["simulation-stats",t]}),r.invalidateQueries({queryKey:["simulation-vehicles",t]}),r.invalidateQueries({queryKey:["simulations"]})},u=ye({mutationFn:()=>Ur(t),onSuccess:()=>{d(),te.success("Started")}}),c=ye({mutationFn:()=>Xd(t),onSuccess:()=>{d(),te.success("Paused")}}),g=ye({mutationFn:()=>Zd(t),onSuccess:()=>{d(),te.success("Resumed")}}),f=ye({mutationFn:()=>eu(t),onSuccess:()=>{d(),te.success("Stopped")}});if(a||!n)return e.jsx(K,{className:"ios-card",loading:!0});const k=i??n.stats,j=((w=n.route_config)==null?void 0:w.routes)??[],b=(y=(T=n.route_config)==null?void 0:T.random_config)==null?void 0:y.start_point,v=p??[],R=(()=>{const U=v.find(ae=>ae.current);return U!=null&&U.current?[U.current.lat,U.current.lng]:j.length>0&&j[0].waypoints.length>0?[j[0].waypoints[0].lat,j[0].waypoints[0].lng]:b?[b.lat,b.lng]:[31.23,121.47]})(),_=U=>e.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:600,color:"var(--text-primary)"},children:U}),S={color:"var(--text-secondary)",fontWeight:500};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:24},children:[e.jsx(O,{type:"text",icon:e.jsx(bc,{size:18}),onClick:()=>s("/simulation")}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h1",{className:"page-title",style:{marginBottom:0},children:n.name}),e.jsxs(ee,{children:[e.jsx(B,{color:kh[n.status],children:n.status}),n.started_at&&e.jsxs("span",{style:{color:"var(--text-muted)",fontSize:12},children:["Started: ",new Date(n.started_at).toLocaleString()]})]})]}),e.jsxs(ee,{children:[(n.status==="Draft"||n.status==="Paused")&&e.jsx(O,{type:"primary",icon:e.jsx(ir,{size:14}),onClick:()=>n.status==="Draft"?u.mutate():g.mutate(),loading:u.isPending||g.isPending,style:{background:"#34C759",borderColor:"#34C759"},children:n.status==="Draft"?"Start":"Resume"}),n.status==="Running"&&e.jsxs(e.Fragment,{children:[e.jsx(O,{icon:e.jsx($c,{size:14}),onClick:()=>c.mutate(),loading:c.isPending,style:{color:"#FF9500",borderColor:"#FF9500"},children:"Pause"}),e.jsx(O,{danger:!0,icon:e.jsx(Wc,{size:14}),onClick:()=>f.mutate(),loading:f.isPending,style:{color:"#FF3B30",borderColor:"#FF3B30"},children:"Stop"})]})]})]}),e.jsxs(ce,{gutter:[16,16],style:{marginBottom:24},children:[e.jsx(N,{xs:24,sm:6,children:e.jsx(K,{className:"ios-card",children:e.jsx(Vt,{title:"Vehicles",value:((I=n.fleet_config)==null?void 0:I.vehicle_count)??((C=(E=n.fleet_config)==null?void 0:E.vehicles)==null?void 0:C.length)??0,valueStyle:{fontFamily:"var(--font-mono)",color:"var(--accent-strong)"}})})}),e.jsx(N,{xs:24,sm:6,children:e.jsx(K,{className:"ios-card",children:e.jsx(Vt,{title:"Telemetry Sent",value:(k==null?void 0:k.telemetry_sent)??0,valueStyle:{fontFamily:"var(--font-mono)",color:"var(--ios-green)"}})})}),e.jsx(N,{xs:24,sm:6,children:e.jsx(K,{className:"ios-card",children:e.jsx(Vt,{title:"Issues Reported",value:(k==null?void 0:k.issues_sent)??0,valueStyle:{fontFamily:"var(--font-mono)",color:"var(--ios-orange)"}})})}),e.jsx(N,{xs:24,sm:6,children:e.jsx(K,{className:"ios-card",children:e.jsx(Vt,{title:"Total Mileage",value:Number((k==null?void 0:k.total_mileage_km)??0).toFixed(1),suffix:"km",valueStyle:{fontFamily:"var(--font-mono)",color:"var(--brand-green)"}})})})]}),e.jsxs(ce,{gutter:[16,16],children:[e.jsx(N,{xs:24,lg:14,children:e.jsx(K,{className:"ios-card",title:_(l?"Live Vehicle Map":"Route Map"),style:{height:520},children:e.jsx("div",{style:{height:440},children:e.jsxs(Zr,{center:R,zoom:11,style:{height:"100%",width:"100%",borderRadius:8},children:[e.jsx(en,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:"Â© CartoDB"}),j.map((U,ae)=>{var Cs;const Fe=Gs[ae%Gs.length],Oe=(Cs=U.road)==null?void 0:Cs.coordinates,Ye=Oe??U.waypoints;return e.jsx(Is,{positions:Ye.map(F=>[F.lat,F.lng]),pathOptions:{color:Fe,weight:v.length>0?2:4,opacity:v.length>0?.25:.8,dashArray:Oe?void 0:"8 4"}},`route-${U.route_id}`)}),v.map((U,ae)=>{const Fe=Ht[ae%Ht.length];return U.trail.length<2?null:e.jsx(Is,{positions:U.trail.map(Oe=>[Oe.lat,Oe.lng]),pathOptions:{color:Fe,weight:4,opacity:.9}},`trail-${U.vin}`)}),v.length===0&&j.map((U,ae)=>{var Ye;const Fe=Gs[ae%Gs.length],Oe=((Ye=U.road)==null?void 0:Ye.coordinates)??U.waypoints;return e.jsx("span",{children:Oe.length>0&&e.jsx(Rr,{center:[Oe[0].lat,Oe[0].lng],radius:6,pathOptions:{color:"#fff",fillColor:Fe,fillOpacity:1,weight:2},children:e.jsxs(er,{children:[U.name||U.route_id," (Start)"]})})},`markers-${U.route_id}`)}),e.jsx(Ch,{vehicles:v})]})})})}),e.jsxs(N,{xs:24,lg:10,children:[e.jsx(K,{className:"ios-card",title:_("Configuration"),style:{marginBottom:16},children:e.jsxs(Z,{column:1,size:"small",labelStyle:S,children:[e.jsx(Z.Item,{label:"Fleet Mode",children:(x=n.fleet_config)==null?void 0:x.mode}),e.jsx(Z.Item,{label:"Route Mode",children:(P=n.route_config)==null?void 0:P.mode}),e.jsxs(Z.Item,{label:"Routes",children:[j.length," route(s)",j.some(U=>U.road)?" (road-planned)":""]}),j.some(U=>U.road)&&e.jsxs(Z.Item,{label:"Road Distance",children:[(j.reduce((U,ae)=>{var Fe;return U+(((Fe=ae.road)==null?void 0:Fe.total_distance_m)??0)},0)/1e3).toFixed(1)," km total"]}),e.jsxs(Z.Item,{label:"Telemetry Interval",children:[(((D=n.report_config)==null?void 0:D.telemetry_interval_ms)??3e3)/1e3,"s"]}),e.jsxs(Z.Item,{label:"Issue Interval",children:[(((le=(Y=n.report_config)==null?void 0:Y.issue_interval_range_ms)==null?void 0:le[0])??3e4)/1e3,"s - ",(((dt=(de=n.report_config)==null?void 0:de.issue_interval_range_ms)==null?void 0:dt[1])??12e4)/1e3,"s"]}),e.jsxs(Z.Item,{label:"Mode Switch",children:[(((js=n.report_config)==null?void 0:js.status_change_interval_ms)??6e4)/1e3,"s"]}),e.jsxs(Z.Item,{label:"Speed Range",children:[Math.round((((Ss=(bs=n.report_config)==null?void 0:bs.speed_range_mps)==null?void 0:Ss[0])??8)*3.6)," - ",Math.round((((wt=(ks=n.report_config)==null?void 0:ks.speed_range_mps)==null?void 0:wt[1])??33)*3.6)," km/h"]})]})}),v.length>0&&e.jsx(K,{className:"ios-card",title:_("Vehicle Status"),children:e.jsx(xe,{size:"small",dataSource:v,rowKey:"vin",pagination:!1,columns:[{title:"",width:12,render:(U,ae,Fe)=>e.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:Ht[Fe%Ht.length]}})},{title:"VIN",dataIndex:"vin",ellipsis:!0,render:U=>e.jsx("span",{style:{fontSize:11,fontFamily:"monospace"},children:U})},{title:"Speed",render:(U,ae)=>ae.current?`${(ae.current.speed_mps*3.6).toFixed(0)} km/h`:"-"},{title:"Mode",render:(U,ae)=>ae.current?e.jsx(B,{color:"blue",style:{fontSize:10},children:ae.current.driving_mode}):"-"},{title:"Trail",render:(U,ae)=>e.jsxs("span",{style:{fontSize:11,color:"var(--text-muted)"},children:[ae.trail.length," pts"]})}]})})]})]})]})}const wh="https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",Fh='&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>';function fr({center:t=[31.23,121.47],zoom:s=11,style:r={width:"100%",height:"100%",minHeight:400},children:n}){return e.jsxs(Zr,{center:t,zoom:s,style:r,scrollWheelZoom:!0,children:[e.jsx(en,{url:wh,attribution:Fh}),n]})}const Bt={Manual:"#8c8c8c",ACC:"#1890ff",LCC:"#52c41a",HighwayPilot:"#fa8c16",UrbanPilot:"#722ed1",Standby:"#595959",Autonomous:"#13c2c2"},gi={Blocker:"#f5222d",High:"#fa8c16",Medium:"#fadb14",Low:"#8c8c8c"};function xi(t){return Bt[t]??"#8c8c8c"}function Rh(t){return gi[t]??"#8c8c8c"}function Ih(t){const s=`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="${t}" stroke="#fff" stroke-width="2" opacity="0.9"/><circle cx="12" cy="12" r="4" fill="#fff"/></svg>`;return cs.divIcon({html:s,className:"",iconSize:[24,24],iconAnchor:[12,12]})}function vi({vin:t,lat:s,lng:r,drivingMode:n,speed:a,onClick:i}){const l=xi(n??"Manual");return e.jsx(tn,{position:[s,r],icon:Ih(l),eventHandlers:{click:i},children:e.jsx(sn,{children:e.jsxs("div",{style:{fontSize:12,lineHeight:1.6,color:"#fff",minWidth:120},children:[e.jsx("strong",{children:t}),e.jsx("br",{}),"Mode: ",n??"â€”",e.jsx("br",{}),"Speed: ",a!=null?`${a.toFixed(1)} m/s`:"â€”"]})})})}const Th="",Eh=`${Th}/api/sse/vehicles`,Ph={Offline:"#8E8E93",Idle:"#007AFF",Active:"#34C759",Maintenance:"#FF9500"},oa=["#76B900","#007AFF","#FF9500","#AF52DE","#FF3B30","#5AC8FA","#FFCC00","#8E8E93"];function Ah(){const t=_t(),[s,r]=h.useState(),[n,a]=h.useState(),[i,l]=h.useState(),[o,p]=h.useState(),{data:d,isLoading:u}=$({queryKey:["vehicles"],queryFn:()=>yn(),refetchInterval:15e3}),{data:c}=$({queryKey:["fleet-distribution"],queryFn:vd}),{data:g}=$({queryKey:["fleet-status-distribution"],queryFn:jd}),[f,k]=h.useState({}),j=h.useRef(null);h.useEffect(()=>{const y=new EventSource(Eh);return j.current=y,y.onmessage=I=>{try{const E=JSON.parse(I.data),C=E.vin;if(!C)return;k(x=>({...x,[C]:{currentLocation:E.current_location,currentSpeed:E.current_speed_mps,drivingMode:E.driving_mode,status:E.current_status}}))}catch{}},()=>{y.close()}},[]);const b=(d??[]).map(y=>{const I=f[y.vin];return I?{...y,...I}:y}),v=b.filter(y=>!(s&&y.plateType!==s||n&&y.modelCode!==n||i&&y.status!==i||o&&y.drivingMode!==o)),R=v.filter(y=>{var I,E;return((I=y.currentLocation)==null?void 0:I.lat)&&((E=y.currentLocation)==null?void 0:E.lng)}),_=h.useMemo(()=>{const y=b,I=y.filter(P=>P.status==="Active"||P.status==="Idle").length,E=y.filter(P=>P.status==="Maintenance").length,C=y.filter(P=>P.status==="Active").length,x=y.length>0?Math.round(C/y.length*100):0;return{total:y.length,online:I,issues:E,uptime:x}},[b]),S=[{label:"Total Vehicles",value:_.total,color:"#76B900"},{label:"Online",value:_.online,color:"#007AFF"},{label:"Issues",value:_.issues,color:"#FF9500"},{label:"Avg Uptime",value:`${_.uptime}%`,color:"#34C759"}],w=[{title:"VIN",dataIndex:"vin",key:"vin",width:180,render:y=>e.jsx(Me,{to:`/fleet/vehicles/${y}`,mono:!0,children:y})},{title:"Plate",dataIndex:"plateType",key:"plateType",width:100,render:y=>y?e.jsx(B,{children:y==="permanent"?"Perm":"Temp"}):"â€”"},{title:"Model",dataIndex:"modelCode",key:"modelCode",width:100,render:y=>y??"â€”"},{title:"Status",dataIndex:"status",key:"status",width:100,render:y=>e.jsx(B,{color:Ph[y]??"#8E8E93",children:y})},{title:"Mode",dataIndex:"drivingMode",key:"drivingMode",width:120,render:y=>y?e.jsx(B,{color:Bt[y],children:y}):"â€”"},{title:"Speed",dataIndex:"currentSpeed",key:"speed",width:100,render:y=>y!=null?`${y.toFixed(1)} m/s`:"â€”"},{title:"Platform",dataIndex:"platform",key:"platform",width:120,render:y=>y??"â€”"}],T=y=>{const I=Math.floor(y/36e5),E=Math.floor(y%36e5/6e4);return I>0?`${I}h ${E}m`:`${E}m`};return e.jsxs("div",{children:[e.jsx(ct,{title:"Fleet Dashboard",subtitle:`${b.length} vehicles`}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16,marginBottom:20},children:S.map(y=>e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-card-label",children:y.label}),e.jsx("span",{className:"stat-card-value",style:{color:y.color},children:y.value})]},y.label))}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(ee,{size:"small",wrap:!0,children:[e.jsx(se,{allowClear:!0,placeholder:"Plate",style:{width:110},value:s,onChange:r,options:[{value:"permanent",label:"Perm"},{value:"temporary",label:"Temp"}]}),e.jsx(se,{allowClear:!0,placeholder:"Model",style:{width:120},value:n,onChange:a,options:((c==null?void 0:c.model_code)??[]).map(y=>({value:y.name,label:y.name}))}),e.jsx(se,{allowClear:!0,placeholder:"Status",style:{width:120},value:i,onChange:l,options:["Offline","Idle","Active","Maintenance"].map(y=>({value:y,label:y}))}),e.jsx(se,{allowClear:!0,placeholder:"Mode",style:{width:130},value:o,onChange:p,options:Object.keys(Bt).map(y=>({value:y,label:y}))})]})}),e.jsxs("div",{className:"ios-card",style:{display:"flex",gap:0,overflow:"hidden",marginBottom:20},children:[e.jsxs("div",{style:{flex:"0 0 60%",borderRight:"1px solid var(--border-secondary)"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border-secondary)",fontWeight:600,fontSize:"0.9375rem",color:"var(--text-primary)"},children:"Live Map"}),e.jsx("div",{style:{height:460},children:e.jsx(fr,{children:R.map(y=>e.jsx(vi,{vin:y.vin,lat:y.currentLocation.lat,lng:y.currentLocation.lng,drivingMode:y.drivingMode,speed:y.currentSpeed,onClick:()=>t(`/fleet/vehicles/${y.vin}`)},y.vin))})})]}),e.jsxs("div",{style:{flex:"0 0 40%",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--border-secondary)",fontWeight:600,fontSize:"0.9375rem",color:"var(--text-primary)"},children:["Vehicles",e.jsx("span",{style:{fontWeight:400,fontSize:"0.8125rem",color:"var(--text-muted)",marginLeft:8},children:v.length})]}),e.jsx("div",{style:{flex:1,overflow:"auto"},children:e.jsx(xe,{dataSource:v,columns:w,rowKey:"vin",size:"small",loading:u,scroll:{y:410},pagination:!1,onRow:y=>({onClick:()=>t(`/fleet/vehicles/${y.vin}`),style:{cursor:"pointer"}})})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16},children:[e.jsxs("div",{className:"ios-card",style:{padding:20},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.9375rem",color:"var(--text-primary)",marginBottom:16},children:"Plate Type"}),e.jsx(Lt,{width:"100%",height:200,children:e.jsxs(dr,{children:[e.jsx(ur,{data:(c==null?void 0:c.plate_type)??[],dataKey:"count",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,label:({name:y,count:I})=>`${y}: ${I}`,children:((c==null?void 0:c.plate_type)??[]).map((y,I)=>e.jsx(os,{fill:oa[I%oa.length]},I))}),e.jsx(ze,{})]})})]}),e.jsxs("div",{className:"ios-card",style:{padding:20},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.9375rem",color:"var(--text-primary)",marginBottom:16},children:"Model Distribution"}),e.jsx(Lt,{width:"100%",height:200,children:e.jsxs(Zs,{data:(c==null?void 0:c.model_code)??[],children:[e.jsx(Ct,{dataKey:"name",tick:{fill:"var(--text-muted)",fontSize:11}}),e.jsx(Je,{tick:{fill:"var(--text-muted)",fontSize:11}}),e.jsx(ze,{}),e.jsx(ls,{dataKey:"count",fill:"#76B900",radius:[4,4,0,0]})]})})]}),e.jsxs("div",{className:"ios-card",style:{padding:20},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.9375rem",color:"var(--text-primary)",marginBottom:16},children:"Status Duration Distribution"}),e.jsx(Lt,{width:"100%",height:200,children:e.jsxs(Zs,{data:g??[],layout:"vertical",children:[e.jsx(Ct,{type:"number",tick:{fill:"var(--text-muted)",fontSize:11},tickFormatter:y=>T(y)}),e.jsx(Je,{dataKey:"driving_mode",type:"category",tick:{fill:"var(--text-muted)",fontSize:11},width:90}),e.jsx(ze,{formatter:y=>T(y)}),e.jsx(ls,{dataKey:"total_duration_ms",fill:"#34C759",radius:[0,4,4,0]})]})})]})]})]})}function zh(t){const s=t[0];if(!s)return[];const r=[];let n=s.driving_mode,a=[[s.location.lat,s.location.lng]],i=s.speed_mps,l=s.timestamp;for(let p=1;p<t.length;p++){const d=t[p],u=t[p-1];d.driving_mode!==n&&(r.push({mode:n,positions:[...a],startTime:l,endTime:u.timestamp,avgSpeed:i/a.length}),n=d.driving_mode,a=[[u.location.lat,u.location.lng]],i=0,l=d.timestamp),a.push([d.location.lat,d.location.lng]),i+=d.speed_mps}const o=t[t.length-1];return r.push({mode:n,positions:a,startTime:l,endTime:o.timestamp,avgSpeed:i/a.length}),r}function ji({points:t}){const s=zh(t);return e.jsx(e.Fragment,{children:s.map((r,n)=>e.jsx(Is,{positions:r.positions,pathOptions:{color:xi(r.mode),weight:3,opacity:.85},children:e.jsx(er,{sticky:!0,children:e.jsxs("div",{style:{fontSize:11,lineHeight:1.5},children:[e.jsx("strong",{children:r.mode}),e.jsx("br",{}),"Avg speed: ",r.avgSpeed.toFixed(1)," m/s",e.jsx("br",{}),r.startTime&&new Date(r.startTime).toLocaleTimeString()," â†’ ",r.endTime&&new Date(r.endTime).toLocaleTimeString()]})})},n))})}const Mh={Offline:"#8E8E93",Idle:"#007AFF",Active:"#34C759",Maintenance:"#FF9500"},Nh={Manual:"#8E8E93",ACC:"#007AFF",LCC:"#76B900",HighwayPilot:"#FF9500",UrbanPilot:"#AF52DE",Standby:"#636366",Autonomous:"#5AC8FA"};function Oh(){const{vin:t}=ys(),s=_t(),{data:r,isLoading:n}=$({queryKey:["vehicle",t],queryFn:()=>yd(t),enabled:!!t}),{data:a}=$({queryKey:["vehicle-status-dist",t],queryFn:()=>gd(t),enabled:!!t}),{data:i}=$({queryKey:["vehicle-trajectory",t],queryFn:()=>xd(t,{limit:"2000"}),enabled:!!t}),{data:l}=$({queryKey:["vehicle-runs",t],queryFn:()=>$s({vehicleVin:t}),enabled:!!t});if(n)return e.jsx("div",{style:{textAlign:"center",padding:80},children:e.jsx(Kt,{size:"large"})});if(!r)return e.jsx(ne,{description:"Vehicle not found"});const o=f=>{const k=Math.floor(f/36e5),j=Math.floor(f%36e5/6e4);return k>0?`${k}h ${j}m`:`${j}m`},p=(a??[]).map(f=>({name:f.driving_mode,value:f.total_duration_ms,mileage:f.total_mileage_km})),d=(l??[]).filter(f=>f.status==="Active"||f.status==="Scheduled"),u=f=>e.jsx("span",{style:{fontFamily:"var(--font-display)",fontWeight:600,color:"var(--text-primary)"},children:f}),c={color:"var(--text-secondary)",fontWeight:500},g={color:"var(--text-primary)"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsx(ct,{title:r.vin,subtitle:r.modelCode??r.platform??""}),e.jsxs(ce,{gutter:[16,16],children:[e.jsx(N,{xs:24,lg:12,children:e.jsx(K,{title:u("Vehicle Info"),size:"small",className:"ios-card",children:e.jsxs(Z,{column:2,size:"small",labelStyle:c,contentStyle:g,children:[e.jsx(Z.Item,{label:"VIN",children:r.vin}),e.jsx(Z.Item,{label:"Plate Type",children:r.plateType==="permanent"?"Perm":r.plateType==="temporary"?"Temp":"â€”"}),e.jsx(Z.Item,{label:"Model Code",children:r.modelCode??"â€”"}),e.jsx(Z.Item,{label:"Platform",children:r.platform??"â€”"}),e.jsx(Z.Item,{label:"SoC Arch",children:r.socArchitecture??"â€”"}),e.jsx(Z.Item,{label:"Sensor Suite",children:r.sensorSuiteVersion??"â€”"}),r.componentVersions&&Object.entries(r.componentVersions).map(([f,k])=>e.jsx(Z.Item,{label:f,children:k},f))]})})}),e.jsx(N,{xs:24,lg:12,children:e.jsx(K,{title:u("Real-time Status"),size:"small",className:"ios-card",children:e.jsxs(Z,{column:2,size:"small",labelStyle:c,contentStyle:g,children:[e.jsx(Z.Item,{label:"Status",children:e.jsx(B,{color:Mh[r.status],children:r.status})}),e.jsx(Z.Item,{label:"Mode",children:r.drivingMode?e.jsx(B,{color:Bt[r.drivingMode],children:r.drivingMode}):"â€”"}),e.jsx(Z.Item,{label:"Speed",children:r.currentSpeed!=null?`${r.currentSpeed.toFixed(1)} m/s`:"â€”"}),e.jsx(Z.Item,{label:"Battery",children:r.fuelOrBatteryLevel!=null?`${r.fuelOrBatteryLevel}%`:"â€”"}),e.jsx(Z.Item,{label:"Location",span:2,children:r.currentLocation?`${r.currentLocation.lat.toFixed(5)}, ${r.currentLocation.lng.toFixed(5)}`:"â€”"}),e.jsx(Z.Item,{label:"Last Heartbeat",children:r.lastHeartbeat?new Date(r.lastHeartbeat).toLocaleString():"â€”"})]})})})]}),e.jsxs(ce,{gutter:[16,16],children:[e.jsx(N,{xs:24,lg:8,children:e.jsx(K,{title:u("Active Tasks"),size:"small",className:"ios-card",style:{height:320},children:d.length===0?e.jsx(ne,{description:"No active tasks",image:ne.PRESENTED_IMAGE_SIMPLE}):e.jsx(xe,{dataSource:d,columns:[{title:"Run",dataIndex:"id",key:"id",render:f=>e.jsxs("a",{onClick:()=>s(`/runs/${f}`),children:[f.slice(0,12),"â€¦"]})},{title:"Task",dataIndex:"taskId",key:"task",render:f=>e.jsxs("a",{onClick:()=>s(`/tasks/${f}`),children:[f.slice(0,12),"â€¦"]})},{title:"Status",dataIndex:"status",key:"status",render:f=>e.jsx(B,{color:f==="Active"?"#34C759":"#007AFF",children:f})}],rowKey:"id",size:"small",pagination:!1,scroll:{y:220}})})}),e.jsx(N,{xs:24,lg:8,children:e.jsx(K,{title:u("Driving Mode Distribution"),size:"small",className:"ios-card",style:{height:320},children:e.jsx(Lt,{width:"100%",height:260,children:e.jsxs(dr,{children:[e.jsx(ur,{data:p,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,label:({name:f})=>f,children:p.map((f,k)=>e.jsx(os,{fill:Nh[f.name]??Bt[f.name]??"#8E8E93"},k))}),e.jsx(ze,{formatter:f=>o(f)}),e.jsx(ot,{})]})})})}),e.jsx(N,{xs:24,lg:8,children:e.jsx(K,{title:u("Mode Mileage (km)"),size:"small",className:"ios-card",style:{height:320},children:e.jsx(xe,{dataSource:a??[],columns:[{title:"Mode",dataIndex:"driving_mode",key:"mode",render:f=>e.jsx(B,{color:Bt[f],children:f})},{title:"Duration",dataIndex:"total_duration_ms",key:"dur",render:f=>o(f)},{title:"Mileage",dataIndex:"total_mileage_km",key:"km",render:f=>`${f.toFixed(2)} km`}],rowKey:"driving_mode",size:"small",pagination:!1,scroll:{y:220}})})})]}),e.jsx(K,{title:u("Recent Trajectory"),size:"small",className:"ios-card",children:e.jsx("div",{style:{height:400},children:e.jsxs(fr,{center:r.currentLocation?[r.currentLocation.lat,r.currentLocation.lng]:void 0,zoom:13,children:[(i==null?void 0:i.data)&&e.jsx(ji,{points:i.data}),r.currentLocation&&e.jsx(vi,{vin:r.vin,lat:r.currentLocation.lat,lng:r.currentLocation.lng,drivingMode:r.drivingMode,speed:r.currentSpeed})]})})})]})}const{RangePicker:Lh}=Rs;function Dh(){const[t,s]=h.useState(),[r,n]=h.useState(),[a,i]=h.useState(),[l,o]=h.useState(),[p,d]=h.useState(null),[u,c]=h.useState(),{data:g}=$({queryKey:["projects"],queryFn:()=>xs()}),{data:f}=$({queryKey:["tasks",t],queryFn:()=>Bs(t?{projectId:t}:void 0)}),{data:k}=$({queryKey:["runs",r],queryFn:()=>$s(r?{taskId:r}:void 0)}),{data:j}=$({queryKey:["vehicles-list"],queryFn:()=>yn()}),{data:b,isLoading:v}=$({queryKey:["trajectory",u],queryFn:()=>bd(u),enabled:!!u}),R=()=>{const T={};l&&(T.vin=l),a?T.run_id=a:r?T.task_id=r:t&&(T.project_id=t),p&&(T.start_time=p[0].toISOString(),T.end_time=p[1].toISOString()),c(T)},_=(b==null?void 0:b.data)??[],S=_.length>0?_[Math.floor(_.length/2)]:void 0,w=S?[S.location.lat,S.location.lng]:void 0;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsx(ct,{title:"Trajectory Query",subtitle:"Vehicle trajectory by project/task/run/vin"}),e.jsx(K,{size:"small",className:"ios-card",children:e.jsxs(ee,{wrap:!0,size:"middle",children:[e.jsx(se,{allowClear:!0,placeholder:"Project",style:{width:180},value:t,onChange:T=>{s(T),n(void 0),i(void 0)},options:(g??[]).map(T=>({value:T.id,label:T.name})),showSearch:!0,optionFilterProp:"label"}),e.jsx(se,{allowClear:!0,placeholder:"Task",style:{width:180},value:r,onChange:T=>{n(T),i(void 0)},options:(f??[]).map(T=>({value:T.id,label:T.title})),showSearch:!0,optionFilterProp:"label"}),e.jsx(se,{allowClear:!0,placeholder:"Run",style:{width:180},value:a,onChange:i,options:(k??[]).map(T=>({value:T.id,label:T.id.slice(0,16)})),showSearch:!0}),e.jsx(se,{allowClear:!0,placeholder:"Vehicle",style:{width:180},value:l,onChange:o,options:(j??[]).map(T=>({value:T.vin,label:T.vin})),showSearch:!0,optionFilterProp:"label"}),e.jsx(Lh,{showTime:!0,value:p,onChange:T=>d(T)}),e.jsx(O,{type:"primary",onClick:R,loading:v,children:"Search"})]})}),e.jsx(K,{size:"small",className:"ios-card",bodyStyle:{padding:0,height:"calc(100vh - 280px)",minHeight:500},children:u?v?e.jsx("div",{style:{textAlign:"center",paddingTop:100},children:e.jsx(Kt,{size:"large"})}):_.length===0?e.jsx(ne,{description:"No trajectory points found",style:{paddingTop:100}}):e.jsx(fr,{center:w,zoom:13,style:{width:"100%",height:"100%"},children:e.jsx(ji,{points:_})}):e.jsx(ne,{description:"Set filters and click Search",style:{paddingTop:100}})}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[Object.entries(Bt).map(([T,y])=>e.jsx(B,{color:y,children:T},T)),b&&e.jsxs(B,{children:["Total: ",b.total," points"]})]})]})}function Bh(t){const s=`<svg xmlns="http://www.w3.org/2000/svg" width="20" height="28" viewBox="0 0 20 28"><path d="M10 0C4.5 0 0 4.5 0 10c0 7.5 10 18 10 18s10-10.5 10-18C20 4.5 15.5 0 10 0z" fill="${t}" stroke="#fff" stroke-width="1.5"/><circle cx="10" cy="10" r="4" fill="#fff"/></svg>`;return cs.divIcon({html:s,className:"",iconSize:[20,28],iconAnchor:[10,28],popupAnchor:[0,-28]})}function $h({issue:t}){var r,n;if(!((r=t.location)!=null&&r.lat)||!((n=t.location)!=null&&n.lng))return null;const s=Rh(t.severity);return e.jsx(tn,{position:[t.location.lat,t.location.lng],icon:Bh(s),children:e.jsx(sn,{children:e.jsxs("div",{style:{fontSize:12,lineHeight:1.6,color:"#fff",minWidth:160},children:[e.jsx("strong",{children:t.issue_id}),e.jsx("br",{}),"Category: ",t.category??"â€”",e.jsx("br",{}),"Severity: ",e.jsx("span",{style:{color:s},children:t.severity}),e.jsx("br",{}),t.description&&e.jsxs("span",{children:[t.description.slice(0,80),t.description.length>80?"â€¦":"",e.jsx("br",{})]}),t.triggered_at&&e.jsxs(e.Fragment,{children:["Time: ",new Date(t.triggered_at).toLocaleString(),e.jsx("br",{})]}),e.jsx("a",{href:`/issues/${t.issue_id}`,style:{color:"#1890ff"},children:"View Detail â†’"})]})})})}const{RangePicker:qh}=Rs;function Kh(){const[t,s]=h.useState(),[r,n]=h.useState(),[a,i]=h.useState(),[l,o]=h.useState(),[p,d]=h.useState(null),[u,c]=h.useState(),{data:g}=$({queryKey:["projects"],queryFn:()=>xs()}),{data:f}=$({queryKey:["tasks",t],queryFn:()=>Bs(t?{projectId:t}:void 0)}),{data:k}=$({queryKey:["runs",r],queryFn:()=>$s(r?{taskId:r}:void 0)}),{data:j}=$({queryKey:["vehicles-list-im"],queryFn:()=>yn()}),{data:b,isLoading:v}=$({queryKey:["issue-locations",u],queryFn:()=>Sd(u),enabled:!!u}),R=()=>{const y={};l&&(y.vin=l),a?y.run_id=a:r?y.task_id=r:t&&(y.project_id=t),p&&(y.start_time=p[0].toISOString(),y.end_time=p[1].toISOString()),c(y)},S=((b==null?void 0:b.data)??[]).filter(y=>{var I,E;return((I=y.location)==null?void 0:I.lat)&&((E=y.location)==null?void 0:E.lng)}),w=S[0],T=w!=null&&w.location?[w.location.lat,w.location.lng]:void 0;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsx(ct,{title:"Issue Map",subtitle:"Issue locations on map"}),e.jsx(K,{size:"small",className:"ios-card",children:e.jsxs(ee,{wrap:!0,size:"middle",children:[e.jsx(se,{allowClear:!0,placeholder:"Project",style:{width:180},value:t,onChange:y=>{s(y),n(void 0),i(void 0)},options:(g??[]).map(y=>({value:y.id,label:y.name})),showSearch:!0,optionFilterProp:"label"}),e.jsx(se,{allowClear:!0,placeholder:"Task",style:{width:180},value:r,onChange:y=>{n(y),i(void 0)},options:(f??[]).map(y=>({value:y.id,label:y.title})),showSearch:!0,optionFilterProp:"label"}),e.jsx(se,{allowClear:!0,placeholder:"Run",style:{width:180},value:a,onChange:i,options:(k??[]).map(y=>({value:y.id,label:y.id.slice(0,16)})),showSearch:!0}),e.jsx(se,{allowClear:!0,placeholder:"Vehicle",style:{width:180},value:l,onChange:o,options:(j??[]).map(y=>({value:y.vin,label:y.vin})),showSearch:!0,optionFilterProp:"label"}),e.jsx(qh,{showTime:!0,value:p,onChange:y=>d(y)}),e.jsx(O,{type:"primary",onClick:R,loading:v,children:"Search"})]})}),e.jsx(K,{size:"small",className:"ios-card",bodyStyle:{padding:0,height:"calc(100vh - 280px)",minHeight:500},children:u?v?e.jsx("div",{style:{textAlign:"center",paddingTop:100},children:e.jsx(Kt,{size:"large"})}):S.length===0?e.jsx(ne,{description:"No issues with location found",style:{paddingTop:100}}):e.jsx(fr,{center:T,zoom:12,style:{width:"100%",height:"100%"},children:S.map(y=>e.jsx($h,{issue:y},y.issue_id))}):e.jsx(ne,{description:"Set filters and click Search",style:{paddingTop:100}})}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[Object.entries(gi).map(([y,I])=>e.jsx(B,{color:I,children:y},y)),b&&e.jsxs(B,{children:["Total: ",b.total," issues, ",S.length," with GPS"]})]})]})}function Wh(){return e.jsx(to,{children:e.jsxs(ue,{element:e.jsx(sd,{}),children:[e.jsx(ue,{index:!0,element:e.jsx(Xl,{to:"/projects",replace:!0})}),e.jsx(ue,{path:"projects",element:e.jsx(cu,{})}),e.jsx(ue,{path:"projects/:id",element:e.jsx(hu,{})}),e.jsx(ue,{path:"tasks",element:e.jsx(yu,{})}),e.jsx(ue,{path:"tasks/:id",element:e.jsx(xu,{})}),e.jsx(ue,{path:"runs",element:e.jsx(ju,{})}),e.jsx(ue,{path:"runs/:id",element:e.jsx(bu,{})}),e.jsx(ue,{path:"issues",element:e.jsx(ku,{})}),e.jsx(ue,{path:"issues/:id",element:e.jsx(Fu,{})}),e.jsx(ue,{path:"kpi",element:e.jsx(ih,{})}),e.jsx(ue,{path:"traceability",element:e.jsx(uh,{})}),e.jsx(ue,{path:"auto-triage",element:e.jsx(mh,{})}),e.jsx(ue,{path:"simulation",element:e.jsx(Sh,{})}),e.jsx(ue,{path:"simulation/:id",element:e.jsx(_h,{})}),e.jsx(ue,{path:"fleet",element:e.jsx(Ah,{})}),e.jsx(ue,{path:"fleet/vehicles/:vin",element:e.jsx(Oh,{})}),e.jsx(ue,{path:"fleet/trajectory",element:e.jsx(Dh,{})}),e.jsx(ue,{path:"fleet/issues-map",element:e.jsx(Kh,{})})]})})}const Uh=new ac({defaultOptions:{queries:{staleTime:3e4,retry:1,refetchOnWindowFocus:!1}}}),Vh={algorithm:Bi.defaultAlgorithm,token:{colorPrimary:"#76B900",colorInfo:"#007AFF",colorSuccess:"#34C759",colorWarning:"#FF9500",colorError:"#FF3B30",colorBgContainer:"#FFFFFF",colorBgElevated:"#FFFFFF",colorBgLayout:"#F5F5F7",colorBorder:"#D1D1D6",colorBorderSecondary:"#E5E5EA",colorText:"#1D1D1F",colorTextSecondary:"#6E6E73",colorTextTertiary:"#AEAEB2",colorTextQuaternary:"#C7C7CC",borderRadius:12,borderRadiusLG:16,borderRadiusSM:8,fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif",fontSize:14,controlHeight:36,wireframe:!1},components:{Layout:{headerBg:"#FFFFFF",siderBg:"#FFFFFF",bodyBg:"#F5F5F7",triggerBg:"#E5E5EA"},Menu:{itemBg:"transparent",subMenuItemBg:"transparent",itemSelectedBg:"rgba(118, 185, 0, 0.08)",itemHoverBg:"#F0F0F2",itemColor:"#6E6E73",itemSelectedColor:"#76B900",itemBorderRadius:10,itemMarginInline:8,iconSize:16},Table:{headerBg:"#F5F5F7",headerColor:"#6E6E73",rowHoverBg:"#F0F0F2",borderColor:"#E5E5EA",cellPaddingBlock:12,cellPaddingInline:16},Card:{colorBgContainer:"#FFFFFF",colorBorderSecondary:"#E5E5EA"},Button:{primaryShadow:"0 2px 8px rgba(118, 185, 0, 0.20)",defaultBg:"#FFFFFF",defaultBorderColor:"#D1D1D6",borderRadius:12,borderRadiusLG:12},Input:{colorBgContainer:"#FFFFFF",activeBorderColor:"#76B900",hoverBorderColor:"#D1D1D6"},Select:{colorBgContainer:"#FFFFFF",optionSelectedBg:"rgba(118, 185, 0, 0.08)"},Tag:{borderRadiusSM:999},Descriptions:{colorSplit:"#E5E5EA",titleColor:"#6E6E73",contentColor:"#1D1D1F"},Timeline:{dotBorderWidth:2,tailColor:"#E5E5EA"},Breadcrumb:{separatorColor:"#AEAEB2",linkColor:"#6E6E73",linkHoverColor:"#1D1D1F",lastItemColor:"#1D1D1F"},Statistic:{titleFontSize:12,contentFontSize:28},Progress:{remainingColor:"#E5E5EA"},Tabs:{inkBarColor:"#76B900",itemSelectedColor:"#76B900",itemColor:"#6E6E73",itemHoverColor:"#1D1D1F"},Collapse:{headerBg:"#F5F5F7",contentBg:"#FFFFFF"},Modal:{contentBg:"#FFFFFF",headerBg:"#FFFFFF"}}};Li.createRoot(document.getElementById("root")).render(e.jsx(h.StrictMode,{children:e.jsx(wo,{children:e.jsx(ic,{client:Uh,children:e.jsx(Di,{theme:Vh,children:e.jsx($i,{children:e.jsx(du,{children:e.jsx(Wh,{})})})})})})}));
